/* Discount Ninja v4 - production */
//! Discount Ninja price rule engine
//! COPYRIGHT (c) 2017-2019 ALL RIGHTS RESERVED
//! See terms and conditions at https://support.discountninja.io/terms-and-conditions/conditions/terms-and-conditions
if(window.location.search.indexOf("frame_token")>-1&&window!==window.top)throw new Error("Limoni Apps DiscountNinja has detected it is running in the Shopify Admin theme editor. Aborting script.");function LimoniAppsLoadDependency(t,e){let n=document.createElement("script");return n.type="text/javascript",n.onload=n.onreadystatechange=e,n.src=t,document.body.appendChild(n)}!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bugsnag=t()}(function(){var t=function(t,e,n){for(var i=n,o=0,r=t.length;o<r;o++)i=e(i,t[o],o,t);return i},e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=function(t){return t<10?"0"+t:t},o=function(e,n){return t(e,function(t,e,i,o){return t.concat(n(e,i,o))},[])},r=t,a=function(e,n){return t(e,function(t,e,i,o){return n(e,i,o)?t.concat(e):t},[])},c=function(e,n){return t(e,function(t,e,i,o){return!0===t||e===n},!1)},s=function(t){return"[object Array]"===Object.prototype.toString.call(t)},u=function(){var t=new Date;return t.getUTCFullYear()+"-"+i(t.getUTCMonth()+1)+"-"+i(t.getUTCDate())+"T"+i(t.getUTCHours())+":"+i(t.getUTCMinutes())+":"+i(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},d={intRange:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=1/0),function(n){return"number"==typeof n&&parseInt(""+n,10)===n&&t<=n&&n<=e}},stringWithLength:function(t){return"string"==typeof t&&!!t.length}},l={},g=a,f=r,p=function(t){var i,o=[];for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&o.push(i);if(!e)return o;for(var r=0,a=n.length;r<a;r++)Object.prototype.hasOwnProperty.call(t,n[r])&&o.push(n[r]);return o},m=s,h=c,j=d.intRange,N=d.stringWithLength;function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}l.schema={apiKey:{defaultValue:function(){return null},message:"is required",validate:N},appVersion:{defaultValue:function(){return null},message:"should be a string",validate:function(t){return null===t||N(t)}},appType:{defaultValue:function(){return null},message:"should be a string",validate:function(t){return null===t||N(t)}},autoNotify:{defaultValue:function(){return!0},message:"should be true|false",validate:function(t){return!0===t||!1===t}},beforeSend:{defaultValue:function(){return[]},message:"should be a function or array of functions",validate:function(t){return"function"==typeof t||m(t)&&g(t,function(t){return"function"==typeof t}).length===t.length}},endpoints:{defaultValue:function(){return{notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}},message:"should be an object containing endpoint URLs { notify, sessions }. sessions is optional if autoCaptureSessions=false",validate:function(t,e){return t&&"object"==typeof t&&N(t.notify)&&(!1===e.autoCaptureSessions||N(t.sessions))&&0===g(p(t),function(t){return!h(["notify","sessions"],t)}).length}},autoCaptureSessions:{defaultValue:function(t,e){return void 0===e.endpoints||!!e.endpoints&&!!e.endpoints.sessions},message:"should be true|false",validate:function(t){return!0===t||!1===t}},notifyReleaseStages:{defaultValue:function(){return null},message:"should be an array of strings",validate:function(t){return null===t||m(t)&&g(t,function(t){return"string"==typeof t}).length===t.length}},releaseStage:{defaultValue:function(){return"production"},message:"should be a string",validate:function(t){return"string"==typeof t&&t.length}},maxBreadcrumbs:{defaultValue:function(){return 20},message:"should be a number â‰¤40",validate:function(t){return j(0,40)(t)}},autoBreadcrumbs:{defaultValue:function(){return!0},message:"should be true|false",validate:function(t){return"boolean"==typeof t}},user:{defaultValue:function(){return null},message:"(object) user should be an object",validate:function(t){return"object"==typeof t}},metaData:{defaultValue:function(){return null},message:"should be an object",validate:function(t){return"object"==typeof t}},logger:{defaultValue:function(){},message:"should be null or an object with methods { debug, info, warn, error }",validate:function(t){return!t||t&&f(["debug","info","warn","error"],function(e,n){return e&&"function"==typeof t[n]},!0)}},filters:{defaultValue:function(){return["password"]},message:"should be an array of strings|regexes",validate:function(t){return m(t)&&t.length===g(t,function(t){return"string"==typeof t||t&&"function"==typeof t.test}).length}}},l.mergeDefaults=function(t,e){if(!t||!e)throw new Error("opts and schema objects are required");return f(p(e),function(n,i){return n[i]=void 0!==t[i]?t[i]:e[i].defaultValue(t[i],t),n},{})},l.validate=function(t,e){if(!t||!e)throw new Error("opts and schema objects are required");var n=f(p(e),function(n,i){return e[i].validate(t[i],t)?n:n.concat({key:i,message:e[i].message,value:t[i]})},[]);return{valid:!n.length,errors:n}};var C=l.schema,S=o,_={releaseStage:{defaultValue:function(){return/^localhost(:\d+)?$/.test(window.location.host)?"development":"production"},message:"should be set",validate:d.stringWithLength},logger:y({},C.logger,{defaultValue:function(){return"undefined"!=typeof console&&"function"==typeof console.debug?L():void 0}})},L=function(){var t={},e=console.log;return S(["debug","info","warn","error"],function(n){var i=console[n];t[n]="function"==typeof i?i.bind(console,"[bugsnag]"):e.bind(console,"[bugsnag]")}),t},P=u,v=function(){function t(t,e,n,i){void 0===t&&(t="[anonymous]"),void 0===e&&(e={}),void 0===n&&(n="manual"),void 0===i&&(i=P()),this.type=n,this.name=t,this.metaData=e,this.timestamp=i}return t.prototype.toJSON=function(){return{type:this.type,name:this.name,timestamp:this.timestamp,metaData:this.metaData}},t}(),T=function(t){return t.app&&"string"==typeof t.app.releaseStage?t.app.releaseStage:t.config.releaseStage},D=function(t){switch(Object.prototype.toString.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return t instanceof Error}},b=function(t,e){return t.isIgnored()||!1===e},E={};!function(t,e){"use strict";"object"==typeof E?E=e():t.StackFrame=e()}(this,function(){"use strict";function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function n(t){return function(){return this[t]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],r=["fileName","functionName","source"],a=i.concat(o,r,["args"]);function c(t){if(t instanceof Object)for(var n=0;n<a.length;n++)t.hasOwnProperty(a[n])&&void 0!==t[a[n]]&&this["set"+e(a[n])](t[a[n]])}c.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof c)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new c(t)}},toString:function(){return(this.getFunctionName()||"{anonymous}")+"("+(this.getArgs()||[]).join(",")+")"+(this.getFileName()?"@"+this.getFileName():"")+(t(this.getLineNumber())?":"+this.getLineNumber():"")+(t(this.getColumnNumber())?":"+this.getColumnNumber():"")}};for(var s=0;s<i.length;s++)c.prototype["get"+e(i[s])]=n(i[s]),c.prototype["set"+e(i[s])]=function(t){return function(e){this[t]=Boolean(e)}}(i[s]);for(var u=0;u<o.length;u++)c.prototype["get"+e(o[u])]=n(o[u]),c.prototype["set"+e(o[u])]=function(e){return function(n){if(!t(n))throw new TypeError(e+" must be a Number");this[e]=Number(n)}}(o[u]);for(var d=0;d<r.length;d++)c.prototype["get"+e(r[d])]=n(r[d]),c.prototype["set"+e(r[d])]=function(t){return function(e){this[t]=String(e)}}(r[d]);return c});var k={};!function(t,e){"use strict";"object"==typeof k?k=e(E):t.ErrorStackParser=e(t.StackFrame)}(this,function(t){"use strict";var e=/(^|@)\S+\:\d+/,n=/^\s*at .*(\S+\:\d+|\(native\))/m,i=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(n))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(t){return!!t.match(n)},this).map(function(e){-1<e.indexOf("(eval ")&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var n=e.replace(/^\s+/,"").replace(/\(eval code/g,"("),i=n.match(/ (\((.+):(\d+):(\d+)\)$)/),o=(n=i?n.replace(i[0],""):n).split(/\s+/).slice(1),r=this.extractLocation(i?i[1]:o.pop()),a=o.join(" ")||void 0,c=-1<["eval","<anonymous>"].indexOf(r[0])?void 0:r[0];return new t({functionName:a,fileName:c,lineNumber:r[1],columnNumber:r[2],source:e})},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(t){return!t.match(i)},this).map(function(e){if(-1<e.indexOf(" > eval")&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new t({functionName:e});var n=/((.*".+"[^@]*)?[^@]*)(?:@)/,i=e.match(n),o=i&&i[1]?i[1]:void 0,r=this.extractLocation(e.replace(n,""));return new t({functionName:o,fileName:r[0],lineNumber:r[1],columnNumber:r[2],source:e})},this)},parseOpera:function(t){return!t.stacktrace||-1<t.message.indexOf("\n")&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),o=[],r=2,a=i.length;r<a;r+=2){var c=n.exec(i[r]);c&&o.push(new t({fileName:c[2],lineNumber:c[1],source:i[r]}))}return o},parseOpera10:function(e){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),o=[],r=0,a=i.length;r<a;r+=2){var c=n.exec(i[r]);c&&o.push(new t({functionName:c[3]||void 0,fileName:c[2],lineNumber:c[1],source:i[r]}))}return o},parseOpera11:function(n){return n.stack.split("\n").filter(function(t){return!!t.match(e)&&!t.match(/^Error created at/)},this).map(function(e){var n,i=e.split("@"),o=this.extractLocation(i.pop()),r=i.shift()||"",a=r.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;r.match(/\(([^\)]*)\)/)&&(n=r.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var c=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new t({functionName:a,args:c,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})},this)}}});var O=k,I=function(t){return!(!t||!t.stack&&!t.stacktrace&&!t["opera#sourceloc"]||"string"!=typeof(t.stack||t.stacktrace||t["opera#sourceloc"])||t.stack===t.name+": "+t.message)},w={};function A(){return(A=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}!function(t,e){"use strict";"object"==typeof w?w=e(E):t.StackGenerator=e(t.StackFrame)}(this,function(t){return{backtrace:function(e){var n=[],i=10;"object"==typeof e&&"number"==typeof e.maxStackSize&&(i=e.maxStackSize);for(var o=arguments.callee;o&&n.length<i&&o.arguments;){for(var r=new Array(o.arguments.length),a=0;a<r.length;++a)r[a]=o.arguments[a];/function(?:\s+([\w$]+))+\s*\(/.test(o.toString())?n.push(new t({functionName:RegExp.$1||void 0,args:r})):n.push(new t({args:r}));try{o=o.caller}catch(t){break}}return n}}});var F=r,R=a,x=function(){function t(t,e,n,i,o){void 0===n&&(n=[]),void 0===i&&(i=G()),this.__isBugsnagReport=!0,this._ignored=!1,this._handledState=i,this.app=void 0,this.apiKey=void 0,this.breadcrumbs=[],this.context=void 0,this.device=void 0,this.errorClass=H(t,"[no error class]"),this.errorMessage=H(e,"[no error message]"),this.groupingHash=void 0,this.metaData={},this.request=void 0,this.severity=this._handledState.severity,this.stacktrace=F(n,function(t,e){var n=B(e);try{return"{}"===JSON.stringify(n)?t:t.concat(n)}catch(e){return t}},[]),this.user=void 0,this.session=void 0,this.originalError=o}var e=t.prototype;return e.ignore=function(){this._ignored=!0},e.isIgnored=function(){return this._ignored},e.updateMetaData=function(t){var e,n;return t?null===(arguments.length<=1?void 0:arguments[1])?this.removeMetaData(t):null===(arguments.length<=2?void 0:arguments[2])?this.removeMetaData(t,arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):("object"==typeof(arguments.length<=1?void 0:arguments[1])&&(n=arguments.length<=1?void 0:arguments[1]),"string"==typeof(arguments.length<=1?void 0:arguments[1])&&((e={})[arguments.length<=1?void 0:arguments[1]]=arguments.length<=2?void 0:arguments[2],n=e),n&&(this.metaData[t]||(this.metaData[t]={}),this.metaData[t]=A({},this.metaData[t],n)),this):this},e.removeMetaData=function(t,e){return"string"!=typeof t||(e?this.metaData[t]&&delete this.metaData[t][e]:delete this.metaData[t]),this},e.toJSON=function(){return{payloadVersion:"4",exceptions:[{errorClass:this.errorClass,message:this.errorMessage,stacktrace:this.stacktrace,type:"browserjs"}],severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,breadcrumbs:this.breadcrumbs,context:this.context,user:this.user,metaData:this.metaData,groupingHash:this.groupingHash,request:this.request,session:this.session}},t}(),B=function(t){var e={file:t.fileName,method:M(t.functionName),lineNumber:t.lineNumber,columnNumber:t.columnNumber,code:void 0,inProject:void 0};return-1<e.lineNumber&&!e.file&&!e.method&&(e.file="global code"),e},M=function(t){return/^global code$/i.test(t)?"global code":t},G=function(){return{unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}},H=function(t,e){return"string"==typeof t&&t?t:e};x.getStacktrace=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),I(t))return O.parse(t).slice(e);try{throw t}catch(e){if(I(e))return O.parse(t).slice(1+n);try{return R(w.backtrace(),function(t){return-1===(t.functionName||"").indexOf("StackGenerator$$")}).slice(1+n)}catch(t){return[]}}},x.ensureReport=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),t.__isBugsnagReport)return t;try{var i=x.getStacktrace(t,e,1+n);return new x(t.name,t.message,i,void 0,t)}catch(e){return new x(t.name,t.message,[],void 0,t)}};var U=x,q=function(t,e){var n="000000000"+t;return n.substr(n.length-e)},V="object"==typeof window?window:self,Q=0;for(var $ in V)Object.hasOwnProperty.call(V,$)&&Q++;var W=navigator.mimeTypes?navigator.mimeTypes.length:0,K=q((W+navigator.userAgent.length).toString(36)+Q.toString(36),4),z=function(){return K},J=0,X=4,Y=36,Z=Math.pow(Y,X);function tt(){return q((Math.random()*Z<<0).toString(Y),X)}function et(){return"c"+(new Date).getTime().toString(Y)+q((J=J<Z?J:0,++J-1).toString(Y),X)+z()+(tt()+tt())}et.fingerprint=z;var nt=et,it=u,ot=function(){function t(){this.id=nt(),this.startedAt=it(),this._handled=0,this._unhandled=0}var e=t.prototype;return e.toJSON=function(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}},e.trackError=function(t){this[t._handledState.unhandled?"_unhandled":"_handled"]+=1},t}();function rt(){return(rt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var at=o,ct=c,st=s,ut=function(){function t(e){if(!(e&&e.name&&e.version&&e.url))throw new Error("`notifier` argument is required");this.notifier=e,this._configured=!1,this._opts={},this.config={},this._delivery={sendSession:function(){},sendReport:function(){}},this._logger={debug:function(){},info:function(){},warn:function(){},error:function(){}},this._plugins={},this._session=null,this.breadcrumbs=[],this.app={},this.context=void 0,this.device=void 0,this.metaData=void 0,this.request=void 0,this.user={},this.BugsnagClient=t,this.BugsnagReport=U,this.BugsnagBreadcrumb=v,this.BugsnagSession=ot;var n=this,i=this.notify;this.notify=function(){return i.apply(n,arguments)}}var e=t.prototype;return e.setOptions=function(t){this._opts=rt({},this._opts,t)},e.configure=function(t){void 0===t&&(t=l.schema);var e=l.mergeDefaults(this._opts,t),n=l.validate(e,t);if(1==!n.valid)throw new Error(gt(n.errors));return"function"==typeof e.beforeSend&&(e.beforeSend=[e.beforeSend]),e.appVersion&&(this.app.version=e.appVersion),e.appType&&(this.app.type=e.appType),e.metaData&&(this.metaData=e.metaData),e.user&&(this.user=e.user),e.logger&&this.logger(e.logger),this.config=rt({},this.config,e),this._configured=!0,this},e.use=function(t){if(!this._configured)throw new Error("client not configured");t.configSchema&&this.configure(t.configSchema);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var o=t.init.apply(t,[this].concat(n));return t.name&&(this._plugins["~"+t.name+"~"]=o),this},e.getPlugin=function(t){return this._plugins["~"+t+"~"]},e.delivery=function(t){return this._delivery=t(this),this},e.logger=function(t,e){return this._logger=t,this},e.sessionDelegate=function(t){return this._sessionDelegate=t,this},e.startSession=function(){return this._sessionDelegate?this._sessionDelegate.startSession(this):(this._logger.warn("No session implementation is installed"),this)},e.leaveBreadcrumb=function(t,e,n,i){if(!this._configured)throw new Error("client not configured");if(n="string"==typeof n?n:void 0,i="string"==typeof i?i:void 0,e="object"==typeof e&&null!==e?e:void 0,"string"==typeof(t=t||void 0)||e){var o=new v(t,e,n,i);return this.breadcrumbs.push(o),this.breadcrumbs.length>this.config.maxBreadcrumbs&&(this.breadcrumbs=this.breadcrumbs.slice(this.breadcrumbs.length-this.config.maxBreadcrumbs)),this}},e.notify=function(t,e,n){var i=this;if(void 0===e&&(e={}),void 0===n&&(n=function(){}),!this._configured)throw new Error("client not configured");var o=T(this),r=dt(t,e,this._logger),a=r.err,c=r.errorFramesToSkip,s=r._opts;s&&(e=s),"object"==typeof e&&null!==e||(e={});var u=U.ensureReport(a,c,2);if(u.app=rt({},{releaseStage:o},u.app,this.app),u.context=u.context||e.context||this.context||void 0,u.device=rt({},u.device,this.device,e.device),u.request=rt({},u.request,this.request,e.request),u.user=rt({},u.user,this.user,e.user),u.metaData=rt({},u.metaData,this.metaData,e.metaData),u.breadcrumbs=this.breadcrumbs.slice(0),this._session&&(this._session.trackError(u),u.session=this._session),void 0!==e.severity&&(u.severity=e.severity,u._handledState.severityReason={type:"userSpecifiedSeverity"}),st(this.config.notifyReleaseStages)&&!ct(this.config.notifyReleaseStages,o))return this._logger.warn("Report not sent due to releaseStage/notifyReleaseStages configuration"),n(null,u);var d,l,g,f,p,m,h,j,N=u.severity,y=[].concat(e.beforeSend).concat(this.config.beforeSend),C=function(t){i._logger.error("Error occurred in beforeSend callback, continuing anywayâ€¦"),i._logger.error(t)};h=u,j=C,l=function(t,e){if("function"!=typeof t)return e(null,!1);try{if(2!==t.length){var n=t(h);return n&&"function"==typeof n.then?n.then(function(t){return setTimeout(function(){return e(null,b(h,t))},0)},function(t){setTimeout(function(){return j(t),e(null,!1)})}):e(null,b(h,n))}t(h,function(t,n){if(t)return j(t),e(null,!1);e(null,b(h,n))})}catch(t){j(t),e(null,!1)}},g=function(t,e){if(t&&C(t),e)return i._logger.debug("Report not sent due to beforeSend callback"),n(null,u);i.config.autoBreadcrumbs&&i.leaveBreadcrumb(u.errorClass,{errorClass:u.errorClass,errorMessage:u.errorMessage,severity:u.severity},"error"),N!==u.severity&&(u._handledState.severityReason={type:"userCallbackSetSeverity"}),i._delivery.sendReport({apiKey:u.apiKey||i.config.apiKey,notifier:i.notifier,events:[u]},function(t){return n(t,u)})},f=(d=y).length,p=0,(m=function(){if(f<=p)return g(null,!1);l(d[p],function(t,e){return t?g(t,!1):!0===e?g(null,!0):(p++,void m())})})()},t}(),dt=function(t,e,n){var i,o,r=function(t){var e=ft(t);return n.warn("Usage error. "+e),new Error("Bugsnag usage error. "+e)},a=0;switch(typeof t){case"string":"string"==typeof e?(i=r("string/string"),o={metaData:{notifier:{notifyArgs:[t,e]}}}):(i=new Error(String(t)),a=3);break;case"number":case"boolean":i=new Error(String(t));break;case"function":i=r("function");break;case"object":null!==t&&(D(t)||t.__isBugsnagReport)?i=t:null!==t&&lt(t)?((i=new Error(t.message||t.errorMessage)).name=t.name||t.errorClass,a=3):i=r(null===t?"null":"unsupported object");break;default:i=r("nothing")}return{err:i,errorFramesToSkip:a,_opts:o}},lt=function(t){return!("string"!=typeof t.name&&"string"!=typeof t.errorClass||"string"!=typeof t.message&&"string"!=typeof t.errorMessage)},gt=function(t){return"Bugsnag configuration error\n"+at(t,function(t){return'"'+t.key+'" '+t.message+" \n    got "+pt(t.value)}).join("\n\n")},ft=function(t){return"notify() expected error/opts parameters, got "+t},pt=function(t){return"object"==typeof t?JSON.stringify(t):String(t)},mt=ut,ht=function(t,e,n,i){var o=i&&i.filterKeys?i.filterKeys:[],r=i&&i.filterPaths?i.filterPaths:[];return JSON.stringify(function(t,e,n){var i=[],o=0;return function t(r,a){function c(){return a.length>yt&&Nt<o}if(o++,a.length>jt)return Ct;if(c())return Ct;if(null===r||"object"!=typeof r)return r;if(function(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return!0;return!1}(i,r))return"[Circular]";if(i.push(r),"function"==typeof r.toJSON)try{o--;var s=t(r.toJSON(),a);return i.pop(),s}catch(t){return St(t)}var u,d;if((u=r)instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(u))){o--;var l=t({name:r.name,message:r.message},a);return i.pop(),l}if(d=r,"[object Array]"===Object.prototype.toString.call(d)){for(var g=[],f=0,p=r.length;f<p;f++){if(c()){g.push(Ct);break}g.push(t(r[f],a.concat("[]")))}return i.pop(),g}var m={};try{for(var h in r)if(Object.prototype.hasOwnProperty.call(r,h))if(_t(n,a.join("."))&&Lt(e,h))m[h]="[Filtered]";else{if(c()){m[h]=Ct;break}m[h]=t(Pt(r,h),a.concat(h))}}catch(t){}return i.pop(),m}(t,[])}(t,o,r),e,n)},jt=20,Nt=25e3,yt=8,Ct="...";function St(t){return"[Throws: "+(t?t.message:"?")+"]"}function _t(t,e){for(var n=0,i=t.length;n<i;n++)if(0===e.indexOf(t[n]))return!0;return!1}function Lt(t,e){for(var n=0,i=t.length;n<i;n++){if("string"==typeof t[n]&&t[n]===e)return!0;if(t[n]&&"function"==typeof t[n].test&&t[n].test(e))return!0}return!1}function Pt(t,e){try{return t[e]}catch(t){return St(t)}}var vt={},Tt=["events.[].app","events.[].metaData","events.[].user","events.[].breadcrumbs","events.[].request","events.[].device"],Dt=["device","app","user"];vt.report=function(t,e){var n=ht(t,null,null,{filterPaths:Tt,filterKeys:e});if(1e6<n.length&&(delete t.events[0].metaData,t.events[0].metaData={notifier:"WARNING!\nSerialized payload was "+n.length/1e6+"MB (limit = 1MB)\nmetaData was removed"},1e6<(n=ht(t,null,null,{filterPaths:Tt,filterKeys:e})).length))throw new Error("payload exceeded 1MB limit");return n},vt.session=function(t,e){var n=ht(t,null,null,{filterPaths:Dt,filterKeys:e});if(1e6<n.length)throw new Error("payload exceeded 1MB limit");return n};var bt,Et=this,kt=u;bt=function(t,e){return void 0===e&&(e=window),{sendReport:function(n,i){void 0===i&&(i=function(){});var o=Ot(t.config,"notify","4",e),r=new e.XDomainRequest;r.onload=function(){i(null)},r.open("POST",o),setTimeout(function(){try{r.send(vt.report(n,t.config.filters))}catch(e){t._logger.error(e),i(e)}},0)},sendSession:function(n,i){void 0===i&&(i=function(){});var o=Ot(t.config,"sessions","1",e),r=new e.XDomainRequest;r.onload=function(){i(null)},r.open("POST",o),setTimeout(function(){try{r.send(vt.session(n,t.config.filters))}catch(t){Et._logger.error(t),i(t)}},0)}}};var Ot=function(t,e,n,i){return It(t.endpoints[e],i.location.protocol)+"?apiKey="+encodeURIComponent(t.apiKey)+"&payloadVersion="+n+"&sentAt="+encodeURIComponent(kt())},It=bt._matchPageProtocol=function(t,e){return"http:"===e?t.replace(/^https:/,"http:"):t},wt=u,At=function(t,e){return void 0===e&&(e=window),{sendReport:function(n,i){void 0===i&&(i=function(){});try{var o=t.config.endpoints.notify,r=new e.XMLHttpRequest;r.onreadystatechange=function(){r.readyState===e.XMLHttpRequest.DONE&&i(null)},r.open("POST",o),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Bugsnag-Api-Key",n.apiKey||t.config.apiKey),r.setRequestHeader("Bugsnag-Payload-Version","4"),r.setRequestHeader("Bugsnag-Sent-At",wt()),r.send(vt.report(n,t.config.filters))}catch(e){t._logger.error(e)}},sendSession:function(n,i){void 0===i&&(i=function(){});try{var o=t.config.endpoints.sessions,r=new e.XMLHttpRequest;r.onreadystatechange=function(){r.readyState===e.XMLHttpRequest.DONE&&i(null)},r.open("POST",o),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Bugsnag-Api-Key",t.config.apiKey),r.setRequestHeader("Bugsnag-Payload-Version","1"),r.setRequestHeader("Bugsnag-Sent-At",wt()),r.send(vt.session(n,t.config.filters))}catch(e){t._logger.error(e)}}}},Ft={init:function(t,e){void 0===e&&(e=window),t.config.beforeSend.unshift(function(t){t.context||(t.context=e.location.pathname)})}};function Rt(){return(Rt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var xt=u,Bt={init:function(t,e){void 0===e&&(e=navigator);var n={locale:e.browserLanguage||e.systemLanguage||e.userLanguage||e.language,userAgent:e.userAgent};t.device=Rt({},n,t.device),t.config.beforeSend.unshift(function(t){t.device=Rt({},t.device,{time:xt()})})}};function Mt(){return(Mt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var Gt={init:function(t,e){void 0===e&&(e=window),t.config.beforeSend.unshift(function(t){t.request&&t.request.url||(t.request=Mt({},t.request,{url:e.location.href}))})}};function Ht(){return(Ht=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var Ut=s,qt=c,Vt={init:function(t){return t.sessionDelegate(Qt)}},Qt={startSession:function(t){var e=t;e._session=new t.BugsnagSession;var n=T(e);return Ut(e.config.notifyReleaseStages)&&!qt(e.config.notifyReleaseStages,n)?e._logger.warn("Session not sent due to releaseStage/notifyReleaseStages configuration"):e.config.endpoints.sessions?e._delivery.sendSession({notifier:e.notifier,device:e.device,app:Ht({},{releaseStage:n},e.app),sessions:[{id:e._session.id,startedAt:e._session.startedAt,user:e.user}]}):e._logger.warn("Session not sent due to missing endpoints.sessions configuration"),e}};function $t(){return($t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var Wt={init:function(t){t.config.collectUserIp||t.config.beforeSend.push(function(t){t.user&&void 0===t.user.id&&delete t.user.id,t.user=$t({id:"[NOT COLLECTED]"},t.user),t.request=$t({clientIp:"[NOT COLLECTED]"},t.request)})},configSchema:{collectUserIp:{defaultValue:function(){return!0},message:"should be true|false",validate:function(t){return!0===t||!1===t}}}},Kt={},zt=o,Jt=r,Xt=a;Kt.init=function(t){var e=/^dev(elopment)?$/.test(t.config.releaseStage),n=!1===t.config.consoleBreadcrumbsEnabled,i=(!1===t.config.autoBreadcrumbs||e)&&!0!==t.config.consoleBreadcrumbsEnabled;n||i||zt(Yt,function(e){var n=console[e];console[e]=function(){for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];t.leaveBreadcrumb("Console output",Jt(o,function(t,e,n){var i="[Unknown value]";try{i=String(e)}catch(t){}if("[object Object]"===i)try{i=JSON.stringify(e)}catch(t){}return t["["+n+"]"]=i,t},{severity:0===e.indexOf("group")?"log":e}),"log"),n.apply(console,o)},console[e]._restore=function(){console[e]=n}})},Kt.configSchema={consoleBreadcrumbsEnabled:{defaultValue:function(){},validate:function(t){return!0===t||!1===t||void 0===t},message:"should be true|false"}};var Yt=Xt(["log","debug","info","warn","error"],function(t){return"undefined"!=typeof console&&"function"==typeof console[t]}),Zt=o,te=r,ee=a,ne={init:function(t,e,n){if(void 0===e&&(e=document),void 0===n&&(n=window),t.config.trackInlineScripts){var i=n.location.href,o="",r=!1,a=function(){return e.documentElement.outerHTML};o=a();var c=e.onreadystatechange;e.onreadystatechange=function(){"interactive"===e.readyState&&(o=a(),r=!0);try{c.apply(this,arguments)}catch(t){}};var s=null,u=function(t){s=t},d=function(){var t=e.currentScript||s;if(!t&&!r){var n=e.scripts||e.getElementsByTagName("script");t=n[n.length-1]}return t};t.config.beforeSend.unshift(function(t){t.stacktrace=ee(t.stacktrace,function(t){return!/__trace__$/.test(t.method)});var e=t.stacktrace[0];if(!e||!e.file||e.file.replace(/#.*$/,"")===i.replace(/#.*$/,"")){var n=d();if(n){var c=n.innerHTML;t.updateMetaData("script","content",c.length<=5e5?c:c.substr(0,5e5))}e&&e.lineNumber&&(e.code=function(t){r&&o||(o=a());var e=["\x3c!-- DOC START --\x3e"].concat(o.split("\n")),n=t-1,i=Math.max(n-3,0),c=Math.min(n+3,e.length);return te(e.slice(i,c),function(t,e,n){return t[i+1+n]=e.length<=200?e:e.substr(0,200),t},{})}(e.lineNumber))}});var l=Zt(["setTimeout","setInterval","setImmediate","requestAnimationFrame"],function(t){return ie(n,t,function(t){return g(t,function(t){return{get:function(){return t[0]},replace:function(e){t[0]=e}}})})})[0];Zt(["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],function(t){n[t]&&n[t].prototype&&n[t].prototype.hasOwnProperty&&n[t].prototype.hasOwnProperty("addEventListener")&&(ie(n[t].prototype,"addEventListener",function(t){return g(t,oe)}),ie(n[t].prototype,"removeEventListener",function(t){return g(t,oe,!0)}))})}function g(t,e,n){return void 0===n&&(n=!1),function(){var i=Array.prototype.slice.call(arguments);try{var o=e(i),r=o.get();if(n&&t.apply(this,i),"function"!=typeof r)return t.apply(this,i);if(r.__trace__)o.replace(r.__trace__);else{var a=d();r.__trace__=function(){u(a),l(function(){u(null)},0);var t=r.apply(this,arguments);return u(null),t},r.__trace__.__trace__=r.__trace__,o.replace(r.__trace__)}}catch(t){}if(t.apply)return t.apply(this,i);switch(i.length){case 1:return t(i[0]);case 2:return t(i[0],i[1]);default:return t()}}}},configSchema:{trackInlineScripts:{validate:function(t){return!0===t||!1===t},defaultValue:function(){return!0},message:"should be true|false"}}};function ie(t,e,n){var i=t[e];if(!i)return i;var o=n(i);return t[e]=o,i}function oe(t){var e=!!t[1]&&"function"==typeof t[1].handleEvent;return{get:function(){return e?t[1].handleEvent:t[1]},replace:function(n){e?t[1].handleEvent=n:t[1]=n}}}var re,ae,ce,se={init:function(t,e){if(void 0===e&&(e=window),"addEventListener"in e){var n=!1===t.config.interactionBreadcrumbsEnabled,i=!1===t.config.autoBreadcrumbs&&!0!==t.config.interactionBreadcrumbsEnabled;n||i||e.addEventListener("click",function(n){var i,o;try{i=ue(n.target),o=function t(e,n){var i=[e.tagName];if(e.id&&i.push("#"+e.id),e.className&&e.className.length&&i.push("."+e.className.split(" ").join(".")),!n.document.querySelectorAll||!Array.prototype.indexOf)return i.join("");try{if(1===n.document.querySelectorAll(i.join("")).length)return i.join("")}catch(t){return i.join("")}if(1<e.parentNode.childNodes.length){var o=Array.prototype.indexOf.call(e.parentNode.childNodes,e)+1;i.push(":nth-child("+o+")")}return 1===n.document.querySelectorAll(i.join("")).length?i.join(""):e.parentNode?t(e.parentNode,n)+" > "+i.join(""):i.join("")}(n.target,e)}catch(e){o=i="[hidden]",t._logger.error("Cross domain error when tracking click event. See docs: https://tinyurl.com/yy3rn63z")}t.leaveBreadcrumb("UI click",{targetText:i,targetSelector:o},"user")},!0)}},configSchema:{interactionBreadcrumbsEnabled:{defaultValue:function(){},validate:function(t){return!0===t||!1===t||void 0===t},message:"should be true|false"}}},ue=function(t){var e=t.textContent||t.innerText||"";return e||"submit"!==t.type&&"button"!==t.type||(e=t.value),function(t,e){return t&&t.length<=e?t:t.slice(0,e-"(...)".length)+"(...)"}(e=e.replace(/^\s+|\s+$/g,""),140)},de={init:function(t,e){if(void 0===e&&(e=window),"addEventListener"in e){var n=!1===t.config.navigationBreadcrumbsEnabled,i=!1===t.config.autoBreadcrumbs&&!0!==t.config.navigationBreadcrumbsEnabled;if(!n&&!i){var o=function(e){return function(){return t.leaveBreadcrumb(e,{},"navigation")}};e.addEventListener("pagehide",o("Page hidden"),!0),e.addEventListener("pageshow",o("Page shown"),!0),e.addEventListener("load",o("Page loaded"),!0),e.document.addEventListener("DOMContentLoaded",o("DOMContentLoaded"),!0),e.addEventListener("load",function(){return e.addEventListener("popstate",o("Navigated back"),!0)}),e.addEventListener("hashchange",function(n){var i=n.oldURL?{from:le(n.oldURL,e),to:le(n.newURL,e),state:fe(e)}:{to:le(e.location.href,e)};t.leaveBreadcrumb("Hash changed",i,"navigation")},!0),e.history.replaceState&&ge(t,e.history,"replaceState",e),e.history.pushState&&ge(t,e.history,"pushState",e),t.leaveBreadcrumb("Bugsnag loaded",{},"navigation")}}},configSchema:{navigationBreadcrumbsEnabled:{defaultValue:function(){},validate:function(t){return!0===t||!1===t||void 0===t},message:"should be true|false"}}},le=function(t,e){var n=e.document.createElement("A");return n.href=t,""+n.pathname+n.search+n.hash},ge=function(t,e,n,i){var o=e[n];e[n]=function(r,a,c){var s,u,d,l,g;t.leaveBreadcrumb("History "+n,(u=r,d=a,l=c,g=le((s=i).location.href,s),{title:d,state:u,prevState:fe(s),to:l||g,from:g}),"navigation"),"function"==typeof t.refresh&&t.refresh(),t.config.autoCaptureSessions&&t.startSession(),o.apply(e,[r,a].concat(void 0!==c?c:[]))}},fe=function(t){try{return t.history.state}catch(t){}},pe={},me="request",he="BS~~U",je="BS~~M",Ne=c,ye=function(){return[re.config.endpoints.notify,re.config.endpoints.sessions]};pe.name="networkBreadcrumbs",pe.init=function(t,e,n){void 0===e&&(e=ye),void 0===n&&(n=window);var i=!1===t.config.networkBreadcrumbsEnabled,o=!1===t.config.autoBreadcrumbs&&!0!==t.config.networkBreadcrumbsEnabled;i||o||(re=t,ae=n,ce=e,Ce(),Le())},pe.configSchema={networkBreadcrumbsEnabled:{defaultValue:function(){},validate:function(t){return!0===t||!1===t||void 0===t},message:"should be true|false"}};var Ce=function(){if("addEventListener"in ae.XMLHttpRequest.prototype){var t=ae.XMLHttpRequest.prototype.open;ae.XMLHttpRequest.prototype.open=function(e,n){this[he]=n,this[je]=e,this["BS~~S"]&&(this.removeEventListener("load",Se),this.removeEventListener("error",_e)),this.addEventListener("load",Se),this.addEventListener("error",_e),this["BS~~S"]=!0,t.apply(this,arguments)}}};function Se(){if(!Ne(ce(),this[he])){var t={status:this.status,request:this[je]+" "+this[he]};400<=this.status?re.leaveBreadcrumb("XMLHttpRequest failed",t,me):re.leaveBreadcrumb("XMLHttpRequest succeeded",t,me)}}function _e(){Ne(ce,this[he])||re.leaveBreadcrumb("XMLHttpRequest error",{request:this[je]+" "+this[he]},me)}var Le=function(){if("fetch"in ae&&!ae.fetch.polyfill){var t=ae.fetch;ae.fetch=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=n[0],r=n[1],a="GET";return r&&r.method&&(a=r.method),new Promise(function(e,i){t.apply(void 0,n).then(function(t){Pe(t,a,o),e(t)}).catch(function(t){ve(a,o),i(t)})})}}},Pe=function(t,e,n){var i={status:t.status,request:e+" "+n};400<=t.status?re.leaveBreadcrumb("fetch() failed",i,me):re.leaveBreadcrumb("fetch() succeeded",i,me)},ve=function(t,e){re.leaveBreadcrumb("fetch() error",{request:t+" "+e},me)},Te=d.intRange,De={init:function(t){var e=0;t.config.beforeSend.push(function(n){if(e>=t.config.maxEvents)return n.ignore();e++}),t.refresh=function(){e=0}},configSchema:{maxEvents:{defaultValue:function(){return 10},message:"should be a positive integer â‰¤100",validate:function(t){return Te(1,100)(t)}}}},be={};function Ee(){return(Ee=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var ke=o,Oe=(be={init:function(t){t.config.beforeSend.push(function(t){t.stacktrace=ke(t.stacktrace,function(t){return Ee({},t,{file:Oe(t.file)})})})}})._strip=function(t){return"string"==typeof t?t.replace(/\?.*$/,"").replace(/#.*$/,""):t},Ie={init:function(t,e){void 0===e&&(e=window);var n=e.onerror;e.onerror=function(e,i,o,r,a){if(0===o&&/Script error\.?/.test(e))t._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{var c,s={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};if(a)a.name&&a.message?c=new t.BugsnagReport(a.name,a.message,we(t.BugsnagReport.getStacktrace(a),i,o,r),s,a):(c=new t.BugsnagReport("window.onerror",String(a),we(t.BugsnagReport.getStacktrace(a,1),i,o,r),s,a)).updateMetaData("window onerror",{error:a});else if("object"!=typeof e||null===e||i&&"string"==typeof i||o||r||a)(c=new t.BugsnagReport("window.onerror",String(e),we(t.BugsnagReport.getStacktrace(a,1),i,o,r),s,e)).updateMetaData("window onerror",{event:e});else{var u=e.type?"Event: "+e.type:"window.onerror",d=e.message||e.detail||"";(c=new t.BugsnagReport(u,d,t.BugsnagReport.getStacktrace(new Error,1).slice(1),s,e)).updateMetaData("window onerror",{event:e,extraParameters:i})}t.notify(c)}"function"==typeof n&&n.apply(this,arguments)}}},we=function(t,e,n,i){var o=t[0];return o&&(o.fileName||"string"!=typeof e||o.setFileName(e),!o.lineNumber&&Ae(n)&&o.setLineNumber(n),o.columnNumber||(Ae(i)?o.setColumnNumber(i):window.event&&Ae(window.event.errorCharacter)&&o.setColumnNumber(window.event.errorCharacter))),t},Ae=function(t){return"number"==typeof t&&"NaN"!==String.call(t)},Fe={},Re=r;Fe.init=function(t,e){void 0===e&&(e=window);var n=function(e){var n=e.reason,i=!1;try{e.detail&&e.detail.reason&&(n=e.detail.reason,i=!0)}catch(t){}var o,r={severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}};n&&I(n)?(o=new t.BugsnagReport(n.name,n.message,O.parse(n),r,n),i&&(o.stacktrace=Re(o.stacktrace,Me(n),[]))):(o=new t.BugsnagReport(n&&n.name?n.name:"UnhandledRejection",n&&n.message?n.message:'Rejection reason was not an Error. See "Promise" tab for more detail.',[],r,n)).updateMetaData("promise","rejection reason",Be(n)),t.notify(o)};"addEventListener"in e?e.addEventListener("unhandledrejection",n):e.onunhandledrejection=function(t,e){n({detail:{reason:t,promise:e}})}};var xe,Be=function(t){return null==t?"undefined (or null)":D(t)?((e={})[Object.prototype.toString.call(t)]={name:t.name,message:t.message,code:t.code,stack:t.stack},e):t;var e},Me=function(t){return function(e,n){return n.file===t.toString()?e:(n.method&&(n.method=n.method.replace(/^\s+/,"")),e.concat(n))}};function Ge(){return(Ge=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var He=Ge({},l.schema,_);return(xe=function(t){"string"==typeof t&&(t={apiKey:t});var e="";t.endpoints&&t.endpoints.notify&&!t.endpoints.sessions&&(e+="notify endpoint is set but sessions endpoint is not. No sessions will be sent.");var n=new mt({name:"Bugsnag JavaScript",version:"6.4.1",url:"https://github.com/bugsnag/bugsnag-js"});return n.setOptions(t),n.delivery(window.XDomainRequest?bt:At),n.configure(He),e&&n._logger.warn(e),n.use(Bt),n.use(Ft),n.use(Gt),n.use(De),n.use(Vt),n.use(Wt),n.use(be),!1!==n.config.autoNotify&&(n.use(Ie),n.use(Fe)),n.use(de),n.use(se),n.use(pe),n.use(Kt),n.use(ne),n._logger.debug("Loaded!"),n.config.autoCaptureSessions?n.startSession():n}).Bugsnag={Client:mt,Report:U,Session:ot,Breadcrumb:v},xe.default=xe});var LimoniAppsLoadJQuery_LoadAttempts=0,LimoniAppsLoadJQuery_Wait=!0;function LimoniAppsLoadJQuery(t){if("function"!=typeof jQuery||!1){let e=1e3,n=50;!0===LimoniAppsLoadJQuery_Wait&&LimoniAppsLoadJQuery_LoadAttempts>e/n?(LimoniAppsLoadJQuery_LoadAttempts=0,LimoniAppsLoadDependency("//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js",function(){t&&t()})):(LimoniAppsLoadJQuery_LoadAttempts+=1,setTimeout(function(){LimoniAppsLoadJQuery(t)},n))}else t&&t()}function LimoniAppsLoadOuiBounce(t){var e,n;"function"!=typeof ouibounce&&(e=this,n=function(t,e,n){return function(t,e){"use strict";function n(t,e){return void 0===t?e:t}function i(t){var e=24*t*60*60*1e3,n=new Date;return n.setTime(n.getTime()+e),"; expires="+n.toUTCString()}function o(t){t.clientY>f||(S=setTimeout(u,m))}function r(){S&&(clearTimeout(S),S=null)}function a(t){L||t.metaKey&&76===t.keyCode&&(L=!0,S=setTimeout(u,m))}function c(t,e){return function(){for(var t=document.cookie.split("; "),e={},n=t.length-1;n>=0;n--){var i=t[n].split("=");e[i[0]]=i[1]}return e}()[t]===e}function s(){return c(y,"true")&&!g}function u(){s()||(t&&(t.style.display="block"),h(),d())}function d(t){var e=t||{};void 0!==e.cookieExpire&&(j=i(e.cookieExpire)),!0===e.sitewide&&(C=";path=/"),void 0!==e.cookieDomain&&(N=";domain="+e.cookieDomain),void 0!==e.cookieName&&(y=e.cookieName),document.cookie=y+"=true"+j+N+C,_.removeEventListener("mouseleave",o),_.removeEventListener("mouseenter",r),_.removeEventListener("keydown",a)}var l=e||{},g=l.aggressive||!1,f=n(l.sensitivity,20),p=n(l.timer,1e3),m=n(l.delay,0),h=l.callback||function(){},j=i(l.cookieExpire)||"",N=l.cookieDomain?";domain="+l.cookieDomain:"",y=l.cookieName?l.cookieName:"viewedOuibounceModal",C=!0===l.sitewide?";path=/":"",S=null,_=document.documentElement;setTimeout(function(){s()||(_.addEventListener("mouseleave",o),_.addEventListener("mouseenter",r),_.addEventListener("keydown",a))},p);var L=!1;return{fire:u,disable:d,isDisabled:s}}},"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n(require,exports,module):e.ouibounce=n()),t&&t()}function LimoniAppsLoadJQueryNotify(t){var e;"function"==typeof jQuery&&"function"!=typeof jQuery.notify&&(e=function(t){function e(e,i,o){i={content:{message:"object"==typeof i?i.message:i,title:i.title?i.title:"",icon:i.icon?i.icon:"",url:i.url?i.url:"#",target:i.target?i.target:"-"}};o=t.extend(!0,{},i,o),this.settings=t.extend(!0,{},n,o),this._defaults=n,"-"==this.settings.content.target&&(this.settings.content.target=this.settings.url_target),this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"},"number"==typeof this.settings.offset&&(this.settings.offset={x:this.settings.offset,y:this.settings.offset}),this.init()}var n={element:"body",position:null,type:"info",allow_dismiss:!0,newest_on_top:!1,showProgressbar:!1,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0} alert-{0}-dynamic alert-animation-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){for(var t=arguments[0],e=1;e<arguments.length;e++)t=t.replace(RegExp("\\{"+(e-1)+"\\}","gm"),arguments[e]);return t},t.extend(e.prototype,{init:function(){var t=this;this.buildNotify(),this.settings.content.icon&&this.setIcon(),"#"!=this.settings.content.url&&this.styleURL(),this.placement(),this.bind(),this.notify={$ele:this.$ele,update:function(e,n){var i={};for(var e in"string"==typeof e?i[e]=n:i=e,i)switch(e){case"type":this.$ele.removeClass("alert-"+t.settings.type),this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+t.settings.type),t.settings.type=i[e],this.$ele.addClass("alert-"+i[e]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+i[e]);break;case"icon":var o=this.$ele.find('[data-notify="icon"]');"class"==t.settings.icon_type.toLowerCase()?o.removeClass(t.settings.content.icon).addClass(i[e]):(o.is("img")||o.find("img"),o.attr("src",i[e]));break;case"progress":var r=t.settings.delay-t.settings.delay*(i[e]/100);this.$ele.data("notify-delay",r),this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",i[e]).css("width",i[e]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",i[e]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",i[e]);break;default:this.$ele.find('[data-notify="'+e+'"]').html(i[e])}var a=this.$ele.outerHeight()+parseInt(t.settings.spacing)+parseInt(t.settings.offset.y);t.reposition(a)},close:function(){t.close()}}},buildNotify:function(){var e=this.settings.content;this.$ele=t(String.format(this.settings.template,this.settings.type,e.title,e.message,e.url,e.target)),this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align),this.settings.allow_dismiss||this.$ele.find('[data-notify="dismiss"]').css("display","none"),(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar)&&this.$ele.find('[data-notify="progressbar"]').remove()},setIcon:function(){"class"==this.settings.icon_type.toLowerCase()?this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon):this.$ele.find('[data-notify="icon"]').is("img")?this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon):this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:"0px",position:"absolute",top:"0px",width:"100%",zIndex:this.settings.z_index+1}),this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},placement:function(){var e=this,n=this.settings.offset.y,i={display:"inline-block",margin:"0px auto",position:this.settings.position?this.settings.position:"body"===this.settings.element?"fixed":"absolute",transition:"all .5s ease-in-out",zIndex:this.settings.z_index},o=!1,r=this.settings;switch(t('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){return n=Math.max(n,parseInt(t(this).css(r.placement.from))+parseInt(t(this).outerHeight())+parseInt(r.spacing))}),1==this.settings.newest_on_top&&(n=this.settings.offset.y),i[this.settings.placement.from]=n+"px",this.settings.placement.align){case"left":case"right":i[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":i.left=0,i.right=0}this.$ele.css(i).addClass(this.settings.animate.enter),t.each(Array("webkit","moz","o","ms",""),function(t,n){e.$ele[0].style[n+"AnimationIterationCount"]=1}),t(this.settings.element).append(this.$ele),1==this.settings.newest_on_top&&(n=parseInt(n)+parseInt(this.settings.spacing)+this.$ele.outerHeight(),this.reposition(n)),t.isFunction(e.settings.onShow)&&e.settings.onShow.call(this.$ele),this.$ele.one(this.animations.start,function(){o=!0}).one(this.animations.end,function(){t.isFunction(e.settings.onShown)&&e.settings.onShown.call(this)}),setTimeout(function(){o||t.isFunction(e.settings.onShown)&&e.settings.onShown.call(this)},600)},bind:function(){var e=this;if(this.$ele.find('[data-notify="dismiss"]').on("click",function(){e.close()}),this.$ele.mouseover(function(){t(this).data("data-hover","true")}).mouseout(function(){t(this).data("data-hover","false")}),this.$ele.data("data-hover","false"),this.settings.delay>0){e.$ele.data("notify-delay",e.settings.delay);var n=setInterval(function(){var t=parseInt(e.$ele.data("notify-delay"))-e.settings.timer;if("false"===e.$ele.data("data-hover")&&"pause"==e.settings.mouse_over||"pause"!=e.settings.mouse_over){var i=(e.settings.delay-t)/e.settings.delay*100;e.$ele.data("notify-delay",t),e.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",i).css("width",i+"%")}t<=-e.settings.timer&&(clearInterval(n),e.close())},e.settings.timer)}},close:function(){var e=this,n=parseInt(this.$ele.css(this.settings.placement.from)),i=!1;this.$ele.data("closing","true").addClass(this.settings.animate.exit),e.reposition(n),t.isFunction(e.settings.onClose)&&e.settings.onClose.call(this.$ele),this.$ele.one(this.animations.start,function(){i=!0}).one(this.animations.end,function(){t(this).remove(),t.isFunction(e.settings.onClosed)&&e.settings.onClosed.call(this)}),setTimeout(function(){i||(e.$ele.remove(),e.settings.onClosed&&e.settings.onClosed(e.$ele))},600)},reposition:function(e){var n=this,i='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',o=this.$ele.nextAll(i);1==this.settings.newest_on_top&&(o=this.$ele.prevAll(i)),o.each(function(){t(this).css(n.settings.placement.from,e),e=parseInt(e)+parseInt(n.settings.spacing)+t(this).outerHeight()})}}),t.notify=function(t,n){return new e(this,t,n).notify},t.notifyDefaults=function(e){return n=t.extend(!0,{},n,e)},t.notifyClose=function(e){void 0===e||"all"==e?t("[data-notify]").find('[data-notify="dismiss"]').trigger("click"):t('[data-notify-position="'+e+'"]').find('[data-notify="dismiss"]').trigger("click")}},"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)),t&&t()}function LimoniAppsLoadDayJs(t){var e,n;"function"!=typeof dayJS&&(e=this,n=function(){"use strict";var t="millisecond",e="second",n="minute",i="hour",o="day",r="week",a="month",c="quarter",s="year",u=/^(\d{4})-?(\d{1,2})-?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?.?(\d{1,3})?$/,d=/\[([^\]]+)]|Y{2,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},g={s:l,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),o=n%60;return(e<=0?"+":"-")+l(i,2,"0")+":"+l(o,2,"0")},m:function(t,e){var n=12*(e.year()-t.year())+(e.month()-t.month()),i=t.clone().add(n,a),o=e-i<0,r=t.clone().add(n+(o?-1:1),a);return Number(-(n+(e-i)/(o?i-r:r-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(u){return{M:a,y:s,w:r,d:o,D:"date",h:i,m:n,s:e,ms:t,Q:c}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p="en",m={};m[p]=f;var h=function(t){return t instanceof C},j=function(t,e,n){var i;if(!t)return p;if("string"==typeof t)m[t]&&(i=t),e&&(m[t]=e,i=t);else{var o=t.name;m[o]=t,i=o}return!n&&i&&(p=i),i||!n&&p},N=function(t,e){if(h(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new C(n)},y=g;y.l=j,y.i=h,y.w=function(t,e){return N(t,{locale:e.$L,utc:e.$u,$offset:e.$offset})};var C=function(){function l(t){this.$L=this.$L||j(t.locale,null,!0),this.parse(t)}var g=l.prototype;return g.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(y.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(u);if(i)return n?new Date(Date.UTC(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)):new Date(i[1],i[2]-1,i[3]||1,i[4]||0,i[5]||0,i[6]||0,i[7]||0)}return new Date(e)}(t),this.init()},g.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},g.$utils=function(){return y},g.isValid=function(){return!("Invalid Date"===this.$d.toString())},g.isSame=function(t,e){var n=N(t);return this.startOf(e)<=n&&n<=this.endOf(e)},g.isAfter=function(t,e){return N(t)<this.startOf(e)},g.isBefore=function(t,e){return this.endOf(e)<N(t)},g.$g=function(t,e,n){return y.u(t)?this[e]:this.set(n,t)},g.year=function(t){return this.$g(t,"$y",s)},g.month=function(t){return this.$g(t,"$M",a)},g.day=function(t){return this.$g(t,"$W",o)},g.date=function(t){return this.$g(t,"$D","date")},g.hour=function(t){return this.$g(t,"$H",i)},g.minute=function(t){return this.$g(t,"$m",n)},g.second=function(t){return this.$g(t,"$s",e)},g.millisecond=function(e){return this.$g(e,"$ms",t)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(t,c){var u=this,d=!!y.u(c)||c,l=y.p(t),g=function(t,e){var n=y.w(u.$u?Date.UTC(u.$y,e,t):new Date(u.$y,e,t),u);return d?n:n.endOf(o)},f=function(t,e){return y.w(u.toDate()[t].apply(u.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(e)),u)},p=this.$W,m=this.$M,h=this.$D,j="set"+(this.$u?"UTC":"");switch(l){case s:return d?g(1,0):g(31,11);case a:return d?g(1,m):g(0,m+1);case r:var N=this.$locale().weekStart||0,C=(p<N?p+7:p)-N;return g(d?h-C:h+(6-C),m);case o:case"date":return f(j+"Hours",0);case i:return f(j+"Minutes",1);case n:return f(j+"Seconds",2);case e:return f(j+"Milliseconds",3);default:return this.clone()}},g.endOf=function(t){return this.startOf(t,!1)},g.$set=function(r,c){var u,d=y.p(r),l="set"+(this.$u?"UTC":""),g=(u={},u[o]=l+"Date",u.date=l+"Date",u[a]=l+"Month",u[s]=l+"FullYear",u[i]=l+"Hours",u[n]=l+"Minutes",u[e]=l+"Seconds",u[t]=l+"Milliseconds",u)[d],f=d===o?this.$D+(c-this.$W):c;if(d===a||d===s){var p=this.clone().set("date",1);p.$d[g](f),p.init(),this.$d=p.set("date",Math.min(this.$D,p.daysInMonth())).toDate()}else g&&this.$d[g](f);return this.init(),this},g.set=function(t,e){return this.clone().$set(t,e)},g.get=function(t){return this[y.p(t)]()},g.add=function(t,c){var u,d=this;t=Number(t);var l=y.p(c),g=function(e){var n=N(d);return y.w(n.date(n.date()+Math.round(e*t)),d)};if(l===a)return this.set(a,this.$M+t);if(l===s)return this.set(s,this.$y+t);if(l===o)return g(1);if(l===r)return g(7);var f=(u={},u[n]=6e4,u[i]=36e5,u[e]=1e3,u)[l]||1,p=this.$d.getTime()+t*f;return y.w(p,this)},g.subtract=function(t,e){return this.add(-1*t,e)},g.format=function(t){var e=this;if(!this.isValid())return"Invalid Date";var n=t||"YYYY-MM-DDTHH:mm:ssZ",i=y.z(this),o=this.$locale(),r=this.$H,a=this.$m,c=this.$M,s=o.weekdays,u=o.months,l=function(t,i,o,r){return t&&(t[i]||t(e,n))||o[i].substr(0,r)},g=function(t){return y.s(r%12||12,t,"0")},f=o.meridiem||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:c+1,MM:y.s(c+1,2,"0"),MMM:l(o.monthsShort,c,u,3),MMMM:l(u,c),D:this.$D,DD:y.s(this.$D,2,"0"),d:String(this.$W),dd:l(o.weekdaysMin,this.$W,s,2),ddd:l(o.weekdaysShort,this.$W,s,3),dddd:s[this.$W],H:String(r),HH:y.s(r,2,"0"),h:g(1),hh:g(2),a:f(r,a,!0),A:f(r,a,!1),m:String(a),mm:y.s(a,2,"0"),s:String(this.$s),ss:y.s(this.$s,2,"0"),SSS:y.s(this.$ms,3,"0"),Z:i};return n.replace(d,function(t,e){return e||p[t]||i.replace(":","")})},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(t,u,d){var l,g=y.p(u),f=N(t),p=6e4*(f.utcOffset()-this.utcOffset()),m=this-f,h=y.m(this,f);return h=(l={},l[s]=h/12,l[a]=h,l[c]=h/3,l[r]=(m-p)/6048e5,l[o]=(m-p)/864e5,l[i]=m/36e5,l[n]=m/6e4,l[e]=m/1e3,l)[g]||m,d?h:y.a(h)},g.daysInMonth=function(){return this.endOf(a).$D},g.$locale=function(){return m[this.$L]},g.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=j(t,e,!0);return i&&(n.$L=i),n},g.clone=function(){return y.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},l}();return N.prototype=C.prototype,N.extend=function(t,e){return t(e,C,N),N},N.locale=j,N.isDayjs=h,N.unix=function(t){return N(1e3*t)},N.en=m[p],N.Ls=m,N},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.dayjs=n()),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.dayjs_plugin_utc=e()}(this,function(){"use strict";return function(t,e,n){var i=(new Date).getTimezoneOffset(),o=e.prototype;n.utc=function(t){return new e({date:t,utc:!0,args:arguments})},o.utc=function(){return n(this.toDate(),{locale:this.$L,utc:!0})},o.local=function(){return n(this.toDate(),{locale:this.$L,utc:!1})};var r=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),r.call(this,t)};var a=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else a.call(this)};var c=o.utcOffset;o.utcOffset=function(t){var e=this.$utils().u;if(e(t))return this.$u?0:e(this.$offset)?c.call(this):this.$offset;var n,o=Math.abs(t)<=16?60*t:t;return 0!==t?(n=this.local().add(o+i,"minute")).$offset=o:n=this.utc(),n};var s=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return s.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+i;return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var u=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?n(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():u.call(this)}}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.dayjs_plugin_duration=e()}(this,function(){"use strict";var t,e,n=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,i={years:31536e6,months:2592e6,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,weeks:6048e5},o=function(t){return t instanceof c},r=function(t,e,n){return new c(t,n,e.$l)},a=function(t){return e.p(t)+"s"},c=function(){function e(t,e,o){var c=this;if(this.$d={},this.$l=o||"en",e)return r(t*i[a(e)],this);if("number"==typeof t)return this.$ms=t,this.parseFromMilliseconds(),this;if("object"==typeof t)return Object.keys(t).forEach(function(e){c.$d[a(e)]=t[e]}),this.calMilliseconds(),this;if("string"==typeof t){var s=t.match(n);if(s)return this.$d.years=s[2],this.$d.months=s[3],this.$d.days=s[5],this.$d.hours=s[6],this.$d.minutes=s[7],this.$d.seconds=s[8],this.calMilliseconds(),this}return this}var c=e.prototype;return c.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(e,n){return e+(t.$d[n]||0)*(i[n]||1)},0)},c.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=Math.floor(t/31536e6),t%=31536e6,this.$d.months=Math.floor(t/2592e6),t%=2592e6,this.$d.days=Math.floor(t/864e5),t%=864e5,this.$d.hours=Math.floor(t/36e5),t%=36e5,this.$d.minutes=Math.floor(t/6e4),t%=6e4,this.$d.seconds=Math.floor(t/1e3),t%=1e3,this.$d.milliseconds=t},c.toISOString=function(){var t=this.$d.years?this.$d.years+"Y":"",e=this.$d.months?this.$d.months+"M":"",n=this.$d.days||0;this.$d.weeks&&(n+=7*this.$d.weeks);var i=n?n+"D":"",o=this.$d.hours?this.$d.hours+"H":"",r=this.$d.minutes?this.$d.minutes+"M":"",a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3);var c=a?a+"S":"",s="P"+t+e+i+(o||r||c?"T":"")+o+r+c;return"P"===s?"P0D":s},c.toJSON=function(){return this.toISOString()},c.as=function(t){return this.$ms/(i[a(t)]||1)},c.get=function(t){var e=this.$ms,n=a(t);return"milliseconds"===n?e%=1e3:e="weeks"===n?Math.floor(e/i[n]):this.$d[n],e},c.add=function(t,e,n){var c;return c=e?t*i[a(e)]:o(t)?t.$ms:r(t,this).$ms,r(this.$ms+c*(n?-1:1),this)},c.subtract=function(t,e){return this.add(t,e,!0)},c.locale=function(t){var e=this.clone();return e.$l=t,e},c.clone=function(){return r(this.$ms,this)},c.humanize=function(e){return t().add(this.$ms,"ms").locale(this.$l).fromNow(!e)},c.milliseconds=function(){return this.get("milliseconds")},c.asMilliseconds=function(){return this.as("milliseconds")},c.seconds=function(){return this.get("seconds")},c.asSeconds=function(){return this.as("seconds")},c.minutes=function(){return this.get("minutes")},c.asMinutes=function(){return this.as("minutes")},c.hours=function(){return this.get("hours")},c.asHours=function(){return this.as("hours")},c.days=function(){return this.get("days")},c.asDays=function(){return this.as("days")},c.weeks=function(){return this.get("weeks")},c.asWeeks=function(){return this.as("weeks")},c.months=function(){return this.get("months")},c.asMonths=function(){return this.as("months")},c.years=function(){return this.get("years")},c.asYears=function(){return this.as("years")},e}();return function(n,i,a){t=a,e=a().$utils(),a.duration=function(t,e){return r(t,{},e)},a.isDuration=o}}),dayjs.extend(window.dayjs_plugin_utc),dayjs.extend(window.dayjs_plugin_duration),t&&t()}let stopLoading=void 0!==discountNinja||"undefined"!=typeof discountNinja_Script_Loading;if(!stopLoading)try{"6"===discountNinja.Core.Version[0]&&(stopLoading=!1)}catch(t){let e=0}if(stopLoading)discountNinja.Logging.LogVerbose("Aborting load of script because it is already loaded");else{let discountNinja_Script_Loading=!0;var discountNinja_Script_Core={Shop:"",Environment:"prod",Version:"7.0.443",SubscribedToDrawerCartOpened:!1,SubscribedToCollectionProductsAdded:!1,TriggerPromotion:function(t){try{let e=jQuery(t).attr("data-limoniapps-discountninja-token");null!=e&&""!==e&&(discountNinja.Logging.LogVerbose("Triggering offer with token "+e),discountNinja.Token.SetTokenInLocalStorage(e),discountNinja.Token.SetCartTokenInLocalStorage(e),discountNinja.Token.SetNonAutomaticTokenInSession(e),discountNinja_Script_Core.Start())}catch(t){discountNinja.Logging.LogError("Core.Exception in TriggerPromotion",t)}},ExecuteOnLoadCallback:function(){try{let callback=discountNinja.Cache.SessionGet("CallbackAfterReloadPageAddingFreeGift");callback&&""!==callback&&(discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",""),setTimeout(function(){try{discountNinja.Logging.LogVerbose("Executing CallbackAfterReloadPageAddingFreeGift"),eval(callback)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback.Eval",t)}},500))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback",t)}},Start:function(t){function e(){try{discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(),!0===discountNinja.Settings.GetFlag("ForceDevelopmentEnvironment")&&"dev"!==discountNinja_Script_Core.Environment&&(discountNinja.Logging.LogWarning("Changing environment to dev"),discountNinja_Script_Core.Environment="dev"),function(){function t(t){return t.replace(/\\{/g,"{").replace(/\\}/g,"}")}function e(e){return e&&(e.Format&&(e.Format=t(e.Format)),e.PrefixText&&(e.PrefixText=t(e.PrefixText)),e.SuffixText&&(e.SuffixText=t(e.SuffixText))),e}discountNinja.Settings.Settings=window.discountNinjaContext.Settings;let n=discountNinja.Settings.Settings;if(n.Currency){n.Currency.MoneyFormat&&(n.Currency.MoneyFormat=n.Currency.MoneyFormat.replace(/\\{/g,"{").replace(/\\}/g,"}"));let t=n.PriceUpdate;t.ProductPagePriceFormat&&(t.ProductPagePriceFormat=e(t.ProductPagePriceFormat)),t.OtherPagePriceFormat&&(t.OtherPagePriceFormat=e(t.OtherPagePriceFormat)),t.CartProductPriceFormat&&(t.CartProductPriceFormat=e(t.CartProductPriceFormat)),t.CartLinePriceFormat&&(t.CartLinePriceFormat=e(t.CartLinePriceFormat)),t.CartSubtotalPriceFormat&&(t.CartSubtotalPriceFormat=e(t.CartSubtotalPriceFormat)),t.DrawerCartProductPriceFormat&&(t.DrawerCartProductPriceFormat=e(t.DrawerCartProductPriceFormat)),t.DrawerCartLinePriceFormat&&(t.DrawerCartLinePriceFormat=e(t.DrawerCartLinePriceFormat)),t.DrawerCartSubtotalPriceFormat&&(t.DrawerCartSubtotalPriceFormat=e(t.DrawerCartSubtotalPriceFormat))}}();let t=discountNinja.Settings.Settings;if(!t||!t.Currency||!t.Currency.BaseCurrency)return void discountNinja.Logging.LogErrorMessage("Core.LoadSettings","No settings available");if("undefined"!==window.discountNinjaContextAdditionalProduct&&window.discountNinjaContextAdditionalProduct&&"object"==typeof window.discountNinjaContextAdditionalProduct.CollectionProducts)for(let t=0;t<window.discountNinjaContextAdditionalProduct.CollectionProducts.length;t++)window.discountNinjaContext.CollectionProducts.push(window.discountNinjaContextAdditionalProduct.CollectionProducts[t]);discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout(),discountNinja.Cart.Shopify.RegisterEventHandlerForAddToCart();let e=discountNinja.DiscountCode;e.EnableDiscountCodeField(),e.UpdateTags(),e.LockDiscountCodeFieldIfRequired(),discountNinja_Script_Core.SubscribedToDrawerCartOpened||(discountNinja.Cart.Shopify.SubscribeDrawerCartOpened(),discountNinja_Script_Core.SubscribedToDrawerCartOpened=!0),discountNinja_Script_Core.SubscribedToCollectionProductsAdded||(discountNinja.Events.Subscribe("CollectionProductsAdded",discountNinja.DynamicPricing.OnCollectionPageProductsAdded),discountNinja_Script_Core.SubscribedToCollectionProductsAdded=!0),discountNinja.Trigger.IntializeTimeOnPageCounter(),discountNinja.Trigger.TrackScrollPercentage(),discountNinja.Offer.PrimaryOffer=null,discountNinja_Script_Core.RegisterDiscountButtonClickEvents(),discountNinja.Logging.LogVerbose("Getting offer info"),discountNinja.Offer.LoadApplicableOffers(function(){!function(t){try{let e=0,n=null,i=function(){e++,"undefined"!=typeof jQuery&&"boolean"==typeof jQuery.isReady&&(discountNinja_Script_Core.DOMHasLoaded=discountNinja_Script_Core.DOMHasLoaded||jQuery.isReady),discountNinja_Script_Core.DOMHasLoaded||50===e?(null!==n&&clearTimeout(n),50===e&&discountNinja.Logging.LogErrorMessage("Core.Start.WaitForDom","Timed out"),discountNinja.Logging.LogVerbose("Waiting for DOM to load - DONE"),"function"==typeof t&&null!==t&&t()):n=setTimeout(function(){try{i()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}},100)};i()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}}(function(){discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Checkout.Shopify.InjectLoadingCheckoutPopUp(),discountNinja.PromotionFlow.StartFlow(),discountNinja.ProductData.Save()})})})},discountNinja.PromotionFlow.StopFlow),discountNinja.PromotionEvent.ProcessQueue()}catch(t){discountNinja.Logging.LogError("Core.StartInternal",t)}}try{discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1),discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(discountNinja_Script_Core.CurrentLocation,"discountninjalog",1),discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(!0),function(){try{discountNinja.TestMode.HandleQueryParameter(),discountNinja.Logging.HandleQueryParameter()}catch(t){discountNinja.Logging.LogError("Core.HandleDiscountNinjaQueryParameters",t)}}(),discountNinja.TestMode.TestModeOutputIssue=!1,t&&discountNinja.Logging.LogToConsole("information","\n\n"+discountNinja.Utilities.GetEmoji(128640)+" This forward-thinking shop uses Discount Ninja (an app by Limoni Apps) to drive more sales and increase average order value.\nScript version: v"+discountNinja_Script_Core.Version+", Environment: "+discountNinja_Script_Core.Environment+"\nLearn more at https://apps.shopify.com/discount-url?ref="+discountNinja_Script_Core.Shop+"\nOur script contains third-party, open source software and/or libraries. To view them and their license terms, go to http://support.discountninja.io/en/articles/3534630-legal-notices\n\n","green",!0,!0),discountNinja.Logging.LogVerbose("Loaded at '"+Date.now().toString()+"' - Version: "+discountNinja_Script_Core.Version);let n=discountNinja.Environment.Shopify;if(!(n.IsCartPage()||n.IsProductPage()||n.IsCollectionPage()||n.IsHomePage()||n.IsBlogPost()||n.IsCustomPage()||n.IsSearchPage()||n.IsAccountPage()))return void discountNinja.Logging.LogVerbose("Not a supported page type. Aborting script.");"function"==typeof XMLHttpRequest?XMLHttpRequest.prototype.send=discountNinja.XmlHttpRequest.CreateSendInterceptor("readystatechange",discountNinja.XmlHttpRequest.HandleSend,XMLHttpRequest.prototype.send):discountNinja.Logging.LogErrorMessage("Core","XMLHttpRequest not available"),discountNinja.XmlHttpRequest.CreateFetchInterceptor(discountNinja.XmlHttpRequest.HandleFetch),discountNinja.Logging.LogVerbose("Dependency -- Loading dependencies"),LimoniAppsLoadJQuery(function(){discountNinja.Logging.LogVerbose("Dependency -- jQuery loaded"),jQuery(document).ready(function(t){discountNinja.DOMHasLoaded=!0,discountNinja.Logging.LogVerbose("JQuery Document Ready"),discountNinja.XmlHttpRequest.RegisterToAjaxEvents()}),LimoniAppsLoadJQueryNotify(function(){discountNinja.Logging.LogVerbose("Dependency -- jQuery notify loaded"),LimoniAppsLoadOuiBounce(function(){discountNinja.Logging.LogVerbose("Dependency -- Oui Bounce loaded"),LimoniAppsLoadDayJs(function(){discountNinja.Logging.LogVerbose("Dependency -- Day JS loaded"),discountNinja.LiquidData.WaitForLiquidAsset(e)})})})})}catch(t){discountNinja.Logging.LogError("Core.Start",t)}},RegisterDiscountButtonClickEvents:function(){try{discountNinja.Logging.LogVerbose("Registering event handler for discount buttons"),function(){try{jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).off("click")})}catch(t){discountNinja.Logging.LogError("Core.UnRegisterDiscountButtonClickEvents",t)}}(),jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).on("click",function(t){discountNinja.Logging.LogVerbose("Offer triggered via discount button"),discountNinja_Script_Core.TriggerPromotion(t.currentTarget)})})}catch(t){discountNinja.Logging.LogError("Core.RegisterDiscountButtonClickEvents",t)}},CheckoutCurrentVariant:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.VariantId(),e=discountNinja.DiscountCode.GetDiscountCode(),n=jQuery('form input[name="quantity"]'),i=1;null!==n&&1===n.length&&(i=n.val()),(void 0===i||"undefined"===i||null===i||isNaN(i))&&(i=1);let o=null==e||""===e?"":"?discount="+e,r=discountNinja.QueryParameter.Get("locale"),a=void 0===r?"":""===o?"?locale="+r:"&locale="+r;window.location.assign("    /"+t+":"+i+o+a)}}catch(t){discountNinja.Logging.LogError("Core.CheckoutCurrentVariant",t)}}},discountNinja_Script_Badge={WrapperClass:"limoniapps-discountninja-badge-wrapper",Add:function(t,e,n){try{if(t.Badge){let i=function(t,e){try{if(!t)return"";let n=t.Badge,i=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(n.Text,t),e),o=jQuery("#limoniapps-discountninja-badge-template").html();return o=discountNinja.TemplateParameter.Replace(o,"TEXT",i),o=discountNinja.TemplateParameter.Replace(o,"TOKEN",t.Token),o=discountNinja.TemplateParameter.Replace(o,"STYLE",n.Style),o=discountNinja.TemplateParameter.Replace(o,"POSITION",n.Position),o=discountNinja.TemplateParameter.Replace(o,"SIZE",n.Size)}catch(t){return discountNinja.Logging.LogError("Badge.GetHtml",t),""}}(t,e),o='<div class="'+discountNinja_Script_Badge.WrapperClass+'">'+i+"</div>";jQuery(n).append(o)}else discountNinja.Logging.LogVerbose("Not showing badge, not enabled for offer with token "+t.Token)}catch(t){return discountNinja.Logging.LogError("Badge.Add",t),""}}},discountNinja_Script_Notification={AnimateOnReminderIntervalHandle:-1,DelayIntervalHandle:-1,GetClass:function(){return"limoniapps-notification.active"},GetStyle:function(t){try{return t?t.Notification.Style:""}catch(t){return discountNinja.Logging.LogError("Notification.GetStyle",t),""}},GetText:function(t,e,n){try{return discountNinja.ShortCode.ReplaceAllPlaceHolders(e,discountNinja.TextSettings.GetText(t,e),n)}catch(t){return discountNinja.Logging.LogError("Notification.GetText",t),""}},GetHtml:function(t){function e(t,e){""!==t&&e.push(t)}try{let n=discountNinja_Script_Notification.DefaultOffer();if(!n)return"";let i=discountNinja.DiscountTier.GetCurrentDiscountTier(n),o=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(i),r=n.Notification,a=discountNinja_Script_Notification.AppSettings(),c=discountNinja.TextSettings.WrapInColor(r.HeaderTextColor,discountNinja_Script_Notification.GetText(r.Header,n,o)),s=discountNinja.TextSettings.WrapInColor(r.FooterTextColor,discountNinja_Script_Notification.GetText(r.Footer,n,o)),u=discountNinja.TextSettings.WrapInColor(r.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(r.TimerFooter,n,o):""),d=discountNinja.TextSettings.WrapInColor(r.MinimizedTextColor,discountNinja_Script_Notification.GetText(r.MinimizedText,n,o)),l=[];e(a.MinimizeButton?"limoniapps-minimizable maximized":"",l),e(a.CloseButton?"closeable":"",l),e(a.OfferCounter?"limoniapps-hasoffercount":"",l),e("active",l),e(r.PlacementVertical+"-"+r.PlacementHorizontal,l),e(r.HasImage?"":"limoniapps-noimage",l),e(r.HasImagePerItem?"limoniapps-imageperitem":"",l);let g=l.join(" "),f=jQuery("#limoniapps-discountninja-notification-template").html();return f=discountNinja.TemplateParameter.Replace(f,"HEADER",c),f=discountNinja.TemplateParameter.Replace(f,"MINIMIZED",d),f=discountNinja.TemplateParameter.Replace(f,"BODY",t),f=discountNinja.TemplateParameter.Replace(f,"FOOTER",s),f=discountNinja.TemplateParameter.Replace(f,"TIMER_FOOTER",u),f=discountNinja.TemplateParameter.Replace(f,"TOKEN",n.Token),f=discountNinja.TemplateParameter.Replace(f,"FLAGS",g)}catch(t){return discountNinja.Logging.LogError("Notification.GetHtml",t),""}},Hiding:!1,Hide:function(t){try{discountNinja.Logging.LogVerbose("Hiding notification");let e=jQuery("."+discountNinja_Script_Notification.GetClass());e&&(discountNinja_Script_Notification.Hiding=!0,discountNinja_Script_Notification.ApplyAnimation(e,discountNinja_Script_Notification.AppSettings().AnimationExit),setTimeout(function(){try{discountNinja_Script_Notification.Hiding&&e.hide()}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}},800)),t&&discountNinja_Script_Notification.SetHiddenInSession(!0),discountNinja.Logging.LogVerbose("Notification hidden")}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}},ToggleMinMaximize:function(){try{discountNinja_Script_Notification.IsMinimized()?discountNinja_Script_Notification.Maximize():discountNinja_Script_Notification.Minimize()}catch(t){discountNinja.Logging.LogError("Notification.ToggleMinMaximize",t)}},Minimize:function(){try{if("minimized"===discountNinja_Script_Notification.IsMinimized())return;discountNinja.Logging.LogVerbose("Minimize notification");let t=jQuery("."+discountNinja_Script_Notification.GetClass());t&&jQuery(t).removeClass("maximized").addClass("minimized")}catch(t){discountNinja.Logging.LogError("Notification.Minimize",t)}},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.Notification}catch(t){discountNinja.Logging.LogError("Notification.AppSettings",t)}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.Notification&&discountNinja.Offer.PrimaryOffer.Notification.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(let t=0;t<discountNinja.Offer.Offers.length;t++){let e=discountNinja.Offer.Offers[t];if(discountNinja.Offer.IsOfferAccepted(e.Token,e.Frequency)&&e.Notification&&e.Notification.PlacementVertical)return e}return null}catch(t){discountNinja.Logging.LogError("Notification.DefaultOffer",t)}},Maximize:function(){try{if(!discountNinja_Script_Notification.IsMinimized())return;discountNinja.Logging.LogVerbose("Maximize notification");let t=jQuery("."+discountNinja_Script_Notification.GetClass());t&&(discountNinja_Script_Notification.ActAfterDelay(),jQuery(t).css("transition","unset"),jQuery(t).removeClass("minimized").addClass("maximized"),jQuery(t).css("transition","all 0.5s ease -in -out 0s"))}catch(t){discountNinja.Logging.LogError("Notification.Maximize",t)}},Clear:function(){discountNinja.Cache.SessionRemove("notificationinfo-data")},Remove:function(t){try{let e=discountNinja_Script_Notification.GetFromCache(),n=[];for(let i=0;i<e.length;i++)e[i].Token!==t&&n.push(e[i]);0===n.length&&discountNinja_Script_Notification.Hide(),discountNinja_Script_Notification.SaveToCache(n),discountNinja_Script_Notification.UpdateOfferCounter(n.length)}catch(t){discountNinja.Logging.LogError("Notification.Remove",t)}},GetOfferCounterElement:function(){try{return jQuery("."+discountNinja_Script_Notification.GetClass()).find(".limoniapps-offercount")}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},UpdateOfferCounter:function(t){try{discountNinja_Script_Notification.GetOfferCounterElement().text(t.length)}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("notificationinfo-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("Notification.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("notificationinfo-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Notification.SaveToCache",t)}},Add:function(t){try{t||discountNinja.Logging.LogErrorMessage("Notification.Add","Expected token");let e=discountNinja_Script_Notification.GetFromCache();for(let n=0;n<e.length;n++)if(e[n]&&e[n].Token===t)return;e.push({Token:t,Animated:!1}),discountNinja_Script_Notification.SaveToCache(e),discountNinja_Script_Notification.UpdateOfferCounter(e)}catch(t){discountNinja.Logging.LogError("Notification.Add",t)}},ClearAnimation:function(t){try{let e=discountNinja_Script_Notification.AppSettings();t.removeClass(e.AnimationEnter),t.removeClass(e.AnimationOnReminder),t.removeClass(e.AnimationExit),t.removeClass("animated shake flash bounce rotateIn")}catch(t){discountNinja.Logging.LogError("Notification.ClearAnimation",t)}},ApplyAnimation:function(t,e,n){try{discountNinja_Script_Notification.ClearAnimation(t),t.addClass(e),n&&t.css("animation-iteration-count",n)}catch(t){discountNinja.Logging.LogError("Notification.ApplyAnimation",t)}},ActAfterDelay:function(){try{let t=discountNinja_Script_Notification.AppSettings();t.Delay&&t.Delay>0&&(clearInterval(discountNinja_Script_Notification.DelayIntervalHandle),discountNinja_Script_Notification.DelayIntervalHandle=setTimeout(function(){try{discountNinja_Script_Notification.GetUserToggledMinMaximize()?discountNinja.Logging.LogVerbose("Not hiding/minimizing notification because it was toggled by the user"):"hide"===t.HideMode?discountNinja_Script_Notification.Hide(!0):"minimize"===t.HideMode&&discountNinja_Script_Notification.Minimize()}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}},t.Delay))}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}},HighlightNewOffers:function(t){try{setTimeout(function(){try{!function(t){try{if(!discountNinja_Script_Notification.AppSettings().AnimationOnReminder)return;setTimeout(function(){try{for(let e=0;e<t.length;e++){let n=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[e]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated shake",1)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}},500),setTimeout(function(){try{for(let e=0;e<t.length;e++){let n=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[e]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated flash",3)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}},1500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.HighlightNewOffers",t)}}(t),function(t){try{let e=discountNinja_Script_Notification.AppSettings();if(!e)return;e.OfferCounterAnimate&&t.length>0&&(discountNinja_Script_Notification.Maximize(),setTimeout(function(){try{discountNinja_Script_Notification.ApplyAnimation(discountNinja_Script_Notification.GetOfferCounterElement(),"animated bounce",2)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}},500))}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}}(t)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}},500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}},Show:function(){function t(e,n){discountNinja_Script_Notification.AnimateOnReminderIntervalHandle=setTimeout(function(){try{!function(){let t=jQuery("."+discountNinja_Script_Notification.GetClass());discountNinja_Script_Notification.ApplyAnimation(t,e)}(),t(e,n)}catch(t){discountNinja.Logging.LogError("Notification.AnimateOnReminder",t)}},n)}try{if(discountNinja_Script_Notification.GetHiddenInSession())return;let e=discountNinja_Script_Notification.GetFromCache();if(!e||0===e.length)return;let n=null,i=e.length>1?"<ul>":"",o=[],r=[];for(let t=0;t<e.length;t++){n=e[t];let a=discountNinja.Offer.GetOfferByToken(n.Token);if(a){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(a),c=!!t&&t.IsMaxTier,s=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t),u='data-offer-token="'+n.Token+'"',d=discountNinja_Script_Notification.GetText(a.Notification.Body,a,s);if(null===d||""===d)continue;let l=!1;for(let t=0;t<r.length;t++)if(r[t]===d){l=!0;break}if(l)continue;r.push(i),i=e.length>1?i+"<li "+u+">"+d+"</li>":i+'<span style="display:block;" '+u+">"+d+"</span>",!1===n.Animated&&c&&o.push(n.Token)}else discountNinja.Logging.LogVerbose("Cached notification refers to offer "+n.Token+", which is not available")}if(e.length>1&&(i+="</ul>"),r.length<1)return;!function(e,n,i){try{if(null===e||"<ul></ul>"===e)return;if(discountNinja.Logging.LogVerbose("Showing notification"),discountNinja_Script_Notification.GetDismissedInSession())return void discountNinja.Logging.LogVerbose("Notification was dismissed during the session, canceling show");if(jQuery("."+discountNinja_Script_Notification.GetClass()).length>0){jQuery(".limoniapps-notification .limoniapps-message-body .text-wrapper").html(n),discountNinja.Logging.LogVerbose("Notification already exists, updating message");let t=jQuery("."+discountNinja_Script_Notification.GetClass());return jQuery(t).find("[data-offer-token]").each(function(){let t=jQuery(this).attr("data-offer-token"),e=discountNinja.Offer.GetOfferByToken(t),n=discountNinja.DiscountTier.GetCurrentDiscountTier(e),i=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(n);discountNinja.ShortCode.RefreshResolvedPlaceholders(this,e,i)}),discountNinja.Logging.LogVerbose("Notification already exists, ensuring it is visible"),discountNinja_Script_Notification.ClearAnimation(t),discountNinja_Script_Notification.Hiding=!1,jQuery(t).show(),discountNinja_Script_Notification.IsMinimized()||discountNinja_Script_Notification.Maximize(),void discountNinja_Script_Notification.HighlightNewOffers(i)}discountNinja.Logging.LogVerbose("Notification does not exist, creating message"),LimoniAppsLoadJQuery(function(){LimoniAppsLoadJQueryNotify(function(){!function(e,n){try{let i=discountNinja_Script_Notification.DefaultOffer();if(!i)return;let o=discountNinja_Script_Notification.AppSettings(),r=i.Notification,a=discountNinja_Script_Notification.GetShownInSession(),c=e.trim().replace(/'/g,"&#39;");jQuery.notify({icon:"",title:"",message:""},{allow_dismiss:o.CloseButton||!1,type:"limoniapps-discountninja",placement:{from:r.PlacementVertical||"bottom",align:r.PlacementHorizontal||"top"},offset:{x:r.HorizontalOffset||0,y:r.VerticalOffset||0},delay:0,template:c,animate:{enter:a||!o.AnimationEnter?"":o.AnimationEnter,exit:""},onClose:function(){discountNinja_Script_Notification.Hide(!0)},onClosed:function(){discountNinja_Script_Notification.SetDismissedInSession(!0)},z_index:99999}),i&&jQuery(".limoniapps-notification").attr("data-token",i.Token);let s=jQuery("."+discountNinja_Script_Notification.GetClass());jQuery(s).click(function(){discountNinja_Script_Notification.SetUserToggledMinMaximize(!0),discountNinja_Script_Notification.ToggleMinMaximize()});let u=jQuery(s).html();if(u){let t="'",e='"',n=new RegExp(t+e,"g"),i=new RegExp(e+t,"g"),o=u.replace(n,e).replace(i,e);o!==u&&jQuery(s).html(o)}a&&o.MinimizeAfterFirstView&&discountNinja_Script_Notification.Minimize(),discountNinja_Script_Notification.ActAfterDelay(),discountNinja.Settings.Settings.General.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),discountNinja_Script_Notification.SetShownInSession(!0),o.AnimationOnReminder&&(clearInterval(discountNinja_Script_Notification.AnimateOnReminderIntervalHandle),t(o.AnimationOnReminder,o.ReminderDuration)),discountNinja_Script_Notification.HighlightNewOffers(n)}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternalAfterEnsuringDependencies",t),!1}}(e,i)})})}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternal",t),!1}}(discountNinja_Script_Notification.GetHtml(i),i,o),function(t){try{let e=discountNinja_Script_Notification.GetFromCache();for(let n=0;n<e.length;n++){let i=e[n];i.Animated=!1;for(let e=0;e<t.length;e++)if(i.Token===t[e]){i.Animated=!0;break}}discountNinja_Script_Notification.SaveToCache(e)}catch(t){discountNinja.Logging.LogError("Notification.MarkNotificationsAsAnimated",t)}}(o),discountNinja_Script_Notification.UpdateOfferCounter(r)}catch(t){discountNinja.Logging.LogError("Notification.Show",t)}},GetUserToggledMinMaximize:function(){let t=discountNinja.Cache.SessionGet("notification-usertoggled");return"true"===t||!0===t},SetUserToggledMinMaximize:function(t){discountNinja.Cache.SessionSet("notification-usertoggled",t)},IsMinimized:function(){return jQuery(".limoniapps-notification.active").hasClass("minimized")},GetShownInSession:function(){let t=discountNinja.Cache.SessionGet("notification-displayed-insession");return"true"===t||!0===t},SetShownInSession:function(t){discountNinja.Cache.SessionSet("notification-displayed-insession",t)},GetDismissedInSession:function(){let t=discountNinja.Cache.SessionGet("notification-dismissed-insession");return"true"===t||!0===t},SetDismissedInSession:function(t){discountNinja.Cache.SessionSet("notification-dismissed",t)},GetHiddenInSession:function(){let t=discountNinja.Cache.SessionGet("notification-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("notification-hidden-insession",t)}},discountNinja_Script_PopUp={GetElement:function(t){return jQuery(".limoniapps-popup[data-token='"+t+"']")},Hide:function(t){try{discountNinja_Script_PopUp.GetElement(t).hide()}catch(t){discountNinja.Logging.LogError("PopUp.Hide",t)}},InjectHtml:function(t,e){try{if(discountNinja_Script_PopUp.GetElement(t.Token).length>0)return void discountNinja.ShortCode.RefreshResolvedPlaceholders(discountNinja_Script_PopUp.GetElement(t.Token),t,e);let n=discountNinja.Utilities.IsMobilePhone()?t.PopUp.MobileSize:t.PopUp.Size,i=jQuery("#limoniapps-discountninja-popup-template").html();i=discountNinja.TemplateParameter.Replace(i,"HEADER",discountNinja.TextSettings.GetText(t.PopUp.Header,t)),i=discountNinja.TemplateParameter.Replace(i,"BODY",discountNinja.TextSettings.GetText(t.PopUp.Body,t)),i=discountNinja.TemplateParameter.Replace(i,"FOOTER",discountNinja.TextSettings.GetText(t.PopUp.Footer,t)),i=discountNinja.TemplateParameter.Replace(i,"NOTHANKSBUTTONLABEL",t.PopUp.NoThanksButtonLabel),i=discountNinja.TemplateParameter.Replace(i,"SIZE",n),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON1LABEL",t.PopUp.ActionButton1Label),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON1STYLE",t.PopUp.ActionButton1Style),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON1SIZE",t.PopUp.ActionButton1Size),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON2LABEL",t.PopUp.ActionButton2Label),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON2STYLE",t.PopUp.ActionButton2Style),i=discountNinja.TemplateParameter.Replace(i,"ACTIONBUTTON2SIZE",t.PopUp.ActionButton2Size),i=discountNinja.TemplateParameter.Replace(i,"BUTTONPLACEMENT","fullscreen"===n?"inside":t.PopUp.ButtonPlacement),i=discountNinja.TemplateParameter.Replace(i,"BACKGROUNDOVERLAY",t.PopUp.BackgroundOverlay),i=discountNinja.TemplateParameter.Replace(i,"SHAPE",t.PopUp.Shape),i=discountNinja.TemplateParameter.Replace(i,"CONTENTALIGNMENTHORIZONTAL",t.PopUp.ContentAlignmentHorizontal),i=discountNinja.TemplateParameter.Replace(i,"CONTENTALIGNMENTVERTICAL",t.PopUp.ContentAlignmentVertical),i=discountNinja.TemplateParameter.Replace(i,"BACKGROUNDTOPCOLORHEIGHT",t.PopUp.ContentAlignmentVertical),i=discountNinja.TemplateParameter.Replace(i,"BACKGROUNDTOPCOLORRADIUS",t.PopUp.BackgroundColorTopHeight),i=discountNinja.TemplateParameter.Replace(i,"BACKGROUNDTOPCOLORRADIUS",t.PopUp.BackgroundColorTopRadius),i=discountNinja.TemplateParameter.Replace(i,"TOKEN",t.Token);let o=function(t){let e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e}(i=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,i,e));document.body.insertBefore(o,document.body.childNodes[0])}catch(t){discountNinja.Logging.LogError("PopUp.InjectPopUpHtml",t)}},Show:function(t,e){function n(t,e){try{discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false"),discountNinja_Script_PopUp.Hide(t.Token),discountNinja.Offer.Stop()}catch(t){discountNinja.Logging.LogError("PopUp.Cancel",t)}}function i(t,e){discountNinja.Cache.LocalSet("popup-displayed-"+t,e)}try{discountNinja_Script_PopUp.InjectHtml(t,e);let c=t.Token;discountNinja.Logging.LogVerbose("Showing pop-up"),discountNinja.DiscountCode.Remove(c),discountNinja.Offer.RemoveFromCache(t);let s=discountNinja_Script_PopUp.GetElement(c);s.find('.limoniapps-close[data-notify="dismiss"]').click(function(){n(t)}),s.find(".limoniapps-lnk-dismiss").click(function(){n(t)}),s.find('.limoniapps-action-btn[data-action="apply"]').click(function(){!function(t,e){try{discountNinja_Script_PopUp.Hide(t.Token),discountNinja.PromotionFlow.ClearCartAdjustments(),discountNinja.PromotionFlow.AcceptPromotion(t,e),discountNinja.PromotionFlow.StopFlow()}catch(t){discountNinja.Logging.LogError("PopUp.Accept",t)}}(t,e)}),discountNinja.Settings.Settings.General.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),o=s.find(".limoniapps-content"),r=t.PopUp.Animation,a=t.PopUp,jQuery(o).removeClass(a.Animation),jQuery(o).addClass(r),s.show(),function(t){var e,n;"onceperdevice"===t.PopUp.Frequency?i(t.Token,"shown"):(i(t.Token,""),e=t.Token,n="shown",discountNinja.Cache.SessionSet("popup-displayed-"+e,n))}(t),discountNinja_Script_PopUp.PopUpDisplayed=!0}catch(t){discountNinja.Logging.LogError("PopUp.Show",t)}var o,r,a}},discountNinja_Script_StickyBar={AnimateOnReminderIntervalHandle:-1,CycleIntervalHandle:-1,CurrentLevelForPromotion:[],WrapperId:"limoniapps-discountninja-stickybar-wrapper",PusherId:"limoniapps-discountninja-stickybar-pusher",TopMarginClass:"limoniapps-discountninja-stickybar-topmargin",GetPusherElement:function(){return jQuery("#"+discountNinja_Script_StickyBar.PusherId)},GetWrapperElement:function(){return jQuery("#"+discountNinja_Script_StickyBar.WrapperId)},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.StickyBar}catch(t){discountNinja.Logging.LogError("StickyBar.AppSettings",t)}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.StickyBar&&discountNinja.Offer.PrimaryOffer.StickyBar.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(let t=0;t<discountNinja.Offer.Offers.length;t++){let e=discountNinja.Offer.Offers[t];if(e.StickyBar&&e.StickyBar.PlacementVertical&&(discountNinja.Offer.IsOfferAccepted(e.Token,e.Frequency)||e.StickyBar.ActionButton1&&"applydiscount"===e.StickyBar.ActionButton1.Action||e.StickyBar.ActionButton2&&"applydiscount"===e.StickyBar.ActionButton2.Action))return e}return null}catch(t){discountNinja.Logging.LogError("StickyBar.DefaultOffer",t)}},ShouldRequestNotification:function(){try{return!!pushowl&&!pushowl.browserHandler.isPermissionGranted}catch(t){return discountNinja.Logging.LogError("StickyBar.ShouldRequestNotification",t),!1}},RequestNotification:function(){try{if(!pushowl)return!1;pushowl.subscribeIfNotAlready()}catch(t){discountNinja.Logging.LogError("StickyBar.RequestNotification",t)}},SlideBodyDownLastExecuted:null,SlideBodyDown:function(){try{if(!function(){let t=discountNinja_Script_StickyBar.SlideBodyDownLastExecuted,e=!0;return null!==t&&new Date-t<50&&(e=!1),discountNinja_Script_StickyBar.SlideBodyDownLastExecuted=new Date,e}())return;let t=discountNinja_Script_StickyBar.DefaultOffer(),e=t?t.StickyBar:null;if(null===e)return;if("top_page_sticky"===e.PlacementVertical||"top_page"===e.PlacementVertical){discountNinja.Logging.LogVerbose("Applying margin to sticky bar since it is positioned on the top");let t=discountNinja_Script_StickyBar.GetWrapperElement().outerHeight();discountNinja_Script_StickyBar.GetPusherElement().height(t),discountNinja_Script_StickyBar.AddTopMarginToElements(t)}else discountNinja.Logging.LogVerbose("No margin applied to sticky bar since it is positioned on the bottom")}catch(t){discountNinja.Logging.LogError("StickyBar.SlideBodyDown",t)}},TopMarginDesktopElements:function(){try{let t=[];return t.push(".limoniapps-discountninja-topmargin-desktop"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginDesktopElements",t),[]}},TopMarginMobileElements:function(){try{let t=[];return t.push(".limoniapps-discountninja-topmargin-mobile"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginMobileElements",t),[]}},TopMarginIncludeClasses:function(){try{let t=[];return t.push("limoniapps-discountninja-topmargin"),t.push("limoniapps-discountninja-header"),t.push("limoniapps-discounturl-header"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginIncludeClasses",t),[]}},TopMarginElements:function(){try{let t=[],e=discountNinjaContext.Flags.StickyBarShouldPushSelectors;if(e&&""!==e&&t.push(e),discountNinja.Settings&&discountNinja.Settings.Settings){let e=discountNinja.Settings.Settings.PriceUpdate.Mode.StickyBarShouldPushSelectors;e&&""!==e&&t.push(e)}return t.push(".limoniapps-discountninja-topmargin, .limoniapps-discountninja-header, .limoniapps-discounturl-header"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginElements",t),[]}},TopMarginExcludeClasses:function(){try{let t=[];return t.push("limoniapps-discountninja-topmargin-ignore"),t.push("limoniapps-discountninja-header-ignore"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginExcludeElements",t),[]}},AddTopMarginToElements:function(t){function e(t,e){try{discountNinja.Logging.LogVerbose("Applying top margin "+e+"px to element "+discountNinja.Utilities.GetElementId(t)),discountNinja.Utilities.AppendToStyle(t,"margin-top",e.toString()+"px !important"),discountNinja.Utilities.AppendToStyle(t,"background-position","0% "+e.toString()+"px !important")}catch(t){discountNinja.Logging.LogError("StickyBar.ApplyTopMarginToElementStyle",t)}}function n(t,n){try{if(0===jQuery(t).length)return;let i=discountNinja_Script_StickyBar.TopMarginExcludeClasses(),o=!1;for(let e=0;e<i.length;e++)if(jQuery(t).hasClass(i[e])){o=!0;break}let r=discountNinja_Script_StickyBar.TopMarginIncludeClasses(),a=!1;for(let e=0;e<r.length;e++)if(jQuery(t).hasClass(r[e])){a=!0;break}if(void 0!==jQuery(t).attr("data-original-body-margin-top")){discountNinja.Logging.LogVerbose("Updating top margin of "+n+"px to element "+discountNinja.Utilities.GetElementId(t)),e(t,parseInt(jQuery(t).attr("data-original-body-margin-top"))+n)}else{discountNinja.Logging.LogVerbose("Adding top margin "+n+"px to element "+discountNinja.Utilities.GetElementId(t));let i=parseInt(jQuery(t).css("margin-top")),o=jQuery(t).css("background-position");e(t,i+n),jQuery(t).attr("data-original-body-margin-top",i),jQuery(t).attr("data-original-body-background-position",o)}}catch(t){discountNinja.Logging.LogError("StickyBar.ShowTopMarginToElement",t)}}try{jQuery("body").addClass(discountNinja_Script_StickyBar.TopMarginClass);let e=discountNinja_Script_StickyBar.TopMarginElements();e=discountNinja.Utilities.IsMobilePhone()?e.concat(discountNinja_Script_StickyBar.TopMarginMobileElements()):e.concat(discountNinja_Script_StickyBar.TopMarginDesktopElements());for(let i=0;i<e.length;i++)jQuery(e[i]).each(function(){n(e[i],t)})}catch(t){discountNinja.Logging.LogError("StickyBar.AddTopMarginToElements",t)}},RemoveTopMarginFromElements:function(){function t(t){try{if(jQuery("body").removeClass(discountNinja_Script_StickyBar.TopMarginClass),0===jQuery(t).length)return;try{discountNinja.Logging.LogVerbose("Removing top margin from element "+("body"===t?"body":jQuery(t).attr("id")))}catch(t){}let e=parseInt(jQuery(t).attr("data-original-body-margin-top")),n=jQuery(t).attr("data-original-body-background-position");jQuery(t).css("margin-top",e.toString()+"px"),jQuery(t).css("background-position",n)}catch(t){discountNinja.Logging.LogError("StickyBar.HideTopMarginFromElement",t)}}try{discountNinja_Script_StickyBar.GetPusherElement().height(0);let e=discountNinja_Script_StickyBar.TopMarginElements();for(let n=0;n<e.length;n++)jQuery(e[n]).each(function(){t(e[n])})}catch(t){discountNinja.Logging.LogError("StickyBar.RemoveTopMarginFromElements",t)}},OnAction:function(t,e,n){try{let i=1===t?e.StickyBar.ActionButton1:e.StickyBar.ActionButton2;discountNinja.ActionButton.HandleAction(i,e,n)}catch(t){discountNinja.Logging.LogError("StickyBar.OnAction",t)}},Hide:function(t){function e(t){try{discountNinja_Script_StickyBar.GetWrapperElement().hide();let e=discountNinja_Script_StickyBar.DefaultOffer(),n=e?e.StickyBar:null;!n||"top_page_sticky"!==n.PlacementVertical&&"top_page"!==n.PlacementVertical||discountNinja_Script_StickyBar.RemoveTopMarginFromElements(),t&&discountNinja_Script_StickyBar.SetHiddenInSession(!0),discountNinja.Logging.LogVerbose("Sticky bar hidden")}catch(t){discountNinja.Logging.LogError("StickyBar.HideInner",t)}}try{discountNinja.Logging.LogVerbose("Hiding sticky bar");let n=discountNinja_Script_StickyBar.AppSettings();n.AnimationExit?(discountNinja_Script_StickyBar.ApplyAnimation(discountNinja_Script_StickyBar.GetWrapperElement(),n.AnimationExit),e(t)):e(t)}catch(t){discountNinja.Logging.LogError("StickyBar.Hide",t)}},Remove:function(t){try{discountNinja.Logging.LogInformation("StickyBar.Remove for token "+t);let e=discountNinja_Script_StickyBar.GetFromCache(),n=[];for(let i=0;i<e.length;i++)e[i].Token!==t&&n.push(e[i]);discountNinja_Script_StickyBar.MessageCount=n.length,discountNinja_Script_StickyBar.SaveToCache(n),setTimeout(function(){try{discountNinja_Script_StickyBar.Show()}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}},500)}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}},Clear:function(){discountNinja.Logging.LogInformation("StickyBar.Clear called "),discountNinja_Script_StickyBar.MessageCount=0,discountNinja.Cache.SessionRemove("stickybar-data")},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("stickybar-data"),e=null===(t="undefined"===t?[]:JSON.parse(t))?[]:t;return discountNinja_Script_StickyBar.MessageCount=e.length,e}catch(t){return discountNinja.Logging.LogError("StickyBar.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("stickybar-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("StickyBar.SaveToCache",t)}},Add:function(t,e){try{discountNinja.Logging.LogInformation("StickyBar.Add for token "+t),t||discountNinja.Logging.LogErrorMessage("StickyBar.Add","Expected token");let n=discountNinja_Script_StickyBar.GetFromCache();for(let e=0;e<n.length;e++)if(n[e]&&n[e].Token===t)return;n.push({Token:t,PlacementVertical:e}),discountNinja_Script_StickyBar.MessageCount=n.length,discountNinja_Script_StickyBar.SaveToCache(n)}catch(t){discountNinja.Logging.LogError("StickyBar.Add",t)}},CurrentMessageIndex:0,MessageCount:0,CycleMessage:function(t){try{discountNinja.Logging.LogVerbose("StickyBar.CycleMessage");let e=discountNinja_Script_StickyBar.AppSettings(),n=e.Cycle.DurationMilliseconds>0?e.Cycle.DurationMilliseconds:6e3;discountNinja_Script_StickyBar.CycleIntervalHandle>0&&clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),discountNinja_Script_StickyBar.CycleIntervalHandle=setInterval(function(){!function(t){try{if(discountNinja_Script_StickyBar.MessageCount<=1)return;discountNinja_Script_StickyBar.CurrentMessageIndex=discountNinja_Script_StickyBar.CurrentMessageIndex+1,discountNinja_Script_StickyBar.ShowMessage(t),t=!0}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage.CycleMessageInner",t)}}(t)},n)}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage",t)}},ClearAnimation:function(t){try{let e=discountNinja_Script_StickyBar.AppSettings();jQuery(t).removeClass(e.AnimationEnter),jQuery(t).removeClass(e.AnimationOnGoal),jQuery(t).removeClass(e.AnimationOnReminder),jQuery(t).removeClass(e.AnimationExit),jQuery(t).removeClass(e.Cycle.AnimationOnCyle)}catch(t){discountNinja.Logging.LogError("StickyBar.ClearAnimation",t)}},ApplyAnimation:function(t,e){try{if(!e)return;discountNinja_Script_StickyBar.ClearAnimation(t),jQuery(t).addClass(e)}catch(t){discountNinja.Logging.LogError("StickyBar.ApplyAnimation",t)}},ShowMessage:function(t){function e(t,e){try{return discountNinja.Timer.IsTimerStarted()?discountNinja.TextSettings.WrapInColor(t.StickyBar.TimerFooterTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBar.TimerFooter,t),e)):""}catch(t){return discountNinja.Logging.LogError("StickyBar.GetTimerFooterMessage",t),""}}function n(t){if(t.StickyBar.AnimationOnGoal){let e=!1,n=discountNinja.DiscountTier.GetCurrentDiscountTier(t),i=discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token];(e=void 0!==i?i<n:n>0)&&(discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token]=n,function(t){let e=jQuery(".limoniapps-sticky-bar .limoniapps-content");discountNinja_Script_StickyBar.ApplyAnimation(e,t)}(discountNinja_Script_StickyBar.AppSettings.AnimationOnGoal))}}function i(t,n){discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Change messages");let i=discountNinja_Script_StickyBar.GetWrapperElement(),o=jQuery(i).find(".limoniapps-message.limoniapps-message-body"),r=jQuery(i).find(".limoniapps-message.limoniapps-message-timerfooter"),a=function(t,e){try{return discountNinja.TextSettings.WrapInColor(t.StickyBar.BodyTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBar.Body,t),e))}catch(t){return discountNinja.Logging.LogError("StickyBar.GetBodyMessage",t),""}}(t,n),c=e(t,n);jQuery(o).html(a,n),jQuery(r).html(c)}try{let o=discountNinja_Script_StickyBar.GetFromCache();discountNinja_Script_StickyBar.CurrentMessageIndex>=o.length&&(discountNinja_Script_StickyBar.CurrentMessageIndex=0);let r=discountNinja_Script_StickyBar.CurrentMessageIndex;discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Index: "+r);let a=o[r];if(!a)return void discountNinja.Logging.LogErrorMessage("StickyBar.ShowMessage","Sticky bar "+r+" not found");let c=discountNinja.Offer.GetOfferByToken(a.Token);if(!c)return void discountNinja.Logging.LogVerbose("Stickybar refers to offer "+a.Token+", which is not available");let s=discountNinja.DiscountTier.GetCurrentDiscountTier(c),u=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(s),d=c.StickyBar;discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Token: "+c.Token);let l=discountNinja_Script_StickyBar.AppSettings(),g=discountNinja_Script_StickyBar.GetWrapperElement(),f=jQuery(g).find(".limoniapps-col-info");jQuery(g).find(".limoniapps-sticky-bar-wrapper").attr("data-token",c.Token),d.ActionButton1&&(discountNinja.ActionButton.HideIfNecessary(d.ActionButton1,c,1),g.find(".limoniapps-action.button1 .limoniapps-action-btn").click(function(){try{discountNinja_Script_StickyBar.OnAction(1,c,u)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton1Click",t),!1}})),d.ActionButton2&&(discountNinja.ActionButton.HideIfNecessary(d.ActionButton2,c,2),g.find(".limoniapps-action.button2 .limoniapps-action-btn").click(function(){try{discountNinja_Script_StickyBar.OnAction(2,c,u)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton2Click",t),!1}}));let p=l.Cycle.AnimationOnCyle;if(t&&p&&o.length>0){let t=function(t){let e=t.split(" ");return 3===e.length?e[0]+" "+e[2]:e[0]+" "+e[1]}(p),o=function(t){let e=t.split(" ");return e[0]+" "+e[1]}(p);o!==t?(discountNinja_Script_StickyBar.ApplyAnimation(f,o),setTimeout(function(){try{timerFooterMessage=e(c),i(c,u),jQuery(f).hide(),setTimeout(function(){try{jQuery(f).show(),discountNinja_Script_StickyBar.ApplyAnimation(f,t)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}},50),n(c)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}},500)):(i(c,u),discountNinja_Script_StickyBar.ApplyAnimation(f,t))}else i(c,u);return setTimeout(function(){discountNinja_Script_StickyBar.SlideBodyDown()},50),n(c),!0}catch(t){return discountNinja.Logging.LogError("StickyBar.ShowMessage",t),!1}},Show:function(){try{if(discountNinja_Script_StickyBar.GetHiddenInSession())return;if(discountNinja_Script_StickyBar.MessageCount<=0)return void discountNinja_Script_StickyBar.Hide();let e=discountNinja_Script_StickyBar.DefaultOffer();if(!e)return;let n=e.StickyBar,i=discountNinja_Script_StickyBar.AppSettings(),o=discountNinja_Script_StickyBar.GetWrapperElement(),r=jQuery(o).is(":visible"),a="true"===discountNinja.Cache.SessionGet("stickybar-displayed-insession");if(!r){let r="limoniapps-stick-to-"+n.PlacementVertical;t=!0,discountNinja.Cache.SessionSet("stickybar-displayed-insession",t);let a=function(t){function e(t,e){""!==t&&e.push(t)}try{let n=t.StickyBar,i=jQuery("#limoniapps-discountninja-stickybar-template").html(),o=discountNinja.DiscountTier.GetCurrentDiscountTier(t),r=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(o),a=discountNinja_Script_Notification.GetText(n.Body,t,r),c=discountNinja.TextSettings.WrapInColor(n.BodyTextColor,a),s=discountNinja.TextSettings.WrapInColor(n.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(n.TimerFooter,t,r):""),u=[];e(n.CloseButton?"closeable":"",u),e(n.ActionButton1?"hasaction1":"",u),e(n.ActionButton2?"hasaction2":"",u),e(n.HasImage?"hasimage":"",u);let d=u.join(" ");return i=discountNinja.TemplateParameter.Replace(i,"BODY",c),i=discountNinja.TemplateParameter.Replace(i,"TIMERFOOTER",s),i=discountNinja.TemplateParameter.Replace(i,"HEIGHT",discountNinja.Utilities.IsMobilePhone()?n.MobileHeight:n.Height),i=discountNinja.TemplateParameter.Replace(i,"FLAGS",d),i=discountNinja.TemplateParameter.Replace(i,"TOKEN",t.Token),i=discountNinja.TemplateParameter.Replace(i,"WIDTH",n.Width?n.Width:""),i=discountNinja.ActionButton.ReplacePlaceHoldersForButton(i,t,r,1,n.ActionButton1),i=discountNinja.ActionButton.ReplacePlaceHoldersForButton(i,t,r,2,n.ActionButton2)}catch(t){return discountNinja.Logging.LogError("StickyBar.GetHtml",t),""}}(e);if(null===a)return;let c=(0===discountNinja_Script_StickyBar.GetPusherElement().length?'<div id="limoniapps-discountninja-stickybar-pusher" class="limoniapps-sticky-bar-pusher"></div>':"")+'<div id="'+discountNinja_Script_StickyBar.WrapperId+'" class="'+r+'" style="display:none;">'+a+"</div>";if("top_header"===n.PlacementVertical){let t=jQuery(".limoniapps-discountninja-headersection");0===t.length&&(t=jQuery("#shopify-section-header")),t.append(c)}else jQuery("body").prepend(c);o=discountNinja_Script_StickyBar.GetWrapperElement(),n.CloseButton&&o.find('.limoniapps-close[data-notify="dismiss"]').click(function(){try{discountNinja_Script_StickyBar.Hide(!0)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.Dismiss",t),!1}});let s=discountNinja_Script_StickyBar.DefaultOffer;s&&s.StickyBar&&jQuery(o).css("background-color",s.StickyBar.BackgroundColor);let u=i.Delay;u&&u>0&&setTimeout(function(){discountNinja_Script_StickyBar.Hide(!0)},u),discountNinja.Settings.Settings.General.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden")}"cycle"===i.Cycle.Mode&&discountNinja_Script_StickyBar.MessageCount>1?(clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),discountNinja_Script_StickyBar.CycleMessage(!1)):(discountNinja_Script_StickyBar.CurrentMessageIndex=0,discountNinja_Script_StickyBar.ShowMessage(!1)),i.AnimationOnReminder&&(clearInterval(discountNinja_Script_StickyBar.AnimateOnReminderIntervalHandle),function t(e,n){setTimeout(function(){try{discountNinja_Script_StickyBar.ApplyAnimation(jQuery(".limoniapps-sticky-bar .limoniapps-col-info"),e),t(e,n)}catch(t){discountNinja.Logging.LogError("StickyBar.AnimateOnReminder",t)}},n)}(i.AnimationOnReminder,i.ReminderDuration)),jQuery(window).on("resize",function(){discountNinja_Script_StickyBar.SlideBodyDown()});let c=r||a||!i.AnimationEnter?"":i.AnimationEnter;""!==c&&discountNinja_Script_StickyBar.ApplyAnimation("#"+discountNinja_Script_StickyBar.WrapperId,c),o.show()}catch(t){return discountNinja.Logging.LogError("StickyBar.Show",t),!1}var t},GetHiddenInSession:function(){let t=discountNinja.Cache.SessionGet("stickybar-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("stickybar-hidden-insession",t)}},discountNinja_Script_Timer={TimeZone:null,TimerIntervalId:null,Start:function(t){function e(t,e){try{return discountNinja_Script_Timer.TimerLabels[t][e]}catch(t){return discountNinja.Logging.LogError("Timer.GetTimeLabel",t),""}}function n(t,n,i){try{let o=discountNinja.DateTime.GetDuration(n,"seconds"),r=function(t,e){try{return 1===e?t.CountdownClock.FormattingTemplateIn_Style1:2===e?t.CountdownClock.FormattingTemplateIn_Style2:3===e?t.CountdownClock.FormattingTemplateIn_Style3:4===e?t.CountdownClock.FormattingTemplateIn_Style4:5===e?t.CountdownClock.FormattingTemplateIn_Style5:t.CountdownClock.FormattingTemplateIn_Style1}catch(t){return discountNinja.Logging.LogError("Timer.GetFormattingForStyle",t),""}}(t,i);if(null===r)return"";let a=r,c="d,h,m,s".split(",");for(let t=0;t<c.length;t++){let e=c[t];if(Math.floor(o.as(e))>0)a=a.replace("{"+e+"}","").replace("{\\"+e+"}","");else{let t="{"+e+"}(.)*{\\\\"+e+"}";a=a.replace(new RegExp(t),"")}}for(let t=0;t<c.length;t++){let e=c[t];a=a.replace("["+e+"]",o.get(e))}for(let t=0;t<5;t++)for(let n=0;n<2;n++)a=a.replace("["+t+","+n+"]",e(t,n));return a}catch(t){return discountNinja.Logging.LogError("Timer.TimeFormattingInternal",t),""}}function i(t){let e=discountNinja.DateTime,n=e.GetUtc(t);return e.DiffInSeconds(e.GetUtc(n),e.UtcNow())}function o(t,e){try{let o=i(e);if(o>0){if("function"!=typeof dayjs||"function"!=typeof dayjs.duration||"object"!=typeof dayjs.duration(10,"seconds"))return discountNinja.Logging.LogVerbose("Timer dependencies not ready, skipping update"),void LimoniAppsLoadDayJs(function(){discountNinja.Logging.LogVerbose("Loading timer dependencies")});jQuery(".limoniapps-discountninja-timer").each(function(){let e=jQuery(this).attr("data-style"),i=n(t,o,e);i=i.replace(/(\d)/g,'<div class="limoniapps-discountninja-countdownclock-digit-wrapper"><div class="limoniapps-discountninja-countdownclock-digit">$1</div></div>'),jQuery(this).html('<div class="limoniapps-discountninja-countdownclock-container style'+e+'">'+i+"</div>")})}else!function(){try{discountNinja.Logging.LogVerbose("Expiring timer"),discountNinja_Script_Timer.IsTimerStarted()?(discountNinja_Script_Timer.SetTimerStarted(!1),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),discountNinja.Logging.LogVerbose("Timer stopped, restarting flow"),location.reload()):discountNinja.Logging.LogVerbose("Timer was not started")}catch(t){discountNinja.Logging.LogError("Timer.Expire",t)}}()}catch(t){discountNinja.Logging.LogError("Timer.UpdateTimer",t)}}try{let e=t?t.TriggeredByTrigger.CountdownClock.EndsAt:null;if(!e)return;if(i(e)<=0)return;let n=discountNinja.Settings.Settings;if(!n||!n.CountdownClock)return;!function(t){function e(t){try{return t&&""!==t?[t,t,t]:null}catch(t){return discountNinja.Logging.LogError("Timer.ProcessCustomTimeLabels",t),null}}try{let n=e(t.CustomDaysLabel)||["days","days","d"],i=e(t.CustomHoursLabel)||["hours","hrs","h"],o=e(t.CustomMinutesLabel)||["minutes","min","m"],r=e(t.CustomSecondsLabel)||["seconds","sec","s"],a=e(t.CustomAndLabel)||["and","&","&"];discountNinja_Script_Timer.TimerLabels=[n,i,o,r,a]}catch(t){discountNinja.Logging.LogError("Timer.ProcessCountdownClock",t)}}(n.CountdownClock),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),discountNinja_Script_Timer.TimerIntervalId=window.setInterval(function(){o(n,e)},1e3),o(n,e),discountNinja_Script_Timer.SetTimerStarted(!0),discountNinja.Logging.LogVerbose("Started timer")}catch(t){discountNinja.Logging.LogError("Timer.Start",t)}},Stop:function(){discountNinja_Script_Timer.SetTimerStarted(!1)},ShouldStartOn:function(t,e){return!!(t&&t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock)&&t.TriggeredByTrigger.CountdownClock.Trigger===e},ShouldStartOnDisplay:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"displayed")},ShouldStartOnAccept:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"accepted")},ShouldStartOnGoalAchieved:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"goalachieved")},ShouldNotStart:function(t){return!!(t&&t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock)&&!t.TriggeredByTrigger.CountdownClock.Trigger},IsTimerStarted:function(){return"true"===discountNinja.Cache.SessionGet("timer-started")},SetTimerStarted:function(t){discountNinja.Cache.SessionSet("timer-started",t)}},discountNinja_Script_Cache={_SupportsCacheLocal:null,_SupportsCacheSession:null,Fallback:{},SupportsCacheLocal:function(){try{return null===discountNinja_Script_Cache._SupportsCacheLocal&&(localStorage.setItem("testSupportsCacheLocal","testSupportsCacheLocal"),localStorage.removeItem("testSupportsCacheLocal"),discountNinja_Script_Cache._SupportsCacheLocal=!0),discountNinja_Script_Cache._SupportsCacheLocal}catch(t){return discountNinja_Script_Cache._SupportsCacheLocal=!1,!1}},SupportsCacheSession:function(){try{return null===discountNinja_Script_Cache._SupportsCacheSession&&(sessionStorage.setItem("testSupportsCacheSession","testSupportsCacheSession"),sessionStorage.removeItem("testSupportsCacheSession"),discountNinja_Script_Cache._SupportsCacheSession=!0),discountNinja_Script_Cache._SupportsCacheSession}catch(t){return discountNinja_Script_Cache._SupportsCacheSession=!1,!1}},LocalRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionRemove(t)}catch(e){discountNinja.Logging.LogError("Cache.LocalRemove",e),discountNinja_Script_Cache.SessionRemove(t)}},LocalGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionGet(t)}catch(e){return discountNinja.Logging.LogError("Cache.LocalGet",e),discountNinja_Script_Cache.SessionGet(t)}},LocalSet:function(t,e){try{discountNinja_Script_Cache.SupportsCacheLocal()?(discountNinja_Script_Cache.LocalRemove(t),localStorage.setItem("limoniapps-discountninja-"+t,e)):discountNinja_Script_Cache.SessionSet(t,e)}catch(n){discountNinja.Logging.LogError("Cache.LocalSet",n),discountNinja_Script_Cache.SessionSet(t,e)}},SessionRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackRemove(t)}catch(e){discountNinja.Logging.LogError("Cache.SessionRemove",e),discountNinja_Script_Cache.FallbackRemove(t)}},SessionGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackGet(t)}catch(e){return discountNinja.Logging.LogError("Cache.SessionGet",e),discountNinja_Script_Cache.FallbackGet(t)}},SessionSet:function(t,e){try{discountNinja_Script_Cache.SupportsCacheSession()?(discountNinja_Script_Cache.SessionRemove(t),sessionStorage.setItem("limoniapps-discountninja-"+t,e)):discountNinja_Script_Cache.FallbackSet(t,e)}catch(n){discountNinja.Logging.LogError("Cache.SessionSet",n),discountNinja_Script_Cache.FallbackSet(t,e)}},FallbackRemove:function(t){try{delete discountNinja_Script_Cache.Fallback[t]}catch(t){discountNinja.Logging.LogError("Cache.FallbackRemove",t)}},FallbackGet:function(t){try{return discountNinja_Script_Cache.Fallback.hasOwnProperty(t)?discountNinja_Script_Cache.Fallback[t]:null}catch(t){return discountNinja.Logging.LogError("Cache.FallbackGet",t),null}},FallbackSet:function(t,e){try{discountNinja_Script_Cache.Fallback[t]=String(e)}catch(t){discountNinja.Logging.LogError("Cache.FallbackSet",t)}},FallbackClear:function(){try{discountNinja_Script_Cache.Fallback={}}catch(t){discountNinja.Logging.LogError("Cache.FallbackClear",t)}},LocalClear:function(){try{discountNinja_Script_Cache.SupportsCacheLocal()&&localStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.LocalClear",t)}},SessionClear:function(){try{discountNinja_Script_Cache.SupportsCacheSession()&&sessionStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.SessionClear",t)}},Clear:function(){try{discountNinja_Script_Cache.LocalClear(),discountNinja_Script_Cache.SessionClear(),discountNinja_Script_Cache.FallbackClear()}catch(t){discountNinja.Logging.LogError("Cache.ClearCache",t)}}},discountNinja_Script_Cookie={GetCookie:function(t){return(document.cookie.match("(^|; )"+t+"=([^;]*)")||0)[2]},GetDiscountCodeCookie:function(){return discountNinja_Script_Cookie.GetCookie("discount_code")},AppendDiscountCodeToCookie:function(t){discountNinja_Script_Cookie.RemoveDiscountCodesFromCookie();let e="discount_code="+encodeURI(t)+"; path=/";discountNinja.Logging.LogVerbose("Adding/updating cookie: "+e,!1),document.cookie=e},RemoveDiscountCodesFromCookie:function(){document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}},discountNinja_Script_Events={GetFullQualifiedEventName:function(t){return"limoniApps:discountNinja:"+t},Publish:function(t,e){let n=discountNinja_Script_Events.GetFullQualifiedEventName(t);jQuery(document).trigger(n,e)},Subscribe:function(t,e,n){null==n&&(n=!0);let i=discountNinja_Script_Events.GetFullQualifiedEventName(t);n&&jQuery(document).off(i),discountNinja.Logging.LogVerbose("Subscribing to event "+i),jQuery(document).on(i,function(){e&&e.apply(this,arguments)})}},discountNinja_Script_Logging={WriteToConsole:!1,LogTimeElapsed:!1,LogWarningToServer:!0,LogMessageHeader:"Discount Ninja - ",Tracing:!1,LogErrorMessage:function(t,e){try{message=null==e?t:"Error occurred in "+t+".\r\nError message: '"+e+"'",discountNinja_Script_Logging.LogToConsole("error",message),discountNinja_Script_Logging.TrackMessage(message,"error")}catch(t){}},LogError:function(t,e,n){try{n=n||"error",message="Error occurred in "+t+".\r\nError message: '"+e.message+"'.\r\nStack: '"+e.stack+"'",discountNinja_Script_Logging.LogToConsole(n,message),discountNinja_Script_Logging.TrackMessage(e,n)}catch(t){}},LogWarning:function(t,e){try{e&&discountNinja_Script_Logging.LogToConsole("warning",t),discountNinja_Script_Logging.TrackMessage(t,"warning")}catch(t){}},LogInformation:function(t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("information",t,"blue"),discountNinja_Script_Logging.TrackMessage(t,"information")}catch(t){}},LogVerbose:function(t){},BuildTrackingClient:function(){try{window.bugsnagClient=bugsnag({apiKey:"7e5b70374d322898dab33544f375cd38",releaseStage:"prod"===discountNinja.Core.Environment?"production":"development",appType:"client",appVersion:discountNinja.Core.Version,autoNotify:!1,interactionBreadcrumbsEnabled:!1,logger:null}),window.bugsnagClient.user={name:discountNinja.Core.Shop}}catch(t){}},TrackMessage:function(t,e){try{void 0!==window.bugsnag&&(void 0===window.bugsnagClient&&discountNinja_Script_Logging.BuildTrackingClient(),"object"==typeof window.bugsnagClient&&(window.bugsnagClient.leaveBreadcrumb(t),"error"===e&&window.bugsnagClient.notify(new Error(t))))}catch(t){}},LogTestMode:function(t,e,n,i){try{if(!0===discountNinja.TestMode.TestMode&&(logToServer=!1),!0!==i&&!0!==logToServer||discountNinja_Script_Logging.LogInformation(e||t),!0===n){let e="- "+t+"<br/>";for(let t=0;t<discountNinja.TestMode.TestModeOutput.length;t++)if(discountNinja.TestMode.TestModeOutput[t]===e)return;discountNinja.TestMode.TestModeOutput.push(e),discountNinja.TestMode.TestModeOutputIssue=!0}}catch(t){}},LogToConsole:function(t,e,n,i,o){try{!discountNinja_Script_Logging.Tracing||"error"!==t&&"critical"!==t&&"warning"!==t||alert(e),o||(e=discountNinja_Script_Logging.LogMessageHeader+e);let r="error"===t||"critical"===t?Function.prototype.bind.call(console.error,console):"warn"===t||"warning"===t?Function.prototype.bind.call(console.warn,console):"debug"===t||"verbose"===t?Function.prototype.bind.call(console.debug,console):Function.prototype.bind.call(console.log,console);n=n||"black";let a="";!0===(i=i||!1)&&(a="font-weight: bold;"),r.apply(console,["%c"+e,"color: "+n+";"+a])}catch(t){try{console&&console.log(e)}catch(t){}}},HandleQueryParameter:function(){discountNinja_Script_Logging.Tracing=discountNinja.QueryParameter.GetFlag("discountninjatracing",!0,!0,!1,!0),discountNinja_Script_Logging.WriteToConsole=discountNinja.QueryParameter.GetFlag("discountninjalog",!0,!0,!1,!0)}},discountNinja_Script_Currency={GetCurrencyFormat:function(){try{let t=discountNinja.Settings.Settings.Currency,e=discountNinjaContext.PresentmentCurrency,n=discountNinjaContext.ShopCurrency,i=null===t.MoneyFormat||""===t.MoneyFormat.trim()?'<span class="money">{{amount}}</span>':t.MoneyFormat;if(e===n)return i;{let o=t.BaseCurrencySymbol;return presentmentCurrencySymbol=discountNinja_Script_Currency.GetCurrencySymbol(e),i.replace(new RegExp(n,"g"),e).replace(new RegExp(o,"g"),presentmentCurrencySymbol)}}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencyFormat",t),""}},GetCurrencySymbol:function(t){try{if(discountNinjaContext&&discountNinjaContext.EnabledCurrencies)for(let e=0;e<discountNinjaContext.EnabledCurrencies.length;e++){let n=discountNinjaContext.EnabledCurrencies[e];if(n.IsoCode===t)return n.Symbol}return""}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencySymbol",t),""}},Convert:function(t,e){try{let n=discountNinja.Settings.Settings.Currency,i=t*JSON.parse(n.ConversionRates)[e],o=n.RoundingAlgorithm;return"exact"===o?i:"ceiling"===o?Math.ceil(i):"floor"===o?Math.floor(i):"round"===o?Math.round(i):"roundtofive"===o?5*Math.round(i/5):"floortofive"===o?5*Math.floor(i/5):"ceiltofive"===o?5*Math.ceil(i/5):5*Math.round(i/5)}catch(e){return discountNinja.Logging.LogError("Currency.Convert",e),t}}},discountNinja_Script_MultiCurrency={UpdateCurrency:function(){try{"object"==typeof window.DoublyGlobalCurrency?function(){try{let t=discountNinja.Settings.Settings.Currency,e=t.BaseCurrency;void 0!==window.DoublyGlobalCurrency.currentCurrency&&null!==window.DoublyGlobalCurrency.currentCurrency&&""!==window.DoublyGlobalCurrency.currentCurrency&&(e=window.DoublyGlobalCurrency.currentCurrency),"function"==typeof window.DoublyGlobalCurrency.convertAll&&(e!==t.BaseCurrency&&(discountNinja.Logging.LogVerbose("Updating currency - Doubly - Back to base currency: "+t.BaseCurrency),window.DoublyGlobalCurrency.convertAll(t.BaseCurrency,".money")),discountNinja.Logging.LogVerbose("Updating currency - Doubly - To current currency: "+e),window.DoublyGlobalCurrency.convertAll(e,".money"))}catch(t){discountNinja.Logging.LogError("UpdateCurrencyDoubly",t,"warning")}}():"object"==typeof window.Geolizr?function(){try{if("object"==typeof window.Geolizr){let t=discountNinja.Settings.Settings.Currency.BaseCurrency,e=window.Geolizr.getCurrency();discountNinja.Logging.LogVerbose("Updating currency - Switching to "+e),window.Geolizr.moneyFormats[t]&&window.Geolizr.moneyFormats[e]?(window.Geolizr.switchCurrency(t),window.Geolizr.switchCurrency(e)):discountNinja.Logging.LogVerbose("Currency unavailable "+t+" or "+e)}}catch(t){discountNinja.Logging.LogError("UpdateCurrencyGeolizr",t,"warning")}}():"object"==typeof window.SECOMAPP&&"object"==typeof window.Currency?function(){try{let t=discountNinja.Settings.Settings.Currency,e=t.BaseCurrency,n=t.BaseCurrency;void 0!==window.Currency.shopCurrency&&null!==window.Currency.shopCurrency&&""!==window.Currency.shopCurrency&&(e=window.Currency.shopCurrency),void 0!==window.Currency.currentCurrency&&null!==window.Currency.currentCurrency&&""!==window.Currency.currentCurrency&&(n=window.Currency.currentCurrency),e!==n&&"function"==typeof window.Currency.convertAll&&(discountNinja.Logging.LogVerbose("Updating currency - SECOMAPP - From base currency: "+e+" - To current currency: "+n),window.Currency.convertAll(e,n))}catch(t){discountNinja.Logging.LogError("UpdateCurrencySecomapp",t,"warning")}}():"function"==typeof window.convertCurrencies&&"object"==typeof window.Currency&&function(){try{"function"==typeof window.convertCurrencies&&(discountNinja.Logging.LogVerbose("Updating currency - Standard"),window.convertCurrencies())}catch(t){discountNinja.Logging.LogError("UpdateCurrencyStandard",t,"warning")}}();try{jQuery(document).trigger("switch-currency")}catch(t){discountNinja.Logging.LogError("UpdateCurrency Switch currency",t,"warning")}}catch(t){discountNinja.Logging.LogError("UpdateCurrency",t,"warning")}}},discountNinja_Script_QueryParameter={GetQueryParameters:function(t){try{let e,n=null==t?window.location.href.replace(window.location.hash,""):t.indexOf("#")>-1?t.substring(0,t.indexOf("#")):t,i=[],o=n.slice(n.indexOf("?")+1).split("&");for(let t=0;t<o.length;t++)e=o[t].split("="),i.push(e[0]),i[e[0]]=e[1];return i}catch(t){return discountNinja.Logging.LogError("QueryParameter.GetQueryParameters",t),[]}},Get:function(t,e){try{let n=discountNinja_Script_QueryParameter.GetQueryParameters(e)[t];return void 0===n||"undefined"===n||"null"===n||"UNDEFINED"===n||"NULL"===n||null===n?null:n}catch(t){return discountNinja.Logging.LogError("QueryParameter.Get",t),null}},Remove:function(t){try{let e=discountNinja_Script_QueryParameter.GetQueryParameters(),n=[];for(let i in Object.keys(e)){let o=e[i],r=e[o];null!=o&&null!=r&&o!==t&&n.push(o+"="+r)}let i=n.length<1?"":"?"+n.join("&");window.history&&window.history.replaceState?window.history.replaceState({},document.title,location.origin+location.pathname+i):document.location.search=i}catch(t){discountNinja.Logging.LogError("QueryParameter.Remove",t)}},RemoveFromUrl:function(t,e,n){try{let i=t.replace(e+"="+n,""),o=(i=(i=i.replace("?&","?")).replace("&&","&")).slice(-1);return"&"!==o&&"?"!==o||(i=i.slice(0,-1)),i}catch(t){discountNinja.Logging.LogError("QueryParameter.RemoveFromUrl",t)}},AppendToUrl:function(t,e,n,i){try{n=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(n),e=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(e);let o=discountNinja_Script_QueryParameter.GetQueryParameters(t)[e];if(void 0!==o&&o===n)return t;i&&void 0!==o&&(t=discountNinja_Script_QueryParameter.RemoveFromUrl(t,e,o));let r="";return r=(r=t.indexOf("?")>0?t+"&"+e+"="+n:t+"?"+e+"="+n).replace("?&","?")}catch(t){discountNinja.Logging.LogError("QueryParameter.AppendToUrl",t)}},GetFlag:function(t,e,n,i,o){let r=discountNinja_Script_QueryParameter.Get(t);if(null!==r)return o&&(r=1==r),e&&discountNinja.Cache.SessionSet(t,r),n&&discountNinja_Script_QueryParameter.Remove(t),r;let a=discountNinja.Cache.SessionGet(t);return null!==a?a:i}},discountNinja_Script_TextSettings={WrapInColor:function(t,e){return t?'<span style="color:'+t+'">'+e+"</span>":e},GetText:function(t,e,n){function i(t){return t.replace(/\\{/g,"{").replace(/\\}/g,"}")}if(!t)return"";t=function(t){return t&&(t.MobileText&&(t.MobileText=i(t.MobileText)),t.MobileTextAfterGoal&&(t.MobileTextAfterGoal=i(t.MobileTextAfterGoal)),t.MobileTextDuringGoal&&(t.MobileTextDuringGoal=i(t.MobileTextDuringGoal)),t.MobileTextOnCart&&(t.MobileTextOnCart=i(t.MobileTextOnCart)),t.MobileTextOnCartAfterGoal&&(t.MobileTextOnCartAfterGoal=i(t.MobileTextOnCartAfterGoal)),t.MobileTextOnCartDuringGoal&&(t.MobileTextOnCartDuringGoal=i(t.MobileTextOnCartDuringGoal)),t.Text&&(t.Text=i(t.Text)),t.TextAfterGoal&&(t.TextAfterGoal=i(t.TextAfterGoal)),t.TextDuringGoal&&(t.TextDuringGoal=i(t.TextDuringGoal)),t.TextOnCart&&(t.TextOnCart=i(t.TextOnCart)),t.TextOnCartAfterGoal&&(t.TextOnCartAfterGoal=i(t.TextOnCartAfterGoal)),t.TextOnCartDuringGoal&&(t.TextOnCartDuringGoal=i(t.TextOnCartDuringGoal))),t}(t);let o=discountNinja.Environment.Shopify.IsCartPage(),r=discountNinja.Utilities.IsMobilePhone(),a=e&&e.Tiers[0]&&e.Tiers[0].Prerequisite&&(e.Tiers[0].Prerequisite.MaximumItems>0||e.Tiers[0].Prerequisite.MinimumItems>0||e.Tiers[0].Prerequisite.MinimumAmount>0||e.Tiers[0].Prerequisite.MaximumAmount>0),c=null!==e&&("spendx_gety"===e.OfferType||a),s="-";if(c){let t=discountNinja.Offer.PrerequisiteItemsCartValue(e),n=null===e?0:discountNinja.DiscountTier.GetCurrentDiscountTierNumber(e,t);n===(null===e?0:discountNinja.DiscountTier.GetMaxDiscountTierNumber(e))?s="after":n>0?s="duringandafter":n>-1&&(s="during")}let u="",d="",l="",g=t.TextOnCartDuringGoal,f=t.TextOnCartAfterGoal,p=t.TextOnCart,m=t.TextDuringGoal,h=t.TextAfterGoal,j=t.Text;r&&(g=t.MobileTextOnCartDuringGoal||g,f=t.MobileTextOnCartAfterGoal||f,p=t.MobileTextOnCart||p,m=t.MobileTextDuringGoal||m,h=t.MobileTextAfterGoal||h,j=t.MobileText||j),o&&(m=g||m,h=f||h,j=p||j),u=m||j||"",d=h||j||"";let N="";return"duringandafter"===s?N=d===u?d:d+u:"during"===s?N=u:"after"===s?N=d:(N=l=j||"",c||""!==N||(N=d)),discountNinja.TextScaling.ReplacePxWithRem(N,.9)}},discountNinja_Script_Utilities={CreateFragment:function(t){try{let e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e}catch(t){return discountNinja.Logging.LogError("Utilities.CreateFragment",t),null}},NumberOfFractionalDigits:function(t){try{return Math.floor(t).toString()===t.toString()?0:t.toString().split(".")[1].length||0}catch(e){return discountNinja.Logging.LogError("Utilities.NumberOfFractionalDigits, number was: "+t,e),t}},FixedMultipliedAmount:function(t,e){try{let n=Math.pow(10,e),i=discountNinja_Script_Utilities.NumberOfFractionalDigits(t);return(t*n).toFixed(Math.max(0,i-e))}catch(e){return discountNinja.Logging.LogError("Utilities.FixedMultipliedAmount",e),t}},RoundToNumberOfDigits:function(t,e){try{let n=Math.pow(10,e),i=discountNinja_Script_Utilities.FixedMultipliedAmount(t,e);return 0===n?0:parseFloat(Math.round(i)/n)}catch(e){return discountNinja.Logging.LogError("Utilities.RoundToNumberOfDigits",e),t}},FloorToNumberOfDigits:function(t,e){try{let n=Math.pow(10,e),i=discountNinja_Script_Utilities.FixedMultipliedAmount(t,e);return 0===n?0:parseFloat(Math.floor(i)/n)}catch(e){return discountNinja.Logging.LogError("Utilities.FloorToNumberOfDigits",e),t}},Debounce:function(t,e,n){let i;return function(){try{let o=this,r=arguments,a=function(){try{i=null,n||t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}},c=n&&!i;clearTimeout(i),i=setTimeout(a,e),c&&t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}}},EncodeUriComponent:function(t){try{if(!t||"string"!=typeof t)return t;let e=t;try{e=decodeURIComponent(t)}catch(t){}let n=e;try{n=encodeURIComponent(e)}catch(e){discountNinja.Logging.LogWarning("Could not encode: "+t,!0,!1)}return n}catch(e){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponent - Could not encode: "+t,!0,!1),t}},EncodeUriComponentComponentForQueryString:function(t){try{if(!t||"string"!=typeof t)return t;return t=t.toString().replace(/\+/g," "),discountNinja_Script_Utilities.EncodeUriComponent(t).replace(/%20/g,"+").replace(/ /g,"+")}catch(e){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponentForQueryString - Could not encode: "+t,!0,!1),t}},GetNumberFromHtmlFragment:function(t){try{return t.match(/\d+/)[0]}catch(e){return t}},GetElementId:function(t){try{if("body"===t)return"body";let e=jQuery(t).attr("id");return e||t}catch(e){return t}},IsInViewport:function(t){try{let e=jQuery(t).offset().top,n=jQuery(t).offset().left,i=e+jQuery(t).outerHeight(),o=n+jQuery(t).outerWidth(),r=jQuery(window).scrollTop(),a=r+jQuery(window).height(),c=jQuery(window).scrollLeft(),s=c+jQuery(window).width();return i>r&&e<a&&n<s&&o>c}catch(t){return discountNinja.Logging.LogError("Utilities.IsInViewport",t),!1}},IsValidEmailAddress:function(t){try{return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.toLowerCase())}catch(t){return discountNinja.Logging.LogError("Utilities.IsValidEmailAddress",t),!1}},GetMutationObserver:function(){try{let t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return void 0===t?discountNinja.Logging.LogWarning("MutationObserver not available, not supporting ListenForDynamicallyAddedElements",!0,!0):t}catch(t){return discountNinja.Logging.LogError("Utilities.GetMutationObserver",t),null}},FormatPercentage:function(t,e){try{return isNaN(t)?t:t.toFixed(e)}catch(e){return discountNinja.Logging.LogError("Utilities.FormatPercentage",e),t}},FormatMoney:function(t,e,n,i,o,r){function a(t,e,n,o){if(n=n||",",o=o||".",isNaN(t)||null===t)return 0;let r=(t=(t/100).toFixed(e)).split("."),a=r[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+n);if(0===e)return a;{let t="";return a+(t=i?"<sup>"+(r[1]?r[1]:"")+"</sup>":r[1]?o+r[1]:"")}}try{if(0===t&&!0===r)return window.discountNinjaContext.Labels.Free;i=i||!1,o=o||!1,"string"==typeof t&&(t=t.replace(".",""));let c="",s=/\{\{\s*(\w+)\s*\}\}/,u=discountNinja.Currency.GetCurrencyFormat(),d=null===e||-1===e.indexOf("{{amount")?u:e;switch(d.match(s)[1]){case"amount":c=a(t,n,",",".");break;case"amount_no_decimals":c=a(t,0,",",".");break;case"amount_with_comma_separator":c=a(t,n,".",",");break;case"amount_no_decimals_with_comma_separator":c=a(t,0,".",",");break;case"amount_with_apostrophe_separator":c=a(t,n,"'",".")}return d.replace(s,c)}catch(e){return discountNinja.Logging.LogError("Utilities.FormatMoney",e),t}},GetNoDecimalsCurrencyFormat:function(t){try{return t&&(t=(t=t.replace("{{amount}}","{{amount_no_decimals}}")).replace("{{amount_with_comma_separator}}","{{amount_no_decimals_with_comma_separator}}")),t}catch(t){return discountNinja.Logging.LogError("Utilities.GetNoDecimalsCurrencyFormat",t),""}},GetCurrencyFormatAmountComponent:function(t){try{if(t){let e=t.match(/({{){1}(.)*(}}){1}/);if(null!==e&&e.length>0)return e[0]}return t}catch(t){return discountNinja.Logging.LogError("Utilities.GetCurrencyFormatAmountComponent",t),""}},StringIsIn:function(t,e,n){try{if(null==t||""===t||null==e||""===e)return!1;null==n&&(n=",");let i=t.split(n),o=e.split(n);for(let t=0;t<i.length;t++)for(let e=0;e<o.length;e++){let n=i[t],r=o[e];if(null!=n&&""!==n.trim()&&null!=r&&""!==r.trim()&&n.toLowerCase().trim()===r.toLowerCase().trim())return!0}return!1}catch(t){return discountNinja.Logging.LogError("Utilities.StringIsIn",t),!1}},AppendToStyle:function(t,e,n){try{jQuery(t).attr("style",function(t,i){"string"==typeof i&&null!=i||(i=""),""!==i&&";"!==i.substr(i.length-1)&&(i+=";");let o=new RegExp(e+"([s])*:([^;\n\r])*","g"),r=i.match(o);return null!==r&&r.length>0?i=i.replace(o,e+": "+n):i+e+": "+n+";"})}catch(t){discountNinja.Logging.LogError("Utilities.AppendToStyle",t)}},IsMobilePhone:function(){try{let e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}catch(t){return discountNinja.Logging.LogError("Utilities.IsMobilePhone",t),!1}var t},GetReferrer:function(){try{return-1===document.referrer.indexOf(document.location.hostname)&&discountNinja.Cache.SessionSet("original-referrer",document.referrer),discountNinja.Cache.SessionGet("original-referrer")}catch(t){return discountNinja.Logging.LogError("Utilities.GetReferrer",t),null}},GetEmoji:function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)},GetHandleFromSelector:function(t,e,n){try{let i=t;if(e){1===jQuery(t).closest(e).first().length&&(i=t)}let o=n.match(/\[\[HANDLE:[^\[]*\]\]/);if(1!==o.length)return void discountNinja.Logging.LogErrorMessage("GetHandleFromSelector expects [[HANDLE:some attribute]]");let r=o[0],a=r.replace(/\[/g,"").replace(/\]/g,"").split(":")[1].toLowerCase();n=n.substring(r.length);let c=!1,s="[[SELF]]";0===n.indexOf(s)&&(c=!0,(n=n.substring(s.length)).length>0&&","===n[0]&&(n=n.substring(1)));let u=null;n.length>0&&(u=jQuery(i).find(n),jQuery(u).attr(a)||(u=null)),null===u&&c&&(u=i);let d=jQuery(u).attr(a);if(!d)return discountNinja.Logging.LogWarning("Could not find collection handle tag, looking for "+n+". Missing Dynamic Pricing data tags? The price will not be updated for the product."),!1;productHandle=d.substring(d.lastIndexOf("/")+1);let l=productHandle.indexOf("?");return l>-1&&(productHandle=productHandle.substring(0,l)),productHandle}catch(t){return discountNinja.Logging.LogError("GetHandleFromSelector",t),null}}},discountNinja_Script_VariantChange={UnRegisterEventHandlerForVariantChange:function(){try{jQuery("body").find("form").find("select").each(function(){jQuery(this).off("change.discountninja")})}catch(t){discountNinja.Logging.LogError("VariantChange.UnRegisterEventHandlerForVariantChange",t)}},RegisterEventHandlerForVariantChange:function(){function t(){try{!function(){let t=discountNinja.Cache.SessionGet("last-known-variant"),e=discountNinja.Environment.Shopify.VariantId();t!==e&&(discountNinja.Cache.SessionSet("last-known-variant",e),discountNinja.VariantChangedEvent.Handle(null,e))}()}catch(t){discountNinja.Logging.LogError("VariantChange.VariantChangeDetected",t)}}try{discountNinja.Logging.LogVerbose("Registering event handler for variant change"),discountNinja_Script_VariantChange.UnRegisterEventHandlerForVariantChange(),jQuery("body").find("form").find("select").each(function(){jQuery(this).on("change.discountninja",function(e){t()})}),jQuery(document).on("variantChanged",function(e,n){discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()}),jQuery(document).on("limoniApps:discountNinja:VariantChanged",function(e,n){discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()})}catch(t){discountNinja.Logging.LogError("VariantChange.RegisterEventHandlerForVariantChange",t)}}},discountNinja_Script_XmlHttpRequest={RequestsHandled:{},ParseCartAddParameters:function(t,e){let n=function(t){try{if(void 0!==t&&null!=t){let e=discountNinja.QueryParameter.GetQueryParameters(t);if(void 0!==e&&null!=e&&e.id)return{variant:e.id,quantity:e.quantity||1}}return discountNinja.Logging.LogVerbose("ParseCartAddParametersFromUrl could not find id / quantity parameters"),null}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromUrl",t),null}}(t)||function(t){try{return"function"==typeof t.get?function(t){try{return discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingFormDataGetter, parsing "+t),{variant:t.get("id"),quantity:t.get("quantity")}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingFormDataGetter",t),null}}(t):"{"===t[0]?function(t){try{discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingJson, parsing "+t);let e=JSON.parse(t);return{variant:e.id,quantity:e.quantity}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingJson",t),null}}(t):function(t){try{discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataAsString, parsing "+t);let e=null;if(t.indexOf("id=")>-1&&(e=t.match(/id=(\d)*/)[0].split("=")[1]),!e)return null;let n=1;return t.indexOf("quantity=")>-1&&(n=t.match(/quantity=(\d)*/)[0].split("=")[1]),{variant:e,quantity:n}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataAsString",t),null}}(t)}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormData",t),null}}(e);return n?discountNinja.Logging.LogVerbose("ParseCartAddParameters found variant: "+n.variant+" quantity: "+n.quantity):discountNinja.Logging.LogWarning("ParseCartAddParameters could not find variant and quantity in url: "+t+" and body "+e,!0),n},HandleFetch:function(t,e){try{if(discountNinja.Logging.LogVerbose("HandleFetch called "+t),"object"==typeof t)try{t=e.href}catch(t){}let n=null;try{n=e.body}catch(t){}n?discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(t,n,!0):discountNinja.Logging.LogVerbose("HandleFetch received data it cannot handle: "+e+" for url "+t)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleFetch",t)}},RegisterToAjaxEvents:function(){jQuery(document).ajaxSuccess(function(t,e,n){discountNinja_Script_XmlHttpRequest.HandleAjaxSuccess(t,e,n)})},HandleAjaxSuccess:function(t,e,n){try{if(null==e)return;if(4===e.readyState){if("text"!==e.responseType&&""!==e.responseType&&!function(t){try{return"string"!=typeof t.responseText}catch(t){return!1}}(this))return void discountNinja.Logging.LogVerbose("HandleSend cannot handle response of type "+this.responseType);if(!discountNinja_Script_XmlHttpRequest.ShouldHandleRequest(e))return;let t=n.url;discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(t,n.data)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleAjaxSuccess",t)}},GetRequestIdHeader:function(t){if(t.getAllResponseHeaders().indexOf("x-request-id")>=0){let e=t.getResponseHeader("x-request-id");return"string"==typeof e?e:null}return null},ShouldHandleRequest:function(t){let e=discountNinja_Script_XmlHttpRequest,n=e.GetRequestIdHeader(t);if(null!==n){return!0!==e.RequestsHandled[n]&&(e.RequestsHandled[n]=!0,!0)}return!0},HandleSend:function(t){try{if(4===this.readyState){if("text"!==this.responseType&&""!==this.responseType&&!function(t){try{return"string"!=typeof t.responseText}catch(t){return!1}}(this))return void discountNinja.Logging.LogVerbose("HandleSend cannot handle response of type "+this.responseType);if(!discountNinja_Script_XmlHttpRequest.ShouldHandleRequest(this))return;let e=this.responseURL||this._url;discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(e,t)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleSend",t)}},HandleNetworkRequest:function(t,e){try{if("string"==typeof t&&null!==t)if(t.indexOf("/cart/add")>-1){discountNinja.Logging.LogVerbose("Handling cart add post");let n=discountNinja_Script_XmlHttpRequest.ParseCartAddParameters(t,e);void 0!==n&&n&&n.variant?discountNinja.ServerCartItemsAddedEvent.Handle(null,n.variant,n.quantity||1):discountNinja.Logging.LogWarning("Invalid params in HandleNetworkRequest",!0)}else t.indexOf("/cart/change")>-1?(discountNinja.Logging.LogVerbose("Handling cart change post"),discountNinja.ServerCartItemsChangedEvent.Handle()):t.indexOf("/cart/update")>-1?(discountNinja.Logging.LogVerbose("Handling cart update post"),discountNinja.ServerCartItemsUpdatedEvent.Handle()):t.indexOf("collections")>-1&&(t.indexOf("?page=")>-1||t.indexOf("&page=")>-1)&&(discountNinja.Logging.LogVerbose("Handling paging request"),discountNinja.ServerCollectionProductsPageLoadedEvent.Handle());else discountNinja.Logging.LogWarning("Invalid url in HandleNetworkRequest",!0)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleNetworkRequest",t)}},SendIntercepted:!1,CreateSendInterceptor:function(t,e,n){return discountNinja_Script_XmlHttpRequest.SendIntercepted?(discountNinja.Logging.LogVerbose("Send handler already registered"),n):function(i){try{discountNinja_Script_XmlHttpRequest.SendIntercepted=!0,discountNinja.Logging.LogVerbose("Send interceptor called, executing custom handler"),this.addEventListener(t,e.bind(this,i)),discountNinja.Logging.LogVerbose("Send interceptor execute original request")}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateSendInterceptor",t)}return n.apply(this,arguments)}},FetchIntercepted:!1,CreateFetchInterceptor:function(t){function e(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(t,e,n,i,o,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(i,o)}try{discountNinja.Logging.LogVerbose("Registering fetch interceptor");var i="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),o=window.fetch;if(discountNinja_Script_XmlHttpRequest.FetchIntercepted||o&&o.toString().indexOf("AsyncWindowFetchHandler")>0)return void discountNinja.Logging.LogVerbose("Fetch handler already registered");discountNinja_Script_XmlHttpRequest.FetchIntercepted=!0}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",t,!0)}if(i){var r=function(t){"use strict";function e(t,e,n,o){var r=e&&e.prototype instanceof i?e:i,a=Object.create(r.prototype),c=new g(o||[]);return a._invoke=s(t,n,c),a}function n(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function o(){}function r(){}function a(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function c(t){function e(i,o,r,a){var c=n(t[i],t,o);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&h.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,r,a)},function(t){e("throw",t,r,a)}):Promise.resolve(u).then(function(t){s.value=t,r(s)},function(t){return e("throw",t,r,a)})}a(c.arg)}var i;this._invoke=function(t,n){function o(){return new Promise(function(i,o){e(t,n,i,o)})}return i=i?i.then(o,o):o()}}function s(t,e,i){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return{value:void 0,done:!0}}for(i.method=r,i.arg=a;;){var c=i.delegate;if(c){var s=u(c,i);if(s){if(s===S)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===o)throw o="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o="executing";var d=n(t,e,i);if("normal"===d.type){if(o=i.done?"completed":"suspendedYield",d.arg===S)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o="completed",i.method="throw",i.arg=d.arg)}}}function u(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,u(t,e),"throw"===e.method))return S;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var o=n(i,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,S;var r=o.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,S):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,S)}function d(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function l(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function g(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(d,this),this.reset(!0)}function f(t){if(t){var e=t[N];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(h.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:p}}function p(){return{value:void 0,done:!0}}var m=Object.prototype,h=m.hasOwnProperty,j="function"==typeof Symbol?Symbol:{},N=j.iterator||"@@iterator",y=j.asyncIterator||"@@asyncIterator",C=j.toStringTag||"@@toStringTag";t.wrap=e;var S={},_={};_[N]=function(){return this};var L=Object.getPrototypeOf,P=L&&L(L(f([])));P&&P!==m&&h.call(P,N)&&(_=P);var v=r.prototype=i.prototype=Object.create(_);return o.prototype=v.constructor=r,r.constructor=o,r[C]=o.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,!(C in t)&&(t[C]="GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},a(c.prototype),c.prototype[y]=function(){return this},t.AsyncIterator=c,t.async=function(n,i,o,r){var a=new c(e(n,i,o,r));return t.isGeneratorFunction(i)?a:a.next().then(function(t){return t.done?t.value:a.next()})},a(v),v[C]="Generator",v[N]=function(){return this},v.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=f,g.prototype={constructor:g,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(l),!t)for(var e in this)"t"===e.charAt(0)&&h.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,i){return r.type="throw",r.arg=t,n.next=e,i&&(n.method="next",n.arg=void 0),!!i}if(this.done)throw t;for(var n=this,i=this.tryEntries.length-1;0<=i;--i){var o=this.tryEntries[i],r=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=h.call(o,"catchLoc"),c=h.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n,i=this.tryEntries.length-1;0<=i;--i)if((n=this.tryEntries[i]).tryLoc<=this.prev&&h.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,S):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),S},finish:function(t){for(var e,n=this.tryEntries.length-1;0<=n;--n)if((e=this.tryEntries[n]).finallyLoc===t)return this.complete(e.completion,e.afterLoc),l(e),S},catch:function(t){for(var e,n=this.tryEntries.length-1;0<=n;--n)if((e=this.tryEntries[n]).tryLoc===t){var i=e.completion;if("throw"===i.type){var o=i.arg;l(e)}return o}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:f(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),S}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}AsyncWindowFetchHandler=function(){var i,r=(i=regeneratorRuntime.mark(function n(i){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return discountNinja.Logging.LogVerbose("Executing original fetch (async)"),n.prev=1,n.next=4,o.apply(void 0,e(i));case 4:r=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1);case 10:discountNinja.Logging.LogVerbose("Calling custom fetch handler (async)");try{t.apply(void 0,e(i))}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor - Custom fetch handler (async)",t,!1)}return n.abrupt("return",r);case 13:case"end":return n.stop()}},n,null,[[1,7]])}),function(){var t=this,e=arguments;return new Promise(function(o,r){var a=i.apply(t,e);function c(t){n(a,o,r,c,s,"next",t)}function s(t){n(a,o,r,c,s,"throw",t)}c(void 0)})});return function(t){return r.apply(this,arguments)}}(),window.fetch=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return AsyncWindowFetchHandler(e)}}else window.fetch=function(){try{discountNinja.Logging.LogVerbose("Calling custom fetch handler (sync)");for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];try{var r;(r=t).apply.apply(r,n)}catch(t){discountNinja.Logging.LogToConsole("error",t,"red",!1)}discountNinja.Logging.LogVerbose("Executing original fetch (sync)")}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",t,!0)}return o.apply(window,n)}},XmlHttpRequestObject:function(){return"undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},Send:function(t,e,n,i,o,r,a,c,s,u){function d(t,e,n){return""===t?t="?":t+="&",t=t+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(e)+"="+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(n)}try{if(null==u&&(u=5),null==s&&(s=1),s>u){let e="SendHttpRequest failed. Retry iterations ("+u+") exceeded for url "+t;return discountNinja.Logging.LogErrorMessage("XMLHttpRequest.Send",e),void("function"==typeof c&&null!==c&&c(e))}!function(t,e,i,o,r,a,c,s,u){let l=function(t){try{if("object"!=typeof t||null===t)return"";let e=Object.getOwnPropertyNames(t),n="";for(let i=0;i<e.length;i++){let o=e[i],r=t[o];if("string"==typeof r&&null!==r&&""!==r){let t=r.split(",");for(let e=0;e<t.length;e++)n=d(n,o,t[e])}else n=d(n,o,r)}return n}catch(t){return console.error("CreateQueryStringFromParameters failed",t),""}}(e),g=t+l;discountNinja.Logging.LogVerbose("Sending request to "+g+" from SendXMLHttpRequest",!1);let f=discountNinja_Script_XmlHttpRequest.XmlHttpRequestObject();f.open(i,g,!0),f.onreadystatechange=function(){let d;4===f.readyState&&(200===(d=f.status)?function(t){var e=null;try{if(null!=t){if("text"!==t.responseType&&""!==t.responseType&&"string"!=typeof t.responseText)return void discountNinja.Logging.LogVerbose("XMLHttpRequest.Send cannot handle response of type "+t.responseType);let n=t.responseText;e=o?null==n?null:JSON.parse(n):n}}catch(t){}"function"==typeof a&&null!==a&&a(e)}(f):function(d){let l="Could not "+i+" data from "+g+" on attempt "+s+". Request status: "+d+" - Parameters: "+JSON.stringify(e);discountNinja.Logging.LogWarning(l,!0,r);let f=Math.pow(2,s)*(400+100*Math.random());setTimeout(function(){discountNinja_Script_XmlHttpRequest.Send(t,e,n,i,o,r,a,c,s+1,u)},f)}(d))},null===n?f.send():(f.setRequestHeader("Content-Type","application/json"),f.send(JSON.stringify(n)))}(t,e,i,o,r,a,c,s,u)}catch(e){try{discountNinja.Logging.LogToConsole("error","Error occurred in Send for url "+t+". Error: "+e)}catch(t){}try{"function"==typeof c&&null!==c&&c(e)}catch(t){}}}},discountNinja_Script_TextScaling={ReplacePxWithRem:function(t,e){let n,i=discountNinja.Utilities.IsMobilePhone()?e:1,o=parseFloat(getComputedStyle(document.documentElement).fontSize),r=new RegExp("font-size:(\\s)*(\\d+)(.)?(\\d+)px","g");for(;null!==(n=r.exec(t));){let e=parseFloat(n[0].replace("px","").replace("font-size:","")),r=e/o*i,a=new RegExp("font-size:(\\s)*"+e+"px","g");t=t.replace(a,"font-size:"+r+"rem")}return t}},discountNinja_Script_DateTime={UnixTimestamp:function(){return dayjs().unix()},UtcNow:function(){return dayjs()},GetUtc:function(t){return dayjs(t)},DiffInSeconds:function(t,e){return t.diff(e,"seconds")},GetDuration:function(t,e){return dayjs.duration(t,e)},FormatDate:function(t,e){try{if(null===e||""===e)return"";let n=dayjs(t);if(e.indexOf("Do")){let t=n.format("DD");e="01"===t||"21"===t||"31"===t?e.replace("Do","D[st]"):"02"===t||"22"===t?e.replace("Do","D[nd]"):"03"===t||"23"===t?e.replace("Do","D[rd]"):e.replace("Do","D[th]")}return n.format(e)}catch(t){return discountNinja.Logging.LogError("DateTime.FormatDate",t),null}}},discountNinja_Script_VariantChangedEvent={Handle:function(t,e){function n(){discountNinja.DynamicPricing.UpdatePrice(!0,!0)}try{discountNinja.Logging.LogInformation("EVENT HANDLED - Variant changed - Variant: "+e),n(),discountNinja.Settings.GetFlag("VariantPriceUpdateRequiresDelay")&&setTimeout(function(){n()},500)}catch(t){discountNinja.Logging.LogError("VariantChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("VariantChanged",discountNinja_Script_VariantChangedEvent.Handle)}},discountNinja_Script_ServerCartItemsAddedEvent={Handle:function(t,e,n){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items added - Variant: "+e+" - Quantity: "+n),discountNinja.Cart.Shopify.OnAddToCart(t,e),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart||discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsAddedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsAdded",discountNinja_Script_ServerCartItemsAddedEvent.Handle)}},discountNinja_Script_ServerCartItemsUpdatedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items updated"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart||discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsUpdated",discountNinja_Script_ServerCartItemsUpdatedEvent.Handle)}},discountNinja_Script_ServerCartItemsChangedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items changed"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.LockRefreshCart||discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsChanged",discountNinja_Script_ServerCartItemsChangedEvent.Handle)}},discountNinja_Script_ServerCollectionProductsPageLoadedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Collection loaded next page of products"),setTimeout(function(){$(document).trigger("limoniApps:discountNinja:CollectionProductsAdded")},500),setTimeout(function(){$(document).trigger("limoniApps:discountNinja:CollectionProductsAdded")},1500)}catch(t){discountNinja.Logging.LogError("ServerCollectionProductsPageLoadedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCollectionProductsPageLoaded",discountNinja_Script_ServerCollectionProductsPageLoadedEvent.Handle)}},discountNinja_Script_LocalCartUpdatedEvent={Handle:function(t,e,n,i){try{if(discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated - IsUpdated: "+n+" - Handle using callback: "+(i?"true":"false")),i)return;n&&discountNinja.DiscountedCart.BuildDiscountedCart(null,!n)}catch(t){discountNinja.Logging.LogError("LocalCartUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("LocalCartUpdated",discountNinja_Script_LocalCartUpdatedEvent.Handle)}},discountNinja_Script_Checkout_Shopify={RedirectingToCheckout:!1,ProcessingCheckout:!1,LoadingCheckoutPopUpId:"LimoniApps-DiscountNinja-Checkout",LoadingCheckoutPopUpMessageId:"LimoniApps-DiscountNinja-Checkout-Message",LoadingCheckoutPopUpDotsId:"LimoniApps-DiscountNinja-Checkout-Dots",FallBackEvent:null,FallbackCallback:null,ProcessingPrepareAdvancedCheckout:!1,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://checkoutapi-v4.discountninja.io":"https://checkoutapi-v4-dev.discountninja.io"},InjectLoadingCheckoutPopUp:function(){if(0===jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId).length){let t=discountNinja.Settings.Settings.Checkout,e='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId+'" style="display:none;background-color:{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}};" class="limoniapps-popup limoniapps-size-small limoniapps-overlay-5 limoniapps-shape-square limoniapps-align-center limoniapps-content-bottom"><div class="limoniapps-popup-vertical-alignment-helper"><div class="limoniapps-popup-vertical-align-center"><div class="limoniapps-content" style="background-color:{{CHECKOUT_BACKGROUND_COLOR}};"><div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId+'" class="limoniapps-body"></div></div></div></div></div>',n=function(t){let e=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.appendChild(n.firstChild);return e}(e=(e=e.replace("{{CHECKOUT_BACKGROUND_COLOR}}",t.CheckoutLoadingBackground||"white")).replace("{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}}",t.CheckoutLoadingOverlay||"rgba(0,0,0,0.7)"));document.body.insertBefore(n,document.body.childNodes[0])}},ShowLoadingCheckoutPopUp:function(t){try{let e=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId);t&&function t(){if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout){let e=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),n=discountNinja.Settings.Settings.Checkout;""===jQuery(e).html()?discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage1):jQuery(e).html()===n.LoadingCheckoutMessage1?discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage2):jQuery(e).html()===n.LoadingCheckoutMessage2&&discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(n.LoadingCheckoutMessage1),setTimeout(function(){t()},2500)}}(),t?e.css("display",""):e.css("display","none")}catch(t){discountNinja.Logging.LogError("ShowLoadingCheckoutPopUp",t),discountNinja_Script_Checkout_Shopify.FallBack("Failure in showLoadingCheckoutPopUp")}},FallBack:function(t){try{discountNinja.Logging.LogVerbose("Redirecting to standard checkout, reason: "+t),function(t,e){{discountNinja.Logging.LogVerbose("Redirecting to standard checkout"),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1;let e=discountNinja.Settings.Settings.Checkout;if(discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(e.LoadingCheckoutMessage3),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!1),"true"===discountNinja.Cache.SessionGet("RedirectToCheckoutOnFallBack"))window.location.href=t;else if(discountNinja_Script_Checkout_Shopify.FallbackCallback)discountNinja_Script_Checkout_Shopify.FallbackCallback();else if(discountNinja_Script_Checkout_Shopify.FallBackEvent){let t=discountNinja_Script_Checkout_Shopify.FallBackEvent.originalEvent,e=new t.constructor(t.type,t);t.target.dispatchEvent(e)}else window.location.href="/checkout"}}(function(){let t="/checkout";try{let e=discountNinja.DiscountCode.GetFirstActiveDiscountCodeForCheckout(!0);""!==e&&(t="/checkout?discount="+e)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link "+t)}let e=function(){let t=null,e=jQuery('form[action="/cart"], form[action^="/cart?"]').attr("action");return e&&(t=discountNinja.QueryParameter.Get("locale",e)),t}();return e&&(t=discountNinja.QueryParameter.AppendToUrl(t,"locale",e)),discountNinja.Logging.LogVerbose("Built classic checkout link: "+t),t}())}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.FallBack","Failed "+t),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,window.location.href="/checkout"}},RedirectToCheckout:function(t,e){try{if("standard"===e)discountNinja_Script_Checkout_Shopify.FallBack("Call to DraftOrder Api determined no discount is required");else if(e&&""!==e){discountNinja.Logging.LogVerbose("Redirecting to checkout url: "+e);let t=discountNinja.Settings.Settings.Checkout;discountNinja_Script_Checkout_Shopify.SetLoadingCheckoutPopUpMessage(t.LoadingCheckoutMessage3);let n=discountNinja.Settings.GetFlag("DelayCheckoutMilliseconds")||0;setTimeout(function(){discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0,window.location=e},n)}else if(discountNinja.Logging.LogVerbose("Checkout URL empty"),(t+=1)<3){discountNinja.DiscountedCart.DiscountedCart;discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(t,discountNinja_Script_Checkout_Shopify.RedirectToCheckout,!1)}else discountNinja.Logging.LogVerbose("Attempts to get checkout URL exhausted"),discountNinja_Script_Checkout_Shopify.FallBack("No valid checkout url received")}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onSuccess","Could not redirect to new checkout url, attempting to redirect to standard url: "+t),discountNinja_Script_Checkout_Shopify.FallBack("Error in processing onSuccess")}},GetCheckoutUrlFromServer:function(t,e,n){let i=discountNinja_Script_Checkout_Shopify.BuildParameters(n),o=discountNinja_Script_Checkout_Shopify.BuildPayLoad();discountNinja.Logging.LogVerbose("Posting to /api/GetCheckoutUrl with query parameters: "+JSON.stringify(i)+" and payload: "+JSON.stringify(o)),discountNinja.Logging.LogVerbose("Getting checkout URL, attempt "+t),discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/GetCheckoutUrl",i,o,"post",!0,!0,function(i){let o=i?i.InvoiceUrl:null;if(n){let t=discountNinja.DiscountedCart.DiscountedCart;discountNinja.Cache.SessionSet("discounted-cart-checkoutlink",t.token+"|"+t.Version+"|prepared")}e&&e(t,o)},function(t){n||(discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onFailure","Call to DraftOrder Api failed, attempting to redirect to standard url: "+t),discountNinja_Script_Checkout_Shopify.FallBack("Call to Checkout Api failed"))},1,3)},SetLoadingCheckoutPopUpMessage:function(t){let e=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),n='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpDotsId+'"></div>';e.html(t+n)},CheckoutButtonSelectors:function(){return'.limoniapps-discountninja-checkoutbutton, :submit[name="checkout"], :submit[value="checkout"], :submit[value="check out"], :submit[value="Checkout"], :submit[value="CheckOut"], :submit[value="Check Out"], :submit[value="Check out"], :submit[value="CHECK OUT"], :submit[value="CHECKOUT"]'},RegisterEventHandlerForCheckout:function(){function t(t){try{return void 0!==t&&t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1),t}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.cancelDefaultBehaviorEvent",t)}}function e(t){try{discountNinja_Script_Checkout_Shopify.RequiresAdvancedCheckout()?(setTimeout(function(){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner","Timed out, redirecting to standard checkout"),discountNinja_Script_Checkout_Shopify.FallBack("Timeout",t)},3e4),discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(1,discountNinja_Script_Checkout_Shopify.RedirectToCheckout,!1)):discountNinja_Script_Checkout_Shopify.FallBack("No advanced checkout required",t)}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}function n(n){if(!(jQuery(".limoniapps-discountninja-checkout-checkbox:visible:not(:checked), .my-terms-conditions-fy:not(.limoniapps-discountninja-ignore) input[required]:visible:checkbox:not(:checked), input[required].tos_agree:visible:checkbox:not(:checked)").length>0&&(discountNinja.Logging.LogWarning("Abandon checkout because required checkbox(es) is not checked",!0),1)||discountNinja_Script_Checkout_Shopify.RedirectingToCheckout)){let i=function(n){try{return discountNinja_Script_Checkout_Shopify.ProcessingCheckout?null:(discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,discountNinja.Logging.Tracing&&alert("Discount Ninja checkout initiated via button"),discountNinja_Script_Checkout_Shopify.FallBackEvent=n,n=t(n),setTimeout(function(){try{discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!0),discountNinja.Cart.Shopify.UpdateCart(function(){try{discountNinja.DiscountedCart.BuildDiscountedCart(function(){e(n)})}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterUpdateCart",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("Build discounted cart failed")}},!1)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterTimeout",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("UpdateCart failed")}},200),n)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButton",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}(n);if(null!==i)return n=i,!1}}function i(e,n){try{if(function(t){let e=discountNinja_Script_Checkout_Shopify.CheckoutButtonSelectors();return jQuery(t).is(e)}(n)&&(discountNinja.Logging.Tracing&&alert("Discount Ninja checkout initiated via submit on form (checkout button)"),discountNinja_Script_Checkout_Shopify.ProcessingCheckout&&!discountNinja_Script_Checkout_Shopify.RedirectingToCheckout)){if(!0===discountNinja.Settings.GetFlag("AllowCancelCheckoutByForm"))return t(e),!1;discountNinja.Logging.LogWarning("Submit should be stopped, Discount Ninja checkout not processed yet. Set flag AllowCancelCheckoutByForm to true",!0)}}catch(e){}}function o(t){t.off(".discountNinja.checkout"),t.each(function(){let t=jQuery(this)[0];t.onclick&&(discountNinja_Script_Checkout_Shopify.FallbackCallback=t.onclick,t.onclick=null),jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){n(t)})})}function r(n){n.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(n){if(!1===function(n){try{return discountNinja_Script_Checkout_Shopify.ProcessingCheckout?null:(discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,discountNinja.Logging.Tracing&&alert("Discount Ninja checkout initiated via buy now button"),discountNinja_Script_Checkout_Shopify.FallBackEvent=n,n=t(n),setTimeout(function(){try{discountNinja_Script_Checkout_Shopify.ShowLoadingCheckoutPopUp(!0);try{window.discountNinjaContext.Cart.items=[];let t=discountNinja.Environment.Shopify.VariantId(),i=discountNinja.Environment.Shopify.ProductHandle(),o=t+":"+discountNinja.DateTime.UnixTimestamp;window.discountNinjaContext.Cart.items.push({id:t,quantity:1,handle:i,key:o}),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DiscountedCart.BuildDiscountedCart(function(){e(n)})}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterUpdateCart",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("Build discounted cart failed")}}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterTimeout",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,discountNinja_Script_Checkout_Shopify.FallBack("UpdateCart failed")}},200),n)}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckout.onCheckoutViaButton",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}(n))return!1})})}function a(t){t.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){if(!1===n(t))return!1})})}function c(t){t.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){if(!1===n(t))return!1})})}function s(){try{if(!discountNinja.Settings.Settings)return;discountNinja.Logging.LogVerbose("Registering event handler for checkout");let t=discountNinja.Settings.GetFlag("UnregisterThirdPartyCheckoutClickEvents"),e=discountNinja.Settings.GetFlag("ReplaceDefaultCheckoutEventsOnButtons")||!1,n=discountNinja.Settings.GetFlag("ReplaceDefaultCheckoutEventsOnLinks")||!0,s=jQuery('form[action^="/cart"]:not([action^="/cart/add"])').not(".limoniapps-discountninja-ignore");if(s&&s.length>0&&(s.off(".discountNinja.checkout"),s.each(function(){jQuery(this).on("click.discountNinja.checkout",function(t){jQuery(this).data("discountninja-clicked",jQuery(event.target))})}),t&&jQuery(s).off("submit"),s.each(function(){jQuery(this).on("submit.discountNinja.checkout",function(t){if(!1===i(t,jQuery(this).data("discountninja-clicked")))return!1})})),discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.PromotionFlow.BuyNowButtonSelector,n=jQuery(t).not(".limoniapps-discountninja-ignore");n&&n.length>0&&(n.off(".discountNinja.checkout"),e&&(document.addEventListener("click",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(n).off("click"),r(n))},!0),document.addEventListener("touch",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(n).off("touch"),r(n))},!0)),r(n))}let u=discountNinja_Script_Checkout_Shopify.CheckoutButtonSelectors(),d=jQuery(u).not(".limoniapps-discountninja-ignore");d&&d.length>0&&(d.off(".discountNinja.checkout"),e&&(document.addEventListener("click",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(d).off("click"),a(d))},!0),document.addEventListener("touch",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(d).off("touch"),a(d))},!0)),a(d));let l=jQuery('a[href^="/checkout"]').not(".limoniapps-discountninja-ignore");l&&l.length>0&&(n&&(jQuery(l).off("click touch"),document.addEventListener("click",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(l).off("click"),c(l))},!0),document.addEventListener("touch",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(l).off("touch"),c(l))},!0)),c(l));let g=jQuery('button[onclick*="/checkout"]').not(".limoniapps-discountninja-ignore");g&&g.length>0&&(n&&(g.prop("onclick",null).off("click touch"),document.addEventListener("click",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(g).off("click"),o(g))},!0),document.addEventListener("touch",function(){discountNinja_Script_Checkout_Shopify.ProcessingCheckout||(jQuery(g).off("touch"),o(g))},!0)),o(g)),discountNinja.Logging.Tracing&&alert("Discount Ninja checkout hooks registered")}catch(t){discountNinja.Logging.LogError("RegisterEventHandlerForCheckoutInner",t)}}s(),setTimeout(function(){s()},500),setTimeout(function(){s()},1500),setTimeout(function(){s()},3e3)},RequiresAdvancedCheckout:function(){function t(t,e){for(let n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}try{if(null===discountNinja.Settings||null===discountNinja.Settings.Settings)return!1;let e=discountNinja.DiscountedCart.CountAppliedPromotions(),n=discountNinja.DiscountedCart.HasFreeShipping(),i=discountNinja.Settings.Settings.Checkout.CheckoutMode;return discountNinja.Logging.LogVerbose("Checking if advanced checkout is required with "+e+" offers and "+(n?"":"no")+" free shipping"),function(e,n,i){let o=i.split(","),r=!1;if(0!==e||n?1!==e||n?0===e&&n?r=t(o,"1F"):e>1&&!n?r=t(o,"N"):e>0&&n&&(r=t(o,"NF")):r=t(o,"1"):r=t(o,"0"),!r&&(1===e||0===e&&n)&&""===discountNinja_Script_DiscountCode.GetFirstActiveDiscountCodeForCheckout(!1))return discountNinja.Logging.LogWarning("Configured to use standard checkout mode, but discount code is missing.",!0),!0;return r}(e,n,i)?(discountNinja.Logging.LogVerbose("Configured to use advanced checkout mode."),!0):(discountNinja.Logging.LogVerbose("Configured to use standard checkout. Redirecting."),!1)}catch(t){discountNinja.Logging.LogError("RequiresDraftOrderCheckout",t)}},BuildParameters:function(t){try{let e=discountNinja.DeviceId.Get(),n={shop:discountNinja.Core.Shop,m:e+"-"+discountNinja.DateTime.UnixTimestamp(),version:discountNinja.Core.Version,prepareOnly:1==t};return discountNinja.TestMode.TestMode&&(n.testMode=!0,n.testModeToken=discountNinja.TestMode.TestModeToken),n}catch(t){return discountNinja.Logging.LogError("BuildParameters",t),null}},BuildPayLoadLogEvent:function(){try{return function(){try{return{DiscountCodes:discountNinja.DiscountedCart.GetAppliedPromotions(),DeviceId:discountNinja.DeviceId.Get()}}catch(t){return discountNinja.Logging.LogError("BuildPayLoad.BuildPayLoadLogEvent",t),null}}()}catch(t){return discountNinja.Logging.LogError("BuildPayLoadLogEvent",t),null}},BuildPayLoad:function(){function t(){try{let t=[],e=discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.items?discountNinja.DiscountedCart.DiscountedCart.items:null;if(e&&e.length>0)for(let n=0;n<e.length;n++)t.push({Quantity:e[n].Line.QuantityDiscounted+e[n].Line.QuantityNotDiscounted,VariantId:e[n].Product.VariantId,ProductHandle:e[n].Product.ProductHandle,OfferToken:e[n].OfferToken,TriggerToken:e[n].TriggerToken,Properties:e[n].Properties,LineItemKey:e[n].Key});return t}catch(t){return null}}function e(){try{let t=[],e=window.discountNinjaContext&&window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.attributes:null;if(null===e)return null;for(let n in e)t.push({Name:n,Value:e[n]});let n=jQuery('form [name^="attributes"]');if(n)for(let e=0;e<n.length;e++){let i=n[e],o=jQuery(i).attr("name"),r=o.replace("attributes[","").replace("]",""),a=!1;for(let e=0;e<t.length;e++)if(t[e].Name===r){a=!0;break}let c=null;if(c="checkbox"===jQuery(i).attr("type")?jQuery('form [name="'+o+'"]:checked').val():jQuery('form [name="'+o+'"]').val(),a){for(let e=0;e<t.length;e++)if(t[e].Name===r){t[e].Value=c;break}}else t.push({Name:r,Value:c})}return t}catch(t){return null}}function n(){try{let t=jQuery('form[action^="/cart"]').attr("action");return"string"==typeof t&&null!==t&&""!==t?t.replace("/cart?","").replace("/cart",""):null}catch(t){return null}}function i(){try{let t=jQuery('form[action^="/cart"] [name="note"]').val();return void 0===t?null:t}catch(t){return null}}try{return function(){try{return{LineItems:t(),DiscountCodes:discountNinja.DiscountedCart.GetAppliedPromotions(),NoteAttributes:e(),DeviceId:discountNinja.DeviceId.Get(),CartAction:n(),Note:i(),Currency:discountNinjaContext.PresentmentCurrency}}catch(t){return discountNinja.Logging.LogError("BuildPayLoad.BuildOrderDetailsJson",t),null}}()}catch(t){return discountNinja.Logging.LogError("BuildPayLoad",t),null}},PrepareAdvancedCheckoutDebounced:function(){try{if(discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout)return;discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout=!0,discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.DiscountedCart.HasAppliedPromotions()&&function(){try{let t=discountNinja.DiscountedCart.DiscountedCart,e=!1;if(t){let n=discountNinja.Cache.SessionGet("discounted-cart-checkoutlink");if(n){let i=n.split("|"),o=i[0],r=i[1],a="prepared"===i[2];t.token===o&&t.Version===r&&a&&(e=!0)}}t&&!e&&discountNinja_Script_Checkout_Shopify.GetCheckoutUrlFromServer(1,null,!0),discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout=!1}catch(t){discountNinja.Logging.LogError("PrepareAdvancedCheckout_Inner",t)}}()})})}catch(t){discountNinja.Logging.LogError("PrepareAdvancedCheckoutDebounced",t)}},PrepareAdvancedCheckout:discountNinja_Script_Utilities.Debounce(function(){discountNinja_Script_Checkout_Shopify.PrepareAdvancedCheckoutDebounced()},1e3,!1)},discountNinja_Script_Environment_Shopify={MyShopifyDomain:function(t){let e="";try{let t="undefined"!=typeof discountNinjaContext&&discountNinjaContext?discountNinjaContext.Shop:null,n="undefined"!=typeof Shopify&&Shopify?Shopify.shop:null;e=t||n}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}try{return null!=e&&""!==e||(e=window.top.location.hostname,t||(e&&e.endsWith(".myshopify.com")?discountNinja.Logging.LogWarning("GetMyShopifyDomain could not find domain from Shopify.shop or context. Falling back to hostname",!0):discountNinja.Logging.LogErrorMessage("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain could not retrieve domain from Shopify.shop property or context. URL hostname is "+e+"."))),e}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}},UrlPath:function(){try{return discountNinja_Script_Environment_Shopify.TrimmedPathName().toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.UrlPath",t),""}},IsSearchPage:function(){return"/search"===discountNinja_Script_Environment_Shopify.UrlPath()},IsAccountPage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return"/account"===t||t.indexOf("/account/")>-1},IsCartPage:function(){return"/cart"===discountNinja_Script_Environment_Shopify.UrlPath()},IsProductPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/products/")>-1},IsCollectionPage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return"/collections"===t||-1===t.indexOf("/products/")&&t.indexOf("/collections/")>-1},IsHomePage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return""===t||"/"===t},IsBlogPost:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/blogs/")>-1},IsCustomPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/pages/")>-1},IsCatalogPage:function(){return discountNinja_Script_Environment_Shopify.IsCollectionPage()&&"all"===discountNinja_Script_Environment_Shopify.CollectionHandle().toLowerCase()},BlogHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),e=t.indexOf("/blogs/");if(-1===e)return null;let n=t.indexOf("/",e+1);if(-1===n)return null;let i=t.indexOf("/",n+1);return-1===i?decodeURIComponent(t).substr(n+1):decodeURIComponent(t).substr(n+1,i-n-1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogHandle",t),null}},BlogPostHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),e=t.indexOf("/blogs/");if(-1===e)return null;let n=t.indexOf("/",e+1);if(-1===n)return null;let i=t.indexOf("/",n+1);return-1===i?null:decodeURIComponent(t).substr(i+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogPostHandle",t),null}},CollectionHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.UrlPath();if(t.indexOf("/collections/")<0)return"";let e=(t=t.replace("/collections/","")).indexOf("/");return e<0?t:t.substr(0,e)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CollectionHandle",t),""}},PageType:function(){return discountNinja_Script_Environment_Shopify.IsProductPage()?"product":discountNinja_Script_Environment_Shopify.IsCollectionPage()?"collection":discountNinja_Script_Environment_Shopify.IsHomePage()?"home":discountNinja_Script_Environment_Shopify.IsCartPage()?"cart":discountNinja_Script_Environment_Shopify.IsBlogPost()?"blogpost":discountNinja_Script_Environment_Shopify.IsCustomPage()?"custom":void 0},VariantId:function(){if(!discountNinja_Script_Environment_Shopify.IsProductPage())return null;try{let t=document.querySelector("form[action^='/cart/add'] [name^='id']");null!==t&&0===t.length&&(t=document.querySelector("form [name^='id']"));let e=null;if(null!==t&&"object"==typeof t.options&&"number"==typeof t.selectedIndex&&void 0!==t.options[t.selectedIndex]?e=t.options[t.selectedIndex].value:null!==t&&"string"==typeof t.value&&(e=t.value),null!=e&&""!==e&&0!==e&&!isNaN(e)){discountNinja.Logging.LogVerbose("Returning variant from form: "+e);let t=discountNinja.Utilities.GetNumberFromHtmlFragment(e);if(null!==discountNinja_Script_LiquidData.VariantInfoFromLiquid(t))return t}}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{let t=discountNinja.QueryParameter.Get("variant");if(null!=t&&""!==t){discountNinja.Logging.LogVerbose("Returning variant from query parameter: "+t);let e=t;if(null!==discountNinja_Script_LiquidData.VariantInfoFromLiquid(e))return e}}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{let t=discountNinja.LiquidData.ProductDefaultVariantId();if(null!=t&&""!==t)return discountNinja.Logging.LogVerbose("Returning variant from liquid: "+t),t}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}return discountNinja.Logging.LogErrorMessage("Environment.Shopify.VariantId","No variant information found"),null},TrimmedPathName:function(){try{let t=window.location.pathname;if(null===t||""===t)return t;let e="(/collections|/products|/search|/pages|/blogs|/account|/cart){1}(.*)",n=window.location.pathname.match(e);return n&&(t=n[0]),"/"===t.slice(-1)&&(t=t.substr(0,t.length-1)),t}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.GetLastPartOfPathName",t),null}},ProductHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/products/")?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.ProductHandle",t),null}},CustomPageHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/pages/")?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CustomPageHandle",t),null}},IsCustomer:function(){return void 0!==window.discountNinjaContext&&null!==window.discountNinjaContext.Customer},CustomerTags:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.Tags?window.discountNinjaContext.Customer.Tags:null},CustomerSpend:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.TotalSpent?window.discountNinjaContext.Customer.TotalSpent:null},CustomerNumberOfOrders:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.NumberOfOrders?window.discountNinjaContext.Customer.NumberOfOrders:null},CustomerLastOrderDate:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.LastOrderDate?window.discountNinjaContext.Customer.LastOrderDate:null}},discountNinja_Script_DiscountCode={ClassPrefix:"limoniapps-discountninja-cartdiscountfield",HideFeedbackTimeoutHandle:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotionapi-v4.discountninja.io":"https://promotionapi-v4-dev.discountninja.io"},InjectDiscountCodesInHtmlElements:function(t,e){function n(t,e){try{return discountNinja.QueryParameter.RemoveFromUrl(t,"discount",e).replace(/attributes\[limoniapps\-discounturl\]\=(.)*(\&)?/g,"")}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodeInUrl",t)}}function i(t,e){try{return discountNinja.QueryParameter.AppendToUrl(t,"discount",e,!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.AppendDiscountCodeToUrl",t)}}try{jQuery('a[href^="/checkout"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("href"),r=e?n(o,t):i(o,t);jQuery(this).attr("href",r)}),jQuery('form[action^="/checkout"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("action"),r=e?n(o,t):i(o,t);jQuery(this).attr("action",r)}),jQuery('button[onclick*="/checkout"]').each(function(){try{if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("onclick"),r=o.match(/(['"]){1}(.)*(['"])/g);if(null!==r&&1===r.length){let a=r[0];if(a.length>2){let r=a.substr(1,a.length-2),c=e?n(r,t):i(r,t);jQuery(this).attr("onclick",o.replace(r,c))}}}catch(t){}}),jQuery('form[action="/cart"]:not([action^="/cart/add"]), form[action^="/cart?"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("method");if(o&&"post"===o.toLowerCase()){let o=jQuery(this).attr("action"),r=e?n(o,t):i(o,t);jQuery(this).attr("action",r)}}),jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore hulkapps-ignore")}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtmlElements",t)}},UndoInjectDiscountCodesInHtml:function(){try{let t=discountNinja.Offer.Offers;if(!t)return;for(let e=0;e<t.length;e++)discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(discountNinja_Script_DiscountCode.GetDiscountCode(t[e].Token),!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodesInHtml",t)}},InjectDiscountCodesInHtml:function(){try{let t=discountNinja_Script_DiscountCode.GetFirstActiveDiscountCodeForCheckout(!1);if(""===t)return;discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(t,!1),function(t){try{let e=jQuery('form[action^="/checkout"]');if(null!==e&&e.length>0){let t=0;e.each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let e=jQuery(this).find('input[name="discount"]');null!==e&&0!==e.length||(jQuery("<input>").attr("type","hidden").attr("name","discount").addClass("limoniapps-discountninja-discount-attribute").attr("id","limoniapps-discountninja-discount-attribute-"+t).appendTo(this),t++)})}jQuery('form[action^="/checkout"], form[action^="/cart"] input[name="discount"], .limoniapps-discountninja-discount-attribute').each(function(){jQuery(this).hasClass("discountninja-ignore")||jQuery(this).attr("value",t)})}catch(t){discountNinja.Logging.LogError("UpdateFormInputDiscountCode",t)}}(t)}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtml",t)}},GetApplicationCounter:function(){try{let t=discountNinja.Cache.SessionGet("discountcode-applicationcounter");return t?parseInt(t):0}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetApplicationCounter",t),[]}},IncrementApplicationCounter:function(){try{let t=discountNinja_Script_DiscountCode.GetApplicationCounter();discountNinja.Cache.SessionSet("discountcode-applicationcounter",t+1)}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetApplicationCounter",t),[]}},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("discountcode-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("discountcode-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveToCache",t)}},RemoveFromCache:function(t){try{let e=discountNinja_Script_DiscountCode.GetFromCache();if(!e)return;let n=[];for(let i=0;i<e.length;i++)e[i].DiscountCode!==t&&n.push(e[i]);discountNinja_Script_DiscountCode.SaveToCache(n)}catch(t){return discountNinja.Logging.LogError("DiscountCode.RemoveFromCache",t),[]}},GetExternalDiscountCodesFromCache:function(){try{let t=discountNinja.Cache.SessionGet("discountcode-external-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetExternalDiscountCodesFromCache",t),[]}},LockDiscountCodeFieldIfRequired:function(){try{let t=jQuery("input."+discountNinja_Script_DiscountCode.ClassPrefix+"-input"),e=jQuery("."+discountNinja_Script_DiscountCode.ClassPrefix+"-apply");if(!discountNinja.Settings.Settings.Cart.AllowMultipleDiscountCodes){if(discountNinja.DiscountCodeTrigger.Get().length>0)return void function(t,e){t.prop("disabled",!0),e.addClass("disabled")}(t,e)}!function(t,e){t.prop("disabled",!1),e.removeClass("disabled")}(t,e)}catch(t){discountNinja.Logging.LogError("DiscountCode.LockDiscountCodeFieldIfRequired",t)}},UpdateTags:function(){try{let t="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",e=jQuery(t+"discountcodes");jQuery(e).empty();let n=jQuery(t+"discountcode-template").html();if(n){let t=discountNinja.DiscountCodeTrigger.Get();for(let i=0;i<t.length;i++){let o=n.replace(/\[\[DISCOUNT_CODE\]\]/g,t[i].discountCode);e.append(o)}}}catch(t){discountNinja.Logging.LogError("DiscountCode.UpdateTags",t)}},Process:function(){try{discountNinja_Script_DiscountCode.UpdateTags(),discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired();let t=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();discountNinja.Offer.AllOffers=t.Offers,discountNinja.Offer.Triggers=t.Triggers,discountNinja.Offer.ReEvaluate()}catch(t){discountNinja.Logging.LogError("DiscountCode.UpdateTags",t)}},AddDiscountCodeFromLookup:function(t){discountNinja_Script_DiscountCode.AddDiscountCode(t,!0)},AddDiscountCode:function(t,e){function n(){d.prop("disabled",!1),l.removeClass("disabled")}function i(){n(),jQuery(c).hide(),jQuery(u).show()}function o(){jQuery(s).show()}let r="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",a=r+"apply",c=r+"searching",s=r+"applied",u=r+"notfound",d=jQuery("input"+r+"input"),l=jQuery(a);try{if(!t||""===t)return;e&&(d.prop("disabled",!0),l.addClass("disabled"),jQuery(c).show(),jQuery(s).hide(),jQuery(u).hide()),discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle&&clearTimeout(discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle),discountNinja.XmlHttpRequest.Send(discountNinja_Script_DiscountCode.ServerUrl()+"/api/GetDiscountDetails",function(t){try{let e={},n=null===discountNinja.Cache.SessionGet("discountcode-promotiondata-requested-"+t),i=discountNinja.Core.Shop,o=discountNinja.Utilities.GetReferrer();i&&(e.shop=i),t&&(e.discountCode=encodeURIComponent(t)),null!==discountNinja.TestMode.TestMode&&(e.testMode=discountNinja.TestMode.TestMode,e.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,e.testModeToken=discountNinja.TestMode.TestModeToken),null!==n&&(e.firstRequest=n),o&&(e.referrer=o),e.m=discountNinja.DateTime.UnixTimestamp();let r=discountNinja.DeviceId.Get();return e.deviceId=r,e.version=discountNinja.Core.Version,e.f="6.4",e}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(t),null,"get",!0,!0,function(i){e&&(jQuery(c).hide(),n(),d.val("")),i&&"false"!==i?(discountNinja.DiscountedCart.IsDirty=!0,i.DiscountCodeDetails?(e&&o(),function(t,e,n){try{null===e&&discountNinja.Logging.LogWarning("DiscountCode.AddExternal - No discountcode provided",!0,!1,!1);let i=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache(),o=i.length;for(;o--;)i[o]&&i[o].DiscountCode===e&&i.splice(o,1);i.push({OfferToken:null,TriggerToken:null,DiscountCode:e,PriceRuleId:t,TargetType:n}),discountNinja_Script_DiscountCode.IncrementApplicationCounter(),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),function(t){try{discountNinja.Cache.SessionSet("discountcode-external-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveExternalDiscountCodesToCache",t)}}(i)}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternal",t)}}(i.DiscountCodeDetails.PriceRuleId,i.DiscountCodeDetails.DiscountCode,i.DiscountCodeDetails.TargetType)):null===i.Offers||0===i.Offers.length||null===i.Triggers||0===i.Triggers.length?jQuery(u).show():(e&&o(),discountNinja.DiscountCodeTrigger.Add(t,i),discountNinja.Cache.SessionSet("discountcode-promotiondata-requested-"+t,!0),discountNinja_Script_DiscountCode.Process())):jQuery(u).show(),discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired(),discountNinja_Script_DiscountCode.RemoveSavedDiscountCode(),discountNinja_Script_QueryParameter.Remove("discountcode")},function(){e&&i()},1,2)}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternalDiscountCode",t),e&&i()}},Add:function(t,e,n,i){try{null!==e&&null!==n||discountNinja.Logging.LogWarning("DiscountCode.Add - No discountcode or priceruleid available",!0,!1,!1);let o=discountNinja_Script_DiscountCode.GetFromCache(),r=o.length;for(;r--;)o[r]&&o[r].Token===t&&o.splice(r,1);o.push({Token:t,DiscountCode:e,PriceRuleId:n,TargetType:i}),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),discountNinja_Script_DiscountCode.SaveToCache(o)}catch(t){discountNinja.Logging.LogError("DiscountCode.Add",t)}},Remove:function(t){try{let e=discountNinja_Script_DiscountCode.GetFromCache(),n=[];for(let i=0;i<e.length;i++)e[i].Token!==t&&n.push(e[i]);discountNinja_Script_DiscountCode.SaveToCache(n)}catch(t){discountNinja.Logging.LogError("DiscountCode.Remove",t)}},RemoveTag:function(t){try{discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml();let e="."+discountNinja_Script_DiscountCode.ClassPrefix,n=jQuery(t).parent(e+"-discountcode").attr("data-discountcode");discountNinja.DiscountCodeTrigger.RemoveAndUpdateTags(n),discountNinja_Script_DiscountCode.RemoveFromCache(n),discountNinja_Script_DiscountCode.IncrementApplicationCounter(),jQuery(e+"-applied, "+e+"-notfound").hide(),discountNinja_Script_DiscountCode.Process()}catch(t){discountNinja.Logging.LogError("DiscountCode.RemoveTag",t)}},ToggleLink:function(t){try{let e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-";jQuery(t).closest(e+"placeholder").find(e+"inner").toggle(),jQuery(t).closest(e+"placeholder").find(e+"input").focus()}catch(t){discountNinja.Logging.LogError("DiscountCode.ToggleLink",t)}},ShowFooterInstructions:function(t){try{let e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-";jQuery(t).closest(e+"placeholder").find(e+"footer-onhover").show()}catch(t){discountNinja.Logging.LogError("DiscountCode.ShowFooterInstructions",t)}},HideFooterInstructions:function(t){try{let e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-";jQuery(t).closest(e+"placeholder").find(e+"footer-onhover").hide()}catch(t){discountNinja.Logging.LogError("DiscountCode.HideFooterInstructions",t)}},Clear:function(){discountNinja.Cache.SessionRemove("discountcode-data")},GetFirstActiveDiscountCodeForCheckout:function(t){try{let e=discountNinja.DiscountedCart.GetFirstDiscountCode();return e?t?discountNinja.Utilities.EncodeUriComponentComponentForQueryString(e):e:""}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFirstActiveDiscountCodeForCheckout",t),""}},GetDiscountCode:function(t){try{let e=discountNinja_Script_DiscountCode.GetFromCache();for(let n=0;n<e.length;n++)if(e[n].Token===t)return e[n].DiscountCode;return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCode",t),null}},GetPromotionForDiscountCode:function(t){try{let n=discountNinja.Offer.Offers;if(!n)return null;for(let i=0;i<n.length;i++)for(var e=0;e<5;e++)if(n[i].Tiers[e]&&n[i].Tiers[e].DiscountCode.Code===t)return n[i];return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetPromotionForDiscountCode",t),null}},EnableDiscountCodeField:function(){function t(t){let e=discountNinja.Settings.Settings.PriceUpdate.Mode,n=t?e.DrawerCartDiscountField:e.CartDiscountField,i=discountNinja_Script_DynamicPricing.InjectPlaceHolder,o=discountNinja_Script_DiscountCode.ClassPrefix+(t?"-drawercart":"-cart")+"-injected";if(!n||"custom"===n||"none"===n)return;if(jQuery("."+o).length>0)return;let r='<div class="'+discountNinja_Script_DiscountCode.ClassPrefix+"-placeholder "+o+'"></div>';i.Inject(n,r)}try{let e=discountNinja.Settings.Settings.Cart;if(!!e&&!0===e.CartDiscountField){let e="."+discountNinja_Script_DiscountCode.ClassPrefix+"-",n=e+"wrapper",i=e+"placeholder";discountNinja.Environment.Shopify.IsCartPage()?t(!1):t(!0);let o=jQuery(i);if(o.length>0){let t=jQuery(n).html();o.html(t);let r=e+"input",a=i+" input"+r;jQuery(i+" "+e+"apply").click(function(){let t=jQuery(this).closest(i).find(r).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(t)}),jQuery(a).keypress(function(t){var e=t.keyCode?t.keyCode:t.which;if("13"===e||13===e){let e=jQuery(this).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(e),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1}}),o.find(n).show()}}}catch(t){discountNinja.Logging.LogError("DiscountCode.EnableDiscountCodeField",t)}},RemoveSavedDiscountCode:function(){try{discountNinja.Cache.SessionRemove("saveddiscountcode")}catch(t){return discountNinja.Logging.LogError("DiscountCode.RemoveSavedDiscountCode",t),""}},GetDiscountCodeFromQueryParameter:function(){try{let t=discountNinja.QueryParameter.Get("discountcode");return t?t.toUpperCase():function(){try{let t=discountNinja.Cache.SessionGet("saveddiscountcode");return t?t.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetSavedDiscountCode",t),""}}()}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCodeFromQueryParameter",t),""}}},discountNinja_Script_DiscountCodeTrigger={SessionStorageKeyTriggers:"triggersfromdiscountcode",Get:function(){let t=discountNinja.Cache.SessionGet(discountNinja_Script_DiscountCodeTrigger.SessionStorageKeyTriggers);return t?JSON.parse(t):[]},Save:function(t){discountNinja.Cache.SessionSet(discountNinja_Script_DiscountCodeTrigger.SessionStorageKeyTriggers,JSON.stringify(t))},FindByDiscountCode:function(t,e){for(let n=0;n<e.length;n++)if(e[n].discountCode.toLowerCase()===t.toLowerCase())return e[n];return null},Add:function(t,e){let n=discountNinja_Script_DiscountCodeTrigger.Get();discountNinja_Script_DiscountCodeTrigger.FindByDiscountCode(t,n)||n.push({discountCode:t,trigger:e}),discountNinja_Script_DiscountCodeTrigger.Save(n)},Remove:function(t){let e=discountNinja_Script_DiscountCodeTrigger.Get(),n=[];for(let i=0;i<e.length;i++)e[i].discountCode.toLowerCase()!==t.toLowerCase()&&n.push(e[i]);discountNinja_Script_DiscountCodeTrigger.Save(n)},RemoveAndUpdateTags:function(t){discountNinja_Script_DiscountCodeTrigger.Remove(t),discountNinja.DiscountCode.Process()}},discountNinja_Script_DiscountedCart={Version:1,IsDirty:!1,DiscountedCart:null,SplitRowsInProcess:!1,FreeGiftAdjustmentInProcess:!1,SplitRowPrefix:"DiscountNinja.SplitRow.",FreeGiftPrefix:"DiscountNinja.FreeGift.",Get:function(t){try{if(null===discountNinja_Script_DiscountedCart.DiscountedCart)return null;for(let e=0;e<discountNinja_Script_DiscountedCart.DiscountedCart.items.length;e++){let n=discountNinja_Script_DiscountedCart.DiscountedCart.items[e];if(n.Key===t)return n}return null}catch(t){return discountNinja.Logging.LogError("DiscountedCart.Get",t),null}},BuildDiscountedCart:function(t){function e(t){try{let e=[],n=t.properties;if(null===n)return null;for(let t in n)e.push({Name:t,Value:n[t]});return e}catch(t){return[]}}function n(t,n,i,o,r,a){let c=-1;for(let e=0;e<n.items.length;e++)if(n.items[e].Key===t){c=e;break}let s=function(t,n,i,o,r){let a=discountNinja.LiquidData.CartItemByKey(t),c={Key:t,Product:i,Line:o,OfferToken:n?n.Token:null,TriggerToken:n?discountNinja.Offer.GetTriggerTokenForOffer(n.Token):null,TargetType:n?n.Entitlement?n.Entitlement.TargetType:null:"line_item",DiscountCode:n?discountNinja.Offer.GetPromotionDiscountCode(n):null,PriceRuleId:n?discountNinja.Offer.GetPromotionPriceRuleId(n):null,PriceRuleTitle:n?discountNinja.Offer.GetPromotionPriceRuleTitle(n):null,Properties:e(a),Tier:r};try{delete c.Product.Key,delete c.Product.OfferToken,delete c.Product.TriggerToken,delete c.Product.DiscountCode,delete c.Line.Key,delete c.Line.OfferToken,delete c.Line.TriggerToken,delete c.Line.DiscountCode}catch(t){}return c}(t,i,o,r,a);-1===c?(discountNinja.Logging.LogVerbose("Adding line in discounted cart"),n.items.push(s)):(discountNinja.Logging.LogVerbose("Updating line discounted cart"),n.items[c]=s)}function i(t,e,n,i,o,r,a){return{Key:t,VariantId:e,ProductHandle:n,OriginalPrice:i/100,OriginalCompareAtPrice:o/100,Amount:0,Percentage:0,EffectiveCompareAtPrice:o/100,DiscountedPrice:i/100,InventoryLeft:r,Collections:a,Tier:null}}function o(t,e,o,r,a,c,s,u){try{discountNinja.Logging.LogVerbose("Evaluating if item with key "+e+" and handle "+o+" must be added to discounted cart");let d=e.split(":")[0],l=discountNinja.Offer.GetOfferForCartItem(e,o,d,u,c,r,a),g=r/100,f=null,p=null,m=null;if(s>0&&l&&l.Entitlement&&"shipping_line"!==l.Entitlement.TargetType&&"each"==l.Entitlement.AllocationMethod)if(f=discountNinja.DiscountedProduct.Get(e,d,o,r,a,c,l),p=discountNinja.DiscountedProduct.Get(e,d,o,r,a,c,l,s),f.Collections=u,p){discountNinja.Logging.LogVerbose("Adding "+s+" item(s) with key "+e+" and handle "+o+" to discounted cart, applying offer "+l.Token+", discounted price is "+f.DiscountedPrice);let n=discountNinja.DiscountTier.GetCurrentDiscountTier(l);m=n?n.Level:null;let i=discountNinja.Prerequisite.EntitledQuantity(l,n)||s;i=Math.min(i,s);let r=Math.max(0,s-i);l.AttributedQuantity=l.AttributedQuantity+i;let a=p.DiscountedPrice,c=discountNinja.Utilities.RoundToNumberOfDigits(a/s*i,2);c+=discountNinja.Utilities.RoundToNumberOfDigits(g*r,2),t.total_discounted_price+=c,p.DiscountedPrice=c;let u=Math.min(p.Amount/s,g-a/s),d=discountNinja.Utilities.RoundToNumberOfDigits(u*i,2);p.EffectiveAmount=d,p.EffectivePercentage=Math.min(0===p.EffectiveCompareAtPrice?0:Math.abs(d/p.EffectiveCompareAtPrice*100),100),p.QuantityDiscounted=i,p.QuantityNotDiscounted=r,t.total_discount+=d;try{delete p.VariantId,delete p.ProductHandle,delete p.InventoryLeft}catch(t){}}else f=i(),p=i(),t.total_discounted_price+=g*s;else f=i(e,d,o,r,a,c,u),p=function(t,e,n){return{OriginalPrice:t/100*n,OriginalCompareAtPrice:e/100*n,Amount:0,Percentage:0,EffectiveAmount:0,EffectivePercentage:0,EffectiveCompareAtPrice:e/100*n,DiscountedPrice:t/100*n,QuantityDiscounted:0,QuantityNotDiscounted:n,Tier:null}}(r,a,s),t.total_discounted_price+=g*s;return n(e,t,l,f,p,m),t.total_original_price+=g*s,t}catch(e){return discountNinja.Logging.LogError("DiscountedCart.AddDiscountedCartItem",e),t}}function r(){for(let t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja.Offer.Offers[t].AttributedQuantity=0}function a(){try{let t=discountNinja.Offer.Offers;if(t&&0!==t.length){discountNinja.Logging.LogVerbose("Building discounted cart - Offers available, continuing");let t=window.discountNinjaContext.Cart;if(discountNinja_Script_DiscountedCart.IsDirty=!1,discountNinja_Script_DiscountedCart.ClearCartValueCache(),function(){if(discountNinja.Offer.Offers)for(let t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja.Offer.Offers[t].AppliedTier=null;discountNinja.Offer.PrimaryOffer&&(discountNinja.Offer.PrimaryOffer.AppliedTier=null)}(),void 0!==t&&void 0!==t.items){let n={items:[]},i=null;n.token=discountNinja.LiquidData.Cart().token;let a=function(t){let e=[];for(let n=0;n<t.items.length;n++)if(t.items[n].properties)for(let i in t.items[n].properties)if(i.indexOf("DiscountNinja.FreeGift")>-1||i.indexOf("DiscountNinja.Discounted")>-1){e.push(t.items[n]);break}for(let n=0;n<t.items.length;n++){let i=!1;for(let o=0;o<e.length;o++)if(t.items[n].key===e[o].key){i=!0;break}i||e.push(t.items[n])}return e.sort(function(t,e){let n=!1,i=!1;if(t.properties)for(let e in t.properties)if(e.indexOf("DiscountNinja.SplitRow")>-1){n=!0;break}if(e.properties)for(let t in e.properties)if(t.indexOf("DiscountNinja.SplitRow")>-1){i=!0;break}return t.original_price<e.original_price?-1:t.original_price>e.original_price?1:n&&!i?-1:!n&&i?1:0}),e}(t),u=-1,d=!0;for(;d;){r(),n.total_original_price=0,n.total_discounted_price=0,n.total_discount=0,n.BogoUsed="";for(let t=0;t<a.length;t++){discountNinja.Logging.LogVerbose("Building discounted cart - Evaluating cart item "+t);let e=discountNinja.ProductData.GetByProductHandle(a[t].handle,!0);e?(discountNinja.Logging.LogVerbose("Building discounted cart - Promotion data found for cart item "+t+" with key "+a[t].key+" and handle "+a[t].handle),n=o(n,a[t].key,a[t].handle,a[t].original_price,e.CompareAtPrice,e.Inventory,a[t].quantity,e.Collections)):discountNinja.Logging.LogVerbose("Building discounted cart - No offer data found for cart item "+t+" with key "+a[t].key+" and handle "+a[t].handle)}discountNinja_Script_DiscountedCart.DiscountedCart=n,n.total_discount<u?(n=i,d=!1):n.total_discount===u?d=!1:(u=n.total_discount,i=JSON.parse(JSON.stringify(n)))}if(discountNinja.Offer.Offers){var e=[];for(let t=0;t<discountNinja.Offer.Offers.length;t++){let n=discountNinja.Offer.Offers[t];if(n.Entitlement&&"line_item"===n.Entitlement.TargetType&&"across"===n.Entitlement.AllocationMethod&&discountNinja.Offer.OfferIsApplicable(n)){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(n);if(t){let i=discountNinja.Offer.EligibleItemsCartValue(n,"discountedcart"),o=i/100,r=0;r="percentage"===n.Entitlement.ValueType?Math.floor(i*t.Entitlement.Percentage/100)/100:t.Entitlement.Amount;let a=Math.min(o,r);if(a>0){let i=t.DiscountCode;e.push({OfferToken:n.Token,TriggerToken:discountNinja.Offer.GetTriggerTokenForOffer(n.Token),Amount:a,DiscountCode:i.Code,PriceRuleId:i.PriceRuleId,PriceRuleAppId:i.PriceRuleAppId,PriceRuleTitle:i.PriceRuleTitle,TargetType:n.Entitlement.TargetType,Tier:t?t.Level:null,Stacks:!0===n.Stacking.Combine&&!0===n.Stacking.Stack,ValueType:n.Entitlement.ValueType,Percentage:t.Entitlement.Percentage})}}}}if(n.CartLevelDiscounts=[],e.length>0){let t=[],i=[],o=[];for(let n=0;n<e.length;n++){let r=e[n];!0===r.Stacks?"percentage"===r.ValueType?o.push(r):i.push(r):t.push(r)}let r=n.total_discounted_price,a=null;for(let e=0;e<t.length;e++){let n=t[e],i=a?a.Amount:0;n.Amount>i&&(a=n)}let u=a?r-a.Amount:-1,d=!0,l=0,g=1,f=-1;l=s(i,n.total_discounted_price).DiscountAmount;for(let t=0;t<o.length;t++)g*=1-o[t].Percentage/100;let p=(r-l)*g,m=r*g-l;p<m?(f=p,d=!1):(f=m,d=!0);let h=f>=0||u>=0?"":"none";if(""===h&&(h=u>=0&&u<f?"nonstacking":"stacking"),"stacking"==h)if(d){let t=c(o,n.total_discounted_price);for(let e=0;e<t.CartLevelDiscounts.length;e++)n.CartLevelDiscounts.push(t.CartLevelDiscounts[e]);n.total_discounted_price-=t.DiscountAmountCents/100,n.total_discount+=t.DiscountAmountCents/100;let e=s(i,n.total_discounted_price);for(let t=0;t<e.CartLevelDiscounts.length;t++)n.CartLevelDiscounts.push(e.CartLevelDiscounts[t]);n.total_discounted_price-=e.DiscountAmount,n.total_discount+=e.DiscountAmount}else{let t=s(i,n.total_discounted_price);for(let e=0;e<t.CartLevelDiscounts.length;e++)n.CartLevelDiscounts.push(t.CartLevelDiscounts[e]);n.total_discounted_price-=t.DiscountAmount,n.total_discount+=t.DiscountAmount;let e=c(o,n.total_discounted_price);for(let t=0;t<e.CartLevelDiscounts.length;t++)n.CartLevelDiscounts.push(e.CartLevelDiscounts[t]);n.total_discounted_price-=e.DiscountAmountCents/100,n.total_discount+=e.DiscountAmountCents/100}else"nonstacking"==h&&(n.total_discounted_price-=a.Amount,n.total_discount+=a.Amount,n.CartLevelDiscounts.push(a))}}if(n.Shipping=null,discountNinja.Offer.Offers)for(let t=0;t<discountNinja.Offer.Offers.length;t++){let e=discountNinja.Offer.Offers[t];if(e.Entitlement&&"shipping_line"===e.Entitlement.TargetType&&discountNinja.Offer.OfferIsApplicable(e)){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(e);if(t){let i=t.DiscountCode;n.Shipping={OfferToken:e.Token,TriggerToken:discountNinja.Offer.GetTriggerTokenForOffer(e.Token),DiscountCode:i.Code,PriceRuleId:i.PriceRuleId,PriceRuleTitle:i.PriceRuleTitle,PriceRuleAppId:i.PriceRuleAppId,TargetType:e.Entitlement.TargetType}}if(n.Shipping&&n.Shipping.PriceRuleId)break}}if(n.items&&!discountNinja_Script_DiscountedCart.SplitRowsInProcess)for(let t=0;t<n.items.length;t++){let e=n.items[t],i=e.Line;if(i.QuantityDiscounted>0&&i.QuantityNotDiscounted>0){discountNinja.Logging.LogInformation("Splitting rows"),discountNinja.Cart.Shopify.LockRefreshCart=!0,discountNinja_Script_DiscountedCart.SplitRowsInProcess=!0;let t=discountNinja_Script_DiscountedCart.SplitRowPrefix+e.OfferToken,n=discountNinja.LiquidData.AddPropertyToCartItem(e.Key,t,"");if(0===i.DiscountedPrice){let t=discountNinja_Script_DiscountedCart.FreeGiftPrefix+e.OfferToken;n=discountNinja.LiquidData.AddPropertyToCartItem(e.Key,t,"")}discountNinja.Cart.Shopify.ChangeCartItemByKey(e.Key,i.QuantityDiscounted,n,function(){let t=discountNinja.LiquidData.CartItemPropertiesAsObject(e.Key);t=discountNinja.LiquidData.RemovePropertiesByPrefix(t,discountNinja_Script_DiscountedCart.FreeGiftPrefix),t=discountNinja.LiquidData.RemovePropertiesByPrefix(t,discountNinja_Script_DiscountedCart.SplitRowPrefix),discountNinja.Cart.Shopify.AddToCart(e.Product.VariantId,i.QuantityNotDiscounted,t,function(){discountNinja.Cart.Shopify.LockRefreshCart=!1,discountNinja_Script_PromotionFlow.RefreshAfterCartAdjustments()})});break}}let l=(new Date).getTime();n.Version=discountNinja_Script_DiscountedCart.Version+"-"+l,discountNinja_Script_DiscountedCart.Version=discountNinja_Script_DiscountedCart.Version+1,r(),discountNinja.Cache.SessionRemove("PrerequisiteItemsCartValue"),function(t){try{if(t.items)for(let e=0;e<t.items.length;e++){let n=t.items[e];if(n.OfferToken&&n.Tier){let t=discountNinja.Offer.GetOfferByToken(n.OfferToken);t&&(!t.AppliedTier||1*t.AppliedTier<1*n.Tier)&&(t.AppliedTier=n.Tier)}}if(t.CartLevelDiscounts)for(let e=0;e<t.CartLevelDiscounts.length;e++){let n=t.CartLevelDiscounts[e];if(n.OfferToken&&n.Tier){let t=discountNinja.Offer.GetOfferByToken(n.OfferToken);t&&(!t.AppliedTier||1*t.AppliedTier<1*n.Tier)&&(t.AppliedTier=n.Tier)}}if(discountNinja.Offer.PrimaryOffer){let t=discountNinja.Offer.GetOfferByToken(discountNinja.Offer.PrimaryOffer.Token);discountNinja.Offer.PrimaryOffer.AppliedTier=t.AppliedTier}}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveTiersUsed",t)}}(n),function(t){try{discountNinja.Cache.LocalSet("discounted-cart",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveDiscountedCartToCache",t)}}(n),discountNinja_Script_DiscountedCart.DiscountedCart=n,discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!0,discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!0,discountNinja.Events.Publish("CartUpdated",[discountNinja.DiscountedCart.DiscountedCart]),discountNinja_Script_Checkout_Shopify.ProcessingPrepareAdvancedCheckout||discountNinja.Checkout.Shopify.PrepareAdvancedCheckout()}else discountNinja.Logging.LogVerbose("Building discounted cart - Cart empty, aborting")}else discountNinja.Logging.LogVerbose("Building discounted cart - Offers unavailable, aborting"),discountNinja_Script_DiscountedCart.DiscountedCart={items:[]},discountNinja_Script_DiscountedCart.IsDirty=!1}catch(t){discountNinja.Logging.LogError("DiscountedCart.BuildDiscountedCart",t)}discountNinja.DynamicPricing.UnblockPricesAndButtons(),null!=t&&"function"==typeof t&&t()}function c(t,e){let n=100*e,i=0;for(let e=0;e<t.length;e++){let o=t[e],r=Math.floor(n*o.Percentage/100);t[e].Amount=r/100,i+=r,n-=r}return{CartLevelDiscounts:t,DiscountAmountCents:i}}function s(t,e){let n=0;for(let i=0;i<t.length;i++){let o=t[i].Amount;e<o&&(o=total),n+=o,e-=o}return{CartLevelDiscounts:t,DiscountAmount:n}}if(discountNinja.Logging.LogVerbose("Building discounted cart - START"),discountNinja_Script_DiscountedCart.IsDirty){let t=discountNinja_Script_DiscountedCart.DiscountedCart;t&&(t.CheckoutLink=null);var u=0;!function t(){u++;let e=window.discountNinjaContext.Cart,n=!0;for(let t=0;t<e.items.length&&(discountNinja.ProductData.GetByProductHandle(e.items[t].handle,!0)||(n=!1),n);t++);!n&&u<5?setTimeout(function(){t()},1e3):a()}()}else discountNinja.Logging.LogVerbose("Building discounted cart - Assumed not dirty"),discountNinja_Script_DiscountedCart.DiscountedCart||(discountNinja.Logging.LogVerbose("Building discounted cart - Rehydrating from cache"),discountNinja_Script_DiscountedCart.DiscountedCart=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache()),discountNinja_Script_DiscountedCart.DiscountedCart?(discountNinja.Logging.LogVerbose("Building discounted cart - Rehydrating from cache - SUCCESS"),null!=t&&"function"==typeof t&&t()):discountNinja.Logging.LogWarning("Building discounted cart - Rehydrating from cache - FAILED"),discountNinja.DynamicPricing.UnblockPricesAndButtons()},GetDiscountedCartFromCache:function(){try{let t=discountNinja.Cache.LocalGet("discounted-cart"),e="undefined"===t?null:JSON.parse(t);return e&&!e.CartLevelDiscounts&&(e.CartLevelDiscounts=[]),e}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedCartFromCache",t),null}},GetCartItemKeys:function(){try{if(discountNinja_Script_DiscountedCart.DiscountedCart=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache(),discountNinja_Script_DiscountedCart.DiscountedCart&&discountNinja_Script_DiscountedCart.DiscountedCart.items){let t="";for(let e=0;e<discountNinja_Script_DiscountedCart.DiscountedCart.items.length;e++)""!==t&&(t+=","),t+=discountNinja_Script_DiscountedCart.DiscountedCart.items[e].Key;return t}return""}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetCartItemKeys",t)}},ClearCartValueCache:function(){discountNinja.Cache.SessionSet("CartValue",null)},DiscountedCartItemsByDelegate:function(t){try{let e=[];if(!discountNinja_Script_DiscountedCart.DiscountedCart||!discountNinja_Script_DiscountedCart.DiscountedCart||0===discountNinja_Script_DiscountedCart.DiscountedCart.items.length)return e;let n=discountNinja_Script_DiscountedCart.DiscountedCart.items;for(let i=0;i<n.length;i++){let o=n[i];t(o)&&e.push(o)}return e}catch(t){return discountNinja.Logging.LogError("DiscountedCart.DiscountedCartItemsByDelegate",t),0}},GetDiscountedLinePriceFromItems:function(t){try{let e=0;if(t)for(let n=0;n<t.length;n++)e+=100*t[n].Line.DiscountedPrice;return e}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedLinePriceFromItems",t),0}},ItemIsInCollection:function(t,e){return e.indexOf("%")>-1&&t.Product.OriginalCompareAtPrice>t.Product.OriginalPrice||discountNinja.Utilities.StringIsIn(t.Product.Collections,e)},ItemsInDiscountedCartFromCollections:function(t,e){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate(function(n){return discountNinja_Script_DiscountedCart.ItemIsInCollection(n,t)&&(!e||!discountNinja_Script_DiscountedCart.ItemIsInCollection(n,e))})}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCartFromCollections",t),0}},ItemsInDiscountedCartFromProducts:function(t,e){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate(function(n){return discountNinja.Utilities.StringIsIn(t,n.Product.ProductHandle)&&(!e||!discountNinja_Script_DiscountedCart.ItemIsInCollection(n,e))})}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCartFromProducts",t),0}},ItemsInDiscountedCart:function(t){try{return discountNinja_Script_DiscountedCart.DiscountedCartItemsByDelegate(function(e){return!t||!discountNinja_Script_DiscountedCart.ItemIsInCollection(e,t)})}catch(t){return discountNinja.Logging.LogError("DiscountedCart.ItemsInDiscountedCart",t),0}},ValueInDiscountedCartFromCollections:function(t,e){let n=discountNinja_Script_DiscountedCart.ItemsInDiscountedCartFromCollections(t,e);return discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(n)},ValueInDiscountedCartFromProducts:function(t,e){let n=discountNinja_Script_DiscountedCart.ItemsInDiscountedCartFromProducts(t,e);return discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(n)},ValueInDiscountedCart:function(t){let e=discountNinja_Script_DiscountedCart.ItemsInDiscountedCart(t);return discountNinja_Script_DiscountedCart.GetDiscountedLinePriceFromItems(e)},GetFirstDiscountCode:function(){try{let t=discountNinja.DiscountedCart.DiscountedCart;if(!t)return!1;if(t.Shipping&&t.Shipping.DiscountCode&&t.Shipping.PriceRuleId)return t.Shipping.DiscountCode;if(t.CartLevelDiscounts)for(let e=0;e<t.CartLevelDiscounts.length;e++){let n=t.CartLevelDiscounts[e];if(n.DiscountCode&&n.PriceRuleId)return n.DiscountCode}if(t.items)for(let e=0;e<t.items.length;e++){let n=t.items[e];if(n.DiscountCode&&n.PriceRuleId)return n.DiscountCode}return null}catch(t){return discountNinja.Logging.LogVerbose("DiscountedCart.GetFirstDiscountCode failed "+t),null}},HasFreeShipping:function(){try{let t=discountNinja.DiscountedCart.DiscountedCart;return!!t&&!(!t.Shipping||!t.Shipping.OfferToken&&!t.Shipping.DiscountCode)}catch(t){return discountNinja.Logging.LogVerbose("DiscountedCart.HasFreeShipping failed "+t),!1}},CountAppliedPromotions:function(){try{let t=discountNinja.DiscountedCart.DiscountedCart;if(!t)return!1;let e=0;if(t.CartLevelDiscounts)for(let n=0;n<t.CartLevelDiscounts.length;n++)(t.CartLevelDiscounts[n].OfferToken||t.CartLevelDiscounts[n].DiscountCode)&&(e+=1);if(t.items)for(let n=0;n<t.items.length;n++)(t.items[n].OfferToken||t.items[n].DiscountCode)&&(e+=1);return e}catch(t){return discountNinja.Logging.LogVerbose("DiscountedCart.CountAppliedPromotions failed "+t),!1}},HasAppliedPromotions:function(){try{return discountNinja_Script_DiscountedCart.HasFreeShipping()||discountNinja_Script_DiscountedCart.CountAppliedPromotions()>0}catch(t){return discountNinja.Logging.LogVerbose("DiscountedCart.HasAppliedPromotions failed "+t),!1}},HasActivePromotions:function(){return null!==discountNinja.Offer.Offers&&null!==discountNinja.Offer.PrimaryOffer},GetAppliedPromotions:function(){try{let t=[],e=discountNinja.DiscountedCart.DiscountedCart;if(e&&e.items.length>0){for(let n=0;n<e.items.length;n++){let i=e.items[n],o=i.OfferToken;discountNinja.Logging.LogVerbose("Line item discount code added to active list for token "+o),t.push({OfferToken:o,TriggerToken:i.TriggerToken,DiscountCode:i.DiscountCode,PriceRuleId:i.PriceRuleId,PriceRuleTitle:i.PriceRuleTitle,PriceRuleAppId:i.PriceRuleAppId,TargetType:i.TargetType})}for(let n=0;n<e.CartLevelDiscounts.length;n++){let i=e.CartLevelDiscounts[n],o=i.OfferToken;discountNinja.Logging.LogVerbose("Cart level discount code added to active list for token "+o),t.push({OfferToken:o,TriggerToken:i.TriggerToken,DiscountCode:i.DiscountCode,PriceRuleId:i.PriceRuleId,PriceRuleTitle:i.PriceRuleTitle,PriceRuleAppId:i.PriceRuleAppId,TargetType:i.TargetType})}if(e.Shipping){let n=e.Shipping,i=n.OfferToken;discountNinja.Logging.LogVerbose("Shipping discount code added to active list for token "+i),t.push({OfferToken:i,TriggerToken:n.TriggerToken,DiscountCode:n.DiscountCode,PriceRuleId:n.PriceRuleId,PriceRuleTitle:n.PriceRuleTitle,PriceRuleAppId:n.PriceRuleAppId,TargetType:n.TargetType})}}let n=discountNinja.Cookie.GetDiscountCodeCookie();n&&(discountNinja.Logging.LogVerbose("Native shareable link code added to active list"),t.push({OfferToken:null,TriggerToken:null,DiscountCode:n,PriceRuleId:null,PriceRuleAppId:null,PriceRuleTitle:null,TargetType:null,ShareableLink:"native"}));let i=jQuery('form[action^="/cart"]:not([action^="/cart/add"]) input[name="discount"]').val();i&&(discountNinja.Logging.LogVerbose("Adding code from form"),t.push({OfferToken:null,TriggerToken:null,DiscountCode:i,PriceRuleId:null,PriceRuleTitle:null,PriceRuleAppId:null,TargetType:null,ShareableLink:"cumulative"}));let o=discountNinja_Script_DiscountCode.GetDiscountCodeFromQueryParameter();if(o){discountNinja.Logging.LogVerbose("Query parameter discount code added to active list"),o=o.split(",");for(let e=0;e<o.length;e++)t.push({OfferToken:null,TriggerToken:null,DiscountCode:o[e],PriceRuleId:null,PriceRuleTitle:null,PriceRuleAppId:null,TargetType:null,ShareableLink:"queryparameter"})}let r=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache();if(r)for(let e=0;e<r.length;e++)discountNinja.Logging.LogVerbose("External code added to active list"),t.push(r[e]);let a=[];for(let e=0;e<t.length;e++){let n=!0;if(t[e]){if(!t[e].DiscountCode){if(!t[e].OfferToken)continue;t[e].DiscountCode=t[e].OfferToken}for(let i=0;i<a.length;i++){let o=a[i];if(a[i].PriceRuleTitle===t[e].PriceRuleTitle){void 0!==o.OfferToken&&null!==o.OfferToken||(o.OfferToken=t[e].OfferToken),void 0!==o.TriggerToken&&null!==o.TriggerToken||(o.TriggerToken=t[e].TriggerToken),void 0!==o.PriceRuleId&&null!==o.PriceRuleId||(o.PriceRuleId=t[e].PriceRuleId),void 0!==o.PriceRuleTitle&&null!==o.PriceRuleTitle||(o.PriceRuleTitle=t[e].PriceRuleTitle),void 0!==o.PriceRuleAppId&&null!==o.PriceRuleAppId||(o.PriceRuleAppId=t[e].PriceRuleAppId),void 0!==o.TargetType&&null!==o.TargetType||(o.TargetType=t[e].TargetType),n=!1;break}}n&&a.push(t[e])}}for(let t=0;t<a.length;t++){let e=a[t];if(e.DiscountCode){let t=!1;if(!t){let n=discountNinja.Offer.AllOffers;for(let i=0;i<n.length;i++){let o=n[i];if(!t)for(let t=0;t<o.Tiers.length;t++){let n=o.Tiers[t];if(n.DiscountCode.Code===e.DiscountCode){void 0!==e.OfferToken&&null!==e.OfferToken||(e.OfferToken=o.Token),void 0!==e.TriggerToken&&null!==e.TriggerToken||(e.TriggerToken=discountNinja.Offer.GetTriggerTokenForOffer(o.Token)),void 0!==e.PriceRuleId&&null!==e.PriceRuleId||(e.PriceRuleId=n.DiscountCode.PriceRuleId),void 0!==e.PriceRuleTitle&&null!==e.PriceRuleTitle||(e.PriceRuleTitle=n.DiscountCode.PriceRuleTitle),void 0!==e.PriceRuleAppId&&null!==e.PriceRuleAppId||(e.PriceRuleAppId=n.DiscountCode.PriceRuleAppId),void 0!==e.TargetType&&null!==e.TargetType||(e.TargetType=o.Entitlement.TargetType);break}}}}}}return a}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetAppliedPromotions",t),[]}}},discountNinja_Script_DiscountedProduct={Get:function(t,e,n,i,o,r,a,c){try{c||(c=1);let s=discountNinja.DiscountTier.GetCurrentDiscountTier(a);if(null===s)return null;let u=a.Entitlement.ValueType,d=a.Entitlement.DiscountPriceType,l=s.Entitlement.Amount||0,g=s.Entitlement.Percentage||0,f=discountNinja.Settings.Settings.Currency,p=f.RoundPrices,m=f.RoundToCents,h={Key:t,VariantId:e,ProductHandle:n,OriginalPrice:i*c/100,OriginalCompareAtPrice:o*c/100,Amount:l*c>i*c?i*c:l*c,Percentage:Math.min(g,100)};(void 0===h.OriginalCompareAtPrice||null===h.OriginalCompareAtPrice||0===h.OriginalCompareAtPrice||isNaN(h.OriginalCompareAtPrice)||h.OriginalCompareAtPrice<h.OriginalPrice)&&(h.OriginalCompareAtPrice=h.OriginalPrice),h.EffectiveCompareAtPrice=h.OriginalCompareAtPrice,"price"===d&&(h.EffectiveCompareAtPrice=h.OriginalPrice);let j=h.EffectiveCompareAtPrice;if(j>0){if("fixed_amount"===u)h.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits(j-h.Amount,2),h.Percentage=Math.min(0===j?0:Math.abs(h.Amount/j*100),100);else if("percentage"===u){let t=j*h.Percentage/100,e=discountNinja.Utilities.FloorToNumberOfDigits(t,2);h.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits(j-e,2),h.Amount=Math.max(discountNinja.Utilities.RoundToNumberOfDigits(j-h.DiscountedPrice,2),0)}if(h.DiscountedPrice<0&&(h.DiscountedPrice=0),p){let t=100*h.DiscountedPrice;t>0&&(t=100*Math.floor(t/100)+m),h.DiscountedPrice=Math.round(t)/100}}else h.DiscountedPrice=0,h.Amount=0;return h.InventoryLeft=r,h.OfferToken=a.Token,h.TriggerToken=discountNinja.Offer.GetTriggerTokenForOffer(a.Token),h.DiscountCode=s.DiscountCode.Code,h}catch(t){return discountNinja.Logging.LogError("DiscountedProduct.Get",t),null}},GetFromProductPage:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.ProductHandle(),e=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Price(e);if(null===n)return null;let i=discountNinja.LiquidData.CompareAtPrice(e),o=discountNinja.LiquidData.Inventory(e),r=discountNinja.Offer.GetOfferForProduct(t,e,null,o,n,i,!0,!0);return r?discountNinja_Script_DiscountedProduct.Get(null,e,t,n,i,o,r):null}return null}catch(t){discountNinja.Logging.LogError("DiscountedProduct.GetFromProductPage",t)}}},discountNinja_Script_DiscountTier={GetCurrentDiscountTierNumber:function(t,e){function n(t,e,n){try{if(!e||!t)return!1;let i=e.Prerequisite;if(!discountNinja.Offer.IsOfferAccepted(t.Token,t.Frequency))return!1;if(i.MinimumAmount&&n<100*i.MinimumAmount)return!1;if(i.MaximumAmount&&n>100*i.MaximumAmount)return!1;if(i.MinimumItems>0){if(discountNinja.Prerequisite.PrerequisiteItemsInCart(t,e)<i.MinimumItems)return!1}if(i.MaximumItems>0){if(discountNinja.Prerequisite.PrerequisiteItemsInCart(t,e)>i.MaximumItems)return!1}if(i.BogoPrerequisiteQuantity>0){if(discountNinja.Prerequisite.PrerequisiteItemsInCart(t,e)<i.BogoPrerequisiteQuantity)return!1}return!0}catch(t){return discountNinja.Logging.LogError("DiscountTier.DiscountTierIsApplicable",t),!1}}try{if(!discountNinja.Offer.OfferIsApplicable(t))return null;if(t.AppliedTier)return t.AppliedTier;let i=n(t,t.Tiers[0],e),o=n(t,t.Tiers[1],e),r=n(t,t.Tiers[2],e),a=n(t,t.Tiers[3],e);return n(t,t.Tiers[4],e)?5:a?4:r?3:o?2:i?1:e>0?0:-1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTierNumber",t),-1}},GetMaxDiscountTierNumber:function(t){try{return"object"==typeof t.Tiers[4]?5:"object"==typeof t.Tiers[3]?4:"object"==typeof t.Tiers[2]?3:"object"==typeof t.Tiers[1]?2:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetMaxDiscountTierNumber",t),1}},GetCurrentDiscountTier:function(t){try{if(t.AppliedTier&&t.Tiers)return t.Tiers[t.AppliedTier-1];let e=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,e);if(null===n||0===n||-1===n)return null;let i=discountNinja_Script_DiscountTier.GetMaxDiscountTierNumber(t),o=t.Tiers[n-1];return o.IsMaxTier=i===n,o.Level=n,o}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTier",t),null}},GetGoalDiscountTierNumber:function(t){try{let e=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,e);if(null===n)return null;let i=discountNinja_Script_DiscountTier.GetMaxDiscountTierNumber(t);return 5===n?-1:4===n?i<=4?-1:5:3===n?i<=3?-1:4:2===n?i<=2?-1:3:1===n?i<=1?-1:2:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetGoalDiscountTier:function(t){try{let e=discountNinja_Script_DiscountTier.GetGoalDiscountTierNumber(t);return null===e||-1===e?null:t.Tiers[e-1]}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetPercentageAmountFromDiscountTier:function(t){try{return t?{Percentage:t.Entitlement.Percentage,Amount:t.Entitlement.Amount}:null}catch(t){discountNinja.Logging.LogError("DiscountTier.GetPercentageAmountFromDiscountTier",t)}},GoalAchieved:function(t){try{let e=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,e);return null!==n&&n>0}catch(t){return discountNinja.Logging.LogError("DiscountTier.GoalAchieved",t),!1}}};const discountNinja_Script_DynamicPricing_Classes_Prefix="limoniapps-discountninja-",discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"productprice",discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"promotioncard-productpage",discountNinja_Script_DynamicPricing_Attributes_Prefix="data-limoniapps-discountninja-",discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-promotionsummary";var discountNinja_Script_DynamicPricing={Classes:{Prefix:discountNinja_Script_DynamicPricing_Classes_Prefix,ProductPrice:{OriginalPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-original",ReplacedPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-replaced",ShowAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-showafterreplace",HideAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-hideafterreplace",Wrapper:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-wrapper",Injected:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-injected"},ProductBanner:{Injected:discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+"-injected",Prerequisite:discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+"-prerequisite"},PromotionSummary:{Injected:discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix+"-injected"},Cart:{PriceForLevel:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-[LEVEL]-price",CommentForLevel:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-[LEVEL]-comment",Root:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-root",DrawerCartRoot:discountNinja_Script_DynamicPricing_Classes_Prefix+"drawercart-root",ProductPrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-product-price",LinePrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-line-price",Quantity:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-item-quantity",SubtotalPrice:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-subtotal-price",SubtotalPriceInjected:discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-subtotal-price-injected"},Collection:{FeaturedProduct:discountNinja_Script_DynamicPricing_Classes_Prefix+"featuredproduct"},ProductPrice_Legacy:"limoniapps-discounturl-productprice",Blocking:{Block:discountNinja_Script_DynamicPricing_Classes_Prefix+"block",BlockStop:discountNinja_Script_DynamicPricing_Classes_Prefix+"block-stop"}},Attributes:{DiscountNinja:{Token:"data-token",Ignore:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore",IgnoreSystem:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore-system",CartLineItemKey:"data-limoniapps-discountninja-cart-key"}},ReplacingPricesInCart:!1,DrawerCartReplacingPricesInCart:[],ProductPriceSelector:function(){return"."+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+",."+discountNinja_Script_DynamicPricing.Classes.ProductPrice_Legacy},BuildFormattedDiscountedPrice:function(t,e,n,i){let o=t.Format.replace(/ /g,"&nbsp"),r=discountNinja.ShortCode.ReplaceAllPlaceHolders(e,o,n);if(t.Animation){let e=t.AnimationIterations>0?' style="animation-iteration-count: '+t.AnimationIterations+' !important;"':"";r='<div class="'+t.Animation+'"'+e+">"+r+"</div>"}if(i&&n.PriceVaries){r='<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-from">'+window.discountNinjaContext.Labels.From+"</div>"+"&nbsp;"+r}let a="";t.PrefixText&&(a='<div class="limoniapps-discountninja-presuffix prefix '+t.PrefixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(e,t.PrefixText,n)+"</div>");let c="";return t.SuffixText&&(c='<div class="limoniapps-discountninja-presuffix suffix '+t.SuffixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(e,t.SuffixText,n)+"</div>"),'<div class="limoniapps-discountninja-discountedprice">'+a+r+c+"</div>"},BuildFormattedPrice:function(t,e,n,i,o,r,a,c){let s=null;e=e||"{{DISCOUNTED_PRICE}} {{ORIGINAL_PRICE,STRIKETHROUGH}}";let u='<div class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice+'" '+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token+'="'+n.Token+'" style="display:none;">'+t+"</div>";s=r?'<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-soldout">'+window.discountNinjaContext.Labels.SoldOut+"</div>":discountNinja_Script_DynamicPricing.BuildFormattedDiscountedPrice(e,n,i,o);let d='<div class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+" limoniapps-discountninja-"+c+'page" data-token="'+n.Token+'" style="display:none;">'+s+"</div>",l="";return l=a?d+u:elementHtml.replace(t,d+u),discountNinja.Logging.LogVerbose("Replacing price with "+l),l},InjectPlaceHolder:{Inject:function(t,e,n,i){function o(t,e){return 0===t.indexOf(e)?{Text:t.substring(e.length),KeywordFound:!0}:{Text:t,KeywordFound:!1}}let r=discountNinja_Script_DynamicPricing.InjectPlaceHolder;if(null!=t)if("underproducttitle"===t)r.UnderProductTitle(e);else if("aboveatcform"===t)r.AboveATCForm(e);else if("underatcform"===t)r.UnderATCForm(e);else if("aboveatcbutton"===t)r.AboveATCButton(e);else if("underatcbutton"===t)r.UnderATCButton(e);else if("abovecheckoutbutton"===t)r.AboveCheckoutButton(e);else if("undercheckoutbutton"===t)r.UnderCheckoutButton(e);else if("abovecheckoutform"===t)r.AboveCheckoutForm(e);else if("undercheckoutform"===t)r.UnderCheckoutForm(e);else{let r=t,a=!1,c=!1,s=!1,u=!1,d=!1,l=!1,g=!1,f=!1,p=!1,m=!1,h=!1,j="[[REPLACE]]",N="[[WRAP]]",y="[[BEFORE]]",C="[[AFTER]]",S="[[APPEND]]",_="[[PREPEND]]",L="[[HIDE]]",P="[[LEFT]]",v="[[CENTER]]",T="[[RIGHT]]",D=o(r,"[[REPLACECONTENT]]");a=D.KeywordFound,s=(D=o(D.Text,N)).KeywordFound,c=(D=o(D.Text,j)).KeywordFound,u=(D=o(D.Text,y)).KeywordFound,d=(D=o(D.Text,C)).KeywordFound,m=(D=o(D.Text,S)).KeywordFound,h=(D=o(D.Text,_)).KeywordFound,l=(D=o(D.Text,L)).KeywordFound,g=(D=o(D.Text,P)).KeywordFound,f=(D=o(D.Text,v)).KeywordFound,p=(D=o(D.Text,T)).KeywordFound,r=D.Text;let b=n?jQuery(n).find(r):jQuery(r);if(i&&(b=b.first()),b.length>0){if(a||c||u||d||s||m||h){let t="limoniapps-discountninja-align-",n=null;g&&(n=t+"left"),f&&(n=t+"center"),p&&(n=t+"right"),n&&(e=jQuery(e).addClass(n))}s?b.wrap(e):a?b.html(e):c?b.replaceWith(e):u?b.before(e):d?b.after(e):m?b.append(e):h&&b.prepend(e),l&&b.addClass("limoniapps-discountninja-whenpromotionsincart-hide")}}},InjectElement:function(t,e,n){e?t.after(n):t.before(n)},AboveATCForm:function(t){let e=jQuery("form[action^='/cart/add']").first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!1,t)},UnderATCForm:function(t){let e=jQuery("form[action^='/cart/add']").first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!0,t)},UnderProductTitle:function(t){let e=jQuery("h1").first();0===e.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.AboveATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!0,t)},UnderATCButton:function(t){let e=jQuery('.limoniapps-discountninja-addtocartbutton, form[action^="/cart/add"] :submit[name="add"]').first();0===e.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!0,t)},AboveATCButton:function(t){let e=jQuery('.limoniapps-discountninja-addtocartbutton, form[action^="/cart/add"] :submit[name="add"]').first();0===e.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!1,t)},UnderCheckoutForm:function(t){let e=jQuery('form[action^="/cart"]:not([action^="/cart/add"])').first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!0,t)},AboveCheckoutForm:function(t){let e=jQuery('form[action^="/cart"]:not([action^="/cart/add"])').first();discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!1,t)},UnderCheckoutButton:function(t){let e=jQuery('.limoniapps-discountninja-checkoutbutton, form[action^="/cart"] :submit[name="checkout"]').first();0===e.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!0,t)},AboveCheckoutButton:function(t){let e=jQuery('.limoniapps-discountninja-checkoutbutton, form[action^="/cart"] :submit[name="checkout"]').first();0===e.length?discountNinja_Script_DynamicPricing.InjectPlaceHolder.UnderATCForm(t):discountNinja_Script_DynamicPricing.InjectPlaceHolder.InjectElement(e,!1,t)}},OnCollectionPageProductsAdded:function(){discountNinja.Logging.LogVerbose("Received OnCollectionPageProductsAdded event"),discountNinja_Script_DynamicPricing.UpdatePrice(!0,!1,!0)},UpdatePrice:function(t,e,n){function i(t){let e=discountNinja.Settings.Settings.PriceUpdate.Mode,i=e.FeaturedProductPrice,o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_DynamicPricing.Classes.ProductPrice.Injected+"-featuredproduct";if(!i||"custom"===i||"none"===i)return;if(!n&&jQuery("."+r).length>0)return;let a=e.FeaturedProductCard,c=e.FeaturedProductHandle,s=null!==a&&""!==a&&null!==c&&""!==c?function(t,e,n){let i=t.replace(/\[\[.*\]\]/g,""),o=jQuery(i);return discountNinja.Utilities.GetHandleFromSelector(o,e,n)}(i,a,c):null,u="<div "+(s?'data-limoniapps-discountninja-product-handle="'+s+'" ':"")+'class="'+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+" "+discountNinja_Script_DynamicPricing.Classes.Collection.FeaturedProduct+" "+r+'"></div>';o.Inject(i,u,null,t)}function o(t){let e=discountNinja.Settings.Settings.PriceUpdate.Mode,i=t?e.ProductPrice:e.CollectionProductPrice,o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_DynamicPricing.Classes.ProductPrice.Injected+(t?"-product":"-collectionproduct");if(!i||"custom"===i||"none"===i)return;if(!n&&jQuery("."+r).length>0)return;let a='<div class="'+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+" "+r+'"></div>';o.Inject(i,a,null,t)}function r(n,s){try{if(isNaN(s)&&(s=1),s>10)return!0;let u=!1;if(discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(n,!1)){discountNinja.Logging.LogInformation("FLOW: Updating price"),jQuery(".rc_price__onetime").addClass(discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix),discountNinja.Environment.Shopify.IsProductPage()?(o(!0),o(!1)):discountNinja.Environment.Shopify.IsHomePage()?(i(),o(!1)):o(!1);let t=discountNinja_Script_DynamicPricing.ProductPriceSelector(),n=jQuery(t+":not(["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Ignore+"])");n.length>0&&(discountNinja.Logging.LogVerbose("Replacing product price"),u=!0,n.each(function(t,n){!function t(n,i){try{let o=0,r=0,s=discountNinja.Settings.Settings.PriceUpdate.Mode,u=jQuery(n).parents('.limoniapps-discountninja-cart-root,form[action^="/cart"]:not([action^="/cart/add"])');if(null!==u&&u.length>0)return;let d=discountNinja.Environment.Shopify.ProductHandle(),l=discountNinja.Environment.Shopify.IsHomePage()&&jQuery(n).hasClass(discountNinja_Script_DynamicPricing.Classes.Collection.FeaturedProduct),g=s.CollectionProductCard,f=g&&"custom"!==g&&"none"!==g?","+g:"",p="";if(l){let t=s.FeaturedProductCard;p=t&&"custom"!==t&&"none"!==t?","+t:""}let m=jQuery(n).closest("[data-limoniapps-discountninja-product-handle],[data-limoniapps-discounturl-product-handle]"+f+p),h=!1,j=null,N=null,y=null,C=!1,S=0,_=null,L=discountNinja.Environment.Shopify.IsProductPage();if(null===m||1!==m.length){if(!L)return discountNinja.Logging.LogVerbose("Product handle found on non-product page"),5!==i&&(setTimeout(function(){t(n,i+1)},500*i),!1);{y=discountNinja.LiquidData.ProductCollections(),h=!0,discountNinja.Logging.LogVerbose("No product handle found, assuming the product is the product on the current product page");let e="data-limoniapps-discountninja-product-variant",a=jQuery(n).closest("["+e+"]").attr(e);if(!(_=a||discountNinja.Environment.Shopify.VariantId()))return discountNinja.Logging.LogVerbose("No product variant found on product page"),5!==i&&(setTimeout(function(){t(n,i+1)},500*i),!1);if(null===(o=discountNinja.LiquidData.Price(_)))return void discountNinja.Logging.LogVerbose("No price available");r=discountNinja.LiquidData.CompareAtPrice(_),N=discountNinja.LiquidData.Inventory(_),discountNinja.Logging.LogVerbose("Loading pricing for variant "+_+": price "+o+", compare at:"+r)}}else{discountNinja.Logging.LogVerbose("Product handle found, assuming the product is not on the product page, reading price from data tags");let a=m[0];if(j=a,null===(d=discountNinja.ProductData.GetDataFromCollectionAttribute(a,"Handle",null,l)))return discountNinja.Logging.LogWarning("Could not find product handle of collection product",!0,!1),5!==i&&(setTimeout(function(){t(n,i+1)},500*i),!1);{discountNinja.ProductData.SaveProductDataUsingDataTags(a);let c=discountNinja.ProductData.GetByProductHandle(d,e);if(!c)return discountNinja.Logging.LogVerbose("No product data found for '"+d+"'. Are you missing Dynamic Pricing data tags? The price will not be updated for the product."),5!==i&&(setTimeout(function(){t(n,i+1)},500*i),!1);o=c.Price,r=c.CompareAtPrice,N=null,y=c.Collections,(void 0===N||isNaN(N))&&(N=null),(null==o||isNaN(o)||0===o)&&(o=0),(null==r||isNaN(r)||0===r)&&(r=o),r<o&&(r=o),o/=100,r/=100,discountNinja.Logging.LogVerbose("Derived price "+o+" and compare at price "+r+" and inventory level "+N+" from data tags")}let c=discountNinja.ProductData.GetDataFromCollectionAttribute(a,"Available",d);"false"!==c&&!1!==c||(N=0);let s=discountNinja.ProductData.GetDataFromCollectionAttribute(a,"PriceVaries",d);"true"!==s&&!0!==s||(S=discountNinja.ProductData.GetDataFromCollectionAttribute(a,"PriceMin",d),C=!0)}let P=L&&h||l,v=discountNinja.Offer.GetOfferDataForProduct(d,_,y,N,100*o,100*r,!0,L||!C),T=null===v||null===v.Applicable?null:discountNinja.Offer.GetOfferByToken(v.Applicable);if(!T){if(discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+_+" with handle '"+d+"' since the product is not a target of the offer(s)."),L&&function(t){let e=jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice);e.hide(),e.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"");let n=jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice);n.show(),n.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}(n),h&&P){let t=null===v||null===v.ApplicableNoTier?null:discountNinja.Offer.GetOfferByToken(v.ApplicableNoTier);if(t){let e=discountNinja.DiscountedProduct.Get(null,null,d,100*o,100*r,N,t);c(t,e,!1)}else{let t=discountNinja.Offer.GetOfferDataForPrerequisiteProduct(d,_,y,N,100*o,100*r,!0,L||!C);if(t&&t.Applicable){let e=discountNinja.Offer.GetOfferByToken(t.Applicable),n=discountNinja.DiscountedProduct.Get(null,null,d,100*o,100*r,N,e);c(e,n,!0)}}}return!1}if(!1===T.UpdatePriceProductPage){discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+_+" with handle '"+d+"' since Dynamic Pricing for non-cart pages is disabled for offer "+T.Token+".");let t=discountNinja.DiscountedProduct.Get(null,null,d,100*o,100*r,N,T);return c(T,t,!1),!1}!function(t){jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem),jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}(n),C&&(o=S/100);let D=discountNinja.DiscountedProduct.Get(null,null,d,100*o,100*r,N,T);D.PriceVaries=C;let b=!0===h?"current ":"";discountNinja.Logging.LogVerbose("Updating price for "+b+"product ("+d+"), price is "+o+" and compare at is "+r+", discounting to "+D.DiscountedPrice);let E=0===jQuery(n).find(".limoniapps-discountninja-shortcode").length;if(E){discountNinja.Logging.LogVerbose("Replacing prices first time");let t=jQuery(n).hasClass("limoniapps-discountninja-otherpage"),e=l||h&&!t?"product":discountNinja.Environment.Shopify.IsCartPage()?"cart":"other";!function(t,e,n,i,o){try{discountNinja.Logging.LogVerbose("Replacing prices for product first time");let r=jQuery(e).html(),a=jQuery(e).find(".limoniapps-discountninja-productprice-inner"),c=null===a||0===a.length,s=c?r:jQuery(a).prop("outerHTML"),u=discountNinja.Settings.Settings.Label,d=null!==i.InventoryLeft&&i.InventoryLeft<=0,l=n&&u.UseSoldOutLabelProductPage||!n&&u.UseSoldOutLabelCollectionPage,g=d&&u&&l,f=!n&&i.PriceVaries&&u.UseFromLabelCollectionPage,p=discountNinja.Settings.GetPriceFormat("standard",null,n&&"product"===o),m=discountNinja_Script_DynamicPricing.BuildFormattedPrice(s,p,t,i,f,g,c,o);jQuery(e).html(m)}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",t)}}(T,n,h,D,e),(h||l)&&P&&c(T,D,!1)}else discountNinja.Logging.LogVerbose("Replacing prices after first time"),discountNinja.ShortCode.RefreshResolvedPlaceholders(n,T,D),(h||l)&&P&&function(t,e){var n=a();n&&jQuery(n).each(function(){discountNinja.ShortCode.RefreshResolvedPlaceholders(this,t,e),jQuery(this).show()})}(T,D);!function(t,e){try{let n=jQuery(".afterpay-instalments,.afterpay_instalments,#afterpay-instalments,#afterpay_instalments");if(n&&n.length>0){discountNinja.Logging.LogVerbose("Replacing AfterPay instalments amount");let i=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}",e);jQuery(n).html(i)}}catch(t){return discountNinja.Logging.LogError("DynamicPricing.ReplaceAfterPayInstalments",t),!1}}(T,D);let k=null!==D.InventoryLeft&&D.InventoryLeft<=0;if(!k&&s.CollectionProductBadge&&"none"!==s.CollectionProductBadge){if("custom"!==s.CollectionProductBadge)j=jQuery(j).find(s.CollectionProductBadge);else{let t=jQuery(j).find(".limoniapps-discountninja-collectionbadge");t&&1===t.length&&(j=t)}discountNinja.Badge.Add(T,D,j)}return!0}catch(t){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",t),!1}}(n,1)}))}else discountNinja.Logging.LogInformation("FLOW: Not updating price",!0,!1);t||discountNinja_Script_DynamicPricing.ReplacePricesInCart(),discountNinja_Script_DynamicPricing.Show();let d=discountNinja.Settings.GetFlag("ProductsAreLoadedAsynchronously");return!(!u&&d)||(discountNinja.Logging.LogVerbose("Didn't find any prices to replace, assuming they are loaded asynchronously. Attempting again after delay."),s+=1,setTimeout(function(){r(n,s)},100))}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}}function a(){return function(t){let e=discountNinja.Settings.Settings.PriceUpdate.Mode,n=t?e.ProductBanner:e.FeaturedProductBanner,i=discountNinja_Script_DynamicPricing.InjectPlaceHolder,o=discountNinja_Script_DynamicPricing.Classes.ProductBanner.Injected;if(!n||"custom"===n||"none"===n)return;if(jQuery("."+o).length>0)return;let r='<div class="'+discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix+" "+o+'"></div>';i.Inject(n,r,null,!0)}(discountNinja.Environment.Shopify.IsProductPage()),jQuery("."+discountNinja_Script_DynamicPricing_Classes_ProductBanner_Prefix)}function c(t,e,n){if(t.PromotionCard){var i=a();i&&jQuery(i).each(function(){n&&jQuery(this).addClass(discountNinja_Script_DynamicPricing.Classes.ProductBanner.Prerequisite),jQuery(this).attr("data-token",t.Token);let i=n?t.PromotionCard.PrerequisiteProductPageTextColor:t.PromotionCard.ProductPageTextColor,o=n?t.PromotionCard.PrerequisiteProductPageText:t.PromotionCard.ProductPageText,r=discountNinja.TextSettings.GetText(o,t),a=discountNinja.TextSettings.WrapInColor(i,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,r,e));jQuery(this).html(a),jQuery(this).show()})}}try{let t=discountNinja.Settings.Settings;if(!t)return void discountNinja.Logging.LogVerbose("UpdatePrice - Cancel, no settings");if(discountNinja.DiscountedCart.SplitRowsInProcess||discountNinja.DiscountedCart.FreeGiftAdjustmentInProcess)return void discountNinja.Logging.LogVerbose("Split rows or free gift in process, canceling");discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){if(discountNinja.Environment.Shopify.IsCollectionPage()){let e=r.bind(this,t,!0,1);if(!(!0===discountNinja.Settings.GetFlag("WaitForProductCards")))return e.apply(this,arguments);!function t(e,n){try{let i=discountNinja_Script_DynamicPricing.ProductPriceSelector(),o=jQuery("[data-limoniapps-discountninja-product-handle]").last().find(i).first();if(o&&1===o.length&&jQuery(o).is(":visible")||100===e)return e<100?(discountNinja.Logging.LogVerbose("Collection product cards are assumed to be ready"),n.apply(this,arguments)):(discountNinja.Logging.LogVerbose("Collection product cards may not be ready, timed out"),n.apply(this,arguments));setTimeout(function(){t(e+1,n)},50)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForProductCards",t)}}(1,e)}else r(t,1)})})}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}},UnblockPricesAndButtons:function(){let t=discountNinja_Script_DynamicPricing.Classes.Blocking.Block,e=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockStop,n=discountNinja_Script_Checkout_Shopify.CheckoutButtonSelectors();jQuery("."+t+","+n).removeClass(t).addClass(e)},Show:function(t){function e(t){return function(e,n){try{t?jQuery(n).show():jQuery(n).hide()}catch(t){discountNinja.Logging.LogError("DynamicPricing.SetDynamicPricingVisibility",t)}}}var n="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice,i="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.Wrapper,o="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ShowAfterReplace,r="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.HideAfterReplace,a=":not(["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Ignore+"],["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem+"])",c="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;function s(t,c){let s=c?"[data-token='"+c+"']":"";priceMatches=jQuery(n+s+a),priceMatches.each(e(t)),discountNinja.Environment.Shopify.IsProductPage()?priceMatches=jQuery(o):priceMatches=jQuery(n+s).closest(i).find(o),priceMatches.each(e(t)),discountNinja.Environment.Shopify.IsProductPage()?priceMatches=jQuery(n+s).closest(i).find(r):priceMatches=jQuery(r),priceMatches.each(e(!t))}try{let n=void 0===t?discountNinja.Environment.Shopify.IsCartPage()?discountNinja.DiscountedCart.HasAppliedPromotions():discountNinja.DiscountedCart.HasActivePromotions():t;if(discountNinja.Logging.LogVerbose("Setting visibility of Dynamic Pricing to "+n),discountNinja.MultiCurrency.UpdateCurrency(),jQuery(c+a).each(e(!n)),n){if(discountNinja.Offer.Offers)for(var u=0;u<discountNinja.Offer.Offers.length;u++){s(n,discountNinja.Offer.Offers[u].Token)}s(n,"ALL-TOKENS")}else s(n,null)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.Show",t),!1}},FindElementInCart:function(t,e,n){try{if(!t)return null;let i=jQuery(t).find(e);return i&&0!==i.length||(i=jQuery(t).parent().find(e)),i&&0!==i.length?i:(n&&discountNinja.Logging.LogVerbose("Could not find "+e+" in cart element"),null)}catch(t){discountNinja.Logging.LogError("DynamicPricing.FindElementInCart",t)}},DrawerCartIsDirty:!0,ReplacePricesInDrawerCart:function(t){try{if(!discountNinja_Script_DynamicPricing.DrawerCartIsDirty)return;if(discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!0)&&(discountNinja.Logging.LogVerbose("Replace prices in drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!0))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInDrawerCart",t)}},ClassicCartIsDirty:!0,ReplacePricesInClassicCart:function(t){try{if(!discountNinja_Script_DynamicPricing.ClassicCartIsDirty)return;if(discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;(discountNinja.Environment.Shopify.IsCartPage()||jQuery(".limoniapps-discountninja-cart-root").length>0)&&discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!1)&&(discountNinja.Logging.LogVerbose("Replace prices in classic cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!1))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInClassicCart",t)}},ReplacePricesInCartInner:function(t){function e(t,e,n){return discountNinja.ShortCode.ReplaceAllPlaceHolders(e,discountNinja.TextSettings.GetText(t,e),n)}function n(t,n,i){let o=discountNinja.Settings.Settings.PromotionSummary;if(!o||o.HideInCart&&!n||o.HideInDrawerCart&&n)return;!function(t,e){let n=discountNinja.Settings.Settings.PriceUpdate.Mode,i=e?n.DrawerCartPromotionSummary:n.CartPromotionSummary,o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_DynamicPricing.Classes.PromotionSummary.Injected;if(!i||"custom"===i||"none"===i)return;if(jQuery(t).find("."+r).length>0)return;let a='<div class="'+discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix+" "+r+'"></div>';o.Inject(i,a,t,!0)}(t,n);let r=jQuery("."+discountNinja_Script_DynamicPricing_Classes_PromotionSummary_Prefix);if(0===r.length&&(placeholder=jQuery(".limoniapps-discountninja-cart-subtotalcomment")),r.length>0&&(r.html(""),i.length>0)){if(0===i.length)return;let t=jQuery("#limoniapps-promotionsummary-template").html(),n=jQuery("#limoniapps-promotionsummary-row-template").html();t=(t=(t=t.replace("limoniapps-discountninja-productprice-replaced","")).replace('limoniapps-discountninja-whenpromotionsincart-show" style="display:none;"','"')).replace('class="limoniapps-discountninja-subtotalcomment-summary-table" style="display:none;"','class="limoniapps-discountninja-subtotalcomment-summary-table"');let a=discountNinja.TextSettings.WrapInColor(o.HeaderTextColor,e(o.Header,null,null)),c=discountNinja.TextSettings.WrapInColor(o.FooterTextColor,e(o.Footer,null,null)),s="";for(let t=0;t<i.length;t++)s+=discountNinja.TemplateParameter.Replace(n,"ROW",i[t].Label);t=discountNinja.TemplateParameter.Replace(t,"HEADER",a),t=discountNinja.TemplateParameter.Replace(t,"SHOWHEADER",o.Header&&discountNinja.DiscountedCart.HasAppliedPromotions()?"":"display:none"),t=discountNinja.TemplateParameter.Replace(t,"FOOTER",c),t=discountNinja.TemplateParameter.Replace(t,"SHOWFOOTER",o.Footer&&discountNinja.DiscountedCart.DiscountedCart.total_discount>0?"":"display:none"),t=discountNinja.TemplateParameter.Replace(t,"BODY",s),r.html(t)}}function i(t,n,i){let o=!1;for(let e=0;e<i.length;e++)if(i[e].Offer===t){o=!0;break}if(o)return;let r=discountNinja.Offer.GetOfferByToken(t);if(r&&r.Cart){let t=n?r.DrawerCart.SubtotalSavingsLabel:r.Cart.SubtotalSavingsLabel,o=n?r.DrawerCart.SubtotalSavingsTextColor:r.Cart.SubtotalSavingsTextColor,a=discountNinja.TextSettings.WrapInColor(o,e(t,r));i.push({Offer:r.Token,Label:a,ProductInfo:null})}}function o(t,e){try{if(null===discountNinja.DiscountedCart.DiscountedCart)return;let o=discountNinja.DiscountedCart.GetCartItemKeys();discountNinja.Logging.LogVerbose("Replacing prices in cart for root - Discounted: "+o);let a=100*discountNinja.DiscountedCart.DiscountedCart.total_discount,c=[],s=discountNinja.Settings.Settings.PriceUpdate.Mode,u=e?s.DrawerCartItemSelector:s.CartItemSelector;u&&(u=","+u);let d=discountNinja.Settings.Settings.PriceUpdate.Mode.CartItemKeyAttribute;jQuery(t).find(".limoniapps-discountninja-cart-item-product-price, .limoniapps-discountninja-cart-item-line-price"+u).each(function(t,e){let n=jQuery(e).attr("data-limoniapps-discountninja-cart-key");if(!n&&d&&(n=jQuery(e).attr(d)),n){let t=!0;for(let e=0;e<c.length;e++)if(c[e]===n){t=!1;break}t&&(discountNinja.Logging.LogVerbose("Adding key to cart item keys to process: "+n),c.push(n))}});for(let n=0;n<c.length;n++){let i=r(t,c[n],e);discountNinja.Logging.LogVerbose("Calculated savings for item in cart: "+i+" cents")}discountNinja.Logging.LogVerbose("Replacing subtotal");let l=function(t,e){try{let n=e/100,i=t/100,o=Math.round(100*(i-n))/100;return o<0&&(o=0),{OriginalPrice:i,Amount:n,Percentage:n/i*100,DiscountedPrice:o}}catch(t){discountNinja.Logging.LogError("DynamicPricing.BuildProductInfoFromAmount",t)}}(100*discountNinja.DiscountedCart.DiscountedCart.total_original_price,a),g=discountNinja.Settings.Settings.PriceUpdate,f=e?g.Enable.DrawerCart:g.Enable.Cart,p=function(t){let e=[],n=[];for(let o=0;o<discountNinja.DiscountedCart.DiscountedCart.items.length;o++){let r=discountNinja.DiscountedCart.DiscountedCart.items[o];r.OfferToken&&(i(r.OfferToken,t,e),n.push(r.OfferToken))}for(let o=0;o<discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts.length;o++){let r=discountNinja.DiscountedCart.DiscountedCart.CartLevelDiscounts[o];r.OfferToken&&(i(r.OfferToken,t,e),n.push(r.OfferToken))}if(discountNinja.DiscountedCart.DiscountedCart.Shipping&&(i(discountNinja.DiscountedCart.DiscountedCart.Shipping.OfferToken,t,e),n.push(discountNinja.DiscountedCart.DiscountedCart.Shipping.OfferToken)),discountNinja.Offer.Offers)for(let o=0;o<discountNinja.Offer.Offers.length;o++){let r=discountNinja.Offer.Offers[o];if(r.Cart.TextAfterGoal||r.Cart.TextDuringGoal){let o=!1,a=r.Token;for(let t=0;t<n.length;t++)if(n[t]===a){o=!0;break}o||(i(a,t,e),n.push(a))}}return e}(e),m=p,j=discountNinja.Settings.Settings.PromotionSummary;j&&!1===j.ShowComments&&(m=[]),function(t,e){let n=discountNinja.Settings.Settings.PriceUpdate.Mode,i=e?n.DrawerCartSubtotalPrice:n.CartSubtotalPrice,o=(discountNinja_Script_DynamicPricing.InjectPlaceHolder,discountNinja_Script_DynamicPricing.Classes.Cart.SubtotalPriceInjected);if(!i||"custom"===i||"none"===i)return;if(jQuery(t).find("."+o).length>0)return;let r=discountNinja.Settings.Settings.PromotionSummary&&discountNinja.Settings.Settings.PromotionSummary.HideSubtotal?" limoniapps-discountninja-whencartdiscounted-hide":"",a='<div class="'+discountNinja_Script_DynamicPricing.Classes.Cart.SubtotalPrice+r+" "+o+'"></div>',c=i,s=jQuery(t).find(c);s&&1===s.length&&s.wrap(a)}(t,e),h(null,null,t,!0,f&&a>0,"subtotal",m,l,e,!1),n(t,e,p),_(),discountNinja_Script_PromotionFlow.ShowHideElementsWhenPromotionsInCart()}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRoot",t)}}function r(t,e,n){try{let i="Replacing prices in cart - Key "+e;discountNinja.Logging.LogVerbose(i);let o=e.split(":")[0],r=discountNinja.LiquidData.QuantityFromCartByKey(e);if(0===r)return 0;let a=100*discountNinja.LiquidData.PriceFromCartByKey(e);discountNinja.Logging.LogVerbose(i+" - Price "+a+" and quantity "+r);discountNinja.LiquidData.CompareAtPrice(o);if(discountNinja.ProductData.GetByVariant(o,!0)){let o=discountNinja.DiscountedCart.Get(e),c=o?discountNinja.Offer.GetOfferByToken(o.OfferToken):null,s=c&&!1!==c.UpdatePriceCartPage;if(c&&s&&"line_item"===c.Entitlement.TargetType&&"each"===c.Entitlement.AllocationMethod){let i=o.Product,s=o.Line,u=discountNinja.Settings.Settings.PriceUpdate.Enable,d=n?u.DrawerCart:u.Cart,l=c.Cart?n?c.DrawerCart.ProductSavingsLabel:c.Cart.ProductSavingsLabel:null,g=c.Cart?n?c.DrawerCart.ProductSavingsTextColor:c.Cart.ProductSavingsTextColor:null,f=[];if(l){let t=discountNinja.TextSettings.WrapInColor(g,discountNinja.TextSettings.GetText(l,null));f.push({Offer:c.Token,Label:t,ProductInfo:s})}let p=function(t){try{let e=discountNinja.LiquidData.CartItemByKey(t).properties;if(e)for(let t in e)if(t.indexOf("DiscountNinja.FreeGift")>-1)return!0;return!1}catch(t){return discountNinja.Logging.LogError("DynamicPricing.IsFreeGift",t),!1}}(e);return h(e,c,t,!0,d,"item-product",f,i,s,n,p),h(e,c,t,!0,d,"item-line",null,s,s,n,p),(a-100*i.DiscountedPrice)*r}return c&&!s?discountNinja.Logging.LogVerbose(i+" - Cart line item price is not replaced, the offer "+c.Token+" has disabled Dynamic Pricing at cart level. The price will be reset instead."):discountNinja.Logging.LogVerbose(i+" - Cart line item price is not replaced. The price will be reset instead."),f(e,t,"item-product",n),f(e,t,"item-line",n),0}return discountNinja.Logging.LogVerbose(i+" - No match found in discounted cart"),0}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItem",t)}}function a(t){return discountNinja_Script_DynamicPricing.Classes.Cart.PriceForLevel.replace("[LEVEL]",t)}function c(t){return discountNinja_Script_DynamicPricing.Classes.Cart.CommentForLevel.replace("[LEVEL]",t)}function s(t,e){let n=discountNinja.Settings.Settings.PriceUpdate.Mode;return"subtotal"===t?"custom":"item-product"===t?e?n.DrawerCartProductPrice:n.CartProductPrice:"item-line"===t?e?n.DrawerCartLinePrice:n.CartLinePrice:void 0}function u(t,e){let n=s(t,e);return"custom"===n?"."+a(t):n}function d(t,e,n){let i=s(t,n);return"custom"===i?function(t,e){let n="["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey+'="'+e+'"]';return"."+a(t)+n}(t,e):i?i.replace(/\[\[CARTITEMKEY\]\]/g,e):""}function l(t,e){return"."+c(t)}function g(t,e,n){return function(t,e){let n="["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey+'="'+e+'"]';return"."+c(t)+n}(t,e)}function f(t,e,n,i){try{let o=u(n,i),r=d(n,t,i),a=m(),c=p(),s=null===t?jQuery(e).find(o):jQuery(e).find(r);if(null!==s&&0!==s.length){if(0===jQuery(s).find(".limoniapps-discountninja-shortcode").length)return;if(null===t||jQuery(s).attr(c)===t||jQuery(s).attr(a)===t||jQuery(s).parents("["+a+"]").attr(a)===t){let e=discountNinja.LiquidData.CartItemByKey(t),i=null;if("item-product"===n&&e?i={OriginalPrice:e.original_price/100}:"item-line"===n&&e&&(i={OriginalPrice:e.original_line_price/100}),null===i&&"subtotal"!==n)discountNinja.Logging.LogVerbose("ResetCartItemLevel - No match found for level "+n+" for key "+t);else{let t="{{ORIGINAL_PRICE}}";"subtotal"===n&&(t="{{TOTAL_PRICE}}"),price=discountNinja.ShortCode.ReplaceAllPlaceHolders(null,t,i,n),jQuery(s).html(price)}}}let f=l(n),h=g(n,t),j=null===t?jQuery(e).find(f):jQuery(e).find(h);if(null===j||0===j.length)return;if(null!==t&&jQuery(j).attr(c)!==t&&jQuery(s).attr(a)!==t&&jQuery(s).parents("["+a+"]").attr(a)!==t||jQuery(j).html(""),"subtotal"!==n){let n="["+c+'="'+t+'"]',i="."+discountNinja_Script_DynamicPricing.Classes.Cart.Quantity,o=jQuery(e).find(i+n);null!==o&&0!==o.length||(o=e),jQuery(o).attr(c)!==t&&jQuery(s).attr(a)!==t&&jQuery(s).parents("["+a+"]").attr(a)!==t||jQuery(o).removeClass("limoniapps-discountninja-cart-item-quantity-hide")}}catch(t){discountNinja.Logging.LogError("DynamicPricing.ResetCartItemLevel",t)}}function p(){return discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey}function m(){return discountNinja.Settings.Settings.PriceUpdate.Mode.CartItemKeyAttribute}function h(t,e,n,i,o,r,a,c,s,h,N){try{f(t,n,r,h);let s="Replacing prices in cart - Level "+r+" - ";if(i){let i=discountNinja.Settings.GetPriceFormat(r,h);discountNinja.Logging.LogVerbose(s+"Discounted");let f=m(),y=p(),C="["+y+'="'+t+'"]';if(o){let o=discountNinja_Script_DynamicPricing.BuildFormattedDiscountedPrice(i,e,c,!1),a=u(r,h),l=d(r,t,h),g=null===t?jQuery(n).find(a):jQuery(n).find(l);if(null===g||0===g.length)discountNinja.Logging.LogVerbose(s+"Cart price field not found for level "+r);else if(null===t||jQuery(g).attr(y)===t||jQuery(g).attr(f)===t||jQuery(g).parents("["+f+"]").attr(f)===t){!function(t,e,n,i,o){try{let r=t;if(r){let t='<span class="limoniapps-discountninja-cart-'+e+'-price"><span class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+'" '+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token+'="'+o+'" style="display:none;">'+i+"</span></span>";jQuery(r).html(t+n)}}catch(t){return discountNinja.Logging.LogError("ReplacePriceInCart",t),null}}(g,r,function(t,e,n){try{let o="GetOriginalPriceHtmlFromCartItem - Level "+e+" - ",r=discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;var i=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token;let a=t;if(a){let t=discountNinja_Script_DynamicPricing.FindElementInCart(a,"."+r,!1),e='<span class="'+r+'" '+i+'="'+n+'" style="display:none;">'+a.html()+"</span>";if(null===t)return e;{let e=t[0],n=e?jQuery(e).prop("outerHTML"):"";return n||""}}return discountNinja.Logging.LogVerbose(o+"No match found for price element"),""}catch(t){return discountNinja.Logging.LogError("DynamicPricing.GetOriginalPriceHtmlFromCartItem",t),null}}(g,r,e?e.Token:"ALL-TOKENS"),o,e?e.Token:"ALL-TOKENS")}}else discountNinja.Logging.LogVerbose(s+"Dynamic Pricing on cart not enabled for level "+r);if(a){"subtotal"!==r&&function(t,e){let n=discountNinja.Settings.Settings.PriceUpdate.Mode,i=t?n.DrawerCartProductComment:n.CartProductComment;i&&(i=i.replace(/\[\[CARTITEMKEY\]\]/g,e));let o=discountNinja_Script_DynamicPricing.InjectPlaceHolder,r=discountNinja_Script_DynamicPricing_Classes_Prefix+"cart-product-comment-injected-"+e.replace(/:/g,"-");if(!i||"custom"===i||"none"===i)return;if(jQuery("."+r).length>0)return;let a='<div class="limoniapps-discountninja-cart-item-product-comment '+r+'" data-limoniapps-discountninja-cart-key="'+e+'"></div>';o.Inject(i,a,null,!0)}(h,t);let e=l(r),i=g(r,t),o=null===t?jQuery(n).find(e):jQuery(n).find(i);null===o||0===o.length?discountNinja.Logging.LogVerbose(s+"Cart comment field not found for level "+r):null===t||jQuery(o).attr(y)===t?j(o,a,r,!1):jQuery(o).attr(f)!==t&&jQuery(o).parents("["+f+"]").attr(f)!==t||j(o,a,r,!0)}if(N&&"subtotal"!==r){let e="."+discountNinja_Script_DynamicPricing.Classes.Cart.Quantity,i=jQuery(n).find(e+C);null===i||0===i.length?discountNinja.Logging.LogVerbose(s+"Cart quantity field not found for level "+r):jQuery(i).attr(y)===t&&jQuery(i).addClass("limoniapps-discountninja-cart-item-quantity-hide")}}else discountNinja.Logging.LogVerbose(s+"Not discounted")}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItemLevel",t)}}function j(t,e,n,i){try{let r=t;if(e&&e.length>0&&r){discountNinja.Logging.LogVerbose("Adding comment for level: "+n);let t="";for(let i=0;i<e.length;i++){let r=e[i].Label,a=e[i].ProductInfo,c=e[i].Offer,s=discountNinja.Offer.GetOfferByToken(c),u=discountNinja.ShortCode.ReplaceAllPlaceHolders(s,r,a);var o=discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice;let d=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token,l="";if("subtotal"===n)l='<div class="'+o+'" '+d+'="'+c+'" style="display:none;">'+u+"</div>",t=""===t?l:t+l;else{if(l='<span class="'+o+'" '+d+'="'+c+'" style="display:none;">'+u+"</span>",discountNinja.ShortCode.ContainsPlaceHolder(l,"DISCOUNT_LINE")){let t=discountNinja.Currency.GetCurrencyFormat(),n=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(t),o=discountNinja.Utilities.GetCurrencyFormatAmountComponent(t),r=discountNinja.Utilities.GetCurrencyFormatAmountComponent(n),a=2;l=discountNinja.ShortCode.BuildResolvedPlaceHolderAmount(s,null,l,!0,"{{DISCOUNT_LINE}}","offer","discount_line",100*e[i].ProductInfo.Amount,t,n,o,r,a,!1,null,null,!0)}t=""===t?l:t+"&nbsp;"+l}}let a="limoniapps-discountninja-cart-"+n+"-comment";""!==t&&(t='<div class="'+a+'">'+t+"</div>"),i?jQuery(r).next().hasClass(a)?jQuery(r).next().html(t):jQuery(r).after(t):jQuery(r).html(t);try{r.show()}catch(t){}}else e&&0!==e.length||discountNinja.Logging.LogVerbose("No comment for level: "+n)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.AddCartComment",t),null}}function N(){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}function y(){jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-comment").hide(),jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-discounted_price").text("0"),jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-original_price").hide()}function C(t,e,n,i){try{var o=null;if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart)for(let t=0;t<discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.length;t++)if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[t].Item===i&&discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[t].Ready)return;let r=discountNinjaContext.Settings.PriceUpdate.Mode.DrawerCartSubtotalPrice;if(r&&(r=r.replace(/\[\[HIDE\]\]/g,"")),(e.find(".limoniapps-discountninja-cart-subtotal-price").length>0||e.find(r).length>0)&&function(t){let e=!1;return jQuery(t).each(function(){jQuery(this).is(":visible")&&(e=!0)}),e}(e)&&function(t){let e=!1;return jQuery(t).each(function(){discountNinja.Utilities.IsInViewport(this)&&(e=!0)}),e}(e)||200===t)return t<200?(discountNinja.Logging.LogVerbose("Drawer cart is ready"),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:i,Ready:!0}),null!==o&&clearTimeout(o),n.call(this,e)):(discountNinja.Logging.LogVerbose("Drawer cart not ready, timed out"),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:i,Ready:!1,Expired:!0}),N());t+=1,o=setTimeout(function(){C(t,e,n,i)},100)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForDrawerCart",t)}}function S(t){try{discountNinja.Logging.LogVerbose("Replace prices in drawer cart - starting"),o(t,!0),setTimeout(function(){o(t,!0)},100),setTimeout(function(){o(t,!0)},500),discountNinja.Logging.LogVerbose("Replace prices in drawer cart - done")}catch(t){_(),discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRootAfterWait",t)}}function _(){discountNinja_Script_DynamicPricing.Show(!0),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}try{if(null===discountNinja.Settings.Settings)return;if(null===discountNinja.DiscountedCart.DiscountedCart)return;if(!discountNinja.DiscountedCart.HasActivePromotions())return N(),void y();let e=t?"drawer cart":"classic cart";if(discountNinja.Logging.LogVerbose("Replace prices in "+e+" (inner)"),0===window.discountNinjaContext.Cart.items.length)return discountNinja.Logging.LogVerbose("Replace prices in "+e+" stopped: no items in cart"),N(),void y();let n=t?jQuery(".limoniapps-discountninja-drawercart-root"):jQuery(".limoniapps-discountninja-cart-root");if(void 0===n||0===n.length){if(discountNinja.Environment.Shopify.IsCartPage()&&!t)(n=jQuery('form[action^="/cart"]:not([action^="/cart/add"]').not(".limoniapps-discountninja-ignore")).addClass("limoniapps-discountninja-cart-root");else if(t){let t=discountNinja.Settings.Settings.PriceUpdate.Mode.DrawerCartRoot;t&&(n=jQuery(t)).addClass("limoniapps-discountninja-drawercart-root")}if(void 0===n||0===n.length)return discountNinja.Logging.LogVerbose(t?"Could not find limoniapps-discountninja-drawercart-root":"Could not find limoniapps-discountninja-cart-root"),void N()}if(jQuery(".limoniapps-discountninja-drawercart-root").parents("div").last().addClass("limoniapps-discountninja-drawercart-wrapper"),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!0,t){discountNinja.Logging.LogVerbose("Found "+n.length+" drawer cart roots, waiting until they are rendered");discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart=[];let t=1;jQuery(n).each(function(){C(1,jQuery(this),S,t),t++})}else jQuery(n).each(function(){o(this,!1)})}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartInner",t)}},ReplacePricesInCart:function(){discountNinja.Logging.LogVerbose("Requested ReplacePricesInCart"),discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){!function(){try{let t=discountNinja.Settings.Settings;discountNinja.Logging.LogVerbose("Hiding checkout buttons"),discountNinja.DiscountedCart.HasActivePromotions()?discountNinja.PromotionFlow.HideAcceleratedCheckoutButtons():discountNinja.PromotionFlow.ShowAcceleratedCheckoutButtons(),discountNinja.Logging.LogVerbose("Inject in Html"),discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t),discountNinja_Script_DynamicPricing.ReplacePricesInClassicCart(t)}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCart.Inner",t)}}()})})},IsDynamicPricingRequired:function(t,e){let n="",i=t.PriceUpdate.Enable,o=discountNinja.Environment.Shopify;if(e){if(!1!==t.PriceUpdate.Enable.DrawerCart)return!0;n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on the drawer cart."}let r="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on ";return""===n&&o.IsHomePage()&&!1===i.Home&&(n=r+"the home page."),""===n&&o.IsCollectionPage()&&!1===i.Collection&&(n=r+"collection pages."),""===n&&o.IsProductPage()&&!1===i.Product&&(n=r+"product pages."),""===n&&o.IsBlogPost()&&!1===i.Blog&&(n=r+"blog pages."),""===n&&o.IsCustomPage()&&!1===i.Custom&&(n=r+"custom pages."),""===n&&o.IsCartPage()&&!1===i.Cart&&(n=r+"the cart page."),discountNinja.PromotionFlow.HandleFlowErrorMessage(n)}},discountNinja_Script_LiquidData={WaitForLiquidAsset:function(t){try{let e=void 0!==window.discountNinjaContext;if(e)t&&t();else{discountNinja.Logging.LogVerbose("Waiting for liquid asset to be returned");let n=0,i=function(){if(n++,!(e=void 0!==window.discountNinjaContext))return 150===n?(discountNinja.Logging.LogTestMode("A Discount Ninja liquid asset (limoniapps-discountninja-body/limoniapps-discountninja-context) is missing in your theme. Contact support@discountninja.io to have the issue resolved.",!0,!0,!0,!0),discountNinja.Logging.LogErrorMessage("LiquidData.WaitForLiquidAsset","Waiting for liquid asset (limoniapps-discountninja-body/limoniapps-discountninja-context) to be returned timed out. Either the asset does not exist or it is not included in the theme.liquid file. Exiting.")):setTimeout(i,100);discountNinja.Logging.LogVerbose("LiquidData.WaitForLiquidAsset","Waiting for liquid asset to be available - DONE"),t&&t()};i()}}catch(t){return discountNinja.Logging.LogError("LiquidData.WaitForLiquidAsset",t),""}},Cart:function(){try{return void 0!==window.discountNinjaContext&&void 0!==window.discountNinjaContext.Cart&&void 0!==window.discountNinjaContext.Cart.total_price?window.discountNinjaContext.Cart:null}catch(t){discountNinja.Logging.LogError("LiquidData.Cart",t)}},CartValue:function(){try{let t=discountNinja_Script_LiquidData.Cart();return null===t?null:t.total_price}catch(t){discountNinja.Logging.LogError("LiquidData.CartValue",t)}},VariantIdsFromCart:function(){try{let t="",e=discountNinja_Script_LiquidData.Cart();if(e&&"object"==typeof e.items)for(let n=0;n<e.items.length;n++)""!==t&&(t+=","),t+=e.items[n].variant_id;return t.split(",")}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantIdsFromCart",t),null}},ProductCollections:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.Collections:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductCollections",t),null}},ProductDefaultVariantId:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.VariantId:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductDefaultVariantId",t),null}},VariantInfoFromLiquid:function(t){try{if(window.discountNinjaContext.ProductVariants)for(let e=0;e<window.discountNinjaContext.ProductVariants.length;e++)if(window.discountNinjaContext.ProductVariants[e].VariantId===parseInt(t))return window.discountNinjaContext.ProductVariants[e];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantInfoFromLiquid",t),null}},CompareAtPrice:function(t){try{let e=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===e?null:e.CompareAtPrice/100}catch(t){return discountNinja.Logging.LogError("LiquidData.CompareAtPrice",t),null}},Price:function(t){try{let e=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===e?null:e.Price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.Price",t),null}},Inventory:function(t){try{let e=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===e?null:"null"===e.Inventory?null:e.Inventory}catch(t){return discountNinja.Logging.LogError("LiquidData.Inventory",t),null}},CollectionProductByHandle:function(t){try{let e=window.discountNinjaContext.CollectionProducts;for(let n=0;n<e.length;n++)if(e[n].Handle===t)return e[n];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByProductHandle",t),null}},CartItemByVariantAndProperty:function(t,e,n){function i(t,e,n){return t.properties&&t.properties[e]===n}try{let o=window.discountNinjaContext.Cart.items;for(let r=0;r<o.length;r++){let a=o[r];if(a.variant_id.toString()===t.toString()&&i(a,e,n))return a}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByVariant",t),null}},AddPropertyToCartItem:function(t,e,n){try{let i=discountNinja_Script_LiquidData.CartItemPropertiesAsObject(t);return e&&(i[e]=n),i}catch(t){discountNinja.Logging.LogError("LiquidData.AddPropertyToCartItem",t)}},RemovePropertiesByPrefix:function(t,e){try{for(let n in t)n.indexOf(e)>-1&&delete t[n];return t}catch(e){return discountNinja.Logging.LogError("LiquidData.RemovePropertiesByPrefix",e),t}},CartItemPropertiesAsObject:function(t){try{let e=discountNinja.LiquidData.CartItemByKey(t).properties;if(null==e)return{};if(Array.isArray(e)){let t={};for(let e=0;e<propertiesArray.length;e++)t[propertiesArray[e].Name]=propertiesArray[e].Value;return t}return e}catch(t){discountNinja.Logging.LogError("LiquidData.CartItemPropertiesAsObject",t)}},CartItemByDelegate:function(t){try{if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return null;let e=window.discountNinjaContext.Cart.items;for(let n=0;n<e.length;n++){let i=e[n];if(t(i))return i}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByDelegate",t),0}},LineNumberByKey:function(t){try{if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return null;let e=window.discountNinjaContext.Cart.items;for(let n=0;n<e.length;n++){if(e[n].key===t)return n+1}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.LineNumberByKey",t),null}},CartItemsByDelegate:function(t){try{let e=[];if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return e;let n=window.discountNinjaContext.Cart.items;for(let i=0;i<n.length;i++){let o=n[i];t(o)&&e.push(o)}return e}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemsByDelegate",t),0}},CartItemByKey:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(e){return e.key===t})},CartItemByVariant:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(e){return e.variant_id&&t&&e.variant_id.toString()===t.toString()})},CartItemByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(e){return e.handle===t})},CartItemsByVariant:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate(function(e){return e.variant_id&&t&&e.variant_id.toString()===t.toString()})},CartItemsByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate(function(e){return e.handle===t})},CartItemsByProperty:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate(function(e){return void 0!==e.properties&&null!=e.properties&&null!=e.properties[t]})},PriceFromCartByProductHandle:function(t){try{let e=discountNinja_Script_LiquidData.CartItemByProductHandle(t);return null===e?null:e.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCartByKey:function(t){try{let e=discountNinja_Script_LiquidData.CartItemByKey(t);return null===e?null:e.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},QuantityFromCartByKey:function(t){try{let e=discountNinja_Script_LiquidData.CartItemByKey(t);return null===e?null:e.quantity}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCart:function(t){try{let e=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===e?null:e.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCart",t),null}},ProductHandleFromCart:function(t){try{let e=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===e?null:e.handle}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductHandleFromCart",t),null}},SubTotalPriceFromCart:function(t){try{return void 0!==window.discountNinjaContext&&"object"==typeof window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.total_price/100:null}catch(t){return discountNinja.Logging.LogError("LiquidData.SubTotalPriceFromCart",t),null}},ItemIsInCollection:function(t,e){let n=discountNinja.ProductData.GetByProductHandle(t.handle);if(n){if(e.indexOf("%")>-1){var i=discountNinja.ProductData.GetByVariant(29141038104669,!1);if(i&&i.CompareAtPrice>t.original_price)return!1}let o=n.Collections;return discountNinja.Utilities.StringIsIn(e,o)}return!1},GetQuantityFromItems:function(t){try{let e=0;if(t)for(let n=0;n<t.length;n++)e+=t[n].quantity;return e}catch(t){return discountNinja.Logging.LogError("LiquidData.GetQuantityFromItems",t),0}},GetOriginalLinePriceFromItems:function(t){try{let e=0;if(t)for(let n=0;n<t.length;n++)e+=t[n].original_price*t[n].quantity;return e}catch(t){return discountNinja.Logging.LogError("LiquidData.GetOriginalLinePriceFromItems",t),0}},ItemsInCartFromCollections:function(t,e,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return discountNinja_Script_LiquidData.ItemIsInCollection(i,t)&&(!n||!discountNinja_Script_LiquidData.ItemHasProperty(i,discountNinja.DiscountedCart.FreeGiftPrefix))&&(!e||!discountNinja_Script_LiquidData.ItemIsInCollection(i,e))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromCollections",t),0}},ItemsInCartFromProducts:function(t,e,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return discountNinja.Utilities.StringIsIn(t,i.handle)&&(!n||!discountNinja_Script_LiquidData.ItemHasProperty(i,discountNinja.DiscountedCart.FreeGiftPrefix))&&(!e||!discountNinja_Script_LiquidData.ItemIsInCollection(i,e))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromProducts",t),0}},ItemsInCart:function(t){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(e){return!t||!discountNinja_Script_LiquidData.ItemIsInCollection(e,t)})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCart",t),0}},ItemsInCartOfVariant:function(t,e,n){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return i.variant_id&&t&&i.variant_id.toString()===t.toString()&&(!e||!discountNinja_Script_LiquidData.ItemIsInCollection(i,e))&&(!n||discountNinja_Script_LiquidData.ItemHasProperty(i,n))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCart",t),0}},ItemHasProperty:function(t,e){if(t.properties)for(let n in t.properties)if(n.indexOf(e)>-1)return!0;return!1},ItemsInCartWithoutProperty:function(t,e){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(n){return!(discountNinja_Script_LiquidData.ItemHasProperty(n,t)||e&&discountNinja_Script_LiquidData.ItemIsInCollection(n,e))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartWithoutProperty",t),0}},ItemsInCartAddedByOffer:function(t){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(e){return void 0!==e.properties[discountNinja.DiscountedCart.FreeGiftPrefix+t.Token]})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartAddedByOffer",t),0}},QuantityInCartFromCollections:function(t,e,n){let i=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,e,n);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},QuantityInCartFromProducts:function(t,e,n){let i=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,e,n);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},QuantityInCart:function(t){let e=discountNinja_Script_LiquidData.ItemsInCart(t);return discountNinja_Script_LiquidData.GetQuantityFromItems(e)},QuantityInCartOfVariant:function(t,e,n){let i=discountNinja_Script_LiquidData.ItemsInCartOfVariant(t,e,n);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},QuantityInCartExcludingGifts:function(t){let e=discountNinja_Script_LiquidData.ItemsInCartWithoutProperty(discountNinja.DiscountedCart.FreeGiftPrefix,t);return discountNinja_Script_LiquidData.GetQuantityFromItems(e)},ValueInCartFromCollections:function(t,e,n){let i=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,e,n);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(i)},ValueInCartFromProducts:function(t,e,n){let i=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,e,n);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(i)},ValueInCart:function(t){let e=discountNinja_Script_LiquidData.ItemsInCart(t);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(e)},ValueInCartExcludingGifts:function(t){let e=discountNinja_Script_LiquidData.ItemsInCartWithoutProperty(discountNinja.DiscountedCart.FreeGiftPrefix,t);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(e)},ValueInCartOfVariant:function(t,e){let n=discountNinja_Script_LiquidData.ItemsInCartOfVariant(t,e);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(n)}},discountNinja_Script_Offer={Offers:null,AllOffers:null,Triggers:null,PrimaryOffer:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotionapi-v4.discountninja.io":"https://promotionapi-v4-dev.discountninja.io"},GetOfferByToken:function(t){let e=discountNinja_Script_Offer.AllOffers;if(e)for(let n=0;n<e.length;n++){let i=e[n];if(i.Token===t)return i}return null},SetPrimaryOffer:function(){try{if(discountNinja_Script_Offer.PrimaryOffer=null,discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.ProductHandle(),e=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Inventory(e);discountNinja.Logging.LogVerbose("Selecting primary offer based on product handle: "+t+" (inventory: "+n+")");let i=discountNinja.LiquidData.Price(e),o=discountNinja.LiquidData.CompareAtPrice(e),r=discountNinja.LiquidData.ProductCollections();discountNinja_Script_Offer.PrimaryOffer=discountNinja_Script_Offer.GetOfferForProduct(t,e,r,n,i,o,!1,!0)}if(null===discountNinja_Script_Offer.PrimaryOffer){discountNinja.Logging.LogVerbose("Selecting primary offer based on first applicable");let t=discountNinja_Script_Offer.Offers;if(null===t)return;let e=[];for(let n=0;n<t.length;n++){let i=t[n];discountNinja_Script_Offer.IsOfferAccepted(i.Token,i.Frequency)&&e.push(i)}if(0===e.length)discountNinja.Logging.LogInformation("No primary offer detected");else if(1===e.length)discountNinja_Script_Offer.PrimaryOffer=e[0];else{let t=[];for(let n=0;n<e.length;n++){let i=e[n];t.push(i)}if(0===t.length)discountNinja_Script_Offer.PrimaryOffer=e[0];else if(1===t.length)discountNinja_Script_Offer.PrimaryOffer=t[0];else{for(let e=0;e<t.length;e++){let n=t[e];if(!discountNinja_Script_Offer.IsOfferAccepted(n.Token,n.Frequency))return void(discountNinja_Script_Offer.PrimaryOffer=n)}discountNinja_Script_Offer.PrimaryOffer=t[0]}}}}catch(t){discountNinja.Logging.LogError("Offer.SetPrimaryOffer",t)}},CombinePromotionsFromTokenAndDiscountCode:function(){let t=JSON.parse(discountNinja.Cache.SessionGet("triggersfromtoken")),e=discountNinja.DiscountCodeTrigger.Get(),n=t?t.Offers:[],i=t?t.Triggers:[];return{Offers:function(t,e){try{t||(t=[]);for(let n=0;n<e.length;n++){let i=!1;for(let o=0;o<e[n].trigger.Offers.length;o++){for(let r=0;r<t.length;r++)if(t[r].Token===e[n].trigger.Offers[o].Token){i=!0;break}i||t.push(e[n].trigger.Offers[o])}}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineOffersFromTokenAndDiscountCode",t),null}}(n,e),Triggers:function(t,e){try{t||(t=[]);for(let i=0;i<e.length;i++){let o=!1;for(let r=0;r<e[i].trigger.Triggers.length;r++){for(let n=0;n<t.length;n++)if(t[n].Token===e[i].trigger.Triggers[r].Token){o=!0;break}if(!o){var n=e[i].trigger.Triggers[r];n.Offers=[];for(let t=0;t<e[i].trigger.Offers.length;t++)n.Offers.push(e[i].trigger.Offers[t].Token);t.push(n)}}}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineTriggersFromTokenAndDiscountCode",t),null}}(i,e)}},FilterPromotions:function(){try{discountNinja_Script_Offer.Offers=function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" offers available");let e=[];for(let n=0;n<t.length;n++){let i=t[n];discountNinja_Script_Offer.OfferIsApplicable(i)&&e.push(i)}return discountNinja.Logging.LogVerbose("After filter "+e.length+" offers available"),e}catch(t){return discountNinja.Logging.LogError("Offer.FilterOffers",t),null}}(discountNinja_Script_Offer.Offers),discountNinja_Script_Offer.Triggers=function(t){try{if(!t)return null;let e=!1,n=null,i=null;for(let o=0;o<t.length;o++){let r=t[o];r.Stacking&&!r.Stacking.Combine&&(e=!0,(null===n||n>r.Stacking.Priority)&&(i=r,n=r.Stacking.Priority))}return e?[i]:t}catch(t){return discountNinja.Logging.LogError("Offer.HandleExclusiveTrigger",t),null}}(function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" triggers available");let e=[];for(let n=0;n<t.length;n++){let i=t[n];discountNinja_Script_Offer.TriggerIsApplicable(i)&&e.push(i)}return discountNinja.Logging.LogVerbose("After filter "+e.length+" triggers available"),e}catch(t){return discountNinja.Logging.LogError("Offer.FilterOffers",t),null}}(discountNinja_Script_Offer.Triggers))}catch(t){return discountNinja.Logging.LogError("Offer.FilterPromotions",t),null}},LoadApplicableOffers:function(t,e){try{let n=discountNinja.Token.GetNonAutomaticToken();!function(t,e,n,i){function o(t,n){try{if(discountNinja_Script_Offer.AllOffers=[],discountNinja_Script_Offer.Offers=[],discountNinja_Script_Offer.Triggers=[],discountNinja_Script_Offer.PrimaryOffer=[],!discountNinja.Settings.SettingsAreValid(discountNinja.Settings.Settings))return discountNinja.Logging.LogWarning("Settings invalid",!0,!1),null;if(discountNinja_Script_Offer.AllOffers=t.Offers,discountNinja_Script_Offer.Triggers=t.Triggers,discountNinja_Script_Offer.FilterPromotions(),discountNinja_Script_Offer.Offers=function(t){try{if(!t)return null;let e=discountNinjaContext.PresentmentCurrency,n=discountNinjaContext.ShopCurrency;if(!e||!n)return t;for(let i=0;i<t.length;i++){let o=t[i];for(let t=0;t<o.Tiers.length;t++){let i=o.Tiers[t];i.Prerequisite&&i.Prerequisite.MinimumAmount&&(i.Prerequisite.MinimumAmount=n===e?i.Prerequisite.MinimumAmountBaseCurrency:discountNinja.Currency.Convert(i.Prerequisite.MinimumAmountBaseCurrency,e)),i.Prerequisite&&i.Prerequisite.MaximumAmount&&(i.Prerequisite.MaximumAmount=n===e?i.Prerequisite.MaximumAmountBaseCurrency:discountNinja.Currency.Convert(i.Prerequisite.MaximumAmountBaseCurrency,e)),i.Entitlement&&i.Entitlement.Amount&&(i.Entitlement.Amount=n===e?i.Entitlement.AmountBaseCurrency:discountNinja.Currency.Convert(i.Entitlement.AmountBaseCurrency,e))}}return t}catch(t){return discountNinja.Logging.LogError("Offer.ConvertRates",t),null}}(discountNinja_Script_Offer.Offers),!discountNinja_Script_Offer.Offers)return discountNinja.Logging.LogInformation("No offers available after filter",!1),null;if(!discountNinja_Script_Offer.Triggers)return discountNinja.Logging.LogInformation("No triggers available after filter",!1),null;discountNinja.Trigger.TrackExitIntent(),n||(function(t){try{discountNinja.Cache.SessionSet("offerinfo-"+e,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SavePromotionInfoToCache",t)}}(t),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.StickyBar.Clear(),discountNinja.Notification.Clear())}catch(t){return discountNinja.Logging.LogError("Offer.ProcessPromotionInfo",t),null}}function r(t,e){try{!1===t||"false"===t?(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}):null==t||void 0===t.Offers||null===t.Offers||void 0===t.Offers||null===t.Offers||void 0===t.Triggers||null===t.Triggers?(discountNinja.Logging.LogErrorMessage("Offer.PromotionInfoReady","Offer Info null or no offers/triggers available"),t={Offers:[],Triggers:[]}):!1===t||0===t.Triggers.length?(discountNinja.Logging.LogInformation("No applicable trigger(s) detected",!1),t={Offers:[],Triggers:[]}):!1!==t&&0!==t.Offers.length||(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}),discountNinja.Cache.SessionSet("triggersfromtoken",JSON.stringify(t));let r=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();t.Offers=r.Offers,t.Triggers=r.Triggers,discountNinja.Logging.LogVerbose("Promotion info from server and session combined."),o(t,e);let a=discountNinja.Token.GetTokenFromQueryParameter();return null!==a&&""!==a&&discountNinja.Token.SetNonAutomaticTokenInSession(a),discountNinja.Token.RemoveSavedToken(),!e&&t.Version&&discountNinja.Cache.SessionSet("offersVersion",t.Version),discountNinja.Events.Publish("PromotionsLoaded",[discountNinja.Offer.AllOffers]),n?n(t):void 0}catch(t){return discountNinja.Logging.LogError("Offer.PromotionInfoReady",t),i?i():void 0}}try{let n=function(){try{let t=discountNinja.Cache.SessionGet("offerinfo-"+e),n="undefined"===t?null:JSON.parse(t);return null===n?null:1*n.Status==1*discountNinjaContext.Status?n:(discountNinja.Cache.SessionRemove("offerinfo-"+e,null),null)}catch(t){return discountNinja.Logging.LogError("Offer.GetPromotionInfoFromCache",t),null}}();if(null!==n)return discountNinja.Logging.LogVerbose("Offer info available in cache"),r(n,!0);{discountNinja.Logging.LogVerbose("Loading offer info from server");let n=null===discountNinja.Cache.SessionGet("offerinfo-requested-"+e),i=discountNinja.Core.Shop,o=discountNinja.Utilities.GetReferrer();discountNinja.XmlHttpRequest.Send(discountNinja_Script_Offer.ServerUrl()+"/api/ApplicablePromotions",function(t,e,n,i){try{let o={};t&&(o.shop=t),e&&(o.token=e),null!==discountNinja.TestMode.TestMode&&(o.testMode=discountNinja.TestMode.TestMode,o.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,o.testModeToken=discountNinja.TestMode.TestModeToken),null!==n&&(o.firstRequest=n),i&&(o.referrer=i),o.version=discountNinja.Core.Version,o.status=discountNinjaContext.Status;let r=discountNinja.DeviceId.Get();return o.deviceId=r,o.m=r+"-"+discountNinja.DateTime.UnixTimestamp(),o.f="7.0",o}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(i,t,n,o),null,"get",!0,!0,r),discountNinja.Cache.SessionSet("offerinfo-requested-"+e,!0)}}catch(t){discountNinja.Logging.LogError("Offer.LoadApplicableOffersInner",t),i()}}(n,function(t){let e="";return e=(e=t?"token-"+t:"anytoken")+"-"+discountNinja_Script_DiscountCode.GetApplicationCounter(),discountNinja.Logging.LogVerbose("Checking offer info cache for key: "+e),e}(n),t,e)}catch(t){discountNinja.Logging.LogError("Offer.LoadPromotionInfo",t),e()}},TriggerIsApplicable:function(t){return!0},OfferIsApplicable:function(t){try{return!!t&&(discountNinja.Logging.LogVerbose("The offer is applicable"),!0)}catch(t){return discountNinja.Logging.LogError("Offer.PromotionIsApplicable",t),null}},GetOfferservedInSession:function(t,e){return discountNinja.Cache.SessionGet("offer-served-session-"+t+"-"+e)},SetOfferservedInSession:function(t,e,n){discountNinja.Cache.SessionSet("offer-served-session-"+t+"-"+e,n)},GetOfferservedOnDevice:function(t,e){return discountNinja.Cache.LocalGet("offer-served-device-"+t+"-"+e)},SetOfferservedOnDevice:function(t,e,n){discountNinja.Cache.LocalSet("offer-served-device-"+t+"-"+e,n)},IsOfferAccepted:function(t,e){if("onceperdevice"===e){let e="true"===discountNinja.Cache.LocalGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted on device: "+e),e}{let e="true"===discountNinja.Cache.SessionGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted in the session: "+e),e}},SetPromotionAccepted:function(t,e,n){"onceperdevice"===e?discountNinja.Cache.LocalSet("offer-accepted-"+t,n):(discountNinja.Cache.LocalSet("offer-accepted-"+t,""),discountNinja.Cache.SessionSet("offer-accepted-"+t,n))},SetPromotionExpired:function(t,e){discountNinja.Cache.LocalSet("offer-expired-"+t,"true")},ExpireOffersAccepted:function(){if(discountNinja_Script_Offer.AllOffers)for(let t=0;t<discountNinja_Script_Offer.AllOffers.length;t++)discountNinja_Script_Offer.SetPromotionExpired(discountNinja_Script_Offer.AllOffers[t].Token)},GetPromotionPriceRuleId:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);let e=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return e?e.DiscountCode.PriceRuleId:null},GetPromotionPriceRuleTitle:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);let e=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return e?e.DiscountCode.PriceRuleTitle:null},GetPromotionDiscountCode:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);let e=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return e?e.DiscountCode.Code:null},PromotionForProductCacheKey:"OfferForProduct-v3.1",PromotionForCartItemCacheKey:"OfferForCartItem-v3.1",ClearPromotionForProductCache:function(){discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForProductCacheKey,null),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForCartItemCacheKey,null)},GetOfferForProductFromCache:function(t,e,n,i){try{let o=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForProductCacheKey),r=void 0===o?null:JSON.parse(o);if(null!==r)for(let o=0;o<r.length;o++)if(r[o].ProductHandle===t&&r[o].VariantId===e&&r[o].CheckForProductPrice.toString()===n.toString()&&r[o].CheckForDiscountedVariant.toString()===i.toString()){let t=r[o].OfferNumber;return discountNinja_Script_Offer.OfferIsApplicable(discountNinja_Script_Offer.Offers[t])?t:null}return null}catch(t){return discountNinja.Logging.LogError("Offer.GetOfferForProductFromCache",t),null}},AddPromotionForProductToCache:function(t,e,n,i,o){try{let a=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForProductCacheKey),c=void 0===a?null:JSON.parse(a);c||(c=[]);var r=c.filter(function(n,r,a){return n.ProductHandle!==t&&n.VariantId!==e&&n.CheckForProductPrice.toString()===i.toString()&&n.CheckForDiscountedVariant.toString()===o.toString()});r.push({ProductHandle:t,VariantId:e,OfferNumber:n,CheckForProductPrice:i,CheckForDiscountedVariant:o}),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForProductCacheKey,JSON.stringify(r))}catch(t){discountNinja.Logging.LogError("Offer.AddPromotionForProductToCache",t)}},GetOfferForCartItemFromCache:function(t){try{let e=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForCartItemCacheKey),n=void 0===e?null:JSON.parse(e);if(null!==n)for(let e=0;e<n.length;e++)if(n[e].Key===t){let t=n[e].OfferNumber;return discountNinja_Script_Offer.OfferIsApplicable(discountNinja_Script_Offer.Offers[t])?t:null}return null}catch(t){return discountNinja.Logging.LogError("Offer.GetOfferForCartItemFromCache",t),null}},AddPromotionForCartItemToCache:function(t,e){try{let i=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForCartItemCacheKey),o=void 0===i?null:JSON.parse(i);o||(o=[]);var n=o.filter(function(e,n,i){return e.Key!==t});n.push({Key:t,OfferNumber:e}),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForCartItemCacheKey,JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("Offer.AddPromotionForCartItemToCache",t)}},GetOfferDataForPrerequisiteProduct:function(t,e,n,i,o,r,a,c){try{if(null==t)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;let s=discountNinja_Script_Offer.Offers;return s?discountNinja_Script_Offer.GetApplicableOfferNumberInternal(s,t,e,n,i,o,r,a,!1,c,!1,!0,!0):(discountNinja.Logging.LogInformation("No offers available",!1),null)}catch(t){discountNinja.Logging.LogError("Offer.GetOfferDataForPrerequisiteProduct",t)}},GetOfferDataForProduct:function(t,e,n,i,o,r,a,c){try{if(null==t)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;let s=discountNinja_Script_Offer.Offers;if(!s)return discountNinja.Logging.LogInformation("No offers available",!1),null;let u=discountNinja_Script_Offer.GetOfferForProductFromCache(t,e,a,c);return null!==u?"no_applicable_offer"===u?(discountNinja.Logging.LogVerbose("Returning from cache: no applicable offer for product "+t),null):(discountNinja.Logging.LogVerbose("Returning offer data from cache for product "+t),u):null===(u=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(s,t,e,n,i,o,r,a,!1,c,!0,!1,!0)).Applicable&&null===u.ApplicableNoTier?(discountNinja_Script_Offer.AddPromotionForProductToCache(t,e,"no_applicable_offer",a,c),null):(discountNinja_Script_Offer.AddPromotionForProductToCache(t,e,u,a,c),u)}catch(t){discountNinja.Logging.LogError("Offer.GetOfferDataForProduct",t)}},GetOfferForProduct:function(t,e,n,i,o,r,a,c){try{let s=discountNinja_Script_Offer.GetOfferDataForProduct(t,e,n,i,o,r,a,c);if(null===s||null===s.Applicable)return discountNinja.Logging.LogInformation("No applicable offer available for product "+t,!1),null;{let e=discountNinja_Script_Offer.GetOfferByToken(s.Applicable);return discountNinja.Logging.LogVerbose("Using offer "+e.Token+" for product "+t),e}}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},GetOfferForCartItem:function(t,e,n,i,o,r,a){try{let t=discountNinja_Script_Offer.Offers;if(!t)return discountNinja.Logging.LogInformation("No offers available",!1),null;let c=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(t,e,n,i,o,r,a,!1,!0,!0,!0,!1,!1);return applicableOfferToken=c.Applicable,null===applicableOfferToken?(discountNinja.Logging.LogInformation("No applicable offer available for product "+e,!1),null):(discountNinja.Logging.LogVerbose("Using offer "+applicableOfferToken+" for product "+e),discountNinja_Script_Offer.GetOfferByToken(applicableOfferToken))}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},GetApplicableOfferNumberInternal:function(t,e,n,i,o,r,a,c,s,u,d,l,g){function f(t,e){let n=discountNinja.Prerequisite.EntitledQuantity(t,e);return null===n||n>0}function p(t){if(t.Exclusions){let e=0;t.Exclusions.Collections?e=discountNinja.LiquidData.ItemsInCartFromCollections(t.Exclusions.Collections):"*"===t.Exclusions.Products?e=discountNinja.LiquidData.Cart?discountNinja.LiquidData.Cart.item_count:0:t.Exclusions.Products&&(e=discountNinja.LiquidData.ItemsInCartFromProducts(t.Exclusions.Products));let n=t.Exclusions.Minimum;if(n&&e&&e.length>=n)return!0;let i=t.Exclusions.Maximum;if(i&&e&&e.length<=i)return!0}return!1}function m(t,e,i,o,c){try{if("line_item"!==t.Entitlement.TargetType)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+e+" - Shipping only"),!1;if("each"!==t.Entitlement.AllocationMethod&&(!c||"percentage"!==t.Entitlement.ValueType))return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+e+" - Cart level only"),!1;if(u&&t.Entitlement.ExcludeCollectionHandles&&t.Entitlement.ExcludeCollectionHandles.indexOf("%")>-1&&a>r)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for variant "+n+" - Discounted variant"),!1;if(discountNinja.Utilities.StringIsIn(i,t.Entitlement.ExcludeCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+e+" because that product is in an exclude collection."),!1;if("collection"===t.Entitlement.EntitledItemType){if(!discountNinja.Utilities.StringIsIn(i,t.Entitlement.EntitledCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+e+" because that product is not in the set of promoted collections."),discountNinja.Logging.LogVerbose("The offer applies to products in the collections '"+t.Entitlement.EntitledCollectionHandles+"' the product '"+e+" is in collections '"+i+"'."),!1}else if("product"===t.Entitlement.EntitledItemType){if(!discountNinja.Utilities.StringIsIn(t.Entitlement.EntitledProductHandles,e))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+e+" because that product is not in the set of promoted products."),discountNinja.Logging.LogVerbose("The offer applies to products '"+t.Entitlement.EntitledProductHandles+"' the product '"+e+" is not in that list."),!1}else if("site"!==t.Entitlement.EntitledItemType)return discountNinja.Logging.LogErrorMessage("Offer.OfferIsValidForProduct","TargetType unknown"),!1;return discountNinja.Logging.LogVerbose("Offer is valid for product"),!0}catch(t){return discountNinja.Logging.LogError("Offer.OfferIsValidForProduct",t),!1}}function h(t,e,n){try{if(discountNinja.Utilities.StringIsIn(n,t.Prerequisite.PrerequisiteExcludeCollections))return!1;if(t.Prerequisite.PrerequisiteCollections){if(discountNinja.Utilities.StringIsIn(n,t.Prerequisite.PrerequisiteCollections))return!0}else if(t.Prerequisite.PrerequisiteProducts&&discountNinja.Utilities.StringIsIn(e,t.Prerequisite.PrerequisiteProducts))return!0;return!1}catch(t){return discountNinja.Logging.LogError("Offer.ProductIsPrerequisiteFor",t),!1}}function j(t,e,n){try{let i=t.Entitlement.ValueType,o=100*e.Amount,r=e.Percentage,a=discountNinja.Settings.Settings.Currency,c=a.RoundPrices,s=a.RoundToCents,u=0;if("fixed_amount"===i?u=n-o:"percentage"===i&&(u=parseFloat((n-Math.floor(n*r)/100).toFixed(4))),u<0&&(u=0),c){let t=100*u;if(t>0){t=100*Math.floor(t/100)+s}u=Math.round(t)/100}return Math.round(100*u)/100}catch(t){discountNinja.Logging.LogError("Offer.TestDiscountedPrice",t)}}try{let n=i,o=null,a=null,c=null;for(let i=0;i<t.length;i++){let u=t[i];if(discountNinja.Logging.LogVerbose("Checking offer "+(i+1)+" with token "+u.Token),!discountNinja_Script_Offer.OfferIsApplicable(u)||p(u)||d&&!m(u,e,n,0,g)||l&&!h(u,e,n)||!discountNinja_Script_Offer.IsOfferAccepted(u.Token,u.Frequency))discountNinja.Logging.LogVerbose("Offer "+(i+1)+" with token "+u.Token+" - Not valid");else if(d){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(u);if(t)if(!s||f(u,t)){let e=j(u,discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t),r);(null===c||e<c)&&(o=i,c=e,discountNinja.Logging.LogVerbose("Offer "+(i+1)+" with token "+u.Token+" - Candidate"))}else discountNinja.Logging.LogVerbose("Offer with token "+u.Token+" is over allocated - Not valid");else discountNinja.Logging.LogVerbose("No tier detected for offer with token "+u.Token+" - Not valid"),a=i}else l&&(o=i)}return{Applicable:null===o?null:t[o].Token,ApplicableNoTier:null===a?null:t[a].Token}}catch(t){return discountNinja.Logging.LogError("Offer.GetApplicableOfferNumberInternal",t),!1}},GetFromCache:function(t){try{let e=discountNinja.Cache.SessionGet("offer-data-"+t);return"undefined"===e?[]:JSON.parse(e)}catch(t){return discountNinja.Logging.LogError("Offer.GetFromCache",t),null}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("offer-data-"+t.Token,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SaveToCache",t)}},RemoveFromCache:function(t){try{discountNinja.Cache.SessionRemove("offer-data-"+t)}catch(t){return discountNinja.Logging.LogError("Offer.RemoveFromCache",t),null}},Stop:function(t){try{discountNinja.Logging.LogVerbose("Stopping offer."),discountNinja.DiscountCode.Remove(t),discountNinja.Notification.Remove(t),discountNinja.PopUp.Hide(t),discountNinja.StickyBar.Remove(t),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.SetPromotionExpired(t)}catch(t){discountNinja.Logging.LogError("Offer.Stop",t)}},UnApply:function(t){try{discountNinja.Logging.LogVerbose("Unapplying offer."),discountNinja.DiscountCode.Remove(t)}catch(t){discountNinja.Logging.LogError("Offer.UnApply",t)}},ReEvaluate:function(){try{discountNinja.Logging.LogVerbose("Re-evaluate all offers. Stopping all offers with timers. Undoing all side effects"),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),discountNinja.DiscountCode.Clear(),discountNinja.ShortCode.HideShortcodePlaceholders(),discountNinja.Notification.Clear(),discountNinja.Notification.Hide(!1),discountNinja.StickyBar.Clear(),discountNinja.StickyBar.Hide(!1);let t=discountNinja_Script_Offer.PrimaryOffer;t&&discountNinja.PopUp.Hide(t.Token),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.ExpireOffersAccepted(),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.PromotionFlow.StartFlow()}catch(t){discountNinja.Logging.LogError("Offer.ReEvaluate",t)}},GetTier:function(t,e){try{return t.Tiers.length>e?offers.Tiers[e]:null}catch(t){return discountNinja.Logging.LogError("Offer.GetTier",t),null}},GetTriggerTokenForOffer:function(t){try{if(!discountNinja_Script_Offer.Triggers)return null;for(let e=0;e<discountNinja_Script_Offer.Triggers.length;e++){let n=discountNinja_Script_Offer.Triggers[e];for(let e=0;e<n.Offers.length;e++)if(n.Offers[e]===t)return n.Token}return null}catch(t){return discountNinja.Logging.LogError("Offer.GetTriggerTokenForOffer",t),null}},PrerequisiteItemsCartValue:function(t){try{let e=function(t){try{let e=discountNinja.Cache.SessionGet("PrerequisiteItemsCartValue"),n=void 0===e?null:JSON.parse(e);if(null!==n)for(let e=0;e<n.length;e++)if(n[e].Token===t)return n[e].Value;return null}catch(t){discountNinja.Logging.LogError("Offer.GetPrerequisiteItemsCartValueFromCache",t)}}(t.Token);if(null!==e)return e;let n=0;return!0===t.Prerequisite.AfterDiscount?t.Prerequisite&&"*"===t.Prerequisite.PrerequisiteCollections?n=discountNinja.DiscountedCart.ValueInDiscountedCart(t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite&&t.Prerequisite.PrerequisiteCollections?n=discountNinja.DiscountedCart.ValueInDiscountedCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite&&t.Prerequisite.PrerequisiteProducts&&(n=discountNinja.DiscountedCart.ValueInDiscountedCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections)):t.Prerequisite&&"*"===t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCart(t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite&&t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite&&t.Prerequisite.PrerequisiteProducts&&(n=discountNinja.LiquidData.ValueInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections)),discountNinja.Logging.LogVerbose("Cart value for prerequisite items of offer "+t.Token+" is "+n),function(t,e){try{let n=function(t){let e=discountNinjaContext.Cart.token+"-"+discountNinjaContext.Cart.total_price+"-"+discountNinjaContext.Cart.item_count,n="";for(let t=0;t<discountNinjaContext.Cart.items.length;t++)n=n+discountNinjaContext.Cart.items[t].key+"-";return"PrerequisiteItemsCartValue-"+t+"-"+e+"-"+n}(t),i=discountNinja.Cache.SessionGet(n),o=void 0===i?null:JSON.parse(i);o||(o=[]),o.push({Token:t,Value:e}),discountNinja.Cache.SessionSet(n,JSON.stringify(o))}catch(t){discountNinja.Logging.LogError("Offer.AddPrerequisiteItemsCartValueToCache",t)}}(t.Token,n),n}catch(t){return discountNinja.Logging.LogError("Offer.PrerequisiteItemsCartValue",t),0}},EligibleItemsCartValue:function(t,e){try{let n=function(t){try{let e=discountNinja.Cache.SessionGet("EligibleItemsCartValue"),n=void 0===e?null:JSON.parse(e);if(null!==n)for(let e=0;e<n.length;e++)if(n[e].Token===t)return n[e].Value;return null}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetEligibleItemsCartValueFromCache",t)}}(t.Token);if(null!==n)return n;let i=0;return"discountedcart"===e?"*"===t.Entitlement.EntitledProductHandles?i=discountNinja.DiscountedCart.ValueInDiscountedCart(t.Entitlement.ExcludeCollectionHandles):t.Entitlement.EntitledCollectionHandles?i=discountNinja.DiscountedCart.ValueInDiscountedCartFromCollections(t.Entitlement.EntitledCollectionHandles,t.Entitlement.ExcludeCollectionHandles):t.Entitlement.EntitledProductHandles&&(i=discountNinja.DiscountedCart.ValueInDiscountedCartFromProducts(t.Entitlement.EntitledProductHandles,t.Entitlement.ExcludeCollectionHandles)):t.Entitlement.EntitledCollectionHandles?i=discountNinja.LiquidData.ValueInCartFromCollections(t.Entitlement.EntitledCollectionHandles,t.Entitlement.ExcludeCollectionHandles):"*"===t.Entitlement.EntitledProductHandles?i=discountNinja.LiquidData.ValueInCartExcludingGifts(t.Entitlement.ExcludeCollectionHandles):t.Entitlement.EntitledProductHandles&&(i=discountNinja.LiquidData.ValueInCartFromProducts(t.Entitlement.EntitledProductHandles,t.Entitlement.ExcludeCollectionHandles)),discountNinja.Logging.LogVerbose("Cart value for eligible items of offer "+t.Token+" is "+i),function(t,e){try{let n=discountNinja.Cache.SessionGet("EligibleItemsCartValue"),i=void 0===n?null:JSON.parse(n);i||(i=[]),i.push({Token:t,Value:e}),discountNinja.Cache.SessionSet("CartValue",JSON.stringify(i))}catch(t){discountNinja.Logging.LogError("DiscountedCart.AddEligibleItemsCartValueToCache",t)}}(t.Token,i),i}catch(t){return discountNinja.Logging.LogError("Offer.EligibleItemsCartValue",t),0}}},discountNinja_Script_ProductData={CachePrefix:function(){return"productdata-v3.1-"},ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://productapi-v4.discountninja.io":"https://productapi-v4-dev.discountninja.io"},RequestsPending:[],SaveProductDataToCache:function(t,e,n,i,o,r,a){try{discountNinja.Logging.LogVerbose("Saving product data for handle: "+t);let c={CompareAtPrice:e,Price:n,Inventory:r,Collections:i,CollectionsComplete:o,Source:a},s=discountNinja_Script_ProductData.GetByProductHandle(t,!1);if(!s)return void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c));if("product"===a||"collection"===a){if(discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t,"true"),"product"===a)return void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c));if("collection"===a)return s.CollectionsComplete&&!c.CollectionsComplete?c.Collections=s.Collections:null===s.Collections&&(c.CollectionsComplete||null!==c.Collections||discountNinja.Environment.Shopify.IsCollectionPage()&&!discountNinja.Environment.Shopify.IsCatalogPage()&&(c.Collections=discountNinja.Environment.Shopify.CollectionHandle(),c.CollectionsComplete=!1,discountNinja.Logging.LogVerbose("No collections data, setting current collection for: "+t))),void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c))}else{if("product"!==s.Source||!discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t))return"server"===a?void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c)):"product"===s.Source||"collection"===s.Source||"server"===s.Source?void discountNinja.Logging.LogVerbose("Current cached product data is from "+s.Source+" and new data is from a less trustworthy source "+c.Source+" , skipping save for handle: "+t):void discountNinja.Cache.LocalSet(t,JSON.stringify(c));discountNinja.Logging.LogVerbose("Current cached product data is from product page and new data is not from liquid, skipping save for handle: "+t)}}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataToCache",t),null}},GetDataFromCollectionAttribute:function(t,e,n,i){try{let o=e.toLowerCase(),r=jQuery(t).attr("data-limoniapps-discountninja-product-"+o);if(r||(r=jQuery(t).attr("data-limoniapps-discounturl-product-"+o)),!r&&n){let t=discountNinja.LiquidData.CollectionProductByHandle(n);t&&(r=t[e])}if(!r&&"Handle"===e){let e=discountNinja.Settings.Settings.PriceUpdate.Mode,n=i?e.FeaturedProductHandle:e.CollectionProductHandle;if(n&&"custom"!==n)return discountNinja.Utilities.GetHandleFromSelector(t,null,n)}return void 0===r?null:r}catch(t){return discountNinja.Logging.LogError("GetDataFromCollectionAttribute",t),null}},SaveProductDataUsingDataTags:function(t){try{let e=!0,n=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Handle"),i=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Price",n),o=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"CompareAtPrice",n),r=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Collections",n);if(r||!discountNinja.Environment.Shopify.IsCollectionPage()||discountNinja.Environment.Shopify.IsCatalogPage()||(r=discountNinja.Environment.Shopify.CollectionHandle(),e=!1),!(null!=n&&null!=i&&null!=o&&null!=r))return void discountNinja.Logging.LogVerbose("Incomplete data in tags for handle: "+n+", aborting");discountNinja.Logging.LogVerbose("Saving product data for collection product with handle: "+n),discountNinja_Script_ProductData.SaveProductDataToCache(n,o,i,r,e,null,"collection")}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataUsingDataTags",t),null}},Save:function(){try{discountNinja.Logging.LogVerbose("Saving product data for products on page");let t=jQuery("[data-limoniapps-discountninja-product-handle]");for(let e=0;e<t.length;e++)discountNinja.ProductData.SaveProductDataUsingDataTags(t[e]);if(discountNinja.Environment.Shopify.IsProductPage()){handle=discountNinja.Environment.Shopify.ProductHandle();let t=discountNinja.LiquidData.ProductDefaultVariantId(handle);if(t){let e=discountNinja.LiquidData.Inventory(t);if(price=discountNinja.LiquidData.Price(t),null===price)return void discountNinja.Logging.LogVerbose("No price available");price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(t),collections=discountNinja.LiquidData.ProductCollections(),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected product page product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,collections,!0,e,"product")}}if(window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.items&&window.discountNinjaContext.Cart.length>0)for(let t=0;t<window.discountNinjaContext.Cart.length;t++){handle=window.discountNinjaContext.Cart.items[t].handle,discountNinja_Script_ProductData.GetByProductHandle(handle,!0)||(variant=discountNinja.LiquidData.ProductDefaultVariantId(handle),inventory=discountNinja.LiquidData.Inventory(variant),price=discountNinja.LiquidData.Price(variant),null!==originalPrice?(price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(variant),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected cart product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,null,!1,inventory,"cart")):discountNinja.Logging.LogVerbose("No price available"))}}catch(t){return void discountNinja.Logging.LogError("ProductData.Save",t)}},SaveOnAddToCart:function(t){try{let e=100*discountNinja.LiquidData.PriceFromCartByProductHandle(t);discountNinja_Script_ProductData.SaveProductDataToCache(t,null,e,null,!1,null,"addtocart")}catch(t){return discountNinja.Logging.LogError("ProductData.Save",t),null}},GetByVariant:function(t,e){try{let n=discountNinja.LiquidData.ProductHandleFromCart(t);return discountNinja_Script_ProductData.GetByProductHandle(n,e)}catch(t){return discountNinja.Logging.LogError("ProductData.Get",t),null}},GetProductDataFromServer:function(t){function e(t){try{if(!t)return;discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t.Handle,"true"),discountNinja.Cache.SessionSet(n(t.Handle),JSON.stringify(t)),discountNinja.Logging.LogVerbose("Retrieved product data from server for product with handle: "+t.Handle),discountNinja_Script_ProductData.SaveProductDataToCache(t.Handle,t.CompareAtPrice,t.Price,t.Collections,!0,0,"server"),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate()}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.ProductDataReady",t),null}}function n(t){return"productdata-servercache-"+t}try{if(!t)return void discountNinja.Logging.LogErrorMessage("ProductData","Requesting GetProductDataFromServer with empty handle");let o=discountNinja.Cache.SessionGet(n(t));if(o)return e(JSON.parse(o));let r="productdata-servercache-requested-"+t,a=discountNinja.Cache.SessionGet(r);var i=a?parseInt(a):0;if(i>=3)return"attempts-exhausted";discountNinja_Script_ProductData.RequestsPending||(discountNinja_Script_ProductData.RequestsPending=[]);let c=discountNinja_Script_ProductData.RequestsPending[t];if(c){if(!function(t){try{let e=discountNinja.DateTime;return e.DiffInSeconds(t,e.UtcNow())>5}catch(t){return!0}}(c))return discountNinja.Logging.LogWarning("Getting product data from server for "+t+" canceled because another request for the same product is pending"),"request-pending"}else discountNinja_Script_ProductData.RequestsPending[t]=discountNinja.DateTime.UtcNow();discountNinja.Cache.SessionSet(r,i+1),discountNinja.Logging.LogVerbose("Getting product data from server for product with handle: "+t),discountNinja.XmlHttpRequest.Send(discountNinja_Script_ProductData.ServerUrl()+"/api/ProductData",function(t,e){try{let n={};t&&(n.shop=t),e&&(n.handle=e);let i=discountNinja.DeviceId.Get();return n.m=i+"-"+discountNinja.DateTime.UnixTimestamp(),n.version=discountNinja.Core.Version,n.f="6.4",n}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.GetProductDataFromServer",t),null}}(discountNinja.Core.Shop,t),null,"get",!0,!0,e,null,1,3)}catch(t){discountNinja.Logging.LogError("ProductData.GetProductDataFromServer",t)}},GetByProductHandle:function(t,e,n,i){function o(e){try{if(null===e)return!1;let n=("server"===e.Source||"product"===e.Source)&&"true"===discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t);return"collection"===e.Source&&e.CollectionsComplete&&void 0!==e.Price&&null!==e.Price&&void 0!==e.CompareAtPrice&&null!==e.CompareAtPrice||n}catch(t){discountNinja.Logging.LogError("ProductData.GetByProductHandle.IsComplete",t)}}try{let r=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+t),a="undefined"===r?null:JSON.parse(r);null===e&&(e=!1);let c=o(a);return!c&&n&&i&&(discountNinja.ProductData.SaveProductDataUsingDataTags(i),c=o(a="undefined"===(r=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+t))?null:JSON.parse(r))),e&&!c&&discountNinja_Script_ProductData.GetProductDataFromServer(t),a}catch(t){return discountNinja.Logging.LogError("ProductData.GetByProductHandle",t),null}}},discountNinja_Script_PromotionEvent={Queue:"promotionevent-queue",ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotioneventsapi-v4.discountninja.io":"https://promotioneventsapi-v4-dev.discountninja.io"},PromotionEventKey:function(t,e,n){return"offerevent-sent-"+t+"-"+e+"-"+n},GetPromotionEventSentInSession:function(t,e,n){return discountNinja.Cache.SessionGet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,e,n))},SetPromotionEventSentInSession:function(t,e,n,i){discountNinja.Cache.SessionSet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,e,n),i)},GetQueue:function(){try{let t=discountNinja.Cache.LocalGet(discountNinja_Script_PromotionEvent.Queue);return JSON.parse(t)}catch(t){return discountNinja.Logging.LogError("PromotionEvent.GetQueue",t),null}},AddToQueue:function(t,e){try{if(discountNinja.TestMode.TestMode)return;let n=discountNinja_Script_PromotionEvent.GetQueue();null===n&&(n=[]),n.push({triggerToken:t.Token,eventType:e,processed:!1}),discountNinja_Script_PromotionEvent.SaveQueue(n),discountNinja_Script_PromotionEvent.ProcessQueue()}catch(t){discountNinja.Logging.LogError("PromotionEvent.AddToQueue",t)}},SaveQueue:function(t){try{let e=[];for(let n=0;n<t.length;n++){let i=t[n];i.processed||e.push(i)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(e))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}},ProcessQueueDebounced:function(){function t(t){try{if("sent"===discountNinja_Script_PromotionEvent.GetPromotionEventSentInSession(t.triggerToken,"",t.eventType))return discountNinja.Logging.LogVerbose("Event of type "+t.eventType+" already sent for offer with token "+t.triggerToken),void(t.processed=!0);discountNinja.Logging.LogVerbose("Logging event of type "+t.eventType),discountNinja.XmlHttpRequest.Send(discountNinja_Script_PromotionEvent.ServerUrl()+"/api/AddPromotionEvent",function(t){try{let e={};e.token=t.triggerToken,e.deviceId=discountNinja.DeviceId.Get(),e.eventType=t.eventType,e.shop=discountNinja.Core.Shop,e.version=discountNinja.Cache.SessionGet("offersVersion");let n=discountNinja.DeviceId.Get();return e.m=n+"-"+discountNinja.DateTime.UnixTimestamp(),e}catch(t){return discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent.BuildParameters",t),null}}(t),null,"get",!0,!0,function(e){try{e?(discountNinja.Logging.LogVerbose("Log event of type "+t.eventType+" completed successfully"),function(t){try{let e=discountNinja_Script_PromotionEvent.GetQueue();null===e&&(e=[]);for(let n=0;n<e.length;n++){let i=e[n];i.triggerToken===t.triggerToken&&i.eventType===t.eventType&&(i.processed=!0)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(e))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}}(t),discountNinja_Script_PromotionEvent.SetPromotionEventSentInSession(t.triggerToken,"",t.eventType,"sent")):discountNinja.Logging.LogErrorMessage("PromotionEvent.LogPromotionEvent.onLogComplete","Could not log event of type "+t.eventType)}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent.onLogComplete",t)}},null,1,1)}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent",t)}}try{let e=discountNinja_Script_PromotionEvent.GetQueue();null===e&&(e=[]);for(let n=0;n<e.length;n++){let i=e[n];i.processed||t(i)}discountNinja_Script_PromotionEvent.SaveQueue(e)}catch(t){discountNinja.Logging.LogError("PromotionEvent.ProcessQueue",t)}}},discountNinja_Script_PromotionFlow={CartAdjustments:[],HandlingDrawerCartTimeoutHandle:null,HandlingDrawerCartTimeout:!1,BuyNowButtonSelector:".limoniapps-discountninja-buynowbutton",ShowStickyBarAndNotification:function(){function t(t){try{let e="",n=t.StickyBar;return n||(e="Sticky bar disabled for offer "+t.Token),""!==e||"mobileonly"!==n.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?""===e&&"desktoponly"===n.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(e="Sticky bar is not displayed on mobile phones"):e="Sticky bar is only displayed on mobile phones",""===e&&(e=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(n,e,"Sticky bar")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(e,!1)}catch(t){return discountNinja.Logging.LogError("PromotionFlow.IsStickyBarRequired",t),!1}}function e(t){let e="",n=t.Notification;return n||(e="Notification disabled for offer "+t.Token),""!==e||"mobileonly"!==n.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?""===e&&"desktoponly"===n.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(e="Notification is not displayed on mobile phones"):e="Notification is only displayed on mobile phones",""===e&&(e=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(n,e,"Notification")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(e,!1)}try{let n=null,i=null;null!=n&&0!==n.length&&null!=i&&0!==i.length||function(){try{discountNinja.StickyBar.Clear(),discountNinja.Notification.Clear();let i=discountNinja.Offer.Offers;if(i)for(let o=0;o<i.length;o++){let r=i[o];if(!discountNinja.Offer.IsOfferAccepted(r.Token,r.Frequency)&&r.AutoAccept)discountNinja.Logging.LogVerbose("Not adding sticky bar / notification, offer with token "+r.Token+" is not accepted");else{let i=!0,o=r.Tiers[r.Tiers.length-1],a=o.Prerequisite,c=r.Tiers&&a?a.MaximumAmount:null,s=r.Tiers&&a?a.MaximumItems:null;if(c&&discountNinja.Offer.PrerequisiteItemsCartValue(r)>c&&(discountNinja.Logging.LogVerbose("No sticky bar / notification message for offer with token "+r.Token+" because the cart value is over the maximum amount"),i=!1),s&&discountNinja.Prerequisite.PrerequisiteItemsInCart(r,o)>s&&(discountNinja.Logging.LogVerbose("No sticky bar / notification message for offer with token "+r.Token+" because the cart content is over the maximum number of items"),i=!1),i){var n=r.StickyBar&&(r.StickyBar.ActionButton1&&"applydiscount"===r.StickyBar.ActionButton1.Action||r.StickyBar.ActionButton2&&"applydiscount"===r.StickyBar.ActionButton2.Action);(discountNinja.Offer.IsOfferAccepted(r.Token,r.Frequency)||n)&&t(r)?r.StickyBar&&(r.StickyBar.Body||r.StickyBar.TimerFooter)?(discountNinja.Logging.LogVerbose("Adding sticky bar message for offer with token "+r.Token),discountNinja.StickyBar.Add(r.Token,r.StickyBar.PlacementVertical)):discountNinja.Logging.LogVerbose("No sticky bar message for offer with token "+r.Token):discountNinja.Logging.LogVerbose("Sticky bar message for offer with token "+r.Token+" not added, not a building block"),discountNinja.Offer.IsOfferAccepted(r.Token,r.Frequency)&&e(r)?r.Notification&&r.Notification.Body?(discountNinja.Logging.LogVerbose("Adding notification message for offer with token "+r.Token),discountNinja.Notification.Add(r.Token)):discountNinja.Logging.LogVerbose("No notification message for offer with token "+r.Token):discountNinja.Logging.LogVerbose("Notification message for offer with token "+r.Token+" not added, not a building block")}}}}catch(t){discountNinja.Logging.LogError("PromotionFlow.BuildStickyBarAndNotificationArrays",t)}}(),discountNinja.StickyBar.Show(),discountNinja.Notification.Show(),n=discountNinja.Notification.GetFromCache(),i=discountNinja.StickyBar.GetFromCache();let o=!1;if(null!=i&&i.length>0)for(let t=0;t<i.length;t++){let e=i[t];if("top_page_sticky"===e.PlacementVertical||"top_page"===e.PlacementVertical){o=!0;break}}o||discountNinja.StickyBar.RemoveTopMarginFromElements()}catch(t){discountNinja.Logging.LogError("PromotionFlow.ShowStickyBarAndNotification",t)}},ShowAcceleratedCheckoutButtons:function(){discountNinja_Script_PromotionFlow.HandleAcceleratedCheckoutButtons(!0)},HideAcceleratedCheckoutButtons:function(){discountNinja_Script_PromotionFlow.HandleAcceleratedCheckoutButtons(!1)},HandleAcceleratedCheckoutButtons:function(t){try{!function(t,e,n){try{let i="";for(let t=0;t<e.length;t++)i=i+" "+e[t]+" { "+n+" }";0===jQuery("#"+t).length&&function(t,e){try{discountNinja.Logging.LogVerbose("Adding css :"+t);let n=document.createElement("style");n.type="text/css",n.id=e,n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(n)}catch(t){discountNinja.Logging.LogError("AddInlineCssToDocument",t)}}(i,t)}catch(t){discountNinja.Logging.LogError("ShowAcceleratedCheckoutButtonsInternal",t)}}("limoniapps-additionalcheckoutbuttons-style",discountNinja_Script_PromotionFlow.AcceleratedCheckoutButtonSelectors(),t?"display: unset !important;":"display: none !important;")}catch(t){discountNinja.Logging.LogError("PromotionFlow.HandleAcceleratedCheckoutButtons",t)}},AcceleratedCheckoutButtonSelectors:function(){return[".additional-checkout-buttons",".additional-checkout-button",".shopify-payment-button",'[data-shopify="dynamic-checkout-cart"]',".paypal-buttons",".limoniapps-discountninja-hide"]},SwitchToCustomCheckoutButton:function(){try{let t=".limoniapps-discountninja-checkoutbutton";jQuery(t+"-hide").hide(),jQuery(t+"-show").show()}catch(t){discountNinja.Logging.LogError("PromotionFlow.SwitchToCustomCheckoutButton",t)}},DisplayAppliedOffers:function(){try{discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.DynamicPricing.UpdatePrice(!1,!0),discountNinja.DiscountedCart.HasActivePromotions()?(!function(){let t=!1;"object"==typeof mamutaTier&&(mamutaTier=null,t=!0),"object"==typeof Spurit&&(Spurit=null,t=!0),"object"==typeof SMARTOFFER&&(SMARTOFFER=null,t=!0),t&&discountNinja.Cache.SessionSet("RedirectToCheckoutOnFallBack","true")}(),!0===discountNinjaContext.Flags.CustomCheckoutButton&&discountNinja_Script_PromotionFlow.SwitchToCustomCheckoutButton(),discountNinja.PromotionFlow.HideAcceleratedCheckoutButtons()):discountNinja_Script_PromotionFlow.ShowAcceleratedCheckoutButtons(),discountNinja.ShortCode.ShowShortcodePlaceholders(),discountNinja_Script_PromotionFlow.ShowStickyBarAndNotification()}catch(t){discountNinja.Logging.LogError("PromotionFlow.DisplayAppliedOffers",t)}},StartFlow:function(){function t(t,e,n,i,o){if(!t)return!1;let r=t.nodeName?t.nodeName.toLowerCase():"",a="function"==typeof t.getAttribute?t.getAttribute(n):"";return a||(a=""),r===e&&(a===i||!o&&a.indexOf(i)>-1)&&(discountNinja.Logging.LogVerbose("Detected node of type "+e+" with attribute "+n+" set to "+i),!0)}function e(t,e,n){if(t)if(e){if(t.indexOf("<"+e)>-1)return!n||t.indexOf(n)>-1}else if(n)return t.indexOf(n)>-1;return!1}try{if(!discountNinja.Settings.Settings)return void discountNinja.Logging.LogInformation("FLOW: Canceling since no settings are available");discountNinja.Logging.LogInformation("FLOW: Starting flow"),discountNinja.Offer.PrimaryOffer=null,discountNinja.Trigger.Clear(),discountNinja.DiscountCode.EnableDiscountCodeField(!1),discountNinja.Environment.Shopify.IsCartPage()?discountNinja.DiscountedCart.IsDirty=!0:discountNinja.VariantChange.RegisterEventHandlerForVariantChange(),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),function(){let t=discountNinja.Offer.Offers;if(t)for(let e=0;e<t.length;e++){let n=t[e];if(discountNinja.Offer.OfferIsApplicable(n)){let i=discountNinja.Offer.PrerequisiteItemsCartValue(n);discountNinja.DiscountTier.GetCurrentDiscountTierNumber(n,i)!==discountNinja.DiscountTier.GetMaxDiscountTierNumber(n)&&discountNinja.Offer.UnApply(t[e].Token)}else discountNinja.Offer.Stop(t[e].Token)}}(),discountNinja.Offer.Offers=null,function(){try{let n=new(discountNinja.Utilities.GetMutationObserver())(function(n){try{for(let i=0;i<n.length;i++)for(let o=0;o<n[i].addedNodes.length;o++){let r=n[i].addedNodes[o];if(null!=r&&null!==r.nodeName&&void 0!==r.nodeName&&-1===r.nodeName.indexOf("text")){r.nodeName.toLowerCase();let n=jQuery(r).html(),i=jQuery("body").css("margin-top");e(n,"form",null)?n.indexOf("/cart")>-1?(discountNinja.Logging.LogVerbose("Cart form added"),$(document).trigger("limoniApps:discountNinja:DrawerCartOpened")):(n.indexOf("/cart")>-1||n.indexOf("/checkout")>-1)&&(discountNinja.Logging.LogVerbose("Checkout form added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()):e(n,"button","submit")||e(n,"input","submit")||e(n,"a","/checkout")||t(r,"div","id","spurit-occ-popup",!0)||t(r,"button","type","submit",!0)||t(r,"input","type","submit",!0)||t(r,"a","href","/checkout",!1)?discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout():t(r,"div","id","qab_bar",!0)?jQuery("#qab_bar").css("top",i):t(r,"div","id","fsb_background",!0)?discountNinja.Utilities.IsMobilePhone()||jQuery("#fsb_background").css("top",i):t(r,"div","id","spb-information-bar",!0)?jQuery("#spb-information-bar").css("top",i):t(r,"div","class","wheelio_holder",!1)?jQuery(".wheelio_holder .wlo_btn.wlo_copy_code").on("click",function(t){discountNinja.Logging.LogVerbose("Offer triggered via wheelio apply button");let e=jQuery(".wheelio_holder .wlo_input_code").val();discountNinja_Script_PromotionFlow.TriggerPromotion(e)}):e(n,null,"limoniapps-discountninja-cart-root")&&(discountNinja.Logging.LogVerbose("Cart added, updating prices"),setTimeout(function(){discountNinja.DynamicPricing.ReplacePricesInCart()},1e3))}}}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements.mutationObserver",t)}}),i={attributes:!1,childList:!0,subtree:!0,characterData:!1};n.observe(document.body,i)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements",t)}}(),function(){try{let t=jQuery(".limoniapps-discountninja-drawercart-anchor");t.length>0&&(targetNode=t.get()[0],new MutationObserver(function(){let t=jQuery(targetNode).is(":visible");null!==discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle&&clearTimeout(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=setTimeout(function(){!function(t){try{discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout||(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!0,discountNinja.Logging.LogVerbose("Drawer cart modified"),t?(discountNinja.Logging.LogVerbose("Drawer cart visible: minimizing notification"),discountNinja.Notification.Minimize(),discountNinja.DiscountCode.InjectDiscountCodesInHtml()):discountNinja.Logging.LogVerbose("Drawer cart hidden"),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HandleDrawerCartChange",t),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1}}(t)},500)}).observe(targetNode,{attributes:!0}))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDrawerCartChanges",t)}}(),discountNinja.Trigger.MarkPageAsVisited(),discountNinja.Trigger.WaitForTriggerConditions(discountNinja.Offer.Triggers)}catch(t){discountNinja.Logging.LogError("PromotionFlow.StartFlow",t)}},ViewPromotion:function(t){discountNinja.Logging.LogInformation("FLOW: Viewing promotion"),discountNinja.Timer.ShouldStartOnDisplay(t)&&discountNinja.Timer.Start(t),discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger,0)},AcceptPromotion:function(t){try{discountNinja.Logging.LogInformation("FLOW: Accepting offer"),discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"true"),discountNinja.Offer.SaveToCache(t),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja_Script_PromotionFlow.ApplyPromotionIfApplicable(t)}catch(t){discountNinja.Logging.LogError("PromotionFlow.AcceptPromotion",t)}},UnAcceptPromotion:function(t){discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false")},ApplyPromotionIfApplicable:function(t){let e=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja.DiscountTier.GetCurrentDiscountTierNumber(t,e);if(null!==n&&n>0){let e=discountNinja.Offer.GetPromotionDiscountCode(t),n=discountNinja.Offer.GetPromotionPriceRuleId(t);discountNinja_Script_PromotionFlow.ApplyPromotion(t,e,n)}},ClearCartAdjustments:function(){discountNinja_Script_PromotionFlow.CartAdjustments=[]},AddCartAdjustment:function(t,e,n,i,o){discountNinja_Script_PromotionFlow.CartAdjustments.push({Type:t,Variant:e,Quantity:n,PropertyName:i,PropertyValue:o})},ProcessCartAdjustments:function(){discountNinja.Cart.Shopify.LockRefreshCart=!0,function t(e){let n=discountNinja_Script_PromotionFlow.CartAdjustments;n&&n.length>0?n.length>e?function(t,e){if(discountNinja.Logging.LogInformation("Processing adjustment of type "+t.Type+" for variant "+t.Variant),t)if("change"==t.Type){let n=discountNinja.LiquidData.CartItemByVariantAndProperty(t.Variant,t.PropertyName,t.PropertyValue);n?(discountNinja.Logging.LogInformation("---ADJUSTMENT---: Set quantity to "+t.Quantity+" for "+n.key),discountNinja.Cart.Shopify.ChangeCartItemByKey(n.key,t.Quantity,void 0,e)):discountNinja.Logging.LogErrorMessage("ProcessCartAdjustments","Could not process cart adjustment of type change, could not find item")}else if("add"==t.Type){let n={};n[t.PropertyName]=t.PropertyValue,discountNinja.Logging.LogInformation("---ADJUSTMENT---: Add "+t.Quantity+" of "+t.Variant+" with property "+t.PropertyName),discountNinja.Cart.Shopify.AddToCart(t.Variant,t.Quantity,n,e)}}(n[e],function(){t(e+1)}):function(){discountNinja.Cart.Shopify.LockRefreshCart=!1;let t=parseInt(discountNinja.Cache.SessionGet("adjustment-version")||0);discountNinja.Cache.SessionSet("adjustment-version",t+1),discountNinja_Script_PromotionFlow.RefreshAfterCartAdjustments()}():discountNinja.Cart.Shopify.LockRefreshCart=!1}(0)},RefreshAfterCartAdjustments:function(){function ExecuteDrawerCartRefreshMethod(){try{let modeSettings=discountNinja.Settings.Settings.PriceUpdate.Mode,themeOverridesFlags=!0===discountNinja.Settings.GetFlag("ThemeOverridesReloadPageAfterCartAdjustments"),refreshMethod=modeSettings.DrawerCartRefreshMethod;themeOverridesFlags||(refreshMethod=discountNinja.Settings.GetFlag("DrawerCartRefreshMethod")),refreshMethod&&""!==refreshMethod?(discountNinja.Cart.Shopify.IsDirty=!0,setTimeout(function(){discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){try{discountNinja.Logging.LogVerbose("Executing DrawerCartRefreshMethod"),eval(refreshMethod),discountNinja_Script_DiscountedCart.SplitRowsInProcess=!1}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteDrawerCartRefreshMethod.Eval",t)}})},!0)},500)):discountNinja_Script_DiscountedCart.SplitRowsInProcess=!1}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteDrawerCartRefreshMethod",t)}}let requiresReload=!1,modeSettings=discountNinja.Settings.Settings.PriceUpdate.Mode,isCartPage=discountNinja.Environment.Shopify.IsCartPage(),themeOverridesFlags=!0===discountNinja.Settings.GetFlag("ThemeOverridesReloadPageAfterCartAdjustments"),flagReloadOnCart=modeSettings.ReloadPageAfterCartAdjustmentsOnCart;themeOverridesFlags&&void 0!==flagReloadOnCart&&null!=flagReloadOnCart||(flagReloadOnCart=!0===discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGiftOnCart")||!0===discountNinja.Settings.GetFlag("ReloadPageAfterCartAdjustmentsOnCart"));let refreshOnCart=isCartPage&&flagReloadOnCart,flagReloadOnOtherPages=modeSettings.ReloadPageAfterCartAdjustments;themeOverridesFlags&&void 0!==flagReloadOnOtherPages&&null!=flagReloadOnOtherPages||(flagReloadOnOtherPages=!0===discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGift")||!0===discountNinja.Settings.GetFlag("ReloadPageAfterCartAdjustments"));let refreshOutsideOfCart=!isCartPage&&flagReloadOnOtherPages;if(refreshOnCart||refreshOutsideOfCart){let t=discountNinja.Settings.GetFlag("CallbackAfterReloadPageAddingFreeGift")||discountNinja.Settings.GetFlag("CallbackAfterReloadPageForCartAdjustments");discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",t),requiresReload=!0}requiresReload?requiresReload&&(discountNinja_Script_DiscountedCart.SplitRowsInProcess=!1,location.reload()):ExecuteDrawerCartRefreshMethod()},EvaluateBOGOProductEligibility:function(t){if(null===t)return;let e=t?t.Bogo:null,n=discountNinja.DiscountTier.GoalAchieved(t),i=discountNinja.DiscountTier.GetCurrentDiscountTier(t);discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Started - Evaluating offer with token "+t.Token),function(e,n,i,o){if(n){let r=e?discountNinja.Prerequisite.EntitledQuantity(t,o):0;r>0&&discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger,2);let a="cartadjustment-"+i+"-"+(discountNinja.Cache.SessionGet("adjustment-version")||0)+"-"+discountNinjaContext.Cart.token,c=function(e){let n=t.Entitlement.AllocationLimit;return n>0?Math.min(n,e):e||0}(r),s=discountNinja.LiquidData.CartItemsByProperty(discountNinja.DiscountedCart.FreeGiftPrefix+t.Token),u=s?discountNinja.LiquidData.GetQuantityFromItems(s):0,d=(c||0)-(u||0),l=-1;try{l=parseInt(discountNinja.Cache.SessionGet(a))}catch(t){}if(isNaN(l)&&(l=0),discountNinja.Cache.SessionSet(a,c),discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - Entitled to: "+c+" - Synched for: "+l),c!==l){discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - Adjustment required - Delta "+d);let e=discountNinja.DiscountedCart.FreeGiftPrefix+i;d<0&&n.RemoveFromCartAutomatically?(discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - Logging change adjustment"),discountNinja_Script_PromotionFlow.AddCartAdjustment("change",t.Entitlement.EntitledVariantIds,c,e,"")):d>0&&n.AddToCartAutomatically?(discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - Logging add adjustment"),discountNinja_Script_PromotionFlow.AddCartAdjustment("add",t.Entitlement.EntitledVariantIds,d,e,"")):discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - No delta / no adjustment required")}else discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" - No adjustment required")}else discountNinja.Logging.LogInformation("EvaluateBOGOProductEligibility - Offer with token "+t.Token+" is not a BOGO/Free gift")}(n,e,t.Token,i)},ApplyPropertiesToLineItems:function(){if(!discountNinja.Cart.Shopify.IsDirty&&!discountNinja.DiscountedCart.IsDirty){let t=discountNinja.LiquidData.ItemsInCartWithoutProperty("DiscountNinja.");for(let e=0;e<t.length;e++){let n=discountNinja.DiscountedCart.Get(t[e].key),i=null===n?null:n.Token;discountNinja.Cart.Shopify.AddPropertiesToCartItem(t[e].key,"DiscountNinja."+(null!==n?"":"Not")+"Discounted"+(i?"."+i:""),"")}}},ApplyPromotion:function(t,e,n){try{if(null===t)return;if(discountNinja.Logging.LogInformation("FLOW: Applying offer"),discountNinja.DiscountCode.Add(t.Token,e,n,t.Entitlement.TargetType),discountNinja.Timer.ShouldStartOnAccept(t))discountNinja.Timer.Start(t);else if(discountNinja.Timer.ShouldStartOnGoalAchieved(t)){discountNinja.DiscountTier.GoalAchieved(t)&&discountNinja.Timer.Start(t)}discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger,1),"shipping_line"!==t.Entitlement.TargetType&&"across"!==t.Entitlement.AllocationMethod||discountNinja.PromotionEvent.AddToQueue(t.TriggeredByTrigger,2)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ApplyPromotion",t)}},ShowHideElementsWhenPromotionsInCart:function(){function t(t,e){let n=e?t+"hide":t+"show";jQuery(e?t+"show":t+"hide").show(),jQuery(n).hide()}let e=".limoniapps-discountninja-when";t(e+"activepromotions-",discountNinja.DiscountedCart.HasActivePromotions()),t(e+"promotionsincart-",discountNinja.DiscountedCart.HasAppliedPromotions()),t(e+"cartdiscounted-",discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.total_discount>0)},StopFlow:function(){discountNinja.Logging.LogInformation("FLOW: Stopped",!0,!1),discountNinja.DiscountedCart.BuildDiscountedCart(function(){if(discountNinja.PromotionFlow.DisplayAppliedOffers(),discountNinja.Offer.Offers){for(let t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja_Script_PromotionFlow.EvaluateBOGOProductEligibility(discountNinja.Offer.Offers[t]);discountNinja.PromotionFlow.ProcessCartAdjustments()}}),discountNinja_Script_PromotionFlow.ShowHideElementsWhenPromotionsInCart(),discountNinja_Script_PromotionFlow.ProcessWriteInDiscountCodes(),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml()},ProcessWriteInDiscountCodes:function(){let t=discountNinja.DiscountedCart.GetAppliedPromotions();if(t)for(let e=0;e<t.length;e++){let n=t[e];if("native"===n.ShareableLink||"queryparameter"===n.ShareableLink){let t=!1;if(discountNinja.Offer.Offers&&!t)for(let e=0;e<discountNinja.Offer.Offers.length;e++)if(!t){let i=discountNinja.Offer.Offers[e];for(let e=0;e<i.Tiers.length;e++){if(i.Tiers[e].DiscountCode.Code===n.DiscountCode){t=!0;break}}}t||discountNinja.DiscountCode.AddDiscountCodeFromLookup(n.DiscountCode)}}},IsBuildingBlockEnabledForPage:function(t,e,n){if(""!==e||t||(e=n+" is disabled"),""===e&&discountNinja.Environment.Shopify.IsProductPage()&&"*"!==t.ShowOn.Products){let i=discountNinja.Environment.Shopify.ProductHandle();discountNinja.Utilities.StringIsIn(t.ShowOn.Products,i)||(e=n+" is not displayed because it is disabled for product pages or not enabled for product "+i+" (limited to: "+t.ShowOn.Products+")")}if(""===e&&discountNinja.Environment.Shopify.IsHomePage()&&!t.ShowOn.HomePage&&(e=n+" is not displayed because it is disabled for the home page"),""===e&&discountNinja.Environment.Shopify.IsBlogPost()&&!t.ShowOn.BlogPosts&&(e=n+" is not displayed because it is disabled for blog posts"),""===e&&discountNinja.Environment.Shopify.IsCollectionPage()&&"*"!==t.ShowOn.Collections){let i=discountNinja.Environment.Shopify.CollectionHandle();discountNinja.Utilities.StringIsIn(t.ShowOn.Collections,i)||(e=n+" is not displayed because it is disabled for collection pages or not enabled for collection "+i+" (limited to: "+t.ShowOn.Collections+")")}return""===e&&discountNinja.Environment.Shopify.IsCustomPage()&&!t.ShowOn.CustomPages&&(e=n+" is not displayed because it is disabled for custom pages"),""===e&&discountNinja.Environment.Shopify.IsCartPage()&&!t.ShowOn.CartPage&&(e=n+" is not displayed because it is disabled for cart page"),e},HandleFlowErrorMessage:function(t,e){return!t||""===t||(e?discountNinja.Logging.LogTestMode(t,null,!0,!1,!1):discountNinja.Logging.LogVerbose(t),!1)},HasPopUpBeenShownForLevel:function(t){let e=t.Token;return"shown"===function(t){return discountNinja.Cache.LocalGet("popup-displayed-"+t)}(e)&&"onceperdevice"===t.PopUp.Frequency?(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+e+", because it has already been shown on this device. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0):"shown"===function(t){return discountNinja.Cache.SessionGet("popup-displayed-"+t)}(e)&&"oncepersession"===t.PopUp.Frequency&&(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+e+", because it has already been shown during this session. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0)}},discountNinja_Script_Settings={Settings:null,GetPriceFormat:function(t,e,n){let i=function(t,e,n){let i=discountNinja_Script_Settings.Settings.PriceUpdate.PriceFormat;return"item-product"===t?e?i.DrawerCartProduct||i.Product:i.CartProduct||i.Product:"item-line"===t?e?i.DrawerCartLine||i.Product:i.CartLine||i.Product:"subtotal"===t?e?i.DrawerCartSubtotal||i.Product:i.CartSubtotal||i.Product:"standard"===t?(null==n&&(n=discountNinja.Environment.Shopify.IsProductPage()),!0===n?i.Product:i.Other||i.Product):(discountNinja.Logging.LogWarning("GetPriceFormat - Unexpected level '"+t+"'",!0),i.Product)}(t,e,n);return i||(i={Format:"{{DISCOUNTED_PRICE}} {{ORIGINAL_PRICE,STRIKETHROUGH}}"}),null!==(o=i)&&null!==o.Format&&(o.Format&&(o.Format=o.Format.replace(/\\{/g,"{").replace(/\\}/g,"}")),o.PrefixText&&(o.PrefixText=o.PrefixText.replace(/\\{/g,"{").replace(/\\}/g,"}")),o.SuffixText&&(o.SuffixText=o.SuffixText.replace(/\\{/g,"{").replace(/\\}/g,"}"))),o;var o},SettingsAreValid:function(t){try{return null==t?(discountNinja.Logging.LogWarning("No settings available",!0),!1):(discountNinja.Logging.LogVerbose("Settings valid"),!0)}catch(t){discountNinja.Logging.LogError("Settings.SettingsAreValid",t)}},GetFlag:function(t){try{return"object"!=typeof window.discountNinjaContext.Flags?null:window.discountNinjaContext.Flags[t]}catch(t){return discountNinja.Logging.LogError("Settings.GetFlag",t),null}}};const discountNinja_Script_ShortCode_Prefix_ClassName="limoniapps-discountninja-shortcode",discountNinja_Script_ShortCode_Prefix_Attribute="data-limoniapps-discountninja-shortcode",discountNinja_Script_ShortCode_Product_Attribute="data-limoniapps-discountninja-product";var discountNinja_Script_ShortCode={Attributes:{Offer:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer",OfferToken:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer-token",Product:discountNinja_Script_ShortCode_Prefix_Attribute+"-product"},Classes:{Placeholder:discountNinja_Script_ShortCode_Prefix_ClassName+"-placeholder"},HideShortcodePlaceholders:function(){try{jQuery("."+discountNinja_Script_ShortCode.Classes.Placeholder).css("display","none")}catch(t){discountNinja.Logging.LogError("ShortCode.HideShortcodePlaceholders",t)}},ShowShortcodePlaceholders:function(){try{let t="."+discountNinja_Script_ShortCode.Classes.Placeholder;jQuery(t).each(function(){jQuery(this).html(discountNinja_Script_ShortCode.ReplaceAllPlaceHolders(jQuery(this).html()))}),jQuery(t).css("display","block")}catch(t){discountNinja.Logging.LogError("ShortCode.ShowShortcodePlaceholders",t)}},RefreshResolvedPlaceholders:function(t,e,n){try{discountNinja.Logging.LogVerbose("Refreshing all resolved placeholders");let i=discountNinja_Script_ShortCode.Attributes.Offer,o=discountNinja_Script_ShortCode.Attributes.OfferToken;jQuery(t).find("["+i+"]").each(function(){let t="{{"+jQuery(this).attr(i)+"}}",r=e?e.Token:jQuery(this).attr(o);if(e||(e=discountNinja.Offer.GetOfferByToken(r)),!n){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(e);n=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t)}discountNinja.Logging.LogVerbose("Refreshing shortcode "+t+" context: offer "+r),jQuery(this).html(discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(e,t,!1))});let r=discountNinja_Script_ShortCode.Attributes.Product;jQuery(t).find("["+r+"]").each(function(){let t="{{"+jQuery(this).attr(r)+"}}";jQuery(this).attr(discountNinja_Script_ShortCode_Product_Attribute)===n.ProductHandle&&(discountNinja.Logging.LogVerbose("Refreshing shortcode "+t),jQuery(this).html(discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(t,n,!1)))}),discountNinja.MultiCurrency.UpdateCurrency()}catch(t){discountNinja.Logging.LogError("ShortCode.RefreshResolvedPlaceholders",t)}},BuildResolvedPlaceHolderLink:function(t,e,n,i,o,r,a,c,s,u,d,l){try{if(discountNinja_Script_ShortCode.ContainsPlaceHolder(n,"{{"+o+"}}"))return discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,"{{"+o+"}}",r,a,c,u,d,l);{let c="<a class='limoniapps-targetlink' href='"+c+"'>"+n.match(/\{\{([^\0}])*\}\}/)[0].replace(/{/g,"").replace(/}/g,"").match(/\,([^\}])*/)[0].substring(1)+"</a>";return discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,"{{"+o+"}}",r,a,c,u,d,l)}}catch(t){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderLink",t),n}},BuildResolvedPlaceHolderAmount:function(t,e,n,i,o,r,a,c,s,u,d,l,g,f,p,m,h){function j(t,e,n,i,o,r,a,c,s,u,d,l,g,f,m,h,j,N){let y=function(t,e){return e?"{{"+t.replace("{{","").replace("}}","")+","+e+"}}":t}(o,r);return discountNinja_Script_ShortCode.ContainsPlaceHolder(n,y)&&(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,y,c,s,discountNinja.Utilities.FormatMoney(u,d,m,h,a,N),p,j,!0,a),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,"<del>"+y+"</del>",c,s,discountNinja.Utilities.FormatMoney(u,l,m,h,!0,N),p,j,!0,a)),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,"<strike>"+y+"</strike>",c,s,discountNinja.Utilities.FormatMoney(u,l,m,h,!0,N),p,j,!0,a)),a||(n=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,e,n,i,"<s>"+y+"</s>",c,s,discountNinja.Utilities.FormatMoney(u,l,m,h,!0,N),p,j,!0,a))),n}try{return void 0===c?n:(discountNinja_Script_ShortCode.ContainsPlaceHolder(n,o)&&(n=j(t,e,n,i,o,"",!1,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"NO_DECIMALS",!1,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"NO_CURRENCY",!1,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"NO_DECIMALS,NO_CURRENCY",!1,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"STRIKETHROUGH",!0,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"STRIKETHROUGH,NO_DECIMALS",!0,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"STRIKETHROUGH,NO_CURRENCY",!0,r,a,c,s,u,0,0,g,f,m,h),n=j(t,e,n,i,o,"STRIKETHROUGH,NO_DECIMALS,NO_CURRENCY",!0,r,a,c,s,u,0,0,g,f,m,h)),n)}catch(t){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderAmount",t),n}},BuildResolvedPlaceHolder:function(t,e,n,i,o,r,a,c,s,u,d,l){if(void 0===c)return n;let g="",f=d?'<span class="money">'+c+"</span>":c,p=null==a?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+a+(l?" limoniapps-discountninja-strikethrough":"")+(null==u?"":" "+u)+'" ',m=discountNinja_Script_ShortCode.Attributes.OfferToken,h=t?" "+m+'="'+t.Token+'" ':"",j="product"===r?" "+discountNinja_Script_ShortCode_Product_Attribute+'="'+e.ProductHandle+'" ':"",N=(g=i?"<span "+p+discountNinja_Script_ShortCode_Prefix_Attribute+"-"+r+'="'+o.replace("{{","").replace("}}","")+'"'+h+j+">"+f+"</span>":f).toString().replace("$","$$$");return n.toString().replace(new RegExp(o,"g"),N)},ReplacePromotionLevelPlaceHolders:function(t,e,n){try{if(void 0===e||""===e||null===e)return e;discountNinja.Logging.LogVerbose("Replacing offer level placeholders");let i=discountNinja.Settings.Settings.CountdownClock,o=window.discountNinjaContext.Labels.Here,r=discountNinja.Currency.GetCurrencyFormat(),a=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(r),c=discountNinja.Utilities.GetCurrencyFormatAmountComponent(r),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=2,d=i.FormattingTemplateOnDate,l=i.FormattingTemplateOnTime,g=discountNinja.DateTime,f="",p="",m=t.TriggeredByTrigger?t.TriggeredByTrigger.Schedule.EndsOnDate:null;if(m){let t=g.GetUtc(m);f=g.FormatDate(t,d),p=g.FormatDate(t,l)}let h="",j="",N=t.TriggeredByTrigger&&t.TriggeredByTrigger.CountdownClock?t.TriggeredByTrigger.CountdownClock.EndsAt:m;if(N){let t=g.GetUtc(N);h=g.FormatDate(t,d),j=g.FormatDate(t,l)}let y=discountNinja.DiscountedCart.DiscountedCart,C=0;y&&y.total_discount&&(C=100*y.total_discount);let S=0,_=0;y&&(_=100*y.total_original_price),C>0&&_>0&&(S=100*Math.min(C/_,100));let L=0,P=0;if(y){if(y.items)for(let e=0;e<y.items.length;e++){let n=y.items[e];n.OfferToken===t.Token&&"line_item"===n.TargetType&&(L+=100*n.Line.EffectiveAmount)}if(y.CartLevelDiscounts)for(let e=0;e<y.CartLevelDiscounts.length;e++){let n=y.CartLevelDiscounts[e];n.OfferToken===t.Token&&(L+=100*n.Amount)}}L>0&&_>0&&(P=100*Math.min(L/_,100));let v=discountNinja.DiscountTier.GetCurrentDiscountTier(t);null===v&&(v=t.Tiers[0]);let T=discountNinja.DiscountTier.GetGoalDiscountTier(t);null===T&&(T=t.Tiers[0]);let D=0,b=0,E=0;if(T&&T.Prerequisite&&T.Prerequisite.MaximumAmount>0&&(E=T.Prerequisite.MaximumAmount),T&&T.Prerequisite&&T.Prerequisite.MinimumAmount>0){(D=(100*(b=T.Prerequisite.MinimumAmount)-discountNinja.Offer.PrerequisiteItemsCartValue(t))/100)<0&&(D=0)}let k=0,O=0,I=0;if(T&&T.Prerequisite&&T.Prerequisite.MaximumItems&&(I=T.Prerequisite.MaximumItems),T&&T.Prerequisite&&T.Prerequisite.BogoPrerequisiteQuantity){(k=(O=T.Prerequisite.BogoPrerequisiteQuantity)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,T))<0&&(k=0)}else if(T&&T.Prerequisite&&T.Prerequisite.MinimumItems){(k=(O=T.Prerequisite.MinimumItems)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,T))<0&&(k=0)}v&&v.Entitlement&&v.Entitlement.Percentage,v&&v.Entitlement&&v.Entitlement.Amount;let w=t.Tiers[t.Tiers.length-1],A=w?w.Entitlement:null,F=v&&v.Entitlement?v.Entitlement.EntitledQuantity:null,R=discountNinja.Prerequisite.EntitledQuantity(t,v)||F;return discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_ITEMS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MAXIMUM_ITEMS}}","offer","maximum_items",t.EntitledQuantity||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"ENTITLED_QUANTITY")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{ENTITLED_QUANTITY}}","offer","entitled_quantity",R||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MINIMUM_CART_VALUE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{MINIMUM_CART_VALUE}}","offer","minimum_cart_value",100*b,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_CART_VALUE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{MAXIMUM_CART_VALUE}}","offer","maximum_cart_value",100*E,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"AMOUNT_LEFT_BEFORE_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{AMOUNT_LEFT_BEFORE_DISCOUNT}}","offer","amount_left_before_discount",100*D,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MINIMUM_CART_PRODUCTS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MINIMUM_CART_PRODUCTS}}","offer","minimum_cart_products",O)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_CART_PRODUCTS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MAXIMUM_CART_PRODUCTS}}","offer","maximum_cart_products",I)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"PRODUCTS_LEFT_BEFORE_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{PRODUCTS_LEFT_BEFORE_DISCOUNT}}","offer","products_left_before_discount",k)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"DISCOUNT_CODE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{DISCOUNT_CODE}}","offer","discount_code",discountNinja.Offer.GetPromotionDiscountCode(t))),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"ENDS_AT_DATE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{ENDS_AT_DATE}}","offer","ends_at_date",f)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"ENDS_AT_TIME")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{ENDS_AT_TIME}}","offer","ends_at_time",p)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"EXPIRES_AT_DATE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{EXPIRES_AT_DATE}}","offer","expires_at_date",h)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"EXPIRES_AT_TIME")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{EXPIRES_AT_TIME}}","offer","expires_at_time",j)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"OFFER_LINK_HERE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{OFFER_LINK_HERE}}","offer","offer_link_here","<a class='limoniapps-targetlink' href='"+t.Entitlement.EntitledItemLinks+"'>"+o+"</a>")),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"OFFER_LINK")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,e,n,"OFFER_LINK","offer","offer_link",t.Entitlement.EntitledItemLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"PREREQUISITE_LINK")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,e,n,"PREREQUISITE_LINK","offer","prerequisite_link",t.Prerequisite.PrerequisiteLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"PREREQUISITE_EXCLUSIONS_LINK")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,e,n,"PREREQUISITE_EXCLUSIONS_LINK","offer","prerequisite_exclusions_link",t.Prerequisite?t.Prerequisite.PrerequisiteExclusionLinks:"")),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MINIMUM_PREREQUISITE_PRODUCTS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MINIMUM_PREREQUISITE_PRODUCTS}}","offer","minimum_prerequisite_products",T.Prerequisite?T.Prerequisite.BogoPrerequisiteQuantity:0)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"EXCLUSIONS_LINK")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderLink(t,null,e,n,"EXCLUSIONS_LINK","offer","exclusions_link",t.Entitlement.ExcludeCollectionLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_GIFTS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MAXIMUM_GIFTS}}","offer","maximum_gifts",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_DISCOUNTED_ITEMS")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MAXIMUM_DISCOUNTED_ITEMS}}","offer","maximum_discounted_items",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"TOTAL_DISCOUNT_CODES")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{TOTAL_DISCOUNT_CODES}}","offer","total_discount_codes",t.UsageLimit?t.UsageLimit.Total:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"REMAINING_DISCOUNT_CODES")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{REMAINING_DISCOUNT_CODES}}","offer","remaining_discount_codes",t.UsageLimit?t.UsageLimit.Remaining:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"USED_DISCOUNT_CODES")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{USED_DISCOUNT_CODES}}","offer","used_discount_codes",t.UsageLimit&&t.UsageLimit.Total&&t.UsageLimit.Remaining?t.UsageLimit.Total-t.UsageLimit.Remaining:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"OFFER_TOTAL_DISCOUNT_AMOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{OFFER_TOTAL_DISCOUNT_AMOUNT}}","offer","offer_total_discount_amount",L,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"OFFER_TOTAL_DISCOUNT_PERCENTAGE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{OFFER_TOTAL_DISCOUNT_PERCENTAGE}}","offer","offer_total_discount_percentage",discountNinja.Utilities.FormatPercentage(P,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"TOTAL_DISCOUNT_AMOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{TOTAL_DISCOUNT_AMOUNT}}","offer","total_discount_amount",C,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"TOTAL_DISCOUNT_PERCENTAGE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{TOTAL_DISCOUNT_PERCENTAGE}}","offer","total_discount_percentage",discountNinja.Utilities.FormatPercentage(S,0)+"%")),v&&(t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"DISCOUNT_PERCENTAGE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{DISCOUNT_PERCENTAGE}}","offer","discount_percentage",discountNinja.Utilities.FormatPercentage(v.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"DISCOUNT_AMOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{DISCOUNT_AMOUNT}}","offer","discount_amount",100*v.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0)),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{DISCOUNT}}","offer","discount",discountNinja.Utilities.FormatPercentage(v.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{DISCOUNT}}","offer","discount",100*v.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0))),T&&(t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"NEXT_GOAL_DISCOUNT_PERCENTAGE")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}","offer","next_goal_discount_percentage",discountNinja.Utilities.FormatPercentage(T.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"NEXT_GOAL_DISCOUNT_AMOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{NEXT_GOAL_DISCOUNT_AMOUNT}}","offer","next_goal_discount_amount",100*T.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0)),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"NEXT_GOAL_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",discountNinja.Utilities.FormatPercentage(T.Entitlement.Percentage,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"NEXT_GOAL_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",100*T.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0))),t&&t.Entitlement&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",discountNinja.Utilities.FormatPercentage(A?A.Percentage:0,0)+"%")),t&&t.Entitlement&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"MAXIMUM_DISCOUNT")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",100*(A?A.Amount:0),r,a,c,s,u,!1,null,null,!0)),e=(e=(e=(e=(e=(e=e.replace(/{{TIMER}}/g,'<span class="limoniapps-discountninja-timer" data-style="1"></span>')).replace(/{{TIMER,STYLE1}}/g,'<span class="limoniapps-discountninja-timer" data-style="1""></span>')).replace(/{{TIMER,STYLE2}}/g,'<span class="limoniapps-discountninja-timer" data-style="2""></span>')).replace(/{{TIMER,STYLE3}}/g,'<span class="limoniapps-discountninja-timer" data-style="3""></span>')).replace(/{{TIMER,STYLE4}}/g,'<span class="limoniapps-discountninja-timer" data-style="4""></span>')).replace(/{{TIMER,STYLE5}}/g,'<span class="limoniapps-discountninja-timer" data-style="5""></span>')}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplacePromotionLevelPlaceHolders",t),e}},ReplaceProductLevelPlaceHolders:function(t,e,n,i){function o(t,e,n,i){return' style="'+(t?"color: "+t+" !important;":"")+(e?"font-size: "+e+"px !important;":"")+(n?"font-weight: "+n+" !important;":"")+(i?i+";":"")+'" '}try{if(i||(i="standard"),void 0===t||""===t||null===t)return t;discountNinja.Logging.LogVerbose("Replacing product level placeholders");let r=discountNinja.Currency.GetCurrencyFormat(),a=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(r),c=discountNinja.Utilities.GetCurrencyFormatAmountComponent(r),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=2,d=e.OriginalCompareAtPrice>e.OriginalPrice?e.Amount+e.OriginalCompareAtPrice-e.OriginalPrice:e.Amount,l=d/e.OriginalCompareAtPrice*100,g=function(t){return o(discountNinja.Settings.GetPriceFormat(t).DiscountedPriceColor,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontSize,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceCustomCss)}(i),f=function(t){return o(discountNinja.Settings.GetPriceFormat(t).OriginalPriceColor,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontSize,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).OriginalPriceCustomCss)}(i),p=discountNinja.Settings.GetPriceFormat(i).DiscountedPriceCssClasses,m=discountNinja.Settings.GetPriceFormat(i).OriginalPriceCssClasses;return e&&void 0!==e.CompareAtAmount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{AMOUNT_COMPAREAT}}","product","amount_compareat",100*e.CompareAtAmount,r,a,c,s,u,!1,null,null,!0)),e&&void 0!==e.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{DISCOUNTED_PRICE}}","product","discounted_price",100*e.DiscountedPrice,r,a,c,s,u,!1,g,p,!0)),e&&void 0!==e.OriginalPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{ORIGINAL_PRICE}}","product","original_price",100*e.OriginalPrice,r,a,c,s,u,!1,f,m,!0)),e&&void 0!==e.OriginalCompareAtPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_COMPAREAT_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{ORIGINAL_COMPAREAT_PRICE}}","original_compareat_price","amount",100*e.OriginalCompareAtPrice,r,a,c,s,u,!1,f,m,!0)),e&&void 0!==e.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}","product","discounted_price_afterpay_installment",100*e.DiscountedPrice/4,r,a,c,s,u,!1,g,p,!0)),e&&void 0!==e.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{DISCOUNT_AMOUNT}}","product","discount_amount",100*e.Amount,r,a,c,s,u,!1,null,null,!0)),e&&void 0!==e.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,e,t,n,"{{DISCOUNT_PERCENTAGE}}","product","discount_percentage",discountNinja.Utilities.FormatPercentage(e.Percentage,0)+"%")),e&&void 0!==e.Percentage&&e.Percentage>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,e,t,n,"{{DISCOUNT}}","product","discount",discountNinja.Utilities.FormatPercentage(e.Percentage,0)+"%")),e&&void 0!==e.Amount&&e.Amount>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{DISCOUNT}}","product","discount",100*e.Amount,r,a,c,s,u,!1,null,null,!0)),e&&void 0!==e.CompareAtAmount&&void 0!==e.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,e,t,n,"{{DISCOUNT_AMOUNT_COMPAREAT}}","product","discount_amount_compareat",d,r,a,c,s,u,!1,null,null,!0)),e&&void 0!==e.CompareAtAmount&&void 0!==e.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,e,t,n,"{{DISCOUNT_PERCENTAGE_COMPAREAT}}","product","discount_percentage_compareat",discountNinja.Utilities.FormatPercentage(l,0)+"%")),t}catch(t){discountNinja.Logging.LogError("ShortCode.ReplaceProductLevelPlaceHolders",t)}},ContainsPlaceHolder:function(t,e){try{return""!==t&&null!=t&&t.indexOf(e.replace("{{","").replace("}}",""))>-1}catch(t){return!1}},ReplaceAllPlaceHolders:function(t,e,n,i){return e=function(e,n){try{if(""===e||null==e)return e;discountNinja.Logging.LogVerbose("Replacing settings level placeholders");let i=discountNinja.Currency.GetCurrencyFormat(),o=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(i),r=discountNinja.Utilities.GetCurrencyFormatAmountComponent(i),a=discountNinja.Utilities.GetCurrencyFormatAmountComponent(o),c=2,s=0;window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.total_price&&(s=window.discountNinjaContext.Cart.total_price);let u=0,d=0,l=discountNinja.DiscountedCart.DiscountedCart;l&&(u=100*l.total_original_price),l&&(d=100*l.total_discounted_price);let g=0;d>0&&u>0&&(g=100*Math.min(d/u,100));let f=discountNinja.Settings.Settings.Currency;if(discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{CURRENCY}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{CURRENCY}}","offer","currency",f.BaseCurrency)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{CURRENCY_SYMBOL}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,null,e,n,"{{CURRENCY_SYMBOL}}","offer","currency_symbol",f.BaseCurrencySymbol)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{TOTAL_PRICE}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{TOTAL_PRICE}}","offer","total_price",s,i,o,r,a,c,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{SUBTOTAL}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{SUBTOTAL}}","offer","subtotal",u,i,o,r,a,c,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{DISCOUNTED_SUBTOTAL}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{DISCOUNTED_SUBTOTAL}}","offer","discounted_subtotal",d,i,o,r,a,c,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{DISCOUNT_PERCENTAGE_SUBTOTAL}}")&&(e=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,null,e,n,"{{DISCOUNT_PERCENTAGE_SUBTOTAL}}","offer","discount_percentage_subtotal",g,i,o,r,a,c,!1,null,null,!1)),e=(e=(e=(e=(e=e.replace(/{{NEW_LINE}}/g,"<br>")).replace(/{{DISCOUNT_ICON}}/g,'<svg class="limoniapps-discountninja-icon-discount" aria-hidden="true" focusable="false"> <use xlink:href="#tags-filled">#shadow-root (closed)<svg id="tags-filled"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg></svg></use></svg>')).replace(/{{SHIPPING_ICON}}/g,String.fromCodePoint("0x1f69a"))).replace(/{{GIFT_ICON}}/g,String.fromCodePoint("0x1f381"))).replace(/{{DISCOUNT_PERCENTAGE_ICON}}/g,'<svg class="limoniapps-discountninja-icon-coupon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.a{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5px;}</style></defs><title>icon-coupon</title><line class="a" x1="6.75" y1="17.25" x2="17.25" y2="6.75"></line><circle class="a" cx="8.25" cy="8.25" r="1.5"></circle><circle class="a" cx="15.75" cy="15.75" r="1.5"></circle><path class="a" d="M.75,3.75V2.25A1.5,1.5,0,0,1,2.25.75h1.5"></path><path class="a" d="M3.75,23.25H2.25a1.5,1.5,0,0,1-1.5-1.5v-1.5"></path><line class="a" x1="0.75" y1="7.5" x2="0.75" y2="10.5"></line><line class="a" x1="0.75" y1="13.5" x2="0.75" y2="16.5"></line><line class="a" x1="23.25" y1="7.5" x2="23.25" y2="10.5"></line><line class="a" x1="7.5" y1="0.75" x2="10.5" y2="0.75"></line><path class="a" d="M23.25,20.25v1.5a1.5,1.5,0,0,1-1.5,1.5h-1.5"></path><line class="a" x1="23.25" y1="16.5" x2="23.25" y2="13.5"></line><line class="a" x1="16.5" y1="23.25" x2="13.5" y2="23.25"></line><line class="a" x1="13.5" y1="0.75" x2="16.5" y2="0.75"></line><path class="a" d="M20.25.75h1.5a1.5,1.5,0,0,1,1.5,1.5v1.5"></path><line class="a" x1="10.5" y1="23.25" x2="7.5" y2="23.25"></line></svg>'),discountNinja_Script_ShortCode.ContainsPlaceHolder(e,"{{OFFER_COUNT}}")){let t=discountNinja.Notification.GetFromCache()||[];e=e.replace(/{{OFFER_COUNT}}/g,t.length)}return e}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",t),e}}(e,!0),t&&(e=discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(t,e,!0)),n&&(e=discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(e,n,!0,i)),e}},discountNinja_Script_TabReminder={Set:function(){try{let t=discountNinja.Cache.SessionGet("toggletabtitle");null!==t&&"off"!==t||(discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),function t(){try{if(!discountNinja.DynamicPricing.HasActiveDiscountCode())return;let e=discountNinja.Cache.SessionGet("tabtitle");null===e&&(e=document.title,discountNinja.Cache.SessionSet("tabtitle",e)),"visible"===document.visibilityState&&discountNinja.Cache.SessionSet("toggletabtitle","off"),"on-state1"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="âœ‹ Promotion active! "+e,discountNinja.Cache.SessionSet("toggletabtitle","on-state2"),setTimeout(function(){t()},2500)):"on-state2"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="â˜ž Don't forget! "+e,discountNinja.Cache.SessionSet("toggletabtitle","on-state3"),setTimeout(function(){t()},2500)):"on-state3"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="â˜Ÿ Collect discount! "+e,discountNinja.Cache.SessionSet("toggletabtitle","on-state4"),setTimeout(function(){t()},2500)):"on-state4"===discountNinja.Cache.SessionGet("toggletabtitle")&&(document.title=e,discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),setTimeout(function(){t()},5e3))}catch(t){discountNinja.Logging.LogError("TabReminder.ToggleTabReminder",t)}}())}catch(t){discountNinja.Logging.LogError("TabReminder.Set",t)}},Remove:function(){try{discountNinja.Cache.SessionSet("toggletabtitle","off");let t=discountNinja.Cache.SessionGet("tabtitle");null!==t&&(document.title=t)}catch(t){discountNinja.Logging.LogError("TabReminder.Remove",t)}}},discountNinja_Script_TestMode={TestModeDynamicStylesAdded:!1,TestMode:!1,MatchByTokenOnly:!1,TestModeToken:null,TestModeOutput:[],TestModeOutputIssue:!1,ShowTestModeOutput:function(){try{if(!1===discountNinja_Script_TestMode.TestMode)return;let t=function(t,e){let n="";if(null===t||!1===e)n+="<br/><span style='color:green;'><i class='fa fa-thumbs-o-up' aria-hidden='true'></i> No issues found</span>";else{n="<br/><strong>Remarks:</strong><br>";for(let e=0;e<t.length;e++)n+=t[e]}return n+="<br/><span style='font-size:14px;'><strong>Note</strong> This message is not visible for your visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/test-mode-output' target='_blank'>here</a>.</span>"}(discountNinja_Script_TestMode.TestModeOutput,discountNinja_Script_TestMode.TestModeOutputIssue);discountNinja_Script_TestMode.TestModeOutput=[],function(t){try{LimoniAppsLoadJQuery(function(){LimoniAppsLoadJQueryNotify(function(){jQuery(".alert-limoniapps-notification-testmodeoutput").remove();let e=jQuery.notify({icon:"fa fa-info-circle",title:"Discount Ninja (v"+discountNinja.Core.Version+")<br>Test mode output",message:t},{type:"limoniapps-notification-testmodeoutput",placement:{from:"top",align:"left"},delay:0,animate:{enter:"animate fadeInBottom",exit:"animate fadeOutBottom"}});void 0===jQuery(e)[0].$ele&&discountNinja.Logging.LogVerbose("Cannot show test output, Bootstrap Notify may not be registered correctly")})})}catch(t){discountNinja.Logging.LogError("TestMode.ShowTestModeNotificationMessage",t)}}(t)}catch(t){discountNinja.Logging.LogError("TestMode.ShowTestModeOutput",t)}},HandleQueryParameter:function(){let t="discountninja";discountNinja_Script_TestMode.MatchByTokenOnly=discountNinja.QueryParameter.GetFlag(t+"tokenonly",!0,!0,!1,!0);let e=discountNinja.QueryParameter.GetFlag(t+"testmode",!0,!0,!1,!0);discountNinja_Script_TestMode.TestMode="true"===e||!0===e,discountNinja_Script_TestMode.TestModeToken=discountNinja.QueryParameter.GetFlag(t+"testmodetoken",!0,!0,null,!1)}},discountNinja_Script_Token={RemoveSavedToken:function(){try{discountNinja.Cache.SessionRemove("savedtoken")}catch(t){return discountNinja.Logging.LogError("Token.RemoveSavedToken",t),""}},GetTokenFromQueryParameter:function(){try{let t=discountNinja.QueryParameter.Get("token");return t?t.toUpperCase():function(){try{let t=discountNinja.Cache.SessionGet("savedtoken");return t?t.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetSavedToken",t),""}}()}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromQueryParameter",t),""}},GetTokenFromPromotionOrQueryParameter:function(t){try{let e=null;return(t=t||discountNinja.Offer.PrimaryOffer)&&(e=t?t.Token:null),null===e&&(e=discountNinja_Script_Token.GetTokenFromQueryParameter()),e?e.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromPromotionOrQueryParameter ",t,!1),""}},GetCartToken:function(t){try{let e=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==e&&""!==e||(e=discountNinja_Script_Token.GetCartTokenFromLocalStorage()),e?e.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetCartToken ",t,!1),""}},GetNonAutomaticToken:function(t){try{let e=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==e&&""!==e||(e=discountNinja_Script_Token.GetNonAutomaticTokenFromSession()),e?e.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetNonAutomaticToken ",t,!1),""}},GetToken:function(t){try{let e=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==e&&""!==e||(e=discountNinja_Script_Token.GetTokenFromLocalStorage()),e?e.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetToken ",t,!1),""}},GetTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-device")},SetTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-device",t)},RemoveCartTokenFromLocalStorage:function(){discountNinja.Cache.LocalRemove("token-cart-device")},GetCartTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-cart-device")},SetCartTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-cart-device",t)},GetNonAutomaticTokenFromSession:function(){return discountNinja.Cache.SessionGet("token-non-automatic-session")},SetNonAutomaticTokenInSession:function(t){discountNinja.Cache.SessionSet("token-non-automatic-session",t)}},discountNinja_Script_Trigger={OffersToTrigger:[],Clear:function(){try{let t=discountNinja.Offer.Triggers;if(!t)return;for(let e=0;e<t.length;e++)t[e].Triggered=!1}catch(t){discountNinja.Logging.LogError("Trigger.Clear",t)}},TriggerOffers:function(t){discountNinja_Script_Trigger.OffersToTrigger||(discountNinja_Script_Trigger.OffersToTrigger=[]),t&&(discountNinja_Script_Trigger.OffersToTrigger=discountNinja_Script_Trigger.OffersToTrigger.concat(t)),discountNinja_Script_Trigger.ProcessOffersToTrigger()},ProcessOffersToTriggerDebounced:function(){let t=discountNinja_Script_Trigger.OffersToTrigger;discountNinja_Script_Trigger.OffersToTrigger=null;let e=!0;discountNinja.PromotionFlow.ClearCartAdjustments();for(let n=0;n<t.length;n++){let i=discountNinja.Offer.GetOfferByToken(t[n].offerToken);if(i){i.TriggeredByTrigger=t[n].trigger,discountNinja.Offer.Offers||(discountNinja.Offer.Offers=[]);let o=!1;for(let t=0;t<discountNinja.Offer.Offers.length;t++)if(discountNinja.Offer.Offers[t].Token===i.Token){o=!0;break}o||discountNinja.Offer.Offers.push(i),discountNinja.PromotionFlow.ViewPromotion(i),(i.AutoAccept||discountNinja.Offer.IsOfferAccepted(i.Token,i.Frequency))&&discountNinja.PromotionFlow.AcceptPromotion(i),discountNinja.Timer.ShouldNotStart(i)&&(e=!1)}}e||discountNinja.Timer.Stop(),discountNinja.Offer.FilterPromotions(),function(){if(discountNinja.Offer.SetPrimaryOffer(),null===discountNinja.Offer.PrimaryOffer)discountNinja.Logging.LogInformation("No valid applicable offer",!1),discountNinja_Script_PromotionFlow.ShowAcceleratedCheckoutButtons(),discountNinja.PromotionFlow.StopFlow()}(),discountNinja_Script_PromotionFlow.StopFlow()},IntializeTimeOnPageCounter:function(){try{discountNinja.Cache.SessionSet("trigger-time-on-page",0),null!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&0!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&clearInterval(discountNinja_Script_Trigger.TimeOnPageCounterIntervalId),discountNinja_Script_Trigger.TimeOnPageCounterIntervalId=window.setInterval(function(){let t=discountNinja.Cache.SessionGet("trigger-time-on-page");t=!t||isNaN(t)?0:parseInt(t),discountNinja.Cache.SessionSet("trigger-time-on-page",t+1)},1e3)}catch(t){discountNinja.Logging.LogError("Trigger.IntializeTimeOnPageCounter",t)}},TrackExitIntent:function(){try{discountNinja.Cache.SessionSet("trigger-exit-intent","false");let t=discountNinja.Settings.Settings.General.ExitIntentMode;t||(t="default");ouibounce(!1,{aggressive:!0,timer:"aggressive"===t?0:1e3,delay:"aggressive"===t?150:0,sensitivity:"aggressive"===t?80:20,callback:function(){discountNinja.Logging.LogVerbose("Exit intent detected"),discountNinja.Cache.SessionSet("trigger-exit-intent","true")}})}catch(t){discountNinja.Logging.LogError("Trigger.TrackExitIntent",t)}},TrackScrollPercentage:function(){function t(){try{let t=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(100===t)return;let e=jQuery(window).height(),n=jQuery(document).height(),i=jQuery(window).scrollTop(),o=n-e,r=Math.floor(i/o*100);r>t&&discountNinja.Cache.SessionSet("trigger-scroll-percentage",r)}catch(t){return 0}}try{discountNinja.Cache.SessionSet("trigger-scroll-percentage",0),jQuery(window).on("scroll",function(){t()}),t()}catch(t){discountNinja.Logging.LogError("Trigger.TrackScrollPercentage",t)}},MarkPageAsVisited:function(){try{let t=discountNinja.Cache.SessionGet("trigger-pages-visited-list");t=null===t?[]:t.split(","),-1===jQuery.inArray(window.location.pathname,t)&&t.push(window.location.pathname);let e=t.length;discountNinja.Cache.SessionSet("trigger-pages-visited-list",t),discountNinja.Cache.SessionSet("trigger-pages-visited",e),discountNinja.Logging.LogVerbose("Pages visited: "+e)}catch(t){discountNinja.Logging.LogError("Trigger.MarkPageAsVisited",t)}},ValidForPage:function(t){try{let e=discountNinja.Settings.Settings.PopUp;if(!t.PopUp||!t.PopUp.Enabled)return!0;let n=discountNinja.PromotionFlow.IsBuildingBlockEnabledForPage(e,"","Pop-up");if(!discountNinja.PromotionFlow.HandleFlowErrorMessage(n))return!1;let i=e.ShowOn,o=t.Trigger,r="Offer will not be displayed because ";return discountNinja.Environment.Shopify.IsCustomPage()&&t.PopUp.Enabled?!!i.ShowOnCustomPages&&(!("custom"===o.CustomPagesIncluded&&!discountNinja.Utilities.StringIsIn(o.CustomPageContains,discountNinja.Environment.Shopify.CustomPageHandle()))||(discountNinja.Logging.LogTestMode(r+"the current custom page is not in the set of pages to include",null,!0,!0,!1),!1)):discountNinja.Environment.Shopify.IsBlogPost()&&t.PopUp.Enabled?!!i.ShowOnBlogPosts&&("blogequals"!==o.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(o.BlogEquals,discountNinja.Environment.Shopify.BlogHandle())?("postcontains"!==o.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(o.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle()))&&!("blogandpostcontains"===o.BlogPostsIncluded&&!discountNinja.Utilities.StringIsIn(o.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle())&&!discountNinja.Utilities.StringIsIn(o.BlogEquals,discountNinja.Environment.Shopify.BlogHandle()))||(discountNinja.Logging.LogTestMode(r+"the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1):(discountNinja.Logging.LogTestMode(r+"the current blog is not in the set of blogs to include",null,!0,!0,!1),!1)):!discountNinja.Environment.Shopify.IsCollectionPage()||!t.PopUp.Enabled||!!i.ShowOnCollectionPages&&("overrideinclude"!==o.TargetCollectionHandleMode||discountNinja.Utilities.StringIsIn(o.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())?"overrideexclude"!==o.TargetCollectionHandleMode||!discountNinja.Utilities.StringIsIn(o.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())||(discountNinja.Logging.LogTestMode(r+"the current collection page is in the set of overriden collections to exclude",null,!0,!0,!1),!1):(discountNinja.Logging.LogTestMode(r+"the current collection page is not in the set of overriden collections to include",null,!0,!0,!1),!1))}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggersOnPage",t)}},FilterConditionsAreMet:function(t){let e=t.Filter;return function(t){let e=discountNinja.DateTime,n=!0===discountNinja.TestMode.TestMode&&t.Token===discountNinja.Token.GetNonAutomaticTokenFromSession();if(null!==t.StartsAt&&void 0!==t.StartsAt&&""!==t.StartsAt&&e.DiffInSeconds(e.UtcNow(),e.GetUtc(t.StartsAt))<0){if(!n)return!1;discountNinja.Logging.LogTestMode("Promotion would normally not be displayed because the start date ("+t.StartsAt+") of the promotion is in the future, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-offer-automatically' target='_blank'>here</a>.",null,!0,!0,!1)}return!(void 0!==t.EndsAt&&null!==t.EndsAt&&""!==t.EndsAt&&e.DiffInSeconds(e.UtcNow(),e.GetUtc(t.EndsAt))>=0)}(t)&&function(e){let n=!0===discountNinja.TestMode.TestMode&&t.Token===discountNinja.Token.GetTokenFromQueryParameter(),i=("guests"===e.CustomerType||e.CustomerType,"signedin"===e.CustomerType||"all"===e.CustomerType);if("none"===e.CustomerType&&(discountNinja.Logging.LogTestMode("Trigger will not be activated outside of test mode. Please enable your trigger for guests and/or signed in visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if(e.CustomerType&&"signedin"===e.CustomerType&&!discountNinja.Environment.Shopify.IsCustomer()){if(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because it is restricted to signed in visitors only and you are a guest, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n)return!1}else if("guests"===e.CustomerType&&discountNinja.Environment.Shopify.IsCustomer()&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because it is restricted to guests only and you are signed in to an account, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if(i&&"all"!==e.CustomerTagType){let t=discountNinja.Environment.Shopify.CustomerTags(),i=!1;if(t&&e.CustomerTags){let n=e.CustomerTags.split(",");for(let e=0;e<t.length;e++)for(let o=0;o<n.length;o++)t[e].toLowerCase().trim()===n[o].toLowerCase().trim()&&(i=!0)}if("include"===e.CustomerTagType&&!1===i&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because the signed in visitor is not tagged with one of the following tags: "+e.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1;if("exclude"===e.CustomerTagType&&!0===i&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because the signed in visitor is tagged with one of the following tags: "+e.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!n))return!1}let o=discountNinja.DateTime;if(i&&void 0!==e.MinimumSpend&&null!==e.MinimumSpend&&discountNinja.Environment.Shopify.CustomerSpend<=e.MinimumSpend)return!1;if(i&&void 0!==e.MinimumOrders&&null!==e.MinimumOrders&&discountNinja.Environment.Shopify.CustomerNumberOfOrders<=e.MinimumOrders)return!1;if(i&&void 0!==e.LastOrderBeforeDate&&null!==e.LastOrderBeforeDate&&!(o.DiffInSeconds(e.LastOrderBeforeDate,o.GetUtc(discountNinja.Environment.Shopify.LastOrderBeforeDate))<0))return!1;if(i&&void 0!==e.LastOrderAfterDate&&null!==e.LastOrderAfterDate&&!(o.DiffInSeconds(e.LastOrderAfterDate,o.GetUtc(discountNinja.Environment.Shopify.LastOrderBeforeDate))>=0))return!1;return!0}(e)&&!0},VisitorBehaviorConditionsAreMet:function(t){try{if("true"===discountNinja.Cache.SessionGet("trigger-conditions-met-"+t.Token))return!0;if(discountNinja.PromotionFlow.HasPopUpBeenShownForLevel(t))return!0;let e=t.Trigger;if(!e||"none"===e.Type)return!0;let n=null!==e.ScrollPercentage&&void 0!==e.ScrollPercentage&&!1!==e.ScrollPercentage,i=null!==e.PagesVisited&&void 0!==e.PagesVisited&&!1!==e.PagesVisited,o=null!==e.OnExitIntent&&void 0!==e.OnExitIntent&&!1!==e.OnExitIntent,r=null!==e.TimeOnPageInSeconds&&void 0!==e.TimeOnPageInSeconds&&!1!==e.TimeOnPageInSeconds;if(!(n||i||o||r))return!0;let a=!0,c=!0,s=!0,u=!0;r&&!function(t){let e=t.Trigger.TimeOnPageInSeconds,n=discountNinja.Cache.SessionGet("trigger-time-on-page");if(n&&!isNaN(n))return n>=e}(t)&&(a=!1),n&&!function(t){let e=t.Trigger.ScrollPercentage,n=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(n&&!isNaN(n))return n>=e}(t)&&(c=!1),i&&!function(t){let e=t.Trigger.PagesVisited,n=discountNinja.Cache.SessionGet("trigger-pages-visited");if(n&&!isNaN(n))return n>=e}(t)&&(s=!1),o&&!discountNinja.Utilities.IsMobilePhone()&&"true"!==discountNinja.Cache.SessionGet("trigger-exit-intent")&&(u=!1);let d="or"===e.Type?a||c||s||u:a&&c&&s&&u;return discountNinja.Cache.SessionSet("trigger-conditions-met-"+t.Token,d),d}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggerConditionsMet",t)}},WaitForTriggerConditions:function(t){function e(t,e){for(let n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}function n(t,i){if(o=t.Token,!("onceperdevice"==="oncepersession"?"false"===discountNinja.Cache.LocalGet("trigger-accepted-"+o):"false"===discountNinja.Cache.SessionGet("trigger-accepted-"+o))&&!function(t){if(void 0===t.CountdownClock||null===t.CountdownClock||void 0===t.CountdownClock.EndsAt||null===t.CountdownClock.EndsAt)return!1;let e=discountNinja.DateTime;return e.DiffInSeconds(e.GetUtc(t.CountdownClock.EndsAt),e.UtcNow())<=0}(t)&&discountNinja_Script_Trigger.FilterConditionsAreMet(t)&&discountNinja_Script_Trigger.ValidForPage(t)){discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is applicable on this page, checking visitor behavior conditions");for(let e=0;e<t.Offers.length;e++)i.push(t.Offers[e]);if(discountNinja_Script_Trigger.VisitorBehaviorConditionsAreMet(t)){discountNinja.Logging.LogInformation("FLOW: Trigger "+t.Token+" conditions met, displaying associated offers"),t.Triggered=!0;let e=[];for(let n=0;n<t.Offers.length;n++)e.push({trigger:t,offerToken:t.Offers[n]});discountNinja_Script_Trigger.TriggerOffers(e)}else discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" visitor behavior conditions not met, checking again in 500ms"),waitForTriggerConditionsTimeoutHandle=setTimeout(function(){n(t,i)},500)}else{discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is NOT applicable on this page, not applying offers");for(let n=0;n<t.Offers.length;n++){let o=discountNinja.Offer.GetOfferByToken(t.Offers[n]);o&&!e(o.Token,i)&&discountNinja.PromotionFlow.UnAcceptPromotion(o)}}var o}if(discountNinja.Logging.LogInformation("FLOW: Waiting for trigger conditions to be met"),!t||0===t.length)return discountNinja.PromotionFlow.StopFlow();let i=[];for(let e=0;e<t.length;e++){var o=t[e];!0!==o.Triggered&&n(o,i)}}},discountNinja_Script_Cart_Shopify={IsDirty:!1,ProcessingCartUpdate:!1,LockRefreshCart:!1,AddToCartButtonId:"LimoniAppsDiscountNinjaAddToCartButton",RegisteringAddToCart:!1,SubscribeDrawerCartOpened:function(){discountNinja.Events.Subscribe("DrawerCartOpened",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),jQuery(document).on("afterCartLoad.ajaxCart",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),setTimeout(function(){jQuery(document).on("afterCartLoad.ajaxCart",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened)},500),jQuery(document).on("ajaxCart.afterCartLoad",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),setTimeout(function(){jQuery(document).on("ajaxCart.afterCartLoad",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened)},500),jQuery(document).on("drawerOpen.CartDrawer",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),jQuery(document).on("drawerOpen.NavDrawer",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),jQuery(document).on("drawer_open_done",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),jQuery(document).on("cart.ready",function(t,e){discountNinja_Script_Cart_Shopify.OnDrawerCartOpened(t,e)}),jQuery(document).on("search:close",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened)},OnDrawerCartOpenedDebounced:function(t,e){discountNinja.DiscountedCart.SplitRowsInProcess||discountNinja.DiscountedCart.FreeGiftAdjustmentInProcess?discountNinja.Logging.LogVerbose("Split rows or free gift in process, canceling"):(discountNinja.Logging.LogInformation("Executing OnDrawerCartOpenedDebounced event"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout(),null==e?discountNinja.Cart.Shopify.IsDirty=!0:"object"==typeof window.discountNinjaContext&&(window.discountNinjaContext.Cart=e),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DynamicPricing.ClassicCartIsDirty=!0,discountNinja.DynamicPricing.DrawerCartIsDirty=!0,discountNinja.DynamicPricing.UpdatePrice(!1,!0),discountNinja.DiscountCode.EnableDiscountCodeField(),discountNinja.DiscountCode.UpdateTags(),discountNinja.DiscountCode.LockDiscountCodeFieldIfRequired())},UpdateCart:function(t,e){function n(t,e,n){try{let t=decodeURI($("form").serialize()).split("&"),e=0;if(t&&t.length>0)for(let n=0;n<t.length;n++)try{let i=t[n].split("=");if("updates[]"===i[0]){let t=parseInt(i[1]),n=discountNinjaContext.Cart.items[e];t!==n.quantity&&(n.quantity=t,discountNinja.DiscountedCart.IsDirty=!0),e++}}catch(t){}}catch(t){}i(t,e,n)}function i(t,e,n){return discountNinja.LocalCartUpdatedEvent.Handle(null,t,e,null!==n),discountNinja_Script_Cart_Shopify.ProcessingCartUpdate=!1,null!=n&&"function"==typeof n?n():null}function o(t,e){if(discountNinja_Script_Cart_Shopify.ProcessingCartUpdate)return discountNinja.Logging.LogVerbose("Already handling cart update"),null!=t&&"function"==typeof t?t():null;{discountNinja.Logging.LogVerbose("Updating cart");let o=discountNinja.DeviceId.Get();discountNinja.XmlHttpRequest.Send("/cart.json?m="+o+"-"+discountNinja.DateTime.UnixTimestamp(),null,null,"get",!0,!0,function(o){discountNinja_Script_Cart_Shopify.IsDirty=!1,function(t,e,o){discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated"),discountNinja.DiscountedCart.IsDirty=!0,"object"==typeof window.discountNinjaContext&&(window.discountNinjaContext.Cart=t),discountNinja.Cache.LocalSet("cached-cart",JSON.stringify(t)),o?i(t,!0,e):n(t,!0,e)}(o,t,e),"object"==typeof CartJS&&(CartJS.cart=o)})}}try{if(null==e&&(e=!0),discountNinja_Script_Cart_Shopify.IsDirty)o(t,e);else{let r=function(){try{let t=discountNinja.Cache.LocalGet("cached-cart"),e="undefined"===t?null:JSON.parse(t);return e&&!e.items&&(e.items=[]),e}catch(t){return discountNinja.Logging.LogError("Cart.GetCartFromCache",t),null}}();!function(t){let e=discountNinja.LiquidData.Cart();if(!e||!t)return!0;if(e.token!==t.token)return!0;if(e.total_price!==t.total_price)return!0;if(e.items.length!==t.items.length)return!0;for(let n=0;n<t.items.length;n++){if(e.items[n].key!==t.items[n].key)return!0;if(e.items[n].quantity!==t.items[n].quantity)return!0}return!1}(r)?!function(t){let e=discountNinja_Script_DiscountedCart.DiscountedCart;return e||(e=discountNinja_Script_DiscountedCart.GetDiscountedCartFromCache()),!!e&&e.token===t.token&&Math.round(100*e.total_original_price)===t.original_total_price&&e.items.length===t.items.length}(r)?(discountNinja.Logging.LogVerbose("Cached cart content not in sync with discounted cart"),discountNinja.DiscountedCart.IsDirty=!0,e?i(r,!0,t):n(r,!0,t)):(discountNinja.Logging.LogVerbose("Not updating cart - not assumed dirty"),e?i(r,!1,t):n(r,!1,t)):(discountNinja.Logging.LogVerbose("Cached cart content does not match cart from liquid (server)"),o(t,e))}}catch(t){discountNinja.Logging.LogError("Cart.Shopify.UpdateCart",t)}},AddToCart:function(t,e,n,i){try{if(e<=0)return void discountNinja.Logging.LogVerbose("Not adding variant "+t+" to cart, quantity requested is zero.");"object"==typeof CartJS?CartJS.addItem(t,e,n,{success:function(e,n,o){discountNinja.Logging.LogVerbose("Variant "+t+" successfully added to the cart"),i&&i()}}):discountNinja.XmlHttpRequest.Send("/cart/add.js",null,{quantity:e,id:t,properties:n},"post",!0,!0,function(){discountNinja.Logging.LogInformation(e+" of variant "+t+" successfully added to the cart"),i&&i()})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.AddToCart",t)}},ChangeCartItemByKey:function(t,e,n,i){try{if("object"==typeof CartJS){let o=discountNinja.LiquidData.LineNumberByKey(t);o&&CartJS.updateItem(o,e,n,{success:function(n,o,r){discountNinja.Logging.LogVerbose("Key "+t+" quantity changed in cart to "+e),i&&i()}})}else{let o={id:t};null!=e&&(o.quantity=e),null!=n&&(o.properties=n),discountNinja.XmlHttpRequest.Send("/cart/change.js",null,o,"post",!0,!0,function(){discountNinja.Logging.LogInformation("Key "+t+" quantity changed in cart to "+e),i&&i()})}}catch(t){discountNinja.Logging.LogError("Cart.Shopify.ChangeCartItemByKey",t)}},OnAddToCart:function(t,e){try{discountNinja.Logging.LogVerbose("Handling add to cart");let n=discountNinja.Environment.Shopify.IsProductPage()?discountNinja.Environment.Shopify.ProductHandle():discountNinja.LiquidData.ProductHandleFromCart(e);if(null===n&&null!=t){let e=jQuery(t.target).closest("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle")||jQuery(t.target).find("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle");if(void 0===e){let e=jQuery(t.target).find('input[name="variantid"]').val()||jQuery(t.target).closest(".remodal-wrapper [data-id]").attr("data-id")||jQuery(t.target).find('input[name="id"]').val()||jQuery(t.target).find("button[data-variant-id]").attr("data-variant-id")||jQuery(t.target).find("button[data-variantid]").attr("data-variantid")||jQuery(t.target).find("button[data-id]").attr("data-id")||jQuery(t.target).find("a[data-variant-id]").attr("data-variant-id")||jQuery(t.target).find("a[data-variantid]").attr("data-variantid")||jQuery(t.target).find("a[data-id]").attr("data-id");void 0!==e&&(discountNinja.Logging.LogVerbose("OnAddToCart found variant: "+e+" in the form"),n=discountNinja.LiquidData.ProductHandleFromCart(e))}else discountNinja.Logging.LogVerbose("OnAddToCart found product handle from data attribute: "+e),n=e}null===n?discountNinja.Logging.LogVerbose("OnAddToCart could not find a product handle"):discountNinja.Logging.LogVerbose("OnAddToCart found product handle "+n);let i=null;return null!==n&&(i=discountNinja.Offer.GetOfferForProduct(n,null,null,null,null,null,!1,!1),discountNinja.ProductData.SaveOnAddToCart(n)),i?(discountNinja.PromotionEvent.AddToQueue(i.TriggeredByTrigger,2),discountNinja.Logging.LogVerbose("OnAddToCart tracked product with handle "+n+" is in offer with token "+i.Token)):discountNinja.Logging.LogVerbose("OnAddToCart could not find a offer for product with handle "+n),!0}catch(t){return discountNinja.Logging.LogError("Cart.Shopify.OnAddToCart",t),!0}},OnUpdateCart:function(){try{discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Logging.LogVerbose("Restart flow to handle update to cart"),discountNinja.PromotionFlow.StartFlow(),setTimeout(function(){discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart after update cart");let t=discountNinja.Settings.Settings;discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t)},1e3)})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.OnUpdateCart",t)}},RegisterEventHandlerForAddToCart:function(){function t(t,e){try{e&&function(t){try{void 0!==t&&t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.cancelDefaultBehaviorCheckoutButton",t)}}(t),discountNinja.Cart.Shopify.OnAddToCart(),e&&jQuery("#"+discountNinja_Script_Cart_Shopify.AddToCartButtonId).click()}catch(t){discountNinja.Logging.LogError("Cart.Shopify.RegisterAddToCartHook.onAddToCart",t)}}try{discountNinja.Logging.LogVerbose("Registering event handler for cart/add");let e=jQuery('form[action^="/cart/add"]').not(".limoniapps-discountninja-ignore"),n=discountNinja.Settings.GetFlag("EnableAddToCartHook");if(n?e.each(function(){let t=$('<input id="'+discountNinja_Script_Cart_Shopify.AddToCartButtonId+'" type="submit" name="add" style="display:none" class="limoniapps-discountninja-ignore">');jQuery(this).append(t)}):e.on("submit.discountNinja.cart",function(e){t(e,!1)}),n){let n=e.find(':submit[name="add"], :submit[value="add"], :submit[value="Add"], :submit[value="ADD"]').not(".limoniapps-discountninja-ignore");n.off(".discountNinja.cart"),n.each(function(){jQuery(this).on("click.discountNinja.cart",function(e){t(e,!0)})})}}catch(t){discountNinja.Logging.LogError("Cart.Shopify.RegisterEventHandlerForAddToCart",t)}}},discountNinja_Script_TemplateParameterEngine={Replace:function(t,e,n){if(!t||!e)return t;let i=new RegExp("\\[\\["+e+"\\]\\]","g");return t.replace(i,n||"")}},discountNinja_Script_ActionButton={HideIfNecessary:function(t,e,n){try{let i=!1;"applydiscount"===t.Action&&discountNinja.Offer.IsOfferAccepted(e.Token,e.Frequency)&&(i=!0);let o="hasaction"+n,r=discountNinja.StickyBar.GetWrapperElement().find(".limoniapps-sticky-bar");i?r.removeClass(o):r.addClass(o)}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},HandleAction:function(t,e,n){try{if("redirect"===t.Action){let e=t.OpenInNewTab?"_blank":"_self";window.open(t.RedirectUrl,e)}else"applydiscount"===t.Action&&(discountNinja.PromotionFlow.ClearCartAdjustments(),discountNinja.PromotionFlow.AcceptPromotion(e,n),discountNinja.PromotionFlow.StopFlow())}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},ReplacePlaceHoldersForButton:function(t,e,n,i,o){try{if(!o)return t;let r=discountNinja.ShortCode.ReplaceAllPlaceHolders(e,discountNinja.TextSettings.GetText(o.Text,e),n),a=discountNinja.TextSettings.WrapInColor(o.TextColor,r),c="ACTIONBUTTON"+i;return t=discountNinja.TemplateParameter.Replace(t,c+"_STYLE",o.Style?o.Style:""),t=discountNinja.TemplateParameter.Replace(t,c+"_SIZE",o.Size?o.Size:""),t=discountNinja.TemplateParameter.Replace(t,c+"_LABEL",a),t=discountNinja.TemplateParameter.Replace(t,c+"_ACTION",o.Action?o.Action:"")}catch(e){return discountNinja.Logging.LogError("ActionButton.ReplacePlaceHoldersForButton",e),t}}},discountNinja_Script_Prerequisite={PrerequisiteItemsInCart:function(t,e,n){return function(){if(e.Prerequisite.MinimumItems){if("*"===t.Prerequisite.PrerequisiteCollections)return n?discountNinja.LiquidData.QuantityInCartExcludingGifts(t.Prerequisite.PrerequisiteExcludeCollections):discountNinja.LiquidData.QuantityInCart(t.Prerequisite.PrerequisiteExcludeCollections);if(t.Prerequisite.PrerequisiteCollections)return discountNinja.LiquidData.QuantityInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections,n);if(t.Prerequisite.PrerequisiteProducts)return discountNinja.LiquidData.QuantityInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections,n)}return null}()||function(){if(e.Prerequisite.MinimumAmount){let i=0;return"*"===t.Prerequisite.PrerequisiteCollections?i=n?discountNinja.LiquidData.ValueInCartExcludingGifts(t.Prerequisite.PrerequisiteExcludeCollections):discountNinja.LiquidData.ValueInCart(t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteCollections?i=discountNinja.LiquidData.ValueInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections,n):t.Prerequisite.PrerequisiteProducts&&(i=discountNinja.LiquidData.ValueInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections,n)),e.Prerequisite.MaximumAmount&&i>100*e.Prerequisite.MaximumAmount?null:Math.floor(i/100/e.Prerequisite.MinimumAmount)}return null}()||0},EntitledQuantity:function(t,e){function n(){let n=e.Entitlement.EntitledQuantity,i=e.Prerequisite.BogoPrerequisiteQuantity||1,o=discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(t,e);n*=Math.floor(o/i);let r=t.Entitlement.AllocationLimit;r>0&&(n=Math.min(n,r));let a=t.AttributedQuantity||0;return n=Math.max(0,n-a)}if(e&&e.Entitlement&&e.Entitlement.EntitledQuantity&&(e.Prerequisite.BogoPrerequisiteQuantity&&e.Prerequisite.BogoPrerequisiteQuantity>0||e.Prerequisite.MinimumAmount&&e.Prerequisite.MinimumAmount>0)){return t.Bogo&&!0===t.Bogo.AddToCartAutomatically?function(){var i=discountNinja.LiquidData.GetQuantityFromItems(discountNinja.LiquidData.CartItemsByProperty(discountNinja.DiscountedCart.FreeGiftPrefix+t.Token));if(0===i)return n();{let n=discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(t,e,!1),o=e.Prerequisite.BogoPrerequisiteQuantity||1,r=e.Entitlement.EntitledQuantity,a=(n+i)/(o+r),c=Math.floor(a*r),s=t.Entitlement.AllocationLimit;s>0&&(c=Math.min(c,s));let u=t.AttributedQuantity||0;return Math.max(0,c-u)}}():n()}if(t&&t.Entitlement&&t.Entitlement.AllocationLimit){let e=t.Entitlement.AllocationLimit,n=t.AttributedQuantity||0,i=Math.max(0,e-n);return Math.min(i,e)}return null}},discountNinja_Script_DeviceId={Get:function(){let t=discountNinja.Cache.LocalGet("limoniapps.deviceid.v2");return null===t&&(t="_"+(new Date).getTime()+"_"+function(){let t="";try{t=window.crypto&&"function"==typeof window.crypto.getRandomValues?window.crypto.getRandomValues(new Uint32Array(1))[0]:Math.random().toString().slice(2)}catch(e){t=Math.random().toString().slice(2)}return t}(),discountNinja.Cache.LocalSet("limoniapps.deviceid.v2",t)),t}};if(void 0===discountNinja)var discountNinja={Badge:discountNinja_Script_Badge,Cache:discountNinja_Script_Cache,Cart:{Shopify:discountNinja_Script_Cart_Shopify},Checkout:{Shopify:discountNinja_Script_Checkout_Shopify},Cookie:discountNinja_Script_Cookie,Core:discountNinja_Script_Core,DateTime:discountNinja_Script_DateTime,DiscountCode:discountNinja_Script_DiscountCode,DiscountCodeTrigger:discountNinja_Script_DiscountCodeTrigger,DiscountedCart:discountNinja_Script_DiscountedCart,DiscountedProduct:discountNinja_Script_DiscountedProduct,DiscountTier:discountNinja_Script_DiscountTier,DynamicPricing:discountNinja_Script_DynamicPricing,Environment:{Shopify:discountNinja_Script_Environment_Shopify},LiquidData:discountNinja_Script_LiquidData,Logging:discountNinja_Script_Logging,MultiCurrency:discountNinja_Script_MultiCurrency,Notification:discountNinja_Script_Notification,PopUp:discountNinja_Script_PopUp,ProductData:discountNinja_Script_ProductData,Offer:discountNinja_Script_Offer,PromotionEvent:discountNinja_Script_PromotionEvent,PromotionFlow:discountNinja_Script_PromotionFlow,QueryParameter:discountNinja_Script_QueryParameter,Settings:discountNinja_Script_Settings,ShortCode:discountNinja_Script_ShortCode,StickyBar:discountNinja_Script_StickyBar,TabReminder:discountNinja_Script_TabReminder,TestMode:discountNinja_Script_TestMode,TextSettings:discountNinja_Script_TextSettings,Timer:discountNinja_Script_Timer,Token:discountNinja_Script_Token,Trigger:discountNinja_Script_Trigger,Utilities:discountNinja_Script_Utilities,TextScaling:discountNinja_Script_TextScaling,TemplateParameter:discountNinja_Script_TemplateParameterEngine,VariantChange:discountNinja_Script_VariantChange,XmlHttpRequest:discountNinja_Script_XmlHttpRequest,Events:discountNinja_Script_Events,VariantChangedEvent:discountNinja_Script_VariantChangedEvent,ServerCartItemsAddedEvent:discountNinja_Script_ServerCartItemsAddedEvent,ServerCartItemsChangedEvent:discountNinja_Script_ServerCartItemsChangedEvent,ServerCartItemsUpdatedEvent:discountNinja_Script_ServerCartItemsUpdatedEvent,ServerCollectionProductsPageLoadedEvent:discountNinja_Script_ServerCollectionProductsPageLoadedEvent,LocalCartUpdatedEvent:discountNinja_Script_LocalCartUpdatedEvent,ActionButton:discountNinja_Script_ActionButton,Prerequisite:discountNinja_Script_Prerequisite,DeviceId:discountNinja_Script_DeviceId,Currency:discountNinja_Script_Currency};history.pushState=function(t){return function(){var e=t.apply(this,arguments);return window.dispatchEvent(new Event("pushState")),window.dispatchEvent(new Event("limoniapps-discountninja-locationchange")),e}}(history.pushState),history.replaceState=function(t){return function(){var e=t.apply(this,arguments);return window.dispatchEvent(new Event("replaceState")),window.dispatchEvent(new Event("limoniapps-discountninja-locationchange")),e}}(history.replaceState),window.addEventListener("popstate",function(){window.dispatchEvent(new Event("limoniapps-discountninja-locationchange"))}),window.addEventListener("limoniapps-discountninja-locationchange",function(){var t=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1);(t=discountNinja.QueryParameter.RemoveFromUrl(t,"discountninjalog",1))!==discountNinja.Core.CurrentLocation&&(discountNinja.Core.CurrentLocation=t,setTimeout(function(){discountNinja.Core.Start()},1500))}),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterInject=discountNinja.Utilities.Debounce(function(){discountNinja.DynamicPricing.UpdatePrice(!1,!0)},250),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate=discountNinja.Utilities.Debounce(function(){discountNinja.DynamicPricing.UpdatePrice(!1,!1)},500),discountNinja.PromotionEvent.ProcessQueue=discountNinja.Utilities.Debounce(function(){discountNinja.PromotionEvent.ProcessQueueDebounced()},250),discountNinja.Trigger.ProcessOffersToTrigger=discountNinja.Utilities.Debounce(function(){discountNinja.Trigger.ProcessOffersToTriggerDebounced()},100),discountNinja.Cart.Shopify.OnDrawerCartOpened=discountNinja.Utilities.Debounce(function(t,e){discountNinja.Cart.Shopify.OnDrawerCartOpenedDebounced(t,e)},250),discountNinja.DOMHasLoaded=!1,discountNinja.Core.ExecuteOnLoadCallback(),discountNinja.Core.Start(!0)}